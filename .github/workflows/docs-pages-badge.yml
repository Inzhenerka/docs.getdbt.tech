name: Docs total pages badge (gist)

on:
  push:
    branches: ["current"]
    paths:
      - "website/**"
      - "**/*.md"
  schedule:
    - cron: "0 6 * * *"   # optional: daily refresh
  workflow_dispatch:

jobs:
  make-badge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Ensure jq
        run: |
          command -v jq >/dev/null || { sudo apt-get update && sudo apt-get install -y jq; }

      - name: Count .md in website/docs + website/snippets
        id: count
        shell: bash
        run: |
          count() { [[ -d "$1" ]] && find "$1" -type f -iname "*.md" \
            -not -path "*/_partials/*" -not -path "*/_includes/*" -not -path "*/_components/*" \
            | wc -l | tr -d ' ' || echo 0; }
          DOCS=$(count website/docs)
          SNIPS=$(count website/snippets)
          echo "total=$((DOCS + SNIPS))" >> "$GITHUB_OUTPUT"

      - name: Update badge JSON in Gist
        uses: schneegans/dynamic-badges-action@v1.7.0
        with:
          auth: ${{ secrets.GIST_TOKEN }}
          gistID: 618181e9b63cd72035c4eef203705cec
          filename: docs_total.json
          label: docs total
          message: ${{ steps.count.outputs.total }}
          color: informational
          cacheSeconds: 3600
