name: Docs total pages badge (gist)

on:
  push:
    branches: ["test-badge"]        # change to "current" for prod
    paths:
      - "website/**"
      - "**/*.md"
      - "**/*.mdx"
  workflow_dispatch:

jobs:
  make-badge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Ensure jq
        run: |
          command -v jq >/dev/null || { sudo apt-get update && sudo apt-get install -y jq; }

      - name: Count .md + .mdx in website/docs + website/snippets
        id: count
        shell: bash
        run: |
          set -euo pipefail
          count() {
            [[ -d "$1" ]] && find "$1" -type f \( -iname "*.md" -o -iname "*.mdx" \) \
            | wc -l | tr -d ' ' || echo 0
          }
          DOCS=$(count website/docs)
          SNIPS=$(count website/snippets)
          TOTAL=$((DOCS + SNIPS))
          echo "Docs: $DOCS"; echo "Snippets: $SNIPS"; echo "TOTAL: $TOTAL"
          echo "total=${TOTAL}" >> "$GITHUB_OUTPUT"

      - name: Update badge JSON in Gist
        uses: schneegans/dynamic-badges-action@v1.7.0
        with:
          auth: ${{ secrets.GIST_TOKEN }}
          gistID: 618181e9b63cd72035c4eef203705cec
          filename: docs_total.json
          label: docs total
          message: ${{ steps.count.outputs.total }}
          color: informational
          cacheSeconds: 3600

          
