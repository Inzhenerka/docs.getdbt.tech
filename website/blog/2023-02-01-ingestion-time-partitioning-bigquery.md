---
title: "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ BigQuery —Å dbt"
description: "–ö–∞–∫ –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏–ª–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ BigQuery (–∞ –∑–Ω–∞—á–∏—Ç –∏ –∑–∞—Ç—Ä–∞—Ç—ã), –¥–æ–±–∞–≤–∏–≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π dbt."
slug: bigquery-ingestion-time-partitioning-and-partition-copy-with-dbt
canonical_url: https://medium.com/teads-engineering/bigquery-ingestion-time-partitioning-and-partition-copy-with-dbt-cc8a00f373e3

authors: [christophe_oudar]

tags: [analytics craft]
hide_table_of_contents: false

date: 2023-03-10
is_featured: true
---

–í Teads –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º BigQuery (BQ) –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å 2017 –≥–æ–¥–∞. –ö–∞–∫ –±—ã–ª–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π [—Å—Ç–∞—Ç—å–µ](https://medium.com/teads-engineering/give-meaning-to-100-billion-analytics-events-a-day-d6ba09aa8f44), –º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ–Ω–≤–µ–π–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤–µ—Ä—Ç–∫–∏, –∞–≥—Ä–µ–≥–∏—Ä—É–µ–º—ã–µ –≤ –≤–∏—Ç—Ä–∏–Ω–∞—Ö –¥–∞–Ω–Ω—ã—Ö. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –Ω–∏—Ö –≤—Ä–∞—â–∞—é—Ç—Å—è –≤–æ–∫—Ä—É–≥ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤, –∏ –ø–æ—ç—Ç–æ–º—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ —á–∞—Å—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–º –ø–æ–¥—Ö–æ–¥–æ–º.

<!--truncate-->

–ù–∞ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≤ BQ –±—ã–ª–æ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–Ω–µ–≤–Ω–æ–º —É—Ä–æ–≤–Ω–µ. –î—Ä—É–≥–∏–µ —É—Ä–æ–≤–Ω–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏. –≠—Ç–æ –≤—Å–µ –µ—â–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ 4096 –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–æ—á–∞—Å–æ–≤—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç 170 –¥–Ω—è–º.

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –æ–±–µ—Ä–Ω—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π –≤ BigQuery, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ dbt Labs (—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞–∫ Fishtown Analytics) —Å–æ–∑–¥–∞–≤–∞–ª–∞ —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç: dbt. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –≤ 2021 –≥–æ–¥—É dbt —Å—Ç–∞–ª —á–∞—Å—Ç—å—é –Ω–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤ BigQuery –≤ Teads. –•–æ—Ç—è –µ–º—É –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π, –æ–Ω —Å—Ç–∞–ª –Ω–∞–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –Ω–∞—à–µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

–ö–æ–≥–¥–∞ –≤ BQ –±—ã–ª–æ –≤—ã–ø—É—â–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º, –∏ dbt –æ—Ç–¥–∞–ª –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ [–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏](/docs/build/incremental-models), –º—ã –≤—ã—è–≤–∏–ª–∏ –æ–¥–∏–Ω —Å–ª—É—á–∞–π, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –±—ã–ª —Ö–æ—Ä–æ—à–æ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω: [—Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é](https://github.com/dbt-labs/dbt-bigquery/issues/75).

üéâ **–ú—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∫–æ–Ω—Ü–∞ 2021 –≥–æ–¥–∞ –∏ –Ω–∞–∫–æ–Ω–µ—Ü —Å–º–æ–≥–ª–∏ [–≤–ª–∏—Ç—å –Ω–∞—à –≤–∫–ª–∞–¥](https://github.com/dbt-labs/dbt-bigquery/pull/136) –≤–æ –≤—Ä–µ–º—è Coalesce 2022!**

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

–¢–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º —Å `TIMESTAMP`. –ú—ã –º–æ–∂–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–Ω–æ—Å—è—Ç —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏:

- –í —Ç–∞–±–ª–∏—Ü–∞—Ö —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —É –Ω–∞—Å –µ—Å—Ç—å –ø—Å–µ–≤–¥–æ—Å—Ç–æ–ª–±–µ—Ü `TIMESTAMP`, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π `_PARTITIONTIME`. –≠—Ç–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –≤–µ—Å–µ —Ç–∞–±–ª–∏—Ü—ã, —á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –ø–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ —É –≤–∞—Å –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–≥–æ–¥–Ω–æ. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `_PARTITIONDATE`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —É—Å–µ—á–µ–Ω–Ω—ã–µ –¥–æ —É—Ä–æ–≤–Ω—è –¥–Ω—è —Å —Ç–∏–ø–æ–º `DATE`.
- –í—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏, –≤–∫–ª—é—á–∞—é—â–∏—Ö –ø—Å–µ–≤–¥–æ—Å—Ç–æ–ª–±–µ—Ü, —Ç–∞–∫–∂–µ –¥–µ—à–µ–≤–ª–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç–æ–ª–±–µ—Ü –Ω–µ —Ç–∞—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è. –ú—ã —Ç–∞–∫–∂–µ –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã, —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–æ–ª–±—Ü–∞–º —Ä–∞–∑–¥–µ–ª–æ–≤, –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–æ—Ç–æ–≤. –ü–æ—ç—Ç–æ–º—É, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏ –º—ã "–æ–ø–ª–∞—Ç—É –ø–æ –º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è" –∏–ª–∏ "—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞–≤–∫—É", –º—ã –≤—ã–∏–≥—Ä—ã–≤–∞–µ–º —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
- –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ/–≤—Å—Ç–∞–≤–∫–µ, –º—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º. –û–¥–Ω–∞–∫–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–∏—è–Ω–∏–µ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª–æ–≤ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏.
- –ú—ã –Ω–µ –º–æ–∂–µ–º –≤—ã–±—Ä–∞—Ç—å –ø—Å–µ–≤–¥–æ—Å—Ç–æ–ª–±–µ—Ü –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ `GROUP BY`, –∏ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–º—è —Å—Ç–æ–ª–±—Ü–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –∏ –º—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å–≤–æ–∏—Ç—å –µ–º—É –ø—Å–µ–≤–¥–æ–Ω–∏–º.
- –ú—ã –Ω–µ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CREATE TABLE ‚Ä¶ AS SELECT ‚Ä¶` –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏; —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω, –ø–æ—á–µ–º—É dbt –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª –∏—Ö —Å–Ω–∞—á–∞–ª–∞ —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π. –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `PARTITION BY` –∏ –∑–∞—Ç–µ–º –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –µ—Å–ª–∏ –¥–ª–∏–Ω–∞ —Ä–∞–∑–¥–µ–ª–∞ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã –º–µ–Ω—å—à–µ 1 –º–∏–ª–ª–∏–æ–Ω–∞ —Å—Ç—Ä–æ–∫, –≤–∞–º –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ dbt

> –°–ª–µ–¥—É—é—â–µ–µ —Ç—Ä–µ–±—É–µ—Ç dbt bigquery v1.4+

–ö–æ–≥–¥–∞ –º—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∫–æ–º–∞–Ω–¥–æ–π dbt Labs, –º—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–ª–∏—Å—å –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –Ω–∞ —Ç–æ–º, –∫–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ—Å—à–æ–≤–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π.

–û–¥–Ω–æ–π –∏–∑ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∏, –∫ —Å—á–∞—Å—Ç—å—é, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `MERGE` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏. –≠—Ç–æ —Ç–∞–∫–∂–µ –ø–æ–¥—Ö–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π [–∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–º dbt BigQuery](/docs/core/connect-data-platform/bigquery-setup).

–°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∫—Ä—ã—Ç–∞ –≤ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–µ, –∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ–Ω—å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –º–æ–¥–µ–ª—å —Å —Å–ª–µ–¥—É—é—â–∏–º SQL:

```sql
{{ config(
    materialized = 'incremental',
    incremental_strategy = 'insert_overwrite',
    partition_by = {
      "field": "day",
      "data_type": "date"
    }
) }}

select
    day,
    campaign_id,
    NULLIF(COUNTIF(action = 'impression'), 0) impressions_count
from {{ source('logs', 'tracking_events') }}
```

–ù–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏: `"time_ingestion_partitioning": true`

```sql
{{ config(
    materialized = 'incremental',
    incremental_strategy = 'insert_overwrite',
    partition_by = {
      "field": "day",
      "data_type": "date",
      "time_ingestion_partitioning": true
    }
) }}

select
    day,
    campaign_id,
    NULLIF(COUNTIF(action = 'impression'), 0) impressions_count
from {{ source('logs', 'tracking_events') }}
```

–†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã –±—É–¥–µ—Ç:

```yaml
campaign_id INT64
impressions_count INT64
```

–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –¥–∞–Ω–Ω—ã–µ —Å—Ç–æ–ª–±—Ü–∞ day –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –ø—Å–µ–≤–¥–æ—Å—Ç–æ–ª–±–µ—Ü `_PARTITIONTIME`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤–∏–¥–µ–Ω –≤ —Å—Ö–µ–º–µ —Ç–∞–±–ª–∏—Ü—ã. –í–Ω—É—Ç—Ä–∏ dbt –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä `MERGE`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É. –≠—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω–∞—à –≤—ã—Ö–æ–¥–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–µ–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª–æ–≤ –∏/–∏–ª–∏ –≤–∞—à–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è - `incremental_overwrite`.

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã MERGE –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ—á–∞—Å–æ–≤—ã–º/–¥–Ω–µ–≤–Ω—ã–º —Å–≤–µ—Ä—Ç–∫–æ–π, —Ç–æ –∑–∞–ø–∏—Å—å –≤ —è–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª –≥–æ—Ä–∞–∑–¥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º `MERGE`.

–£ –Ω–∞—Å –±—ã–ª–∞ –∑–∞–¥–∞—á–∞ —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ —Å—Ç—Ä–æ–∫, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –º—ã —Å—Ä–∞–≤–Ω–∏–ª–∏ –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞ –∏ –∏–∑–º–µ—Ä–∏–ª–∏:

- 43 –º–∏–Ω—É—Ç—ã —Å –ø–æ–¥—Ö–æ–¥–æ–º `MERGE`, –∏—Å–ø–æ–ª—å–∑—É—è dbt
- 26 –º–∏–Ω—É—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∑–∞–ø—Ä–æ—Å–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è `WRITE_TRUNCATE` –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞

–≠—Ç–æ —Ä–∞–∑–Ω–∏—Ü–∞ –≤ 17 –º–∏–Ω—É—Ç, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ—á—Ç–∏ 40% –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `MERGE` —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É.

–ö–æ–Ω–µ—á–Ω–æ, –æ–ø–µ—Ä–∞—Ç–æ—Ä `MERGE` –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏, —á–µ–º –∑–∞–ø—Ä–æ—Å `WRITE_TRUNCATE`. –û–¥–Ω–∞–∫–æ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã - –∏, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –ª–∏–±–æ —Ü–µ–ª–µ–≤–æ–π —Ä–∞–∑–¥–µ–ª –ø—É—Å—Ç, –ª–∏–±–æ –Ω–∞–º, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥, —á—Ç–æ–±—ã —ç—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤.

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ü–æ–¥—Ö–æ–¥ dbt –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏/–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `insert_overwrite` –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Å–ª–µ–¥—É—é—â–∏–π:

- –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `on_schema_change`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä `MERGE`, —á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ —Ü–µ–ª–µ–≤—É—é

–ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `MERGE`, –µ—Å—Ç—å 2 —Ä–µ—à–µ–Ω–∏—è:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä `SELECT` –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Ä–∞–∑–¥–µ–ª–∞ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ, —á—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—è `WRITE_TRUNCATE`
- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é, –∏—Å–ø–æ–ª—å–∑—É—è –¥—Ä–∞–π–≤–µ—Ä BigQuery

–í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ –æ–¥–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ –∑–∞ —Ä–∞–∑, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å—é –º–æ–¥–µ–ª–∏, –µ—Å–ª–∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª–æ–≤.

–ù–∞ —Ä–∞–∑–¥–µ–ª–µ —Ä–∞–∑–º–µ—Ä–æ–º 192 –ì–ë –≤–æ—Ç –∫–∞–∫ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

<Lightbox src="/img/blog/2023-02-01-ingestion-time-partitioning-bigquery/merge-vs-select.png" />

–¢–∞–∫–∂–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä `SELECT` –ø–æ—Ç—Ä–µ–±–∏–ª –±–æ–ª–µ–µ 10 —á–∞—Å–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–æ—Ç–æ–≤, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä `MERGE` –∑–∞–Ω—è–ª –¥–Ω–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–æ—Ç–æ–≤.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è BQ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –æ—á–µ–≤–∏–¥–µ–Ω. –≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –≤—ã–±—Ä–∞–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞ BQ –Ω–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—é `insert_overwrite`.

–•–æ—Ç—è —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –µ—Å—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –º—ã –ù–ï —Ö–æ—Ç–∏–º –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- –ï—Å–ª–∏ —É –Ω–∞—Å –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–¥–µ–ª, —Å–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü–µ, –≤—ã–≥–æ–¥—ã –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã
- –ï—Å–ª–∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ –º–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–æ–≤, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤ –¥—Ä—É–≥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, –Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤—Å–µ –µ—â–µ –Ω–µ —É–ª—É—á—à–∏—Ç—å—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `MERGE`.
- –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–º–µ–Ω–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤, —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–µ –ø–æ–¥–æ–π–¥–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ —Å dbt

> –°–ª–µ–¥—É—é—â–µ–µ —Ç—Ä–µ–±—É–µ—Ç dbt bigquery v1.4+

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –º–æ–¥–µ–ª—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ –≤–º–µ—Å—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `MERGE`, –¥–∞–≤–∞–π—Ç–µ –≤–æ–∑—å–º–µ–º —Ç—É –∂–µ –º–æ–¥–µ–ª—å, —á—Ç–æ –∏ —Ä–∞–Ω–µ–µ:

```sql
{{ config(
    materialized = 'incremental',
    incremental_strategy = 'insert_overwrite',
    partition_by = {
      "field": "day",
      "data_type": "date"
    }
) }}

select
    day,
    campaign_id,
    NULLIF(COUNTIF(action = 'impression'), 0) impressions_count
from {{ source('logs', 'tracking_events') }}
```

–°–Ω–æ–≤–∞ –Ω–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é —Ä–∞–∑–¥–µ–ª–æ–≤: `"copy_partitions": true`

```sql
{{ config(
    materialized = 'incremental',
    incremental_strategy = 'insert_overwrite',
    partition_by = {
      "field": "day",
      "data_type": "date",
      "copy_partitions": true
    }
) }}

select
    day,
    campaign_id,
    NULLIF(COUNTIF(action = 'impression'), 0) impressions_count
from {{ source('logs', 'tracking_events') }}
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –¥—Ä–∞–π–≤–µ—Ä–∞ BQ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–µ—Å—à–æ–≤–Ω–æ–π.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ - –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–±–∏—Ç—å—Å—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π**. –ö–æ–Ω–µ—á–Ω–æ, –±—ã–ª–æ –±—ã –ø—Ä–æ—â–µ, –µ—Å–ª–∏ –±—ã –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—ã–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å SQL –∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ —Ä–∞–±–æ—Ç—ã –≤–æ–∫—Ä—É–≥ SQL —è–∑—ã–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö BigQuery –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞.

–ù–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ø–æ–¥—Ö–æ–¥—É dbt –∏ –∫–æ–º–∞–Ω–¥–µ dbt Labs, **—É –Ω–∞—Å –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —ç—Ç–∏—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –µ–µ –±–æ–ª—å—à–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π BigQuery.

–ù–∞–∫–æ–Ω–µ—Ü, —è —Ö–æ—Ç–µ–ª –±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è [–ø–æ—Å—Ç–æ–º –î–∂–µ—Ä–µ–º–∏ –ö–æ—ç–Ω–∞](https://discourse.getdbt.com/t/bigquery-dbt-incremental-changes/982), –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–µ –∏–¥–µ–∏, —á—Ç–æ–±—ã **–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é** –∏ –µ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π.

---

**–ï—Å–ª–∏ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–æ–ª—å—à–∏—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö –∏ –≤—ã –∏—â–µ—Ç–µ –Ω–æ–≤—ã–π –≤—ã–∑–æ–≤**, –≤–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –Ω–∞—à–∏ [–≤–∞–∫–∞–Ω—Å–∏–∏ –≤ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ](https://engineering.teads.com/jobs/) –≤ Teads.

üéÅ –ï—Å–ª–∏ —ç—Ç–∞ —Å—Ç–∞—Ç—å—è –±—ã–ª–∞ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º —Å—Ç–æ–∏—Ç –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ [BQ Booster](https://bqbooster.kayrnt.fr/), –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä—É—é —è —Å–æ–∑–¥–∞—é, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º BigQuery —É–ª—É—á—à–∏—Ç—å –∏—Ö –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É.