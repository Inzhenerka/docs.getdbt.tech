---
title: "Представляем коллекцию Postman для API dbt Cloud: инструмент для масштабирования управления аккаунтами"
description: "Откройте для себя мощные конечные точки dbt Cloud с этой коллекцией Postman, созданной архитектором решений Мэттом Уинклером."
slug: dbt-cloud-api-postman-collection-announcement

authors: [matt_winkler]

tags: [dbt tutorials]
hide_table_of_contents: false

date: 2022-05-10
is_featured: true
---
>:question: Для кого это:
>Это для опытных пользователей dbt Cloud, которые хотят расширить свои знания об API dbt с помощью интерактивной коллекции Postman. Мы рекомендуем углубляться в это только после того, как у вас будет прочное знание dbt + dbt Cloud. У вас есть несколько вариантов для изучения коллекции:
>
>* получите актуальную версию коллекции через [![Run in Postman](https://run.pstmn.io/button.svg)](https://god.gw.postman.com/run-collection/14183654-892ae7dc-e6a2-4165-8b57-1545dd69e4aa?action=collection%2Ffork&collection-url=entityId%3D14183654-892ae7dc-e6a2-4165-8b57-1545dd69e4aa%26entityType%3Dcollection%26workspaceId%3D048d09df-b9b5-4794-ad11-d0453ec3ecc4).
>* ознакомьтесь с [документацией коллекции](https://documenter.getpostman.com/view/14183654/UyxohieD#93c57cbf-3cb9-4c14-8c9a-278c19c5d6f1), чтобы узнать, как ее использовать.

API dbt Cloud имеет хорошо документированные конечные точки для создания, запуска и управления заданиями dbt Cloud. Но есть и другие конечные точки, которые еще не так хорошо документированы, но они чрезвычайно полезны для конечных пользователей. Эти конечные точки, предоставляемые API, позволяют организациям не только оркестрировать задания, но и управлять своими аккаунтами dbt Cloud программно. Это создает действительно интересные возможности для организаций по масштабированию их внедрений dbt Cloud.

Основная цель этой статьи — распространить информацию об этих конечных точках, пока документация еще создается, и показать вам, как их использовать.

<!--truncate-->

Вы можете использовать этот пост в блоге как точку входа в эту [коллекцию Postman](https://documenter.getpostman.com/view/14183654/UVsSNiXC#auth-info-7ad22661-8807-406b-aec0-34a46b671aac), чтобы помочь вам автоматизировать ранее ручные задачи, такие как управление инфраструктурой аккаунта dbt Cloud, создание проектов dbt Cloud, подключений к базам данных и управление пользователями.

Пожалуйста, имейте в виду, что коллекция не является постоянно актуальной документацией. Мы активно разрабатываем и обновляем конечные точки API, используемые для взаимодействия с dbt Cloud, поэтому URL-адреса конечных точек и/или ожидаемые форматы запросов могут измениться. Каждая конечная точка в коллекции предоставляет возможности для комментариев, поэтому, пожалуйста, сообщайте нам там, если что-то выглядит неправильно.

С учетом всего сказанного, почему пользователям dbt стоит заботиться об автоматизации управления аккаунтами dbt Cloud?

## Какие проблемы решает программное управление аккаунтами dbt Cloud?

При первом изучении dbt Cloud и работе в меньшем масштабе большинство конечных пользователей склонны предпочитать ручные, основанные на графическом интерфейсе рабочие процессы для создания и управления инфраструктурой своих аккаунтов. Многие из наших клиентов начинают с этого, но обычно они сталкиваются с этими узкими местами по мере увеличения количества заданий и проектов. Вот некоторые примеры узких мест, о которых я слышу от наших растущих клиентов.

- «Я трачу время на ручное прокликивание интерфейса для управления инфраструктурой, особенно после развертывания более чем нескольких проектов и сред.»
- «Я не уверен, что моя производственная среда настроена именно так, как задумано. Если новый член команды удалит или изменит что-то, мне придется устраивать пожарную тревогу, чтобы это исправить.»
- «Моя организация требует, чтобы я проводил любые изменения конфигурации среды через код-ревью и контроль версий.»

Мы обычно советуем нашим клиентам использовать API-запросы для автоматизации этих обычно ручных задач, и вам тоже стоит!

## Заключительные мысли

Помимо повседневного процесса управления своими аккаунтами dbt Cloud, многие организации получают выгоду от возможности быстро реплицировать среды, экспериментируя с новыми функциями и шаблонами разработки dbt. Управление — еще одно преимущество управления инфраструктурой в коде, так как определения ресурсов могут быть подвержены контролю версий и проверке соответствующими командами до того, как изменения вступят в силу. Эти концепции занимают важное место в наших мыслях, когда мы стремимся предоставить дополнительные возможности нашим клиентам в их использовании dbt Cloud. Удачного использования API!

*Ниже вы найдете серию примеров запросов — используйте их для ориентира или [ознакомьтесь с коллекцией Postman](https://dbtlabs.postman.co/workspace/Team-Workspace~520c7ac4-3895-4779-8bc3-9a11b5287c1c/request/12491709-23cd2368-aa58-4c9a-8f2d-e8d56abb6b1dlinklink), чтобы попробовать самостоятельно.*

## Приложение

### Примеры использования коллекции Postman

Давайте рассмотрим несколько примеров, как эффективно использовать эту коллекцию Postman.

#### Миграция проектов dbt Cloud

Один из часто задаваемых вопросов от клиентов: «Как мы можем мигрировать ресурсы из одного проекта dbt Cloud в другой?» Часто они создают проект разработки, в котором пользователи имеют доступ к интерфейсу и могут вносить изменения вручную, а затем мигрируют выбранные ресурсы из проекта разработки в производственный проект, когда все готово.

Есть несколько причин, по которым это может понадобиться, включая:

- Вероятно, самая распространенная — это разделение сред разработки/тестирования/производства между проектами dbt Cloud, чтобы команды могли вручную строить в проекте разработки, а затем автоматически мигрировать эти среды и задания в производственный проект.
- Создание «стартовых проектов», которые они могут развернуть в качестве шаблонов для новых команд, осваивающих dbt с точки зрения обучения.
- Некоторые особенно заботящиеся о безопасности клиенты могут требовать, чтобы процессы контроля версий и управления проходили перед любыми изменениями в инфраструктуре, включая их аккаунты dbt Cloud.

Ниже мы показываем пример миграции среды и определения задания из проекта разработки в производственный проект. Обратите внимание, что это предполагает, что у вас уже настроены оба проекта. Вы можете продвинуть этот процесс автоматизации еще дальше, создавая новые проекты с подключениями к репозиторию и базе данных через API. Пожалуйста, обратитесь к коллекции для получения дополнительных деталей.

**Прежде чем начать**: Убедитесь, что вы [получили свой API-ключ](https://docs.getdbt.com/docs/dbt-cloud/dbt-cloud-api/user-tokens) и добавили его в заголовок аутентификации ваших запросов.

Наш пример содержит следующие элементы:

![Эта диаграмма показывает, как работает API-запрос. Диаграмма изображает проект разработки и проект производства. Проект разработки содержит две среды: среду разработки и развертывания. Проект развертывания содержит задание. Диаграмма показывает, как среда развертывания, содержащая задание, копируется в производственный проект через API-запрос.](/img/blog/2022-04-19-dbt-cloud-postman-collection/example-cloud-environment.png)

### Настройка

Создайте проект «разработка» и проект «производство» в dbt Cloud с помощью интерфейса
Настройте [подключение к хранилищу данных](https://docs.getdbt.com/docs/dbt-cloud/cloud-configuring-dbt-cloud/connecting-your-database) и [подключение к репозиторию](https://docs.getdbt.com/docs/dbt-cloud/cloud-configuring-dbt-cloud/cloud-configuring-repositories)

#### Извлечение среды из проекта разработки

Вся эта информация доступна из API (см. коллекцию Postman), но вы также можете определить правильные идентификаторы для использования из URL, когда вы вошли в dbt Cloud:

![Скриншот браузера dbt Cloud, с выделенным URL в качестве примера, где найти правильный номер ID](/img/blog/2022-04-19-dbt-cloud-postman-collection/dbt-cloud-api-ID.png)

- ID аккаунта: 28885
- ID проекта: 86704
- ID среды: 75286

Мы отправим GET-запрос на

https://cloud.getdbt.com/api/v3/accounts/28885/projects/86704/environments/75286/

#### Перенос среды в производственный проект

Мы берем ответ от GET-запроса выше и затем делаем следующее:

1. Настраиваем некоторые переменные для новой среды:
    - Изменяем значение поля «project_id» с 86704 на 86711
    - Изменяем значение поля «name» с «dev-staging» на «production–api-generated»
    - Устанавливаем поле «custom_branch» на «main»

2. Отправляем POST-запрос, показанный ниже, на: https://cloud.getdbt.com/api/v3/accounts/28885/projects/86711/environments/

**Тело запроса**:

```
{
   "id": null,
   "account_id": 28885,
   "project_id": 86711,
   "credentials_id": 108731,
   "name": "production–api-generated",
   "dbt_version": "1.0.0",
   "type": "deployment",
   "state": 1,
   "use_custom_branch": true,
   "custom_branch": "main"
}
```

3. Обратите внимание на ID среды, возвращенный в ответе, так как мы будем использовать его для создания задания dbt Cloud на следующем шаге

#### Извлечение определения задания из проекта разработки

Мы отправляем GET-запрос на:

https://cloud.getdbt.com/api/v2/accounts/28885/jobs/72025/

#### Перенос определения задания в производственный проект
1. Настраиваем некоторые переменные для нового задания:
    - Удаляем поля «created_at», «updated_at» и «is_deferrable». Логика [отложенного выполнения](https://docs.getdbt.com/reference/node-selection/defer) выходит за рамки этого поста.
    - Изменяем значение поля «name» на «production-run–api-generated»
2. Отправляем POST-запрос, показанный ниже, на https://cloud.getdbt.com/api/v2/accounts/28885/jobs/

**Тело запроса**:

```
{
       "execution": {
           "timeout_seconds": 600
       },
       "generate_docs": false,
       "run_generate_sources": false,
       "id": null,
       "account_id": {{account_id}},
       "project_id": 86711,
       "environment_id": 75296,
       "name": "production-run--api-generated",
       "dbt_version": null,
       "execute_steps": [
           "dbt build"
       ],
       "state": 1,
       "deactivated": false,
       "run_failure_count": 0,
       "deferring_job_definition_id": null,
       "lifecycle_webhooks": false,
       "lifecycle_webhooks_url": null,
       "triggers": {
           "github_webhook": false,
           "git_provider_webhook": false,
           "custom_branch_only": true,
           "schedule": false
       },
       "settings": {
           "threads": 4,
           "target_name": "default"
       },
       "schedule": {
           "cron": "0 * * * *",
           "date": {
               "type": "every_day"
           },
           "time": {
               "type": "every_hour",
               "interval": 1
           }
       },
       "generate_sources": false,
       "cron_humanized": "Каждый час",
       "next_run": null,
       "next_run_humanized": null
   }
```

И мы закончили! Теперь у нас есть базовые механизмы для миграции объектов dbt Cloud.