---
title: "Максимальная настройка: Конфигурирование уникальных подключений в dbt Cloud"
description: "Исследование новых функций dbt Cloud, которые позволяют создавать несколько уникальных подключений к платформам данных в рамках одного проекта."
slug: configuring-unique-connections-in-dbt-cloud

authors: [gwen_windflower]

tags: [analytics_craft, dbt_tutorials]
hide_table_of_contents: false

date: 2024-04-22
is_featured: true
---

Теперь dbt Cloud включает в себя набор новых функций, которые позволяют настраивать точные и уникальные подключения к платформам данных на уровне окружения и пользователя. Это позволяет создавать более сложные конфигурации, такие как подключение проекта к нескольким учетным записям хранилищ, полноценная поддержка [стейджинговых окружений](/docs/deploy/deploy-environments#staging-environment) и пользовательские [переопределения для конкретных версий dbt](/docs/dbt-versions/upgrade-dbt-version-in-cloud#override-dbt-version). Это дает разработчикам dbt Cloud необходимые функции для решения более сложных задач, таких как рабочие процессы Write-Audit-Publish (WAP) и безопасное тестирование обновлений версий dbt. Хотя вы все еще настраиваете подключение по умолчанию на уровне проекта и для каждого разработчика, теперь у вас есть инструменты для более продвинутой и безопасной работы. Вскоре dbt Cloud пойдет еще дальше, позволяя устанавливать несколько подключений глобально и повторно использовать их с помощью _глобальных подключений_.

<!--truncate-->

Первая новая функция, которую мы рассмотрим, называется [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes).

## Выбор профиля {#profile-pick}

Расширенные атрибуты — это функция, которая приносит гибкость конфигурации `profiles.yml` из dbt Core в dbt Cloud. До выпуска функции расширенных атрибутов вы настраивали подключение на уровне проекта и в основном оставались с ним. Вы могли разрабатывать и оркестрировать в разных схемах, чтобы держать разработку подальше от производства, или настраивать стейджинговый слой с помощью ручных обходных путей, но за пределами этого задачи становились более сложными. Заимствуя гибкость `profiles.yml`, которая позволяет настраивать столько уникальных подключений, сколько вам нужно, теперь вы можете делать то же самое с инструментами безопасности и оркестрации в dbt Cloud.

## Как работают расширенные атрибуты {#how-extended-attributes-work}

Опция **Расширенные атрибуты** доступна в виде текстового поля на странице **Настройки окружения**, где вы можете вводить конфигурации типа `profiles.yml`. При разработке в dbt Cloud IDE, dbt Cloud CLI или оркестрации выполнения заданий, dbt Cloud будет анализировать предоставленный YAML для расширенных атрибутов и объединять его с вашими базовыми настройками подключения проекта. Если атрибут существует в другом источнике (обычно это будут настройки подключения вашего проекта или конфигурации задания), он _заменит_ его значение, включая переопределение любых пользовательских переменных окружения. Если атрибут не существует, он добавит атрибут в конфигурацию подключения. Вы [можете ознакомиться с документацией](https://docs.getdbt.tech/docs/deploy/deploy-environments#extended-attributes) для более конкретных деталей, но теперь, когда у вас есть общее представление, давайте рассмотрим несколько примеров, чтобы понять, почему это так здорово.

## Несколько учетных записей для сред разработки и производства {#multiple-accounts-for-development-and-production-environments}

Наиболее актуальный случай использования для пользователей dbt Cloud — это возможность использовать разные подключения учетных записей для разных команд или этапов разработки в их конвейерах. Рассмотрим команду, у которой есть типичная настройка dev, staging, production (известная как рабочий процесс WAP): разработка для активной работы с небольшими наборами данных, стейджинг для продвижения и проверки изменений на клонированных производственных данных и производство для окончательного развернутого кода, который питает BI-инструменты. Для этой гипотетической команды это, однако, отдельные _учетные записи_ в их платформе данных с собственными наборами RBAC и другими настройками. Это идеальный случай использования для расширенных атрибутов. Давайте посмотрим, как эта команда может настроить это для компании, использующей несколько учетных записей BigQuery, проектов и наборов данных (проекты и наборы данных аналогичны базам данных и схемам на других платформах, таких как Snowflake) для разделения dev, staging и prod:

<Lightbox src="/img/blog/2024-04-10-extended-attributes/ext_attr.png" title="Текстовое поле расширенных атрибутов внизу настроек окружения." />

### Разработка {#development}

```yaml
account: 123dev
project: dev
dataset: dbt_winnie
method: oauth
threads: 1
```

### Стейджинг {#staging}

```yaml
account: 123dev
project: staging
dataset: main
method: service-account-json
threads: 16
```

### Производство {#production}

```yaml
account: 456prod
project: analytics
dataset: main
method: service-account-json
threads: 16
```

С этой настройкой у нас есть отдельная учетная запись для разработки, использующая индивидуальные наборы данных для каждого разработчика (с одним потоком, чтобы журналы сборки разработки было легче читать), подключенная через OAuth; и общий проект `staging` с набором данных по умолчанию `main` для стейджинговой среды, который строится только через учетную запись службы GCP через dbt Cloud. В этом проекте мы можем настроить разрешения IAM, чтобы разрешить сборку в стейджинговую схему только из заданий, использующих стейджинговую среду.

Производство затем указывает на _совершенно отдельную учетную запись_, которая доступна для записи только из сборок производственной среды и доступна для чтения из BI-инструмента.

Это действительно так просто. Это также работает с [private connections](/docs/cloud/secure/about-private-connectivity), которые берут на себя аутентификацию! И снова: хотя у нас есть одно подключение проекта, которое является _default_, теперь вы можете безопасно настраивать отдельные уникальные подключения _для каждого окружения_.

## Весь мир — сцена {#all-the-world-a-stage}

Ранее мы упоминали о стейджинговых средах в обсуждении расширенных атрибутов, но давайте углубимся в то, как dbt Cloud теперь поддерживает их на полноценном уровне. Теперь у вас есть возможность при настройке окружения выбрать **Разработка**, **Производство** или **Стейджинг**. Когда вы настраиваете окружение как стейджинговое, вы разблокируете новые возможности, в первую очередь возможность откладывать работу на _это_ окружение для разработки. Это полностью позволяет реализовать правильный поток Write-Audit-Publish, где разработка строится и продвигается в стейджинг перед слиянием в производственную ветку, когда релизы были протестированы.

Все, что вам нужно сделать, это настроить окружение как стейджинговое и включить опцию **Откладывать на стейджинг/производство** в dbt Cloud IDE. Это будет отдавать предпочтение стейджинговой среде перед производственной, если у вас она настроена.

<Lightbox src="/img/blog/2024-04-10-extended-attributes/env_settings.png" title="Настройка окружения как стейджингового типа." />

<Lightbox src="/img/blog/2024-04-10-extended-attributes/defer_to_stage.png" title="Переключатель для включения откладывания на стейджинговую или производственную среду." />

## Обновление по кривой {#upgrading-on-a-curve}

Наконец, давайте рассмотрим более специализированный случай использования. Представьте, что у нас есть "тигровая команда" (состоящая из единственного аналитического инженера по имени Дэйв), которой поручено обновление с версии dbt 1.6 до нового **[Трека последнего выпуска](/docs/dbt-versions/cloud-release-tracks)**, чтобы воспользоваться новыми функциями и улучшениями производительности. Мы хотим, чтобы остальная часть команды данных оставалась продуктивной в dbt 1.6 на данный момент, позволяя Дэйву обновляться и работать с Latest (и лучшим) dbt.

### Среда разработки {#development-environment}

По умолчанию среда разработки настроена на версию 1.6:

<Lightbox src="/img/blog/2024-04-10-extended-attributes/dbt_version.png" title="Среды разработки настроены на v1.6 по умолчанию." />

### Настройки подключения для разработки {#development-connection-settings}

Настройки подключения для разработки Дэйва:

<Lightbox src="/img/blog/2024-04-10-extended-attributes/dave_version.png" title="Переопределение среды разработки Дэйва." />

## Специальный запуск {#launch-special}

Каждое подключение, которое вы создаете из каждой среды, теперь уникально. Вы можете развертывать, разрабатывать и тестировать свои данные с настройкой, которая адаптируется к вашей организации, а не к тому, что доступно в dbt Cloud. Независимо от того, хотите ли вы создать продвинутые, многослойные среды для безопасного запуска новых моделей или обеспечить большую независимость между разработчиками, dbt Cloud расширяется, чтобы поддержать ваши потребности. Лучшая часть в том, что мы только начинаем: предстоящий набор функций _глобальных подключений_ позволит пойти еще дальше, позволяя устанавливать несколько подключений глобально и повторно использовать их везде, где это необходимо.

Я призываю вас опробовать эти новые функции, создав стейджинговую среду, настроив уникальные подключения, которые вам нужны для ее активации в вашей организации, и увидев, как это может сделать вашу команду данных более эффективной и безопасной. Как всегда, если вам нужна помощь или у вас есть вопросы, [Форум сообщества dbt](https://discourse.getdbt.com/) и [Slack](https://www.getdbt.com/community/join-the-community) здесь, чтобы поддержать вас. Удачного моделирования!