---
title: "Как перенести данные из электронных таблиц в ваш хранилище данных"
description: "Неблагодарная, скромная и неизбежная задача: загрузка данных из электронных таблиц в ваше хранилище данных. Давайте рассмотрим некоторые из различных вариантов и их плюсы и минусы."
slug: moving-spreadsheet-data

authors: [joel_labes]

tags: [analytics craft]
hide_table_of_contents: false

date: 2022-11-23
is_featured: true
---

После того как ваше <Term id="data-warehouse"/> будет построено, подавляющее большинство ваших данных будет поступать из других SaaS-инструментов, внутренних баз данных или платформ данных клиентов (CDP). Но есть еще один незамеченный герой в наборе инструментов аналитической инженерии: скромная электронная таблица.

Электронные таблицы — это швейцарский нож обработки данных. Они могут добавлять дополнительный контекст к иначе непонятным идентификаторам приложений, быть единственным источником истины для уникальных процессов из других подразделений бизнеса или служить слоем перевода между двумя несовместимыми инструментами.

Из-за важности электронных таблиц как связующего звена между многими бизнес-процессами существуют различные инструменты для их загрузки в ваше хранилище данных, и каждый из них имеет свои плюсы и минусы в зависимости от вашего конкретного случая использования.

<!--truncate-->

В общем, перед выбором одного из этих инструментов стоит задать себе несколько вопросов о ваших данных:

- Кто в вашей компании будет загружать данные?
- Имеет ли они постоянный формат?
- Как часто они будут изменяться?
- Каков размер набора данных?
- Нужно ли отслеживать изменения?
- Откуда поступают файлы?

Давайте рассмотрим некоторые из предложений, которые помогут вам загрузить ваши электронные таблицы в ваше хранилище данных.

## dbt seeds

dbt поставляется с встроенным загрузчиком csv ([seeds](https://docs.getdbt.com/docs/build/seeds)), который позволяет заполнять ваше хранилище данных любыми файлами, которые вы помещаете в папку `seeds` вашего проекта. Он автоматически определяет типы данных из содержимого вашего файла, но вы всегда можете переопределить это, [предоставив явные инструкции в вашем файле dbt_project.yml](https://docs.getdbt.com/reference/resource-configs/column_types).

Однако, поскольку dbt создает эти таблицы, вставляя строки по одной, он не работает эффективно в больших масштабах (нет жесткого ограничения, но стремитесь к сотням строк, а не тысячам). [Документация dbt](https://docs.getdbt.com/docs/build/seeds#faqs) предлагает использовать seeds для "файлов, содержащих бизнес-логику, например, список кодов стран или идентификаторов пользователей сотрудников."

Большим преимуществом использования seeds является то, что ваш файл будет проверен в системе контроля версий, что позволит вам легко увидеть, когда файл был обновлен, и восстановить удаленные данные, если это необходимо.

#### Хорошо подходит для:

- Небольших файлов, таких как сопоставление идентификаторов сотрудников с сотрудниками
- Редко изменяемых файлов, таких как сопоставление кодов стран с названиями стран
- Данных, которые выиграют от контроля версий
- Программного контроля типов данных

#### Не подходит для:

- Файлов размером более 1 МБ
- Файлов, которые нуждаются в регулярных обновлениях

## ETL инструменты

Очевидным выбором, если у вас есть данные для загрузки в хранилище, будет ваш существующий [ETL инструмент](https://www.getdbt.com/analytics-engineering/etl-tools-a-love-letter/), такой как Fivetran или Stitch, о которых я расскажу в этом разделе. Ниже приведена сводная таблица, подчеркивающая основные преимущества и недостатки некоторых вариантов <Term id="etl" /> инструментов для загрузки данных из электронных таблиц в ваше хранилище данных.

### Сводная таблица

| Опция/коннектор | Данные обновляемы после загрузки | Настраиваемые типы данных | Несколько таблиц на схему | Хорошо для больших наборов данных |
| --- | --- | --- | --- | --- |
| dbt seeds | ✅ | ✅ | ✅ | ❌ |
| Fivetran Browser Upload | ✅ | ✅ | ✅ | ✅ |
| Fivetran Google Sheets connector | ✅ | ❌ | ❌ | ✅ |
| Fivetran Google Drive connector | ❌ | ❌ | ✅ | ✅ |
| Stitch Google Sheets integration | ✅ | ❌ | ❌ | ✅ |
| Airbyte Google Sheets connector | ✅ | ❌ | ❌ | ✅ |

### Fivetran browser upload

[Загрузчик браузера Fivetran](https://fivetran.com/docs/files/browser-upload) делает именно то, что заявлено: вы загружаете файл в их веб-портал, и он создает таблицу, содержащую эти данные в предопределенной схеме в вашем хранилище. С визуальным интерфейсом для изменения типов данных, это легко для любого пользователя. И с учетной записью, имеющей разрешение только на загрузку файлов, вам не нужно беспокоиться о том, что ваши заинтересованные стороны случайно что-то сломают.

<Lightbox src="/img/blog/2022-11-22-move-spreadsheets-to-your-dwh/fivetran-uploader-1.png" title="Преобразование типов данных из текста в даты и числа легко в визуальном редакторе" />

<Lightbox src="/img/blog/2022-11-22-move-spreadsheets-to-your-dwh/fivetran-uploader-2.png" title="Выбор подходящего формата даты из списка опций для их преобразования в стандартизированный формат" />

Приятным преимуществом загрузчика является поддержка обновления данных в таблице со временем. Если загружается файл с тем же именем и теми же столбцами, любые новые записи будут добавлены, а существующие записи (по <Term id="primary-key"/>) будут обновлены.

Однако имейте в виду, что на эти изменения нет контроля версий или возможности их отмены; возможно, вам стоит рассмотреть возможность [снимка изменений](https://docs.getdbt.com/docs/building-a-dbt-project/snapshots) в dbt, если это вызывает беспокойство.

Также Fivetran не будет удалять записи после их создания, поэтому единственный способ удалить записи, созданные с помощью этого процесса, — это вручную [удалить](https://docs.getdbt.com/terms/dml#delete) их из вашего хранилища. Если у вас есть разовый коннектор, рассмотрите возможность автоматического удаления этих таблиц регулярно, особенно если у вас есть проблемы с управлением PII.

#### Хорошо подходит для:

- Файлов, которые часто обновляются кем-то
- Позволяет любому в компании загружать файлы
- Разовые загрузки данных
- Обновление таблицы вместо создания новой
- Основные изменения типов данных (включая обработку столбцов валют)
- Большие файлы

#### Не подходит для:

- Отслеживания изменений в данных
- Сложных сопоставлений типов

### Fivetran Google Sheets connector

Основное преимущество подключения к Google Sheets вместо статической электронной таблицы должно быть очевидным — коллеги могут изменять лист из любого места, и новые записи будут автоматически загружены в ваше хранилище. [Коннектор Google Sheets от Fivetran](https://fivetran.com/docs/files/google-sheets) требует некоторой дополнительной начальной настройки, но совместное редактирование может сделать усилия стоящими.

Вместо синхронизации всех ячеек в листе вы создаете [именованный диапазон](https://fivetran.com/docs/files/google-sheets/google-sheets-setup-guide) и подключаете Fivetran к этому диапазону. Каждый коннектор Fivetran может читать только один диапазон — если у вас несколько вкладок, вам нужно будет создать несколько коннекторов, каждый со своей схемой и таблицей в целевом хранилище. Когда происходит синхронизация, таблица будет [усечена](https://docs.getdbt.com/terms/ddl#truncate) и загружена заново, так как нет первичного ключа для сопоставления.

<Lightbox src="/img/blog/2022-11-22-move-spreadsheets-to-your-dwh/google-sheets-uploader.png" title="Создание именованного диапазона в Google Sheets для синхронизации через Fivetran Google Sheets Connector" />

Остерегайтесь несоответствий типов данных — если кто-то введет текст в столбец, который изначально был числовым, Fivetran автоматически преобразует столбец в строковый тип, что может вызвать проблемы в ваших последующих преобразованиях. [Рекомендуемое решение](https://fivetran.com/docs/files/google-sheets#typetransformationsandmapping) — явно приводить ваши типы в [моделях подготовки](https://docs.getdbt.com/best-practices/how-we-structure/2-staging), чтобы гарантировать, что любые нежелательные записи будут преобразованы в null.

#### Хорошо подходит для:

- Больших, долгоживущих документов
- Файлов, которые обновляются многими людьми (и довольно часто)

#### Не подходит для:

- Разовых загрузок — вам нужно создать целую схему для каждой подключенной электронной таблицы, и подготовка листа — это кропотливый процесс
- Отслеживания изменений в данных
- Документов с множеством вкладок

### Fivetran Google Drive connector

Я большой поклонник [коннектора Google Drive от Fivetran](https://fivetran.com/docs/files/google-drive); в прошлом я использовал его для упрощения многих еженедельных отчетов. Он позволяет заинтересованным сторонам использовать инструмент, с которым они уже знакомы (Google Drive), вместо того чтобы иметь дело с другим набором учетных данных. Каждый файл, загруженный в определенную папку на Drive (или [Box, или потребительский Dropbox](https://fivetran.com/docs/files/magic-folder)), превращается в таблицу в вашем хранилище.

<Lightbox src="/img/blog/2022-11-22-move-spreadsheets-to-your-dwh/google-drive-uploader.png" title="Fivetran добавит каждый из этих csv файлов в одну схему в вашем хранилище, что делает его идеальным для регулярных загрузок" />

Как и в случае с коннектором Google Sheets, типы данных столбцов определяются автоматически. Даты, в частности, капризны — если вы можете контролировать ваши входные данные, постарайтесь привести их в формат [ISO 8601](https://xkcd.com/1179/), чтобы минимизировать количество очистки, которую вам придется делать на другой стороне.

Я использовал два макроса из пакета dbt_utils ([get_relations_by_pattern](https://github.com/dbt-labs/dbt-utils#get_relations_by_pattern-source) и [union_relations](https://github.com/dbt-labs/dbt-utils#union_relations-source)), чтобы объединить еженедельные экспорты из других инструментов в одну [модель](/docs/build/models) для легкой очистки в модели подготовки. Убедитесь, что вы предоставили вашей учетной записи трансформатора разрешение на доступ ко всем таблицам в схеме (включая будущие), чтобы избежать необходимости вручную вмешиваться после каждой новой загрузки файла.

#### Хорошо подходит для:

- Позволяет любому в компании загружать файлы
- Еженедельные экспорты из другого инструмента
- Большие файлы
- Множество файлов (каждый будет создан как еще одна таблица в одной схеме, в отличие от интеграции Google Sheets)

#### Не подходит для:

- Данных, которые нужно обновить после загрузки
- Пользовательских сопоставлений типов (без дальнейшей обработки в dbt)

### Stitch Google Sheets integration

[Интеграция Google Sheets от Stitch](https://www.stitchdata.com/docs/integrations/saas/google-sheets) немного проще в настройке, чем у Fivetran, так как она импортирует весь лист без необходимости настраивать именованные диапазоны. Помимо этого, она работает так же, с теми же преимуществами и недостатками.

#### Хорошо подходит для:

- Больших, долгоживущих документов
- Файлов, которые обновляются многими людьми

#### Не подходит для:

- Разовых загрузок — вам нужно создать целую схему для каждой подключенной электронной таблицы
- Отслеживания изменений в данных
- Документов с множеством вкладок

### Airbyte Google Sheets connector

Airbyte, инструмент ETL с открытым исходным кодом и облачным решением, [поддерживает коннектор источника Google Sheets](https://airbytehq.github.io/integrations/sources/google-sheets/), очень похожий на интеграцию Stitch и Fivetran. Вам нужно будет аутентифицировать вашу учетную запись Google с помощью OAuth или ключа учетной записи службы и предоставить ссылку на Google Sheet, который вы хотите загрузить в ваше хранилище данных. Обратите внимание, что все столбцы листа загружаются как строки, поэтому вам нужно будет явно приводить их в последующей модели. Коннектор Airbyte также поддерживает как полные обновления, так и добавления.

#### Хорошо подходит для:

- Больших, долгоживущих документов
- Файлов, которые обновляются многими людьми
- Команд, которые могут быть ограничены в бюджете

#### Не подходит для:

- Данных нестрокового типа, которые вы хотите сохранить в ваших исходных таблицах в хранилище данных

## Родные интеграции хранилищ данных

Каждое из основных хранилищ данных также имеет родные интеграции для импорта данных из электронных таблиц. Хотя основы одинаковы, существуют некоторые различия между различными поставщиками хранилищ данных.

### Snowflake

Опции Snowflake надежны и удобны для пользователя, предлагая как [веб-загрузчик](https://docs.snowflake.com/en/user-guide/data-load-web-ui.html), так и [массовый импортер](https://docs.snowflake.com/en/user-guide/data-load-bulk.html). Веб-загрузчик подходит для небольших и средних файлов (до 50 МБ) и может использоваться для конкретных файлов, всех файлов в папке или файлов в папке, которые соответствуют заданному шаблону. Он также является наиболее независимым от поставщика, поддерживая Amazon S3, Google Cloud Storage, Azure и локальную файловую систему.

<Lightbox src="/img/blog/2022-11-22-move-spreadsheets-to-your-dwh/snowflake-uploader.png" title="Веб-мастер загрузки данных Snowflake через блог Snowflake https://www.snowflake.com/blog/tech-tip-getting-data-snowflake/" />

### BigQuery

BigQuery поддерживает импорт данных только из внешних источников, размещенных Google, таких как Google Drive и Google Cloud Storage (поскольку BigQuery и Sheets являются продуктами Google, BigQuery — единственная платформа в этом списке, которая имеет родную интеграцию, не требующую сторонних инструментов). Данные, на которые он ссылается, не копируются в BigQuery, но могут быть использованы в запросах, как если бы они были. Если необходимо, вы можете записать копию в BigQuery или просто оставить ее как внешний источник. Команда supercooldata написала [отличное руководство по настройке Google Sheets с BigQuery](https://blog.supercooldata.com/working-with-sheets-in-bigquery/).

### Redshift

Как и ожидалось для продукта AWS, Redshift предпочитает [импортировать CSV-файлы из S3](https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-data.html). Как и в случае с Snowflake, это достигается с помощью команды COPY, и вы можете легко контролировать, какие файлы импортируются из исходного бакета. Использование S3 в качестве источника по сравнению с веб-загрузчиком или Google Drive означает, что этот вариант не так удобен для пользователей, не обладающих техническими навыками, но все же является отличным вариантом для синхронизации файлов, которые автоматически генерируются другими инструментами.

### Databricks

Databricks также поддерживает [загрузку данных, таких как электронные таблицы, из внешних облачных источников](https://docs.databricks.com/external-data/index.html), таких как Amazon S3 и Google Cloud Storage. Кроме того, возможность [загрузки данных через простой интерфейс](https://docs.databricks.com/ingestion/add-data/index.html) в Databricks в настоящее время находится в публичной предварительной версии.

## Заключение

Помимо уже рассмотренных вариантов, существует целый мир других инструментов, которые могут загружать данные из ваших электронных таблиц в ваше хранилище данных. Это живой документ, поэтому, если ваш предпочтительный метод не указан, пожалуйста, [откройте PR](https://github.com/dbt-labs/docs.getdbt.com), и я его рассмотрю.

Наиболее важные вещи, которые следует учитывать, — это происхождение и формат ваших файлов. Если вам нужно, чтобы ваши коллеги регулярно загружали файлы, постарайтесь предоставить им более удобный процесс; но если вам просто нужно, чтобы два компьютера общались друг с другом, или это разовый файл, который вряд ли когда-либо изменится, то более техническая интеграция вполне уместна.