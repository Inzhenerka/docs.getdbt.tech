---
title: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—à–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º: grants –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ dbt Core v1.2"
description: "–ö–æ–Ω–µ—á–Ω—ã–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º (—Ç–∞–∫–∏–º –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ dbt —Å–æ–∑–¥–∞–µ—Ç –≤ –≤–∞—à–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –í –≤–µ—Ä—Å–∏–∏ v1.2 –º—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `grants`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, —á–µ–º —Ö—É–∫–∏, –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."

slug: configuring-grants

authors: [jeremy_cohen, doug_beatty]

tags: [dbt tutorials]
hide_table_of_contents: false

date: 2022-07-26
is_featured: true
---

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª–∏ dbt —Å 2019 –≥–æ–¥–∞ –ø–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å, –µ—Å—Ç—å –±–æ–ª—å—à–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –ø–æ—Å—Ç ["–¢–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã grant, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ –ø—Ä–æ–µ–∫—Ç–µ dbt"](https://discourse.getdbt.com/t/the-exact-grant-statements-we-use-in-a-dbt-project/430) –Ω–∞ Discourse. –í –Ω–µ–º –æ–±—ä—è—Å–Ω—è–ª–∏—Å—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –¥–≤—É—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:
1. –∑–∞–ø—Ä–æ—Å –æ—Ç–Ω–æ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é "select"
1. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—Ö–æ–¥—è—Ç—Å—è —ç—Ç–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —á–µ—Ä–µ–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é "usage"

<!--truncate-->

## –†–µ—à–µ–Ω–∏–µ —Ç–æ–≥–¥–∞
–î–æ dbt Core v1.2 –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∏ —Ç—Ä–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ (–∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏–º–µ–ª [–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è –∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã](#caveats-and-trade-offs-of-the-original-guidance)):

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–æ–≤ `on-run-end` –¥–ª—è `grant select on all` —Ç–∞–±–ª–∏—Ü/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ—Å—Ç—Ä–æ–∏–ª dbt
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `post-hook` –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è `select` –Ω–∞ –º–æ–¥–µ–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –µ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–±–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –≥—Ä–∞–Ω—Ç–æ–≤ (–±—É–¥—É—â–∏–µ –≥—Ä–∞–Ω—Ç—ã –≤ Snowflake), –ª–∏–±–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ `post-hooks` –∏ `on-run-end` —Ö—É–∫–æ–≤

–≠—Ç–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –±—ã–ª–∏ –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏... –¥–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è!

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

–í –≤–µ—Ä—Å–∏–∏ v1.2 –º—ã [–ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∏](https://www.getdbt.com/blog/teaching-dbt-about-grants) –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é [`grants`](https://docs.getdbt.tech/reference/resource-configs/grants), –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ `post-hook`, —Å –¥–≤—É–º—è –∫–ª—é—á–µ–≤—ã–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏:

- –í—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ `grants` –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å, –∞ –Ω–µ –ø–∏—à–µ—Ç–µ –≤–µ—Å—å SQL —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- dbt –≤—ã–±–µ—Ä–µ—Ç *–Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å* –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –≥—Ä–∞–Ω—Ç–æ–≤

### –ü–æ—á–µ–º—É `grants` –ª—É—á—à–µ, —á–µ–º —Ö—É–∫–∏

–í–æ-–ø–µ—Ä–≤—ã—Ö, [—Ö—É–∫–∏ —Å–ª–æ–∂–Ω—ã](#issues-related-to-hooks)! –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–∞ –ø—É—Ç–∞–Ω–∏—Ü–∞ —Å [–≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏](https://docs.getdbt.tech/docs/building-a-dbt-project/dont-nest-your-curlies).

#### –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–≥–¥–∞
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –≤—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–∞–¥ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é. –†–∞–Ω–µ–µ –≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞–ø—Ä—è–º—É—é `reporter`, —á—Ç–æ–±—ã –ª—é–¥–∏ –º–æ–≥–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –µ–µ –¥–∞–ª–µ–µ:

```sql
-- models/my_incremental_model.sql

{{ config(
	materialized = 'incremental',
	post_hook = ["grant select on {{ this }} to reporter"]
) }}

select ...
```

–°–æ –≤—Ä–µ–º–µ–Ω–µ–º —ç—Ç–∞ –º–æ–¥–µ–ª—å –≤–∑—è–ª–∞ –Ω–∞ —Å–µ–±—è –≤—Å–µ –±–æ–ª—å—à–µ –∏ –±–æ–ª—å—à–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π, –∏ –≤—ã —Ä–µ—à–∏–ª–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–∏—Ç–∞–ª–∞ —Å–µ—Ä–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π. –ó–∞–±–æ—Ç–ª–∏–≤–æ, –≤—ã —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏–ª–∏ `post_hook`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–ª –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏:

```sql
-- models/my_incremental_model.sql

{{ config(materialized = 'incremental') }}

select ...
```

**–ü—Ä–æ–±–ª–µ–º–∞?** –ü–æ–∫–∞ –≤—ã –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `--full-refresh`, –≤–∞—à–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –≤—Å–µ –µ—â–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª–∏ `reporter`!

#### –†–µ—à–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è

–ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `grants` –≤ dbt —É—á–∏—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ. –û–Ω–∞ –∑–Ω–∞–µ—Ç, –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –ª–∏ –≥—Ä–∞–Ω—Ç—ã, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∞ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –≥—Ä–∞–Ω—Ç–∞–º–∏ –∏ —Ç–µ–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ.

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ!

```sql

-- models/my_incremental_model.sql

{{ config(
	materialized = 'incremental',
	grants = {'select': ['another_user']}
) }}

select ...
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `another_user` –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –≤–∞—à—É –º–æ–¥–µ–ª—å. –ó–∞—Ç–µ–º –∏–∑–º–µ–Ω–∏—Ç–µ –≤–∞—à—É –º–æ–¥–µ–ª—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–µ —Å–Ω–æ–≤–∞:

```sql
-- models/my_incremental_model.sql

{{ config(
	materialized = 'incremental',
	grants = {'select': []}
) }}

select ...
```

–ï—Å–ª–∏ –≤—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç–µ —Å–≤–æ—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ *–Ω–∏–∫—Ç–æ* –Ω–µ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–∑ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö —É—Ä–æ–≤–Ω—è –æ—Ç–ª–∞–¥–∫–∏, —á—Ç–æ dbt –≤—ã–ø–æ–ª–Ω–∏–ª –æ–ø–µ—Ä–∞—Ç–æ—Ä `revoke`.

(–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ `grants` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `{}`, dbt –ø–æ–π–º–µ—Ç, —á—Ç–æ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ–Ω —É–ø—Ä–∞–≤–ª—è–ª –≥—Ä–∞–Ω—Ç–∞–º–∏ –¥–ª—è —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã. –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é –∏ —Ç–æ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã *–Ω–∏–∫—Ç–æ* –µ–µ –Ω–µ –∏–º–µ–ª!)

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `grants` –≤ dbt v1.2, –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —É–¥–µ–ª–∏–ª–∏ —ç—Ç–æ–º—É –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è, —á–µ–º –∫–æ–≥–¥–∞-–ª–∏–±–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–Ω–æ–≤–∞ üòé

## –ï—Å—Ç—å –ª–∏ –µ—â–µ –º–µ—Å—Ç–æ –¥–ª—è —Ö—É–∫–æ–≤?

–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±–ª–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–¥–µ–ª—è—é—Ç—Å—è:
- [–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤](#granting-permissions-on-other-object-types), —Ç–∞–∫–∏–µ –∫–∞–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ —Å—Ö–µ–º—É
- [–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è](#advanced-permissions-or-other-operations), —Ç–∞–∫–∏–µ –∫–∞–∫ –¥–æ—Å—Ç—É–ø –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫

### –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Å–µ –µ—â–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å `usage` –Ω–∞ —Å—Ö–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤ —ç—Ç–∏—Ö —Å—Ö–µ–º–∞—Ö. –•–æ—Ç—è dbt —Å–æ–∑–¥–∞–µ—Ç —Å—Ö–µ–º—ã –≤ –Ω–∞—á–∞–ª–µ –∑–∞–ø—É—Å–∫–æ–≤, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ—Ç —Å–ø–æ—Å–æ–±–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å *—Å—Ö–µ–º—ã –∫–∞–∫ –∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã* –≤ dbt.

–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤, –∫–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–æ–π—Ç–∏ –∫ —ç—Ç–æ–º—É:
- –í–∞—Ä–∏–∞–Ω—Ç A -- –ø—Ä–æ—Å—Ç–æ–π –∏ –∑–Ω–∞–∫–æ–º—ã–π -- —Ö—É–∫–∏ –Ω–∞ –ø–æ–º–æ—â—å
- –í–∞—Ä–∏–∞–Ω—Ç B -- —Å–ª–∏—à–∫–æ–º —Ö–∏—Ç—Ä–æ -- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ dbt, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ —Å—Ö–µ–º—ã –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ "usage"

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ø—Ä–æ—Å—Ç–æ–π –∏ –∑–Ω–∞–∫–æ–º—ã–π

```yaml
on-run-end:
	# –ª—É—á—à–µ –∫–∞–∫ –º–∞–∫—Ä–æ—Å
	- "{% for schema in schemas %}grant usage on schema {{ schema }} to reporter;{% endfor %}"
```

–ü–ª—é—Å—ã: –ö–æ—Ä–æ—Ç–∫–æ, —è—Å–Ω–æ, –ø–æ –¥–µ–ª—É.

–ú–∏–Ω—É—Å—ã: –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–æ—Ç –∂–µ —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –∑–¥–µ—Å—å, –∫–æ—Ç–æ—Ä—ã–π –º—ã —É–∫–∞–∑–∞–ª–∏ –≤ –Ω–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `grants`.

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°–ª–∏—à–∫–æ–º —Ö–∏—Ç—Ä–æ

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ `grants` —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –≤ dbt, –¥–æ—Å—Ç—É–ø–Ω–æ–π —á–µ—Ä–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ dbt, –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å —Å –Ω–µ–π –≤—Å–µ–≤–æ–∑–º–æ–∂–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤–µ—â–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ —Å—Ö–µ–º—ã –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π `select` —Ä–æ–ª–∏, –∏ –∑–∞—Ç–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å `usage` –Ω–∞ —ç—Ç—É —Å—Ö–µ–º—É —ç—Ç–æ–π —Ä–æ–ª–∏!

```sql
-- macros/operations/reporting_grants.sql
{% macro grant_usage_on_schemas_where_select() %}
    /*
      –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Å–µ–≤–¥–æ–∫–æ–¥, –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π
      –î–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ö–æ—Ç—è –±—ã –∫ –æ–¥–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É –≤ —Å—Ö–µ–º–µ,
      –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å 'usage' –Ω–∞ —ç—Ç—É —Å—Ö–µ–º—É —ç—Ç–æ–π —Ä–æ–ª–∏.
      –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —ç—Ç–æ–π —Ä–æ–ª—å—é –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã
      –≤ —ç—Ç–æ–π —Å—Ö–µ–º–µ (–æ–±—ã—á–Ω–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –¥–ª—è BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
    */
    {% set schema_grants = {} %}
    {% if execute %}
      {% for node in graph.nodes.values() %}
        {% set grants = node.config.get('grants') %}
        {% set select_roles = grants['select'] if grants else [] %}
        {% if select_roles %}
          {% set database_schema = node.database ~ "." ~ node.schema %}
          {% if database_schema in database_schemas %}
            {% do schema_grants[database_schema].add(select_roles) %}
          {% else %}
            {% do schema_grants.update({database_schema: set(select_roles)}) %}
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}
    {% set grant_list %}
      {% for schema in schema_grants %}
        {% for role in schema_grants[schema] %}
          grant usage on schema {{ schema }} to {{ role }};
        {% endfor %}
      {% endfor %}
    {% endset %}
    {{ return(grant_list) }}
{% endmacro %}
```

–≠—Ç–æ, –∫–æ–Ω–µ—á–Ω–æ, —Å–ª–∏—à–∫–æ–º —Ö–∏—Ç—Ä–æ -- –Ω–æ –≤—ã –ø–æ–Ω—è–ª–∏ –∏–¥–µ—é –∏ –ø–æ–ª—É—á–∏–ª–∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é —Ç–æ–≥–æ, —á—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ!

–í—ã –¥–∞–∂–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤ *–Ω–∞—á–∞–ª–µ* –∑–∞–ø—É—Å–∫–∞, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ dbt —Å–æ–∑–¥–∞—Å—Ç —Å–≤–æ–∏ —Å—Ö–µ–º—ã, –∞ –Ω–µ –∂–¥–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞. (–•–æ—Ç—è —ç—Ç–æ –Ω–µ –±–æ–ª—å—à–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∂–¥–∞—Ç—å.)

```yaml
on-run-start:
	- {{ grant_usage_on_schemas_where_select() }}
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–∏–ª–∏ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

–•–æ—Ç–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π? –ò–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç?

–ü–æ–¥—Ö–æ–¥ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –≤ Snowflake –≤–∞–º –≤—Å–µ –µ—â–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è `post-hook`, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å [–ø–æ–ª–∏—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä–æ–∫–∞–º](https://docs.snowflake.com/en/user-guide/security-row-intro.html) –∏–ª–∏ [–ø–æ–ª–∏—Ç–∏–∫—É –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤](https://docs.snowflake.com/en/sql-reference/sql/create-masking-policy.html) –∫ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ, —Ç–æ–≥–¥–∞ –∫–∞–∫ –≤ Databricks –≤—ã –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ [—Ñ—É–Ω–∫—Ü–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è](https://docs.databricks.com/security/access-control/table-acls/object-privileges.html#dynamic-view-functions).

–•–æ—Ä–æ—à–æ –∏–º–µ—Ç—å —Ö—É–∫–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–∫ –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –õ—é–±—ã–µ —Å–ª—É—á–∞–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–Ω—É—Ç —à–∏—Ä–æ–∫–æ –∏ —è–≤–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å—é, –º–æ–≥—É—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω—ã –ø—É—Ç–µ–º –∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ `dbt-core`.

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è –∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
`on-run-end` —Ö—É–∫–∏:
> –≤ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–æ–º –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ü–æ–º –∑–∞–ø—É—Å–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —ç—Ç—É –º–æ–¥–µ–ª—å, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω–∏ –ø–æ–ª—É—á–∞—Ç –æ—à–∏–±–∫—É "permission denied". –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –≤ –≤–∞—à–µ–º BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ."

–ø—Ä–∏–≤–∏–ª–µ–≥–∏—è `manage grants`:
> –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —ç—Ç–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è *—è–≤–ª—è–µ—Ç—Å—è* –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–∏–ª–µ–≥–∏–µ–π ‚Äì —Ç–µ–ø–µ—Ä—å –ª—é–±–æ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Ä–æ–ª—å `transformer`, –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –≥—Ä–∞–Ω—Ç—ã –Ω–∞ –ª—é–±–æ–º –æ–±—ä–µ–∫—Ç–µ, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –æ–±—ä–µ–∫—Ç–∞. –†–µ—à–∞—Ç—å –≤–∞–º, –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –ª–∏ –≤–∞–º —Å —ç—Ç–∏–º! –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é `post-hooks` –∏ `on-run-end` —Ö—É–∫–æ–≤ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ üôÇ"

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

- –î–∞–∂–µ –µ—Å–ª–∏ –≤—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–∞–º—ã–π [DRY](https://en.wikipedia.org/wiki/Don't_repeat_yourself) –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥–ª–∏, –≤—Å–µ —Ä–∞–≤–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç *—Ç—ã—Å—è—á–∏* –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ –Ω–∞–ø–∏—Å–∞–ª–∏ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ [DCL](https://en.wikipedia.org/wiki/Data_control_language) –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, –æ–±–µ—Ä–Ω—É—Ç—ã–µ –≤ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –º–∞–∫—Ä–æ—Å—ã.
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + –±—É–¥—É—â–∏–µ –≥—Ä–∞–Ω—Ç—ã ‚Äî –Ω–∞—à–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è, –µ—â–µ –≤ 2019 –≥–æ–¥—É ‚Äî *—Å–ª–æ–∂–Ω—ã.* –û–Ω–∏ —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (—Å—Ç–∞—Ç—É—Å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!), –æ–Ω–∏ –≤—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∏–ª—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –º–Ω–æ–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π —Å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –ü—Ä–æ–±–ª–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ö—É–∫–∞–º–∏
–≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –æ–±—Ä–∞–∑–µ—Ü –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –≤–∏–¥–µ–ª–∏:
- [Post hooks, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç –º–∞–∫—Ä–æ—Å—ã, –ø–∞—Ä—Å—è—Ç—Å—è —Å execute = False¬†#2370](https://github.com/dbt-labs/dbt-core/issues/2370)
- [get_relation –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç none –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ö—É–∫–∞¬†#2938](https://github.com/dbt-labs/dbt-core/issues/2938)
- [this.is_view –∏ this.is_table –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ BigQuery –≤–Ω—É—Ç—Ä–∏ —Ö—É–∫–∞¬†#3529](https://github.com/dbt-labs/dbt-core/issues/3529)
- [–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã \{\{ this \}\} –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è –≤ post-hook –º–∞–∫—Ä–æ—Å–µ¬†#3985](https://github.com/dbt-labs/dbt-core/issues/3985)
- [Post-hook –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ö–µ–º—É¬†#4023](https://github.com/dbt-labs/dbt-core/issues/4023)
- [[CT-80] [Bug] post-hook –º–∞–∫—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π¬†#4606](https://github.com/dbt-labs/dbt-core/issues/4606)