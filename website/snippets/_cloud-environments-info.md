## Типы окружений

В <Constant name="cloud" /> существует два типа окружений:
- **Deployment environment** — определяет настройки, которые используются при выполнении заданий (jobs), созданных в рамках этого окружения.<br></br>
    Типы deployment-окружений:
    - General
    - Staging
    - Production
- **Development environment** — определяет настройки, используемые в <Constant name="cloud_ide" /> или <Constant name="cloud_cli" /> для конкретного проекта.

Каждый проект в <Constant name="cloud" /> может иметь только одно development-окружение, но при этом может иметь любое количество deployment-окружений типа General, одно deployment-окружение типа Production и одно deployment-окружение типа Staging.

|          | Development | General | Production | Staging |
|----------|-------------|---------|------------|---------|
| **Определяет настройки для** | <Constant name="cloud_ide" /> или <Constant name="cloud_cli" /> | Запусков <Constant name="cloud" /> Jobs | Запусков <Constant name="cloud" /> Jobs | Запусков <Constant name="cloud" /> Jobs |
| **Сколько может быть в проекте?** | 1 | Любое количество | 1 | 1 |

:::note 
Для пользователей, знакомых с разработкой на <Constant name="core" />, каждое окружение примерно соответствует записи в файле `profiles.yml`, но с добавлением информации о репозитории, необходимой для того, чтобы при выполнении использовалась корректная версия кода. Подробнее об окружениях dbt core см. [здесь](/docs/core/dbt-core-environments).
:::

## Общие настройки окружения

Как окружения разработки, так и развертывания имеют раздел под названием **Общие настройки**, который содержит некоторые базовые настройки, которые определяются для всех окружений:

| Настройка | Пример значения | Определение | Допустимые значения |
| --- | --- | --- | --- |
| Environment name | Production | **Имя окружения** | Any string! |
| Environment type | Deployment | **Тип окружения** | Deployment, Development |
| Set deployment type | PROD | **Определяет тип окружения для деплоя.** | Production, Staging, General | 
| dbt version | Latest | <Constant name="cloud" /> **автоматически обновляет версию dbt, которая используется в этом окружении, в зависимости от выбранного вами [release track](/docs/dbt-versions/cloud-release-tracks).** | Lastest, Compatible, Extended |
| Only run on a custom branch | ☑️ | **Определяет, нужно ли использовать ветку, отличную от ветки репозитория по умолчанию.** | See below |
| Custom branch | dev | **Имя пользовательской ветки** | See below |

:::note О версии dbt

<Constant name="cloud" /> позволяет пользователям выбрать [release track](/docs/dbt-versions/cloud-release-tracks), чтобы получать регулярные обновления версий dbt с той периодичностью, которая подходит их команде.
:::

### Поведение пользовательской ветки

По умолчанию все среды используют ветку по умолчанию в вашем репозитории (обычно это ветка `main`) при доступе к вашему dbt-коду. Это поведение можно переопределить для каждой среды <Constant name="cloud" /> с помощью опции **Default to a custom branch**. В зависимости от типа среды эта настройка ведёт себя немного по‑разному:

- **Development**: определяет, из какой ветки в <Constant name="cloud_ide" /> или <Constant name="cloud_cli" /> разработчики создают новые ветки и в какую ветку они открывают pull request’ы.
- **Deployment**: определяет, какая ветка клонируется при выполнении заданий (jobs) для каждой среды.

Для получения дополнительной информации ознакомьтесь с этой [страницей FAQ по этой теме](/faqs/Environments/custom-branch-settings)!

### Расширенные атрибуты

:::note 
Расширенные атрибуты в настоящее время _не_ поддерживаются для SSH‑туннелирования  
:::

Расширенные атрибуты позволяют пользователям задавать гибкий фрагмент [profiles.yml](/docs/core/connect-data-platform/profiles.yml) в настройках окружения <Constant name="cloud" />. Это дает пользователям больше контроля над окружениями (как для деплоя, так и для разработки) и расширяет способы, с помощью которых <Constant name="cloud" /> подключается к платформе данных в рамках конкретного окружения.

Расширенные атрибуты задаются на уровне окружения и могут частично переопределять учетные данные подключения или окружения, включая любые пользовательские переменные окружения. Вы можете задать любые YAML-атрибуты, которые адаптер dbt принимает в своем `profiles.yml`.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/extended-attributes.png" width="95%" title="Extended Attributes помогает пользователям добавлять атрибуты profiles.yml в настройки окружения dbt с помощью текстового поля свободной формы." /> <br />

Следующий код является примером типов атрибутов, которые вы можете добавить в текстовое поле **Расширенные атрибуты**:

```yaml
dbname: jaffle_shop      
schema: dbt_alice      
threads: 4
username: alice
password: '{{ env_var(''DBT_ENV_SECRET_PASSWORD'') }}'
```

#### Расширенные атрибуты не скрывают секретные значения
Мы рекомендуем избегать установки секретных значений, чтобы предотвратить их видимость в текстовом поле и журналах. Общий обходной путь заключается в оборачивании расширенных атрибутов в [переменные окружения](/docs/build/environment-variables). В предыдущем примере `password: '{{ env_var(''DBT_ENV_SECRET_PASSWORD'') }}'` получит значение из переменной окружения `DBT_ENV_SECRET_PASSWORD` во время выполнения.

#### Как работают расширенные атрибуты
Если вы разрабатываете в [<Constant name="cloud_ide" />](/docs/cloud/studio-ide/develop-in-studio), [<Constant name="cloud_cli" />](/docs/cloud/cloud-cli-installation) или [оркестрируете запуски джобов](/docs/deploy/deployments), механизм расширенных атрибутов проходит по предоставленному YAML и извлекает атрибуты `profiles.yml`. Для каждого отдельного атрибута:

- Если атрибут уже существует в другом источнике (например, в настройках проекта), его значение в профиле будет заменено (например, значения уровня окружения). Он также переопределяет любые пользовательские переменные окружения (если только они сами не подключены с использованием синтаксиса, описанного выше для секретов).

- Если атрибут не существует, он будет добавлен в профиль как пара «атрибут–значение».

#### В расширенных атрибутах принимаются **только ключи верхнего уровня**
Это означает, что если вы хотите изменить значение конкретного вложенного ключа, вы должны передать весь ключ верхнего уровня целиком в виде JSON-блока в итоговом YAML. Например, если вы хотите настроить конкретное поле внутри [JSON сервисного аккаунта](/docs/core/connect-data-platform/bigquery-setup#service-account-json) для подключения к BigQuery (например, `project_id` или `client_email`), вам нужно предоставить переопределение всего основного ключа/атрибута верхнего уровня `keyfile_json` с помощью расширенных атрибутов. При этом вложенные поля должны быть включены как вложенный JSON-блок.

- Если атрибут существует в другом источнике (например, в настройках вашего проекта), он заменит его значение (например, значения на уровне окружения) в профиле. Он также переопределяет любые пользовательские переменные окружения (если сам не подключен с использованием описанного выше синтаксиса для секретов).

- Если атрибут не существует, он добавит атрибут или пару значений в профиль.

#### Только **ключи верхнего уровня** принимаются в расширенных атрибутах
Это означает, что если вы хотите изменить конкретное значение под-ключа, вы должны предоставить весь ключ верхнего уровня в виде JSON-блока в вашем итоговом YAML. Например, если вы хотите настроить определенное поле в [JSON учетной записи службы](/docs/core/connect-data-platform/bigquery-setup#service-account-json) для вашего подключения BigQuery (например, 'project_id' или 'client_email'), вам нужно предоставить переопределение для всего ключа/атрибута верхнего уровня `keyfile_json`, используя расширенные атрибуты. Включите под-поля в виде вложенного JSON-блока.