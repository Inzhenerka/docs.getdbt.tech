---
id: left-join
title: SQL LEFT JOIN
description: Левое соединение возвращает все строки из оператора FROM, независимо от совпадений в объекте базы данных левого соединения.
slug: /sql-reference/left-join
---

<head>
    <title>Работа с левыми соединениями в SQL</title>
</head>

Любимое соединение аналитических инженеров: левое соединение. Без сомнения, это, вероятно, самое часто используемое соединение в любом проекте dbt (и на то есть веские причины).

Левое соединение возвращает все строки из [оператора FROM](/sql-reference/from), независимо от совпадений в объекте базы данных левого соединения. Сравните это с [внутренним соединением](/sql-reference/inner-join), где возвращаются только строки, которые имеют успешные совпадения ключей между объектом базы данных в операторе FROM и в операторе внутреннего соединения.

## Как создать левое соединение

Как и все соединения, вам нужны некоторые объекты базы данных (т.е. таблицы/представления), ключи для соединения и [оператор select](/sql-reference/select) для выполнения левого соединения:

```
select
    <fields>
from <table_1> as t1
left join <table_2> as t2
on t1.id = t2.id 
```

В приведенном выше примере используется только одно поле из каждой таблицы для соединения их вместе; если вы соединяете два объекта базы данных, которые требуют нескольких полей, вы можете использовать операторы AND/OR, а еще лучше — <Term id="surrogate-key">суррогатные ключи</Term>. Вы также можете добавить [WHERE](/sql-reference/where), [GROUP BY](/sql-reference/group-by), [ORDER BY](/sql-reference/order-by), [HAVING](/sql-reference/having) и другие операторы после ваших соединений для создания фильтрации, сортировки и выполнения агрегирования. Вы также можете использовать левое (или любое другое) соединение столько раз, сколько хотите, в одном запросе или <Term id="cte" />.

### Пример SQL левого соединения

Таблица A `car_type`

| **user_id** | **car_type** |
|:---:|:---:|
| 1 | van |
| 2 | sedan |
| 3 | truck |

Таблица B `car_color`

| user_id | car_color |
|:---:|:---:|
| 1 | red |
| 3 | green |
| 4 | yellow |

```sql
select
   car_type.user_id as user_id,
   car_type.car_type as type,
   car_color.car_color as color
from {{ ref('car_type') }} as car_type
left join {{ ref('car_color') }} as car_color
on car_type.user_id = car_color.user_id
```

Этот простой запрос вернет *все строки* из Таблицы A и добавит столбец `color` к строкам, где есть успешное совпадение с Таблицей B:

| **user_id** | **type** | **color** |
|:---:|:---:|:---:|
| 1 | van | red |
| 2 | sedan | null |
| 3 | truck | green |

Поскольку в Таблице B нет `user_id` = 2, для `user_id` 2 нет доступного `color`, поэтому результатом будет `null` в столбце `color`.

## Сценарии использования SQL левого соединения

Левые соединения являются основополагающими в моделировании данных и аналитической инженерии — они позволяют легко соединять объекты базы данных друг с другом, сохраняя при этом количество строк оригинальной таблицы (в операторе from). По сравнению с правыми соединениями, которые возвращают все строки в объекте базы данных правого соединения (а не в операторе from), мы находим левые соединения немного более интуитивно понятными для понимания и построения.

:::tip Убедитесь, что ваши соединения правильные
Важно отметить, что если вы используете левые соединения: если для отдельного ключа в объекте базы данных левого соединения есть несколько записей, будьте осторожны, что дубликаты могут потенциально появиться в конечном результате запроса. Здесь тесты dbt, такие как тестирование на <Term id="primary-key" /> уникальность и [равенство количества строк](https://github.com/dbt-labs/dbt-utils#equal_rowcount-source) между исходными таблицами и дочерними моделями, могут помочь вам выявить ошибки в логике моделирования данных и улучшить качество данных.
:::

Где вы не увидите (и не должны видеть) левых соединений, так это в [стадийных моделях](/best-practices/how-we-structure/2-staging), которые используются для очистки и подготовки сырых исходных данных для аналитических нужд. Все соединения в ваших проектах dbt должны происходить дальше по потоку в [промежуточных](/best-practices/how-we-structure/3-intermediate) и [маркетинговых моделях](/best-practices/how-we-structure/4-marts), чтобы улучшить модульность и чистоту <Term id="dag" />.