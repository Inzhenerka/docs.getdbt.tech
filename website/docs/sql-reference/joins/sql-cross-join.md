---
id: cross-join
title: SQL CROSS JOIN
description: Кросс-джойн обычно берет два столбца между двумя объектами базы данных и создает таблицу, формируя комбинацию всех строк объединенных таблиц, называемую декартовым произведением.
slug: /sql-reference/cross-join
---

<head>
    <title>Работа с кросс-джойнами в SQL</title>
</head>

Редко встречающийся, но важный тип соединения: кросс-джойн. Большинство вашей работы в области аналитического инжиниринга потребует от вас объединения таблиц для создания надежных, широких таблиц, которые в конечном итоге будут доступны конечным пользователям бизнеса. Эти модели обычно создаются в основном с использованием [левых](/sql-reference/left-join) (и некоторых [внутренних](/sql-reference/inner-join)) соединений.

Кросс-джойн, с другой стороны, обычно берет два столбца между двумя объектами базы данных и создает таблицу, формируя комбинацию всех строк объединенных таблиц, называемую декартовым произведением. Используйте эту страницу, чтобы понять, как использовать кросс-джойны и где вы можете их применить в вашем проекте dbt.

## Как создать кросс-джойн

В отличие от обычных соединений, кросс-джойны не используют ключи для объединения объектов базы данных:

```
select
    <fields>
from <table_1> as t1
cross join <table_2> as t2
```

Кросс-джойны — это одна из тех концепций SQL, которые легче понять на конкретном примере, поэтому давайте перейдем к нему.

### Пример кросс-джойна в SQL

Таблица A `date_spine`

| date |
|:---:|
| 2022-01-01 |
| 2022-01-02 |
| 2022-01-03 |

Таблица B `users`

| user_id |
|:---:|
| 1 |
| 3 |
| 4 |

```sql
select
   users.user_id as user_id,
   date.date as date
from {{ ref('users') }} as users
cross join {{ ref('date_spine') }} as date
order by 1
```

Этот простой запрос вернет декартово произведение всех пользователей и дат, фактически создавая уникальную комбинацию пользователя на дату в каждой строке:

| user_id | type |
|:---:|:---:|
| 1 | 2022-01-01 |
| 1 | 2022-01-02 |
| 1 | 2022-01-03 |
| 2 | 2022-01-01 |
| 2 | 2022-01-02 |
| 2 | 2022-01-03 |
| 3 | 2022-01-01 |
| 3 | 2022-01-02 |
| 3 | 2022-01-03 |

:::tip Генерация суррогатных ключей из кросс-джойнов
В сгенерированной таблице выше уникальный ключ представляет собой комбинацию `user_id` и `date` для каждой строки. Чтобы добавить <Term id="primary-key" /> в эту таблицу, вы можете сгенерировать <Term id="surrogate-key" /> с помощью MD5 хеша, используя макрос `generate_surrogate_key` из dbt-utils (например, `{{ dbt_utils.generate_surrogate_key(user_id, type) }}`), который в конечном итоге можно будет объединить с другими таблицами.
:::

## Случай использования кросс-джойна в SQL

Когда сгенерированная таблица выше может быть полезна? Кросс-джойн уникальных дат и пользователей может быть эффективным способом создания базовой таблицы для объединения различных количеств событий, таких как ключевые события на сайте, по электронной почте или продукту. Эти таблицы отчетов полезны для предоставления конечным пользователям бизнеса в инструментах BI для анализа агрегированных данных по дням на пользователя и другим полезным показателям.