---
title: "Доступ к моделям"
id: model-access
sidebar_label: "Доступ к моделям"
description: "Определите доступ к моделям с возможностями групп"
---

:::info "Доступ к моделям" не является "Доступом пользователей"

**Группы моделей и доступ** и **группы пользователей и доступ** означают две разные вещи. "Группы пользователей и доступ" — это специфический термин, используемый в dbt Cloud для управления разрешениями. Для получения дополнительной информации обратитесь к [Доступу пользователей](/docs/cloud/manage-access/about-user-access).

Эти два понятия будут тесно связаны, поскольку мы разрабатываем рабочие процессы многопроектного сотрудничества в этом году:
- Пользователи, имеющие доступ к разработке в проекте dbt, могут просматривать и изменять **все** модели в этом проекте, включая частные модели.
- Пользователи в той же учетной записи dbt Cloud, _не имеющие_ доступа к разработке в проекте, не могут просматривать частные модели этого проекта и могут зависеть только от его публичных моделей.
:::

## Связанная документация
* [`groups`](/docs/build/groups)
* [`access`](/reference/resource-configs/access)

## Группы

Модели могут быть сгруппированы под общим обозначением с общим владельцем. Например, вы можете сгруппировать все модели, принадлежащие определенной команде, или связанные с моделированием конкретного источника данных (`github`).

Зачем определять группы моделей? Есть две причины:
- Это превращает неявные отношения в явную группировку с определенным владельцем. Размышляя о границах интерфейса _между_ группами, вы можете получить более чистый (менее запутанный) DAG. В будущем эти границы интерфейса могут быть уместны как интерфейсы между отдельными проектами.
- Это позволяет вам обозначить определенные модели как имеющие "частный" доступ — для использования исключительно в этой группе. Другие модели будут ограничены в возможности ссылаться (зависеть) на эти модели. В будущем они не будут видны другим командам, зависящим от вашего проекта — только "публичные" модели будут видимы.

Если вы следуете нашим [рекомендациям по структурированию проекта dbt](/best-practices/how-we-structure/1-guide-overview), вы, вероятно, уже используете подкаталоги для организации вашего проекта dbt. Легко применить метку `group` ко всему подкаталогу сразу:

<File name="dbt_project.yml">

```yml
models:
  my_project_name:
    marts:
      customers:
        +group: customer_success
      finance:
        +group: finance
```

</File>

Каждая модель может принадлежать только одной `group`, и группы не могут быть вложенными. Если вы установите другую `group` в YAML этой модели или в конфигурации файла, она переопределит `group`, примененную на уровне проекта.

## Модификаторы доступа

Некоторые модели являются деталями реализации, предназначенными для справки только в пределах их группы связанных моделей. Другие модели должны быть доступны через функцию [ref](/reference/dbt-jinja-functions/ref) между группами и проектами. Модели могут установить [модификатор доступа](https://en.wikipedia.org/wiki/Access_modifiers), чтобы указать свой предполагаемый уровень доступности.

| Доступ    | Ссылается на                       |
|-----------|-------------------------------------|
| private   | Та же группа                       |
| protected | Тот же проект (или установлен как пакет) |
| public    | Любая группа, пакет или проект. При определении повторно запустите производственную задачу, чтобы применить изменение |

Если вы попытаетесь сослаться на модель вне ее поддерживаемого доступа, вы увидите ошибку:

```shell
dbt run -s marketing_model
...
dbt.exceptions.DbtReferenceError: Parsing Error
  Node model.jaffle_shop.marketing_model attempted to reference node model.jaffle_shop.finance_model, 
  which is not allowed because the referenced node is private to the finance group.
```

По умолчанию все модели являются `protected`. Это означает, что другие модели в том же проекте могут ссылаться на них, независимо от их группы. Это в значительной степени для обратной совместимости при назначении групп уже существующему набору моделей, так как могут уже существовать ссылки между назначениями групп.

Тем не менее, рекомендуется устанавливать модификатор доступа новой модели на `private`, чтобы предотвратить зависимость других ресурсов проекта от моделей, не предназначенных для совместного использования между группами.

<File name="models/marts/customers.yml">

```yaml
# Сначала определите группу и владельца
groups:
  - name: customer_success
    owner:
      name: Customer Success Team
      email: cx@jaffle.shop

# Затем добавьте 'group' + 'access' модификатор к конкретным моделям
models:
  # Это публичная модель — это стабильный и зрелый интерфейс для других команд/проектов
  - name: dim_customers
    group: customer_success
    access: public
    
  # Это частная модель — это промежуточная трансформация, предназначенная для использования только в этом контексте
  - name: int_customer_history_rollup
    group: customer_success
    access: private
    
  # Это защищенная модель — она может быть полезна в *этом* проекте,
  # но не должна быть доступна в других
  - name: stg_customer__survey_results
    group: customer_success
    access: protected
```

</File>

Модели с `materialized`, установленным на `ephemeral`, не могут иметь свойство доступа, установленное на публичное.

Например, если у вас есть конфигурация модели, установленная как:

<File name="models/my_model.sql">

```sql

{{ config(materialized='ephemeral') }}

```

</File>

И доступ к модели определен:

<File name="models/my_project.yml">

```yaml
models:
  - name: my_model
    access: public

```

</File>

Это приведет к следующей ошибке:

```
❯ dbt parse
02:19:30  Encountered an error:
Parsing Error
  Node model.jaffle_shop.my_model with 'ephemeral' materialization has an invalid value (public) for the access field
```

## Часто задаваемые вопросы

### Как доступ к моделям соотносится с разрешениями базы данных?

Это разные вещи!

Указание `access: public` для модели не приводит к тому, что dbt автоматически предоставляет `select` на эту модель каждому пользователю или роли в вашей платформе данных при ее материализации. У вас есть полный контроль над управлением разрешениями базы данных для каждой модели/схемы, как это имеет смысл для вас и вашей организации.

Конечно, dbt может облегчить это с помощью [конфигурации `grants`](/reference/resource-configs/grants) и других гибких механизмов. Например:
- Предоставить доступ к моделям для последующих запросов на публичные модели
- Ограничить доступ к частным моделям, отозвав стандартные/будущие гранты или разместив их в другой схеме

По мере того как мы продолжаем развивать многопроектное сотрудничество, `access: public` будет означать, что другим командам разрешено начинать зависеть от этой модели. Это предполагает, что они запросили, и вы предоставили им доступ к выборке из основного набора данных.

### Как мне сослаться на модель из другого проекта?

Вы можете `ref` модель из другого проекта двумя способами:
1. [Зависимость проекта](/docs/collaborate/govern/project-dependencies): В dbt Cloud Enterprise вы можете использовать зависимости проекта, чтобы `ref` модель. dbt Cloud использует служебный метаданных для разрешения ссылки, что позволяет эффективно сотрудничать между командами и в масштабах.
2. ["Пакет" зависимость](/docs/build/packages): Другой способ `ref` модели из другого проекта — рассматривать другой проект как зависимость пакета. Это требует установки другого проекта как пакета, включая его полный исходный код, а также его верхние зависимости.

### Как мне ограничить доступ к моделям, определенным в пакете?

Исходный код, установленный из пакета, становится частью вашей рабочей среды. Вы можете вызывать макросы и запускать модели так, как если бы они были макросами и моделями, которые вы определили в своем собственном проекте.

По этой причине ограничения доступа к моделям по умолчанию "выключены" для моделей, определенных в пакетах. Вы можете ссылаться на модели из этого пакета независимо от их модификатора `access`.

Проект, установленный как пакет, может дополнительно ограничить внешний доступ `ref` только к своим публичным моделям. Поддерживающий пакет делает это, установив конфигурацию `restrict-access` в `True` в `dbt_project.yml`.

По умолчанию значение этой конфигурации равно `False`. Это означает, что:
- Модели в пакете с `access: protected` могут быть ссылками на модели в корневом проекте, как если бы они были определены в том же проекте
- Модели в пакете с `access: private` могут быть ссылками на модели в корневом проекте, при условии, что они также имеют ту же конфигурацию `group`

Когда `restrict-access: True`:
- Любая `ref` снаружи пакета на защищенную или частную модель в этом пакете завершится неудачей.
- Только модели с `access: public` могут быть ссылками снаружи пакета.

<File name="dbt_project.yml">

```yml
restrict-access: True  # по умолчанию False
```

</File>