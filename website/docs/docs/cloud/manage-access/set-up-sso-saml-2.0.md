---
title: "Настройка SSO с SAML 2.0"
id: "set-up-sso-saml-2.0"
---

import SetUpPages from '/snippets/_sso-docs-mt-available.md';

<SetUpPages features={'/snippets/_sso-docs-mt-available.md'}/>

dbt Cloud Enterprise поддерживает одноразовую аутентификацию (SSO) для любого поставщика удостоверений (IdP), совместимого с SAML 2.0.
В настоящее время поддерживаются следующие функции:
* SSO, инициированное IdP
* SSO, инициированное SP
* Провизия "по требованию"

Этот документ описывает шаги по интеграции dbt Cloud с поставщиком удостоверений для настройки одноразовой аутентификации и [управления доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control).

## URI для Auth0

<Snippet path="auth0-uri" />

## Общие интеграции SAML 2.0

Если ваш поставщик удостоверений SAML — это Okta, Google, Azure или OneLogin, перейдите к соответствующему разделу ниже на этой странице. Для всех других поставщиков удостоверений, совместимых с SAML, вы можете использовать инструкции в этом разделе для настройки этого поставщика удостоверений.

### Настройка вашего поставщика удостоверений

Вам потребуется доступ администратора к вашему поставщику удостоверений, совместимому с SAML 2.0, чтобы настроить поставщика удостоверений. Вы можете использовать следующие инструкции с любым поставщиком удостоверений, совместимым с SAML 2.0.

### Создание приложения

1. Войдите в ваш поставщик удостоверений SAML 2.0 и создайте новое приложение.
2. При появлении запроса настройте приложение со следующими данными:
   - **Платформа:** Web
   - **Метод входа:** SAML 2.0
   - **Имя приложения:** dbt Cloud
   - **Логотип приложения (необязательно):** Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и использовать его в качестве логотипа для этого приложения.

#### Настройка приложения

<Snippet path="access_url" />

Для завершения этого раздела вам нужно будет создать slug для входа. Этот slug управляет URL, по которому пользователи вашего аккаунта могут войти в ваше приложение. Slug для входа обычно представляет собой название вашей организации в нижнем регистре. Он должен содержать только буквы, цифры и дефисы. Например, slug для входа для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех аккаунтов dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

При запросе конфигураций приложения SAML 2.0 укажите следующие значения:

* URL для одноразового входа: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
* URI аудитории (SP Entity ID): `urn:auth0:<YOUR_AUTH0_ENTITYID>:{login slug}`
- Relay State: `<login slug>`

Кроме того, вы можете настроить атрибуты IdP, передаваемые от вашего поставщика удостоверений в dbt Cloud. Мы рекомендуем использовать следующие значения:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| email | Не указано | user.email | Адрес электронной почты пользователя |
| first_name | Не указано | user.first_name | Имя пользователя |
| last_name | Не указано | user.last_name | Фамилия пользователя |
| NameID (если применимо) | Не указано | user.email | Адрес электронной почты пользователя |

[Управление доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control) в dbt Cloud полагается на сопоставление групп из IdP для назначения пользователей dbt Cloud в группы dbt Cloud. Чтобы использовать управление доступом на основе ролей в dbt Cloud, также настройте ваш поставщик удостоверений для предоставления информации о членстве в группах в атрибуте пользователя, называемом `groups`:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| groups | Не указано | `<IdP-specific>` | Группы, к которым принадлежит пользователь в IdP |

:::info Примечание
Вы можете использовать ограниченное заявление атрибута группы, чтобы ограничить набор групп, передаваемых в dbt Cloud для каждого аутентифицированного пользователя. Например, если все ваши группы dbt Cloud начинаются с `DBT_CLOUD_...`, вы можете применить фильтр, такой как `Starts With: DBT_CLOUD_`.
:::

### Сбор секретов интеграции

После подтверждения ваших данных IdP должен показать вам следующие значения для новой интеграции SAML 2.0. Храните эти значения в безопасном месте, так как они понадобятся вам для завершения настройки в dbt Cloud.

- Издатель поставщика удостоверений
- URL SSO поставщика удостоверений
- Сертификат X.509

### Завершение настройки

После создания приложения следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с Okta

Вы можете использовать инструкции в этом разделе для настройки Okta в качестве вашего поставщика удостоверений.

1. Войдите в ваш аккаунт Okta. Используя панель администратора, создайте новое приложение.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-1-new-app.png"
    title="Создание нового приложения"
/>

2. Выберите следующие конфигурации:
   - **Платформа**: Web
   - **Метод входа**: SAML 2.0

3. Нажмите **Создать**, чтобы продолжить процесс настройки.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-1-new-app-create.png"
    title="Настройка нового приложения"
/>

### Настройка приложения Okta

<Snippet path="access_url" />

Для завершения этого раздела вам нужно будет создать slug для входа. Этот slug управляет URL, по которому пользователи вашего аккаунта могут войти в ваше приложение. Slug для входа обычно представляет собой название вашей организации в нижнем регистре. Он должен содержать только буквы, цифры и дефисы. Например, slug для входа для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех аккаунтов dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. На странице **Общие настройки** введите следующие данные:

   * **Имя приложения**: dbt Cloud
   * **Логотип приложения** (необязательно): Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и загрузить его в Okta, чтобы использовать в качестве логотипа для этого приложения.

2. Нажмите **Далее**, чтобы продолжить.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-2-general-settings.png"
    title="Настройка общих параметров приложения"
/>

### Настройка параметров SAML

1. На странице **Настройки SAML** введите следующие значения:

   * **URL для одноразового входа**: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   * **URI аудитории (SP Entity ID)**: `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   * **Relay State**: `<login slug>`

  <Lightbox collapsed={false} src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-3-saml-settings-top.png" title="Настройка параметров SAML приложения"/>

2. Сопоставьте атрибуты пользователей и групп вашей организации в Okta с форматом, который ожидает dbt Cloud, используя формы заявлений атрибутов и заявлений атрибутов групп.

3. Следующая таблица иллюстрирует ожидаемые заявления атрибутов пользователей:

   | Имя           | Формат имени | Значение                | Описание                |
   | -------------- | ----------- | -------------------- | -------------------------- |
   | `email`        | Не указано | `user.email`      | _Адрес электронной почты пользователя_ |
   | `first_name`   | Не указано | `user.firstName`  | _Имя пользователя_    |
   | `last_name`    | Не указано | `user.lastName`   | _Фамилия пользователя_     |

4. Следующая таблица иллюстрирует ожидаемые **заявления атрибутов групп**:

   | Имя     | Формат имени | Фильтр        | Значение | Описание                           |
   | -------- | ----------- | ------------- | ----- | ------------------------------------- |
   | `groups` | Не указано | Соответствует регулярному выражению | `.*`  | _Группы, к которым принадлежит пользователь_ |

Вы можете использовать более ограничительное заявление атрибута группы, чем показано в предыдущих шагах. Например, если все ваши группы dbt Cloud начинаются с `DBT_CLOUD_`, вы можете использовать фильтр, такой как `Starts With: DBT_CLOUD_`. **Okta возвращает только 100 групп для каждого пользователя, поэтому, если ваши пользователи принадлежат более чем 100 группам IdP, вам нужно будет использовать более ограничительный фильтр**. Пожалуйста, свяжитесь с поддержкой, если у вас есть вопросы.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-3-saml-settings-bottom.png"
    title="Настройка заявлений атрибутов пользователей и групп приложения"
/>

5. Нажмите **Далее**, чтобы продолжить.

### Завершение настройки Okta

1. Выберите *Я клиент Okta, добавляющий внутреннее приложение*.
2. Выберите *Это внутреннее приложение, которое мы создали*.
3. Нажмите **Завершить**, чтобы завершить настройку приложения.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-4-feedback.png"
    title="Завершение настройки в Okta"
/>

### Просмотр инструкций по настройке

1. На следующей странице нажмите **Просмотреть инструкции по настройке**.
2. В следующих шагах вы предоставите эти значения в настройках аккаунта dbt Cloud для завершения интеграции между Okta и dbt Cloud.

<Lightbox
    collapsed={true}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-5-view-instructions.png"
    title="Просмотр настроенного приложения"
/>

<Lightbox
    collapsed={true}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-5-instructions.png"
    title="Инструкции по настройке приложения"
/>

3. После создания приложения Okta следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с Google

Используйте этот раздел, если вы настраиваете Google в качестве вашего поставщика удостоверений.

### Настройка приложения Google

<Snippet path="access_url" />

Для завершения этого раздела вам нужно будет создать slug для входа. Этот slug управляет URL, по которому пользователи вашего аккаунта могут войти в ваше приложение. Slug для входа обычно представляет собой название вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для входа для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех аккаунтов dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. Войдите в **Консоль администратора Google** через аккаунт с правами супер администратора.
2. На главной странице консоли администратора перейдите в **Приложения**, затем нажмите **Веб и мобильные приложения**.
3. Нажмите **Добавить**, затем нажмите **Добавить пользовательское SAML приложение**.
4. Нажмите **Далее**, чтобы продолжить.
5. Внесите следующие изменения на странице сведений о приложении:
    - Назовите пользовательское приложение
    - Загрузите логотип приложения (необязательно)
    - Нажмите **Продолжить**.

### Настройка параметров SAML

1. Перейдите на страницу **Сведения о поставщике удостоверений Google**.
2. Скачайте **метаданные IDP**.
3. Скопируйте **URL SSO** и **ID сущности** и скачайте **Сертификат** (или **отпечаток SHA-256**, если необходимо).
4. Введите следующие значения в окне **Сведения о поставщике услуг**:
   * **URL ACS**: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   * **URI аудитории (SP Entity ID)**: `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   - **Начальный URL**: `<login slug>`
5. Установите флажок **Подписанный ответ**.
6. По умолчанию **Name ID** — это основной адрес электронной почты. Многозначный ввод не поддерживается.
7. Используйте страницу **Сопоставление атрибутов**, чтобы сопоставить атрибуты каталога Google вашей организации с форматом, который ожидает dbt Cloud.
8. Нажмите **Добавить другое сопоставление**, чтобы сопоставить дополнительные атрибуты.

Ожидаемые **Атрибуты**:

| Имя           | Формат имени | Значение                | Описание                |
| -------------- | ----------- | -------------------- | -------------------------- |
| `First name`   | Не указано | `first_name`         | Имя пользователя.  |
| `Last name`    | Не указано | `last_name`          | Фамилия пользователя.     |
| `Primary email`| Не указано | `email`              |  Адрес электронной почты пользователя. |

9. Чтобы использовать [управление доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control) в dbt Cloud, введите группы в поле **Членство в группах** во время настройки:

| Группы Google  | Атрибуты приложения |
| -------------- | -------------- |
| Название групп | `groups` |

10. Нажмите **Завершить**, чтобы продолжить.

### Завершение настройки Google

1. На главной странице консоли администратора перейдите в **Приложения**, затем нажмите **Веб и мобильные приложения**.
2. Выберите ваше SAML приложение.
3. Нажмите **Доступ пользователей**.
4. Чтобы включить или отключить сервис для всех в вашей организации, нажмите **Включить для всех** или **Отключить для всех**, затем нажмите **Сохранить**.
5. Убедитесь, что адреса электронной почты, которые ваши пользователи используют для входа в SAML приложение, совпадают с адресами электронной почты, которые они используют для входа в ваш домен Google.

**Примечание:** Изменения обычно вступают в силу в течение нескольких минут, но могут занять до 24 часов.

### Завершение настройки

После создания приложения Google следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup).

## Интеграция с Microsoft Entra ID (ранее Azure AD)

Если вы используете Microsoft Entra ID (ранее Azure AD), инструкции ниже помогут вам настроить его в качестве вашего поставщика удостоверений.

### Создание корпоративного приложения Microsoft Entra ID

<Snippet path="access_url" />

Для завершения этого раздела вам нужно будет создать slug для входа. Этот slug управляет URL, по которому пользователи вашего аккаунта могут войти в ваше приложение. Slug для входа обычно представляет собой название вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для входа для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех аккаунтов dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

Следуйте этим шагам, чтобы настроить одноразовую аутентификацию (SSO) с dbt Cloud:

1. Войдите в ваш аккаунт Azure.
2. В портале Entra ID выберите **Корпоративные приложения** и нажмите **+ Новое приложение**.
3. Выберите **Создать собственное приложение**.
4. Назовите приложение "dbt Cloud" или другим описательным именем.
5. Выберите **Интегрировать любое другое приложение, которое вы не найдете в галерее (Не из галереи)** в качестве типа приложения.
6. Нажмите **Создать**.
7. Вы можете найти новое приложение, нажав **Корпоративные приложения** и выбрав **Все приложения**.
8. Нажмите на приложение, которое вы только что создали.
9. Выберите **Одноразовая аутентификация** в разделе Управление в левой навигации.
10. Нажмите **Настроить одноразовую аутентификацию** в разделе Начало работы.
<Lightbox src="/img/docs/dbt-cloud/access-control/single-sign-on-overview.jpg" width="75%" title="На вашей странице Обзор выберите 'Настроить одноразовую аутентификацию" />

11.  Нажмите **SAML** в разделе "Выберите метод одноразовой аутентификации".
<Lightbox src="/img/docs/dbt-cloud/access-control/saml.jpg" width="75%" title="Выберите карточку 'SAML' в разделе 'Выберите метод одноразовой аутентификации'. " />

12.   Нажмите **Редактировать** в разделе Основная конфигурация SAML.

<Lightbox src="/img/docs/dbt-cloud/access-control/basic-saml.jpg" width="75%" title="На странице 'Настройка одноразовой аутентификации с SAML' нажмите 'Редактировать' в карточке 'Основная конфигурация SAML'"  />

13. Используйте следующую таблицу для заполнения обязательных полей и подключения к dbt:

   | Поле | Значение |
   | ----- | ----- |
   | **Идентификатор (Entity ID)** | Используйте `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`. |
   | **URL ответа (URL службы потребления утверждений)** | Используйте `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`. |
   | **Relay State** | `<login slug>` |

14.   Нажмите **Сохранить** в верхней части формы.

### Создание настроек SAML

На странице Настройка одноразовой аутентификации с SAML:

1. Нажмите **Редактировать** в разделе Атрибуты и утверждения пользователей.
2. Оставьте утверждение в разделе "Обязательное утверждение" как есть.
3. Удалите все утверждения в разделе "Дополнительные утверждения".
4. Нажмите **Добавить новое утверждение** и добавьте эти три новых утверждения:

   | Имя | Исходный атрибут |
   | ----- | ----- |
   | **email** | user.mail |
   | **first_name** | user.givenname |
   | **last_name** | user.surname |

5. Нажмите **Добавить утверждение группы** в разделе Атрибуты и утверждения пользователей.
6. Если вы будете назначать пользователей непосредственно корпоративному приложению, выберите **Группы безопасности**. Если нет, выберите **Группы, назначенные приложению**.
7. Установите **Исходный атрибут** на **ID группы**.
8. В разделе **Дополнительные параметры** установите флажок **Настроить имя утверждения группы** и укажите **Имя** как **groups**.

**Примечание:** Имейте в виду, что ID группы в Entra ID сопоставляется с GUID этой группы. Он должен быть указан в нижнем регистре, чтобы сопоставления работали как ожидается. Поле Исходный атрибут может быть установлено на другое значение по вашему усмотрению.

### Завершение настройки

9. После создания приложения Azure следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с OneLogin

Используйте этот раздел, если вы настраиваете OneLogin в качестве вашего поставщика удостоверений.

Для настройки OneLogin вам потребуется доступ **Администратора**.

### Настройка приложения OneLogin

<Snippet path="access_url" />

Для завершения этого раздела вам нужно будет создать slug для входа. Этот slug управляет URL, по которому пользователи вашего аккаунта могут войти в ваше приложение. Slug для входа обычно представляет собой название вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для входа для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех аккаунтов dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. Войдите в OneLogin и добавьте новое приложение SAML 2.0.
2. Настройте приложение со следующими данными:
   - **Платформа:** Web
   - **Метод входа:** SAML 2.0
   - **Имя приложения:** dbt Cloud
   - **Логотип приложения (необязательно):** Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и использовать его в качестве логотипа для этого приложения.

### Настройка параметров SAML

3. В разделе **Конфигурация** введите следующие значения:

   - **RelayState:** `<login slug>`
   - **Аудитория (EntityID):** `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   - **URL валидатора ACS (Consumer):** `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   - **URL ACS (Consumer):** `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`

4. Далее перейдите на вкладку **Параметры**. У вас должен быть параметр для атрибутов Email, First Name и Last Name и включите все параметры в утверждения SAML. При добавлении пользовательских параметров убедитесь, что вы выбрали флажок **Включить в утверждение SAML**.

Мы рекомендуем использовать следующие значения:

| имя | формат имени | значение |
| ---- | ----------- | ----- |
| NameID | Не указано | Email |
| email | Не указано | Email |
| first_name | Не указано | First Name |
| last_name | Не указано | Last Name |

[Управление доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control) в dbt Cloud полагается на сопоставление групп из IdP для назначения пользователей dbt Cloud в группы dbt Cloud. Чтобы использовать управление доступом на основе ролей в dbt Cloud, также настройте OneLogin для предоставления информации о членстве в группах в атрибуте пользователя, называемом `groups`:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| groups | Не указано | Серия групп, которые будут использоваться для вашей организации | Группы, к которым принадлежит пользователь в IdP |

### Сбор секретов интеграции

5. После подтверждения ваших данных перейдите на вкладку **SSO**. OneLogin должен показать вам следующие значения для новой интеграции. Храните эти значения в безопасном месте, так как они понадобятся вам для завершения настройки в dbt Cloud.

- URL издателя
- Конечная точка SAML 2.0 (HTTP)
- Сертификат X.509

### Завершение настройки

6. После создания приложения OneLogin следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Настройка dbt Cloud

### Предоставление значений IdP в dbt Cloud

Чтобы завершить настройку, выполните следующие шаги в dbt Cloud:

1. Перейдите в **Настройки аккаунта**, затем нажмите на **Одноразовая аутентификация**.
2. Нажмите **Редактировать** в правом верхнем углу.
3. Укажите следующие данные SSO:

   | Поле | Значение |
   | ----- | ----- |
   | Вход&nbsp;с&nbsp;помощью | SAML 2.0 |
   | URL&nbsp;SSO&nbsp;поставщика&nbsp;удостоверений | Вставьте **URL одноразовой аутентификации поставщика удостоверений**, показанный в инструкциях по настройке IdP |
   | Издатель&nbsp;поставщика&nbsp;удостоверений | Вставьте **Издатель поставщика удостоверений**, показанный в инструкциях по настройке IdP |
   | Сертификат&nbsp;X.509 | Вставьте **Сертификат X.509**, показанный в инструкциях по настройке IdP; <br />**Примечание:** Когда срок действия сертификата истечет, администратор IdP должен будет сгенерировать новый и вставить его в dbt Cloud для непрерывного доступа к приложению. |
   | Slug | Введите желаемый slug для входа. |
    <Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-6-setup-integration.png"
        title="Настройка приложения в dbt Cloud" />

4. Нажмите **Сохранить**, чтобы завершить настройку интеграции SAML 2.0.
5. После завершения настройки вы можете перейти по URL, сгенерированному для _slug_ вашего аккаунта, чтобы протестировать вход с вашим поставщиком удостоверений. Кроме того, пользователи, добавленные в приложение SAML 2.0, смогут войти в dbt Cloud непосредственно из IdP.

<Snippet path="login_url_note" />

### Настройка RBAC

После настройки поставщика удостоверений вы сможете настроить [управление доступом на основе ролей](/docs/cloud/manage-access/enterprise-permissions) для вашего аккаунта.