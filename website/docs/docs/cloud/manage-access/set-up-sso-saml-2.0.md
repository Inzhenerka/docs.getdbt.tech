---
title: "Настройка SSO с SAML 2.0"
id: "set-up-sso-saml-2.0"
---

import SetUpPages from '/snippets/_sso-docs-mt-available.md';

<SetUpPages features={'/snippets/_sso-docs-mt-available.md'}/>

dbt Cloud Enterprise поддерживает единую аутентификацию (SSO) для любого поставщика идентификации (IdP), совместимого с SAML 2.0. В настоящее время поддерживаемые функции включают:
* Инициированная IdP SSO
* Инициированная SP SSO
* Провизия по запросу

В этом документе описаны шаги для интеграции dbt Cloud с поставщиком идентификации для настройки единой аутентификации и [управления доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control).

## URI Auth0

<Snippet path="auth0-uri" />

## Общие интеграции SAML 2.0

Если ваш SAML поставщик идентификации является одним из Okta, Google, Azure или OneLogin, перейдите к соответствующему разделу ниже на этой странице. Для всех других совместимых с SAML поставщиков идентификации вы можете использовать инструкции в этом разделе для их настройки.

### Настройка вашего поставщика идентификации

Вам потребуется доступ администратора к вашему SAML 2.0 совместимому поставщику идентификации для его настройки. Вы можете использовать следующие инструкции с любым SAML 2.0 совместимым поставщиком идентификации.

### Создание приложения

1. Войдите в ваш SAML 2.0 поставщик идентификации и создайте новое приложение.
2. При запросе настройте приложение с следующими данными:
   - **Платформа:** Веб
   - **Метод входа:** SAML 2.0
   - **Имя приложения:** dbt Cloud
   - **Логотип приложения (по желанию):** Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и использовать его в качестве логотипа для этого приложения.

#### Настройка приложения

<Snippet path="access_url" />

Чтобы завершить этот раздел, вам нужно создать "slug" для входа. Этот slug контролирует URL, по которому пользователи вашей учетной записи могут войти в ваше приложение. Slug для входа обычно представляет собой имя вашей организации в нижнем регистре. Он должен содержать только буквы, цифры и дефисы. Например, slug для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

При запросе конфигураций SAML 2.0 приложения укажите следующие значения:

* URL единой аутентификации: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
* URI аудитории (SP Entity ID): `urn:auth0:<YOUR_AUTH0_ENTITYID>:{login slug}`
* Состояние реле: `<login slug>`

Кроме того, вы можете настроить атрибуты IdP, передаваемые от вашего поставщика идентификации в dbt Cloud. Мы рекомендуем использовать следующие значения:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| email | Неопределенный | user.email | Адрес электронной почты пользователя |
| first_name | Неопределенный | user.first_name | Имя пользователя |
| last_name | Неопределенный | user.last_name | Фамилия пользователя |
| NameID (если применимо) | Неопределенный | user.email | Адрес электронной почты пользователя |

Управление доступом на основе ролей в dbt Cloud зависит от сопоставления групп от IdP для назначения пользователей dbt Cloud в группы dbt Cloud. Чтобы использовать управление доступом на основе ролей в dbt Cloud, также настройте ваш поставщик идентификации для предоставления информации о членстве в группах в атрибуте пользователя, называемом `groups`:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| groups | Неопределенный | `<IdP-specific>` | Группы, к которым принадлежит пользователь в IdP |

:::info Примечание
Вы можете использовать ограниченное утверждение атрибута группы, чтобы ограничить набор групп, передаваемых в dbt Cloud для каждого аутентифицированного пользователя. Например, если все ваши группы dbt Cloud начинаются с `DBT_CLOUD_...`, вы можете применить фильтр, например, `Starts With: DBT_CLOUD_`.
:::

### Сбор секретов интеграции

После подтверждения ваших данных IdP должен показать вам следующие значения для новой интеграции SAML 2.0. Сохраните эти значения в безопасном месте, так как они понадобятся для завершения настройки в dbt Cloud.

- Издатель поставщика идентификации
- URL SSO поставщика идентификации
- Сертификат X.509

### Завершение настройки

После создания приложения следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с Okta
Вы можете использовать инструкции в этом разделе для настройки Okta в качестве вашего поставщика идентификации.

1. Войдите в свою учетную запись Okta. Используя панель администратора, создайте новое приложение.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-1-new-app.png"
    title="Создание нового приложения"
/>

2. Выберите следующие настройки:
   - **Платформа**: Веб
   - **Метод входа**: SAML 2.0

3. Нажмите **Создать**, чтобы продолжить процесс настройки.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-1-new-app-create.png"
    title="Настройка нового приложения"
/>

### Настройка приложения Okta

<Snippet path="access_url" />

Чтобы завершить этот раздел, вам нужно создать "slug" для входа. Этот slug контролирует URL, по которому пользователи вашей учетной записи могут войти в ваше приложение. Slug для входа обычно представляет собой имя вашей организации в нижнем регистре. Он должен содержать только буквы, цифры и дефисы. Например, slug для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. На странице **Общие настройки** введите следующие данные:

   * **Имя приложения**: dbt Cloud
   * **Логотип приложения** (по желанию): Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и загрузить его в Okta для использования в качестве логотипа для этого приложения.

2. Нажмите **Далее**, чтобы продолжить.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-2-general-settings.png"
    title="Настройка общих параметров приложения"
/>

### Настройка параметров SAML

1. На странице **Настройки SAML** введите следующие значения:

   * **URL единой аутентификации**: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   * **URI аудитории (SP Entity ID)**: `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   * **Состояние реле**: `<login slug>`

  <Lightbox collapsed={false} src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-3-saml-settings-top.png" title="Настройка параметров SAML приложения"/>

2. Сопоставьте атрибуты пользователей и групп вашей организации в Okta с форматом, который ожидает dbt Cloud, используя формы Утверждений атрибутов и Утверждений атрибутов групп.

3. Следующая таблица иллюстрирует ожидаемые Утверждения атрибутов пользователей:

   | Имя           | Формат имени | Значение                | Описание                |
   | -------------- | ----------- | -------------------- | -------------------------- |
   | `email`        | Неопределенный | `user.email`      | _Адрес электронной почты пользователя_ |
   | `first_name`   | Неопределенный | `user.firstName`  | _Имя пользователя_    |
   | `last_name`    | Неопределенный | `user.lastName`   | _Фамилия пользователя_     |

4. Следующая таблица иллюстрирует ожидаемые **Утверждения атрибутов групп**:

   | Имя     | Формат имени | Фильтр        | Значение | Описание                           |
   | -------- | ----------- | ------------- | ----- | ------------------------------------- |
   | `groups` | Неопределенный | Соответствует регулярному выражению | `.*`  | _Группы, к которым принадлежит пользователь_ |

Вы также можете использовать более ограничительное Утверждение атрибута группы, чем показано в предыдущих шагах. Например, если все ваши группы dbt Cloud начинаются с `DBT_CLOUD_`, вы можете использовать фильтр, например, `Starts With: DBT_CLOUD_`. **Okta возвращает только 100 групп для каждого пользователя, поэтому, если ваши пользователи принадлежат более чем 100 группам IdP, вам нужно будет использовать более ограничительный фильтр**. Пожалуйста, свяжитесь с поддержкой, если у вас есть вопросы.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-3-saml-settings-bottom.png"
    title="Настройка Утверждений атрибутов пользователей и групп приложения"
/>

5. Нажмите **Далее**, чтобы продолжить.

### Завершение настройки Okta

1. Выберите *Я клиент Okta, добавляющий внутреннее приложение*.
2. Выберите *Это внутреннее приложение, которое мы создали*.
3. Нажмите **Завершить**, чтобы завершить настройку приложения.

<Lightbox
    collapsed={false}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-4-feedback.png"
    title="Завершение настройки в Okta"
/>

### Просмотр инструкций по настройке

1. На следующей странице нажмите **Просмотреть инструкции по настройке**.
2. В следующих шагах вы предоставите эти значения в настройках вашей учетной записи dbt Cloud, чтобы завершить интеграцию между Okta и dbt Cloud.

<Lightbox
    collapsed={true}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-5-view-instructions.png"
    title="Просмотр настроенного приложения"
/>

<Lightbox
    collapsed={true}
    src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-5-instructions.png"
    title="Инструкции по настройке приложения"
/>

3. После создания приложения Okta следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с Google

Используйте этот раздел, если вы настраиваете Google в качестве вашего поставщика идентификации.

### Настройка приложения Google

<Snippet path="access_url" />

Чтобы завершить этот раздел, вам нужно создать "slug" для входа. Этот slug контролирует URL, по которому пользователи вашей учетной записи могут войти в ваше приложение. Slug для входа обычно представляет собой имя вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. Войдите в свою **Консоль администратора Google** через учетную запись с правами супер администратора.
2. На главной странице консоли администратора перейдите в **Приложения**, затем нажмите **Веб и мобильные приложения**.
3. Нажмите **Добавить**, затем нажмите **Добавить пользовательское SAML приложение**.
4. Нажмите **Далее**, чтобы продолжить.
5. Внесите изменения на странице сведений о приложении:
    - Назовите пользовательское приложение
    - Загрузите логотип приложения (по желанию)
    - Нажмите **Продолжить**.

### Настройка параметров SAML

1. Перейдите на страницу **Сведения о поставщике идентификации Google**.
2. Скачайте **метаданные IdP**.
3. Скопируйте **URL SSO** и **Entity ID** и скачайте **Сертификат** (или **SHA-256 отпечаток**, если необходимо).
4. Введите следующие значения в окне **Сведения о поставщике услуг**:
   * **ACS URL**: `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   * **URI аудитории (SP Entity ID)**: `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   * **Начальный URL**: `<login slug>`
5. Установите флажок **Подписанный ответ**.
6. Значение по умолчанию для **Name ID** - это основной адрес электронной почты. Мультизначный ввод не поддерживается.
7. Используйте страницу **Сопоставление атрибутов**, чтобы сопоставить атрибуты каталога Google вашей организации с форматом, который ожидает dbt Cloud.
8. Нажмите **Добавить другое сопоставление**, чтобы сопоставить дополнительные атрибуты.

Ожидаемые **Атрибуты**:

| Имя           | Формат имени | Значение                | Описание                |
| -------------- | ----------- | -------------------- | -------------------------- |
| `First name`   | Неопределенный | `first_name`         | Имя пользователя.  |
| `Last name`    | Неопределенный | `last_name`          | Фамилия пользователя.     |
| `Primary email`| Неопределенный | `email`              |  Адрес электронной почты пользователя. |

9. Чтобы использовать [управление доступом на основе ролей](/docs/cloud/manage-access/about-user-access#role-based-access-control) в dbt Cloud, введите группы в поле **Членство в группах** во время настройки:

| Группы Google  | Атрибуты приложения |
| -------------- | -------------- |
| Название групп | `groups` |

10. Нажмите **Завершить**, чтобы продолжить.

### Завершение настройки Google

1. На главной странице консоли администратора перейдите в **Приложения**, затем нажмите **Веб и мобильные приложения**.
2. Выберите ваше SAML приложение.
3. Нажмите **Доступ пользователей**.
4. Чтобы включить или отключить сервис для всех в вашей организации, нажмите **Включить для всех** или **Отключить для всех**, затем нажмите **Сохранить**.
5. Убедитесь, что адреса электронной почты, которые ваши пользователи используют для входа в SAML приложение, совпадают с адресами электронной почты, которые они используют для входа в ваш домен Google.

**Примечание:** Изменения обычно вступают в силу в течение нескольких минут, но могут занять до 24 часов.

### Завершение настройки

После создания приложения Google следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup).

## Интеграция с Microsoft Entra ID (ранее Azure AD)

Если вы используете Microsoft Entra ID (ранее Azure AD), инструкции ниже помогут вам настроить его в качестве вашего поставщика идентификации.

### Создание корпоративного приложения Microsoft Entra ID

<Snippet path="access_url" />

Чтобы завершить этот раздел, вам нужно создать "slug" для входа. Этот slug контролирует URL, по которому пользователи вашей учетной записи могут войти в ваше приложение. Slug для входа обычно представляет собой имя вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

Следуйте этим шагам, чтобы настроить единую аутентификацию (SSO) с dbt Cloud:

1. Войдите в свою учетную запись Azure.
2. В портале Entra ID выберите **Корпоративные приложения** и нажмите **+ Новое приложение**.
3. Выберите **Создать свое собственное приложение**.
4. Назовите приложение "dbt Cloud" или другое описательное имя.
5. Выберите **Интегрировать любое другое приложение, которое вы не нашли в галерее (Не галерея)** в качестве типа приложения.
6. Нажмите **Создать**.
7. Вы можете найти новое приложение, нажав **Корпоративные приложения** и выбрав **Все приложения**.
8. Нажмите на приложение, которое вы только что создали.
9. Выберите **Единая аутентификация** в разделе Управление в левой навигации.
10. Нажмите **Настроить единую аутентификацию** в разделе Начало работы.
<Lightbox src="/img/docs/dbt-cloud/access-control/single-sign-on-overview.jpg" width="75%" title="На вашей странице Обзор выберите 'Настроить единую аутентификацию'" />

11. Нажмите **SAML** в разделе "Выберите метод единой аутентификации".
<Lightbox src="/img/docs/dbt-cloud/access-control/saml.jpg" width="75%" title="Выберите карточку 'SAML' в разделе 'Выберите метод единой аутентификации'" />

12. Нажмите **Изменить** в разделе Основная конфигурация SAML.

<Lightbox src="/img/docs/dbt-cloud/access-control/basic-saml.jpg" width="75%" title="На странице 'Настройка единой аутентификации с SAML' нажмите 'Изменить' в карточке 'Основная конфигурация SAML'" />

13. Используйте следующую таблицу, чтобы заполнить обязательные поля и подключиться к dbt:

   | Поле | Значение |
   | ----- | ----- |
   | **Идентификатор (Entity ID)** | Используйте `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`. |
   | **URL ответа (URL службы потребления утверждений)** | Используйте `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`. |
   | **Состояние реле** | `<login slug>` |

14. Нажмите **Сохранить** в верхней части формы.

### Создание параметров SAML

На странице Настройка единой аутентификации с SAML:

1. Нажмите **Изменить** в разделе Атрибуты пользователей и утверждения.
2. Оставьте утверждение в разделе "Обязательное утверждение" без изменений.
3. Удалите все утверждения в разделе "Дополнительные утверждения".
4. Нажмите **Добавить новое утверждение** и добавьте три новых утверждения:

   | Имя | Исходный атрибут |
   | ----- | ----- |
   | **email** | user.mail |
   | **first_name** | user.givenname |
   | **last_name** | user.surname |

5. Нажмите **Добавить утверждение группы** в разделе Атрибуты пользователей и утверждения.
6. Если вы будете назначать пользователей непосредственно корпоративному приложению, выберите **Группы безопасности**. Если нет, выберите **Группы, назначенные приложению**.
7. Установите **Исходный атрибут** на **Идентификатор группы**.
8. В разделе **Дополнительные параметры** установите флажок **Настроить имя утверждения группы** и укажите **Имя** как **groups**.

**Примечание:** Имейте в виду, что Идентификатор группы в Entra ID соответствует GUID этой группы. Он должен быть указан в нижнем регистре, чтобы сопоставления работали как ожидалось. Поле Исходный атрибут можно также установить на другое значение по вашему выбору.

### Завершение настройки

9. После создания приложения Azure следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Интеграция с OneLogin

Используйте этот раздел, если вы настраиваете OneLogin в качестве вашего поставщика идентификации.

Для настройки OneLogin вам потребуется доступ **Администратора**.

### Настройка приложения OneLogin

<Snippet path="access_url" />

Чтобы завершить этот раздел, вам нужно создать "slug" для входа. Этот slug контролирует URL, по которому пользователи вашей учетной записи могут войти в ваше приложение. Slug для входа обычно представляет собой имя вашей организации в нижнем регистре, разделенное дефисами. Он должен содержать только буквы, цифры и дефисы. Например, slug для dbt Labs будет `dbt-labs`. Slug для входа должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.

1. Войдите в OneLogin и добавьте новое приложение SAML 2.0.
2. Настройте приложение с следующими данными:
   - **Платформа:** Веб
   - **Метод входа:** SAML 2.0
   - **Имя приложения:** dbt Cloud
   - **Логотип приложения (по желанию):** Вы можете [скачать логотип dbt](https://drive.google.com/file/d/1fnsWHRu2a_UkJBJgkZtqt99x5bSyf3Aw/view?usp=sharing) и использовать его в качестве логотипа для этого приложения.

### Настройка параметров SAML

3. На вкладке **Конфигурация** введите следующие значения:

   - **RelayState:** `<login slug>`
   - **Audience (EntityID):** `urn:auth0:<YOUR_AUTH0_ENTITYID>:<login slug>`
   - **ACS (URL потребителя) валидатор:** `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`
   - **ACS (URL потребителя):** `https://YOUR_AUTH0_URI/login/callback?connection=<login slug>`

4. Затем перейдите на вкладку **Параметры**. Вам необходимо иметь параметр для атрибутов Email, First Name и Last Name и включить все параметры в утверждениях SAML. При добавлении пользовательских параметров убедитесь, что вы выбрали флажок **Включить в утверждение SAML**.

Мы рекомендуем использовать следующие значения:

| имя | формат имени | значение |
| ---- | ----------- | ----- |
| NameID | Неопределенный | Email |
| email | Неопределенный | Email |
| first_name | Неопределенный | First Name |
| last_name | Неопределенный | Last Name |

Управление доступом на основе ролей в dbt Cloud зависит от сопоставления групп от IdP для назначения пользователей dbt Cloud в группы dbt Cloud. Чтобы использовать управление доступом на основе ролей в dbt Cloud, также настройте OneLogin для предоставления информации о членстве в группах в атрибуте пользователя, называемом `groups`:

| имя | формат имени | значение | описание |
| ---- | ----------- | ----- | ----------- |
| groups | Неопределенный | Серия групп, используемых для вашей организации | Группы, к которым принадлежит пользователь в IdP |

### Сбор секретов интеграции

5. После подтверждения ваших данных перейдите на вкладку **SSO**. OneLogin должен показать вам следующие значения для новой интеграции. Сохраните эти значения в безопасном месте, так как они понадобятся для завершения настройки в dbt Cloud.

- URL издателя
- Конечная точка SAML 2.0 (HTTP)
- Сертификат X.509

### Завершение настройки

6. После создания приложения OneLogin следуйте инструкциям в разделе [Настройка dbt Cloud](#dbt-cloud-setup) для завершения интеграции.

## Настройка dbt Cloud

### Предоставление значений IdP в dbt Cloud

Чтобы завершить настройку, выполните следующие шаги в dbt Cloud:

1. Перейдите в **Настройки учетной записи**, затем нажмите на **Единая аутентификация**.
2. Нажмите **Изменить** в правом верхнем углу.
3. Укажите следующие данные SSO:

   | Поле | Значение |
   | ----- | ----- |
   | Вход&nbsp;с&nbsp; | SAML 2.0 |
   | URL&nbsp;SSO&nbsp;поставщика&nbsp;идентификации | Вставьте **URL единой аутентификации поставщика идентификации**, показанный в инструкциях по настройке IdP |
   | Издатель&nbsp;поставщика&nbsp;идентификации | Вставьте **Издатель поставщика идентификации**, показанный в инструкциях по настройке IdP |
   | Сертификат&nbsp;X.509 | Вставьте **Сертификат X.509**, показанный в инструкциях по настройке IdP; <br />**Примечание:** Когда сертификат истечет, администратору IdP придется сгенерировать новый, который нужно будет вставить в dbt Cloud для непрерывного доступа к приложению. |
   | Slug | Введите желаемый slug для входа. |
    <Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/okta/okta-6-setup-integration.png"
        title="Настройка приложения в dbt Cloud" />

4. Нажмите **Сохранить**, чтобы завершить настройку интеграции SAML 2.0.
5. После завершения настройки вы можете перейти по URL, сгенерированному для slug вашей учетной записи, чтобы протестировать вход с вашим поставщиком идентификации. Кроме того, пользователи, добавленные в приложение SAML 2.0, смогут войти в dbt Cloud напрямую из IdP.

<Snippet path="login_url_note" />

### Настройка RBAC

После настройки поставщика идентификации вы сможете настроить [управление доступом на основе ролей](/docs/cloud/manage-access/enterprise-permissions) для вашей учетной записи.