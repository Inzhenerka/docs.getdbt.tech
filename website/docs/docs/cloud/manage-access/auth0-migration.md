---
title: "Миграция на Auth0 для SSO"
id: "auth0-migration"
sidebar: "Миграция SSO Auth0"
description: "Необходимые действия для миграции на Auth0 для SSO-сервисов в dbt Cloud."
---

dbt Labs сотрудничает с Auth0 для улучшения возможностей единого входа (SSO) в dbt Cloud. Auth0 — это платформа управления идентификацией и доступом (IAM) с расширенными функциями безопасности, которая будет использоваться в dbt Cloud. Эти изменения потребуют некоторых действий от клиентов, у которых уже настроен SSO в dbt Cloud, и в этом руководстве будут описаны необходимые изменения для каждой среды.

Если вы еще не настроили SSO в dbt Cloud, вместо этого обратитесь к нашим руководствам по настройке для [SAML](/docs/cloud/manage-access/set-up-sso-saml-2.0), [Okta](/docs/cloud/manage-access/set-up-sso-okta), [Google Workspace](/docs/cloud/manage-access/set-up-sso-google-workspace) или [Microsoft Entra ID (ранее Azure AD)](/docs/cloud/manage-access/set-up-sso-microsoft-entra-id) для сервисов единого входа.

## Начало миграции

Функция миграции на Auth0 постепенно внедряется для клиентов, у которых уже включены функции SSO. Когда опция миграции будет активирована на вашем аккаунте, вы увидите **Доступны обновления SSO** на правой стороне панели меню, рядом с иконкой настроек.

<Lightbox src="/img/docs/dbt-cloud/access-control/sso-migration-available.png" title="Доступна миграция SSO"/>

В качестве альтернативы вы можете начать процесс с страницы **Настройки** в панели **Единый вход**. Нажмите кнопку **Начать миграцию**, чтобы начать.

<Lightbox src="/img/docs/dbt-cloud/access-control/begin-migration.png" title="Начать миграцию"/>

После того как вы решили начать процесс миграции, следующие шаги будут различаться в зависимости от настроенного поставщика идентификации. Вы можете сразу перейти к разделу, который соответствует вашей среде. Эти шаги применимы только к клиентам, проходящим миграцию; новые настройки будут использовать существующие [инструкции по настройке](/docs/cloud/manage-access/sso-overview).

:::warning Логин \{slug\}

Слаги должны содержать только буквы, цифры и дефисы. Убедитесь, что вы удалили подчеркивания (если они есть) из логинов слагов:
* перед миграцией на странице **Настройки аккаунта**, или
* во время миграции (перед активацией), как показано на скриншотах Migrate authentication для вашей настройки.
После изменения слага администраторы должны поделиться новым URL-адресом для входа с пользователями dbt Cloud.

:::

## SAML 2.0 и Okta

Пользователи SAML 2.0 должны обновить несколько полей в конфигурации приложения SSO, чтобы соответствовать новому URL и URI Auth0. Вы можете подойти к этому, редактируя существующие настройки приложения SSO или создавая новое, чтобы учесть настройки Auth0. Один из подходов не является по сути лучше другого, поэтому вы можете выбрать тот, который лучше всего подходит для вашей организации.

Поля, которые будут обновлены:
- URL единого входа — `https://<YOUR_AUTH0_URI>/login/callback?connection={slug}`
- URI аудитории (SP Entity ID) — `urn:auth0:<YOUR_AUTH0_ENTITYID>:{slug}`

Ниже приведены примерные шаги для обновления. Вы должны выполнить все из них, чтобы обеспечить непрерывный доступ к dbt Cloud, и вам следует координировать свои действия с администратором вашего поставщика идентификации при внесении этих изменений.

1. Замените `{slug}` на логин вашего организации. Он должен быть уникальным для всех экземпляров dbt Cloud и обычно представляет собой название вашей компании, разделенное дефисами (например, `dbt-labs`).

Вот пример обновленной настройки SAML 2.0 в Okta.

<Lightbox src="/img/docs/dbt-cloud/access-control/new-okta-config.png" title="Конфигурация Okta с новым URL"/>

2. Сохраните конфигурацию, и ваши настройки SAML будут выглядеть примерно так:

<Lightbox src="/img/docs/dbt-cloud/access-control/new-okta-completed.png" title="Новая конфигурация Okta завершена"/>

3. Переключите опцию `Включить новую аутентификацию SSO`, чтобы обеспечить правильную маршрутизацию трафика. _Действие по миграции SSO является окончательным и не может быть отменено._

<Lightbox src="/img/docs/dbt-cloud/access-control/saml-enable.png" title="Включить новое SSO для SAML/Okta"/>

4. Сохраните настройки и протестируйте новую конфигурацию, используя URL для входа SSO, предоставленный на странице настроек.

## Google Workspace

Администраторы Google Workspace, обновляющие свои API SSO с URL Auth0, не должны делать много, если это существующая настройка. Это можно сделать как в рамках нового проекта, так и редактируя существующую настройку SSO. Дополнительные области не требуются, так как это миграция с существующей настройки. Все области были определены во время первоначальной конфигурации.

Ниже приведены шаги для обновления. Вы должны выполнить все из них, чтобы обеспечить непрерывный доступ к dbt Cloud, и вам следует координировать свои действия с администратором вашего поставщика идентификации при внесении этих изменений.

1. Откройте [консоль Google Cloud](https://console.cloud.google.com/) и выберите проект с настройками единого входа dbt Cloud. На странице проекта в разделе **Быстрый доступ** выберите **API и сервисы**.

<Lightbox src="/img/docs/dbt-cloud/access-control/google-cloud-sso.png" title="Консоль Google Cloud"/>

2. Нажмите **Учетные данные** в левом боковом меню и выберите соответствующее имя из **Идентификаторы клиентов OAuth 2.0**.

<Lightbox src="/img/docs/dbt-cloud/access-control/sso-project.png" title="Выберите идентификатор клиента OAuth 2.0"/>

3. В окне **Идентификатор клиента для веб-приложения** найдите поле **Авторизованные URI перенаправления** и нажмите **Добавить URI**, затем введите `https://<YOUR_AUTH0_URI>/login/callback`.

Нажмите **Сохранить**, когда закончите.

<Lightbox src="/img/docs/dbt-cloud/access-control/google-uri.png" title="Добавить URI перенаправления"/>

4. _Вам потребуется человек с правами администратора Google Workspace, чтобы завершить эти шаги в dbt Cloud_. В dbt Cloud перейдите в **Настройки аккаунта**, нажмите на **Единый вход**, а затем нажмите **Редактировать** в правой части панели SSO. Переключите опцию **Включить новую аутентификацию SSO** и выберите **Сохранить**. Это вызовет окно авторизации от Google, которое потребует учетные данные администратора. _Действие по миграции является окончательным и не может быть отменено_. После успешной аутентификации протестируйте новую конфигурацию, используя URL для входа SSO, предоставленный на странице настроек.

:::warning Авторизация домена

Вы должны завершить авторизацию домена перед тем, как переключить `Включить новую аутентификацию SSO`, иначе миграция не завершится успешно.

:::

<Lightbox src="/img/docs/dbt-cloud/access-control/google-enable.png" title="Включить новое SSO для Google Workspace"/>

## Microsoft Entra ID

Администраторы Microsoft Entra ID должны внести небольшие изменения в существующее приложение аутентификации в портале Azure. Эта миграция не требует удаления или воссоздания всего приложения; вы можете редактировать существующее приложение. Начните с открытия портала Azure и перехода к обзору Microsoft Entra ID.

Ниже приведены шаги для обновления. Вы должны выполнить все из них, чтобы обеспечить непрерывный доступ к dbt Cloud, и вам следует координировать свои действия с администратором вашего поставщика идентификации при внесении этих изменений.

1. Нажмите **Регистрация приложений** в левом боковом меню.

<Lightbox src="/img/docs/dbt-cloud/access-control/aad-app-registration.png" title="Выберите регистрацию приложений"/>

2. Выберите соответствующее приложение **dbt Cloud** (название может варьироваться) из списка. На странице обзора приложения нажмите на гиперссылку рядом с **URI перенаправления**.

<Lightbox src="/img/docs/dbt-cloud/access-control/app-overview.png" title="Нажмите на гиперссылку URI перенаправления"/>

3. В панели **Web** с **URI перенаправления** нажмите **Добавить URI** и введите соответствующий `https://<YOUR_AUTH0_URI>/login/callback`. Сохраните настройки и убедитесь, что он отображается в обновленном обзоре приложения.

<Lightbox src="/img/docs/dbt-cloud/access-control/redirect-URI.png" title="Введите новый URI перенаправления"/>

4. Перейдите в среду dbt Cloud и откройте **Настройки аккаунта**. Нажмите на опцию **Единый вход** в левом боковом меню и нажмите на опцию **Редактировать** в правой части панели SSO. Поле **домен** — это домен, который ваша организация использует для входа в Microsoft Entra ID. Переключите опцию **Включить новую аутентификацию SSO** и **Сохранить**. _После включения этой опции ее нельзя отменить._

:::warning Авторизация домена

Вы должны завершить авторизацию домена перед тем, как переключить `Включить новую аутентификацию SSO`, иначе миграция не завершится успешно.

:::

<Lightbox src="/img/docs/dbt-cloud/access-control/azure-enable.png" title="Включить новое SSO"/>