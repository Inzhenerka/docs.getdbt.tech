---
title: "Настройка SSO с Google Workspace"
description: "Узнайте, как администраторы dbt Cloud могут использовать единую авторизацию (SSO) через Google GSuite для управления доступом в учетной записи dbt Cloud."
id: "set-up-sso-google-workspace"
---

import SetUpPages from '/snippets/_sso-docs-mt-available.md';

<SetUpPages features={'/snippets/_sso-docs-mt-available.md'}/>

dbt Cloud Enterprise поддерживает единую авторизацию (SSO) через Google GSuite. Вам понадобятся права для создания и управления новым приложением Google OAuth2, а также доступ для включения Google Admin SDK. Gsuite является компонентом Google Cloud Platform (GCP), поэтому вам также потребуется доступ к учетной записи с правами для управления приложением GSuite в учетной записи GCP.

Некоторые клиенты выбирают использование различных облачных провайдеров для настройки прав пользователей и групп, отличных от хостинга инфраструктуры. Например, вполне возможно использовать GSuite для управления информацией для входа и конфигурацией многофакторной аутентификации (MFA), в то время как данные обрабатываются на AWS.

В настоящее время поддерживаемые функции включают:

* SSO, инициированное SP
* Провизия по мере необходимости

Этот гид описывает процесс настройки аутентификации в dbt Cloud с помощью Google GSuite.

## Конфигурация организации GSuite в GCP

dbt Cloud использует идентификатор клиента и секрет клиента для аутентификации пользователей организации GSuite. Ниже приведены шаги по созданию идентификатора клиента и секрета клиента для использования в dbt Cloud.

### Создание учетных данных

1. Перейдите в [API Manager](https://console.developers.google.com/projectselector/apis/credentials) GCP.
2. Выберите существующий проект или создайте новый проект для ваших API-учетных данных.
3. Нажмите **Создать учетные данные** и выберите **Идентификатор клиента OAuth** в появившемся окне.
4. Google требует, чтобы вы настроили экран согласия OAuth для учетных данных OAuth. Нажмите кнопку **Настроить экран согласия**, чтобы создать новый экран согласия, если будет предложено.
5. На странице экрана согласия OAuth настройте следующие параметры ([документация Google](https://support.google.com/cloud/answer/6158849?hl=en#userconsent)):

| Конфигурация          | Значение        | примечания |
| ---------------------- | ------------ | ------ |
| **Тип приложения**   | внутреннее     | обязательно |
| **Название приложения**   | dbt Cloud    | обязательно |
| **Логотип приложения**   | Скачайте логотип <a href="https://www.getdbt.com/ui/img/dbt-icon.png" target="_blank" rel="noopener noreferrer">здесь</a> | необязательно |
| **Авторизованные домены** | `getdbt.com` (США, многопользовательский) `getdbt.com` и `dbt.com` (США, ячейка 1) `dbt.com` (EMEA или AU) | Если развертывание происходит в VPC, используйте домен для вашего развертывания |
| **Области** | `email, profile, openid` | Стандартные области достаточны |

<Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/gsuite/gsuite-sso-consent-top.png" title="Конфигурация экрана согласия GSuite"/>

6. Сохраните настройки **Экрана согласия**, чтобы вернуться на страницу **Создать идентификатор клиента OAuth**.
7. Используйте следующие значения конфигурации при создании ваших учетных данных, заменив `YOUR_ACCESS_URL` и `YOUR_AUTH0_URI`, которые необходимо заменить на [соответствующий URL-адрес доступа и URI Auth0](/docs/cloud/manage-access/sso-overview#auth0-multi-tenant-uris) для вашего региона и плана.

| Конфигурация | Значение |
| ------ | ----- |
| **Тип приложения** | Веб-приложение |
| **Название** | dbt Cloud |
| **Авторизованные источники Javascript** | `https://YOUR_ACCESS_URL` |
| **Авторизованные URI перенаправления** | `https://YOUR_AUTH0_URI/login/callback` |

<Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/gsuite/gsuite-sso-credentials.png" title="Конфигурация учетных данных GSuite"/>

8. Нажмите "Создать", чтобы создать ваши новые учетные данные. Появится всплывающее окно с **Идентификатором клиента** и **Секретом клиента**. Запишите их, так как они понадобятся вам позже!

### Включение Admin SDK

dbt Cloud требует, чтобы Admin SDK был включен в этом приложении для запроса информации о членстве в группах из API GSuite. Чтобы включить Admin SDK для этого проекта, перейдите на [страницу настроек Admin SDK](https://console.developers.google.com/apis/api/admin.googleapis.com/overview) и убедитесь, что API включен.

<Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/7f36f50-Screen_Shot_2019-12-03_at_10.15.01_AM.png" title="Страница 'Admin SDK'"/>

## Конфигурация в dbt Cloud

Чтобы завершить настройку, выполните следующие шаги в приложении dbt Cloud.

### Укажите ваш идентификатор клиента OAuth и секрет клиента

1. Перейдите на страницу **Enterprise &gt; Single Sign On** в настройках учетной записи.
2. Нажмите кнопку **Изменить** и укажите следующие данные SSO:
    - **Вход через**: GSuite
    - **Идентификатор клиента**: Вставьте идентификатор клиента, сгенерированный на предыдущих шагах
    - **Секрет клиента**: Вставьте секрет клиента, сгенерированный на предыдущих шагах
    - **Домен в GSuite**: Введите имя домена для вашей учетной записи GSuite (например, `dbtlabs.com`). Только пользователи с адресом электронной почты из этого домена смогут войти в вашу учетную запись dbt Cloud, используя аутентификацию GSuite. При желании вы можете указать CSV-домены, которые _все_ имеют право доступа к вашей учетной записи dbt Cloud (например, `dbtlabs.com, fishtowndata.com`)
    - **Slug**: Введите желаемый slug для входа. Пользователи смогут войти в dbt Cloud, перейдя по адресу `https://YOUR_ACCESS_URL/enterprise-login/LOGIN-SLUG`, заменив `YOUR_ACCESS_URL` на [соответствующий URL-адрес доступа](/docs/cloud/about-cloud/access-regions-ip-addresses) для вашего региона и плана. `LOGIN-SLUG` должен быть уникальным для всех учетных записей dbt Cloud, поэтому выберите slug, который уникально идентифицирует вашу компанию.
    <Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/gsuite/gsuite-sso-cloud-config.png" title="Конфигурация SSO GSuite"/>
3. Нажмите **Сохранить и авторизовать**, чтобы авторизовать ваши учетные данные. Вы должны перейти в поток OAuth GSuite и ввести свои рабочие адрес электронной почты для входа в dbt Cloud. Если аутентификация прошла успешно, вы будете перенаправлены обратно в приложение dbt Cloud.
4. На странице **Учетные данные** убедитесь, что присутствует запись `groups`, и что она отражает группы, членом которых вы являетесь в GSuite. Если вы не видите записи `groups` в списке атрибутов IdP, обратитесь к следующим шагам по устранению неполадок.

    <Lightbox src="/img/docs/dbt-cloud/dbt-cloud-enterprise/gsuite/gsuite-sso-cloud-verify.png" title="Проверка групп GSuite"/>

Если информация о проверке выглядит корректно, значит, вы завершили настройку SSO GSuite.

<Snippet path="login_url_note" />

## Настройка RBAC
Теперь, когда вы завершили настройку SSO с GSuite, следующие шаги будут заключаться в настройке
[групп RBAC](/docs/cloud/manage-access/about-user-access#role-based-access-control-), чтобы завершить вашу конфигурацию управления доступом.

## Устранение неполадок

### Ошибка недействительного клиента

Если вы столкнулись с ошибкой `Error 401: invalid_client` при авторизации с GSuite, дважды проверьте, что:
 - Идентификатор клиента соответствует значению, сгенерированному на странице учетных данных API GCP.
 - Убедитесь, что указанные доменные имена соответствуют доменам вашей учетной записи GSuite.

### Ошибки OAuth

Если проверка OAuth не завершилась успешно, дважды проверьте, что:
 - Admin SDK включен в вашем проекте GCP
 - Идентификатор клиента и секрет клиента соответствуют значениям, сгенерированным на странице учетных данных GCP
 - В конфигурации экрана согласия OAuth был указан авторизованный домен
Если аутентификация с API GSuite проходит успешно, но вы не видите записи `groups` на странице **Учетные данные**, возможно, у вас нет прав доступа к группам в вашей учетной записи GSuite. Либо запросите, чтобы вашему пользователю GSuite была предоставлена возможность запрашивать группы у администратора, либо попросите администратора войти в dbt Cloud и авторизовать интеграцию GSuite.