---
title: "Проверка и форматирование кода"
id: "lint-format"
description: Интеграция с популярными линтерами и форматтерами, такими как SQL Fluff, sqlfmt, Black и Prettier."
sidebar_label: "Проверка и форматирование"
tags: [IDE]
---

Повысьте эффективность процесса разработки, интегрировав популярные линтеры и форматтеры, такие как [SQLFluff](https://sqlfluff.com/), [sqlfmt](http://sqlfmt.com/), [Black](https://black.readthedocs.io/en/latest/) и [Prettier](https://prettier.io/). Используйте эти мощные инструменты напрямую в <Constant name="cloud_ide" />, не прерывая рабочий процесс разработки.

<details>
<summary>Что такое линтеры и форматтеры?</summary>
Линтеры анализируют код на наличие ошибок, багов и проблем со стилем, в то время как форматтеры исправляют правила стиля и форматирования. Подробнее о том, когда использовать линтеры или форматтеры, читайте в <a href="#faqs">Часто задаваемых вопросах</a>.
</details>

В dbt Cloud IDE вы можете выполнять проверку, автоматическое исправление и форматирование для пяти различных типов файлов:

В <Constant name="cloud_ide" /> вы можете выполнять линтинг, автоисправление и форматирование для пяти различных типов файлов:

- SQL — выполнять [lint](#lint) и исправления с помощью SQLFluff, а также [format](#format) с помощью sqlfmt  
- YAML, Markdown и JSON — форматировать с помощью Prettier  
- Python — форматировать с помощью Black

Каждый тип файла имеет свои уникальные правила проверки и форматирования. Вы можете [настроить](#customize-linting) процесс проверки, чтобы добавить больше гибкости и улучшить обнаружение проблем и стиля.

По умолчанию IDE использует правила sqlfmt для форматирования вашего кода, что делает его удобным для использования сразу. Однако, если у вас есть файл с именем `.sqlfluff` в корневом каталоге вашего проекта dbt, IDE будет использовать правила SQLFluff по умолчанию.

<DocCarousel slidesPerView={1}>

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/sqlfluff.gif" width="100%" title="Используйте SQLFluff для проверки/форматирования вашего SQL-кода и просмотра ошибок кода на вкладке Code Quality."/>

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/sqlfmt.gif" width="95%" title="Используйте sqlfmt для форматирования вашего SQL-кода."/>

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/prettier.gif" width="95%" title="Форматируйте файлы YAML, Markdown и JSON с помощью Prettier."/>

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/ide-sql-popup.png" width="95%" title="Используйте кнопку config, чтобы выбрать инструмент."/>

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/ide-sqlfluff-config.png" width="95%" title="Настройте линтинг, задав собственные правила проверки кода, включая правила линтинга и стиля dbtonic."/>

</DocCarousel>

## Проверка

С помощью <Constant name="cloud_ide" /> вы можете бесшовно использовать [SQLFluff](https://sqlfluff.com/) — настраиваемый SQL‑линтер, который предупреждает о сложных функциях, ошибках синтаксиса, форматирования и компиляции. Эта интеграция позволяет запускать проверки, исправлять и просматривать любые ошибки кода напрямую в Cloud <Constant name="cloud_ide" />:

- Работает с Jinja и SQL.
- Поставляется со встроенными [правилами линтинга](https://docs.sqlfluff.com/en/stable/rules.html). Вы также можете [настроить](#customize-linting) собственные правила линтинга.
- Позволяет [включить линтинг](#enable-linting) с такими опциями, как **Lint** (отображает ошибки линтинга и рекомендует действия) или **Fix** (автоматически исправляет ошибки в <Constant name="cloud_ide" />).
- Отображает вкладку **Code Quality** для просмотра ошибок кода, обеспечивая прозрачность и управление качеством кода.

:::info Эфемерные модели не поддерживаются
Проверка не поддерживает эфемерные модели в dbt v1.5 и ниже. Обратитесь к [Часто задаваемым вопросам](#faqs) для получения дополнительной информации.
:::

### Включение проверки

Линтинг доступен во всех ветках, включая защищённую основную ветку git. Поскольку <Constant name="cloud_ide" /> не позволяет делать коммиты в защищённую ветку, он предложит зафиксировать эти изменения в новой ветке.

1. Чтобы включить линтинг, откройте файл `.sql` и перейдите на вкладку **Code Quality**.
2. Нажмите кнопку **`</> Config`** в правом нижнем углу [раздела консоли](/docs/cloud/studio-ide/ide-user-interface#console-section), под **File editor**.
3. Во всплывающем окне конфигурации инструмента контроля качества кода вы можете выбрать **sqlfluff** или **sqlfmt**.
4. Чтобы выполнить линтинг кода, выберите переключатель **sqlfluff**. (Используйте sqlfmt, чтобы [отформатировать](#format) код.)
5. После выбора переключателя **sqlfluff** вернитесь в раздел консоли (под **File editor**) и выберите кнопку из выпадающего списка **Lint** или **Fix**:
    - Кнопка **Lint** &mdash; отображает проблемы линтинга в <Constant name="cloud_ide" /> в виде волнистых подчёркиваний в **File editor**. Вы можете навести курсор на подчёркнутую проблему, чтобы увидеть детали и доступные действия, включая опцию **Quick Fix** для исправления всех или отдельных проблем. После выполнения линтинга вы увидите сообщение с подтверждением результата. Линтинг не запускается повторно автоматически после сохранения файла — нажмите **Lint** ещё раз, чтобы запустить его снова.
    - Кнопка **Fix** &mdash; автоматически исправляет ошибки линтинга в **File editor**. По завершении исправлений вы увидите сообщение с подтверждением результата.
    - Используйте вкладку **Code Quality** для просмотра и отладки любых ошибок в коде.

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/ide-lint-format-console.gif" width="90%" title="Используйте кнопку Lint или Fix в разделе консоли, чтобы проверить или автоматически исправить ваш код."/>

### Настройка проверки

SQLFluff — это настраиваемый SQL линтер, что означает, что вы можете настроить свои собственные правила проверки вместо использования настроек проверки по умолчанию в IDE. Вы можете исключить файлы и каталоги, используя стандартный файл `.sqlfluffignore`. Узнайте больше о синтаксисе в [документации по синтаксису .sqlfluffignore](https://docs.sqlfluff.com/en/stable/configuration.html#id2).

Чтобы настроить свои собственные правила проверки:

1. Создайте новый файл в корневом каталоге проекта (родительский или верхнеуровневый каталог для ваших файлов).  
   Примечание: корневой каталог проекта — это каталог, в котором находится файл `dbt_project.yml`.
2. Назовите файл `.sqlfluff` (обязательно добавьте `.` перед `sqlfluff`).
3. [Создайте](https://docs.sqlfluff.com/en/stable/configuration/setting_configuration.html#new-project-configuration) и добавьте свой пользовательский код конфигурации.  
4. Сохраните изменения и закоммитьте их.
5. Перезапустите <Constant name="cloud_ide" />.
6. Протестируйте и приятного линтинга!

#### Линтинг снапшотов
По умолчанию <Constant name="cloud" /> выполняет линтинг всех изменённых файлов `.sql` в вашем проекте, включая снапшоты. [Snapshots](/docs/build/snapshots) могут быть определены как в YAML, так и в файлах `.sql`, однако их SQL не подлежит линтингу и может вызывать ошибки в процессе линтинга.

Чтобы SQLFluff не выполнял линтинг файлов снапшотов, добавьте директорию снапшотов в файл `.sqlfluffignore` (например, `snapshots/`).

Обратите внимание, что вам необходимо явно исключить снапшоты в файле `.sqlfluffignore`, поскольку <Constant name="cloud" /> не игнорирует снапшоты автоматически на стороне бэкенда.

### Настройка правил линтинга dbtonic

Обратитесь к [файлу конфигурации SQLFluff для Jaffle shop](https://github.com/dbt-labs/jaffle-shop-template/blob/main/.sqlfluff) для dbt-специфичных (или dbtonic) правил проверки, которые мы используем для наших собственных проектов:

<details>
<summary>Пример конфигурационного кода dbtonic, предоставленный dbt Labs</summary>

```
[sqlfluff]
templater = dbt
# Это изменение (с Jinja на dbt templater) сделает линтинг более медленным,
# потому что перед проверкой dbt‑код сначала будет скомпилирован в код для хранилища данных.
runaway_limit = 10
max_line_length = 80
indent_unit = space

[sqlfluff:indentation]
tab_space_size = 4

[sqlfluff:layout:type:comma]
spacing_before = touch
line_position = trailing

[sqlfluff:rules:capitalisation.keywords] 
capitalisation_policy = lower

[sqlfluff:rules:aliasing.table]
aliasing = explicit

[sqlfluff:rules:aliasing.column]
aliasing = explicit

[sqlfluff:rules:aliasing.expression]
allow_scalar = False

[sqlfluff:rules:capitalisation.identifiers]
extended_capitalisation_policy = lower

[sqlfluff:rules:capitalisation.functions]
capitalisation_policy = lower

[sqlfluff:rules:capitalisation.literals]
capitalisation_policy = lower

[sqlfluff:rules:ambiguous.column_references]  # Number in group by
group_by_and_order_by_style = implicit
```
</details>

Чтобы узнать больше о лучших практиках стилизации, см. раздел [How we style our SQL](/best-practices/how-we-style/2-how-we-style-our-sql).

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/ide-sqlfluff-config.png" width="90%" title="Настройка линтинга с помощью собственных правил линтинга кода, включая правила линтинга и стилизации dbtonic."/>

## Форматирование

В <Constant name="cloud_ide" /> вы можете форматировать код в соответствии с руководствами по стилю одним нажатием кнопки. <Constant name="cloud_ide" /> интегрируется с форматтерами, такими как sqlfmt, Prettier и Black, чтобы автоматически форматировать код пяти разных типов файлов &mdash; SQL, YAML, Markdown, Python и JSON:

- SQL &mdash; Форматирование с помощью [sqlfmt](http://sqlfmt.com/), который предоставляет единый способ форматирования dbt SQL и Jinja.
    - **Примечание**: Пользовательская конфигурация sqlfmt в <Constant name="cloud_ide" /> не поддерживается.
- YAML, Markdown и JSON &mdash; Форматирование с помощью [Prettier](https://prettier.io/). 
- Python &mdash; Форматирование с помощью [Black](https://black.readthedocs.io/en/latest/).

Интеграции форматирования в Cloud <Constant name="cloud_ide" /> берут на себя рутинные задачи, такие как форматирование кода, позволяя вам сосредоточиться на создании качественных моделей данных, совместной работе и достижении значимых результатов.

### Форматирование SQL

Чтобы форматировать ваш SQL-код, <Constant name="cloud" /> интегрируется с [sqlfmt](http://sqlfmt.com/) — это строгий форматтер SQL-запросов, который предлагает единый, однозначный способ форматирования SQL и Jinja.

По умолчанию <Constant name="cloud_ide" /> использует правила sqlfmt для форматирования вашего кода, поэтому кнопка **Format** доступна сразу и ею удобно пользоваться. Однако, если в корневом каталоге вашего dbt‑проекта есть файл с именем `.sqlfluff`, <Constant name="cloud_ide" /> по умолчанию будет использовать правила SQLFluff.

Форматирование доступно во всех ветках, включая защищённую основную git‑ветку. Поскольку <Constant name="cloud_ide" /> не позволяет делать коммиты напрямую в защищённую ветку, он предложит закоммитить эти изменения в новую ветку.

1. Откройте файл `.sql` и нажмите на вкладку **Code Quality**.
2. Нажмите на кнопку **`</> Config`** на правой стороне консоли.
3. В всплывающем окне конфигурации инструмента качества кода у вас есть возможность выбрать sqlfluff или sqlfmt.
4. Чтобы форматировать ваш код, выберите радиокнопку **sqlfmt**. (Используйте sqlfluff для [проверки](#linting) вашего кода).
5. После того как вы выбрали радиокнопку **sqlfmt**, перейдите в раздел консоли (расположенный ниже **Редактора файлов**), чтобы выбрать кнопку **Format**.
6. Кнопка **Format** автоматически форматирует ваш код в **Редакторе файлов**. После автоматического форматирования вы увидите сообщение, подтверждающее результат.

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/sqlfmt.gif" width="90%" title="Используйте sqlfmt для форматирования вашего SQL-кода."/>

### Форматирование YAML, Markdown, JSON

Чтобы форматировать код YAML, Markdown или JSON, <Constant name="cloud" /> интегрируется с [Prettier](https://prettier.io/) — форматировщиком кода с жёстко заданными правилами. Форматирование доступно во всех ветках, включая защищённую основную git-ветку. Поскольку <Constant name="cloud_ide" /> не позволяет выполнять коммиты в защищённую ветку, он предлагает зафиксировать эти изменения в новой ветке.

1. Откройте файл `.yml`, `.md` или `.json`.
2. В разделе консоли (расположенном ниже **Редактора файлов**) выберите кнопку **Format**, чтобы автоматически форматировать ваш код в **Редакторе файлов**. Используйте вкладку **Code Quality** для просмотра ошибок кода.
3. После автоматического форматирования вы увидите сообщение, подтверждающее результат.

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/prettier.gif" width="90%" title="Форматируйте файлы YAML, Markdown и JSON с помощью Prettier."/>

Вы можете добавить конфигурационный файл для настройки правил форматирования для файлов YAML, Markdown или JSON с помощью Prettier. IDE ищет конфигурационный файл на основе порядка приоритета. Например, сначала она проверяет наличие ключа "prettier" в вашем файле `package.json`.

Для получения дополнительной информации о порядке приоритета и о том, как настраивать файлы, обратитесь к [документации Prettier](https://prettier.io/docs/en/configuration.html). Обратите внимание, что файлы `.prettierrc.json5`, `.prettierrc.js` и `.prettierrc.toml` в настоящее время не поддерживаются.

### Форматирование Python

Для форматирования вашего Python-кода <Constant name="cloud" /> интегрируется с [Black](https://black.readthedocs.io/en/latest/) — строгим форматтером кода Python. Форматирование доступно во всех ветках, включая защищённую основную git-ветку. Поскольку <Constant name="cloud_ide" /> не позволяет выполнять коммиты в защищённую ветку, он предлагает закоммитить эти изменения в новую ветку.

1. Откройте файл `.py`.
2. В разделе консоли (расположенном ниже **Редактора файлов**) выберите кнопку **Format**, чтобы автоматически форматировать ваш код в **Редакторе файлов**.
3. После автоматического форматирования вы увидите сообщение, подтверждающее результат.

<Lightbox src="/img/docs/dbt-cloud/cloud-ide/python-black.gif" width="80%" title="Форматируйте файлы Python с помощью Black."/>

## Часто задаваемые вопросы

<DetailsToggle alt_header="Когда следует использовать SQLFluff, а когда sqlfmt?">

SQLFluff и sqlfmt — это оба инструмента, используемые для форматирования SQL-кода, но некоторые различия могут сделать один из них предпочтительным в зависимости от вашего случая использования. <br />

SQLFluff — это линтер и форматтер SQL-кода. Это означает, что он анализирует ваш код, чтобы выявить потенциальные проблемы и баги, и следует стандартам кодирования. Он также форматирует ваш код в соответствии с набором правил, которые [настраиваемы](#customize-linting), чтобы обеспечить согласованные практики кодирования. Вы также можете использовать SQLFluff, чтобы ваш SQL-код был хорошо отформатирован и следовал лучшим практикам стилизации. <br />

sqlfmt — это форматтер SQL-кода. Это означает, что он автоматически форматирует ваш SQL-код в соответствии с набором правил форматирования, которые не настраиваемы. Он сосредоточен исключительно на внешнем виде и макете кода, что помогает обеспечить согласованное отступление, разрывы строк и пробелы. sqlfmt не анализирует ваш код на наличие ошибок или багов и не рассматривает проблемы кодирования за пределами форматирования кода. <br />

Вы можете использовать либо SQLFluff, либо sqlfmt в зависимости от ваших предпочтений и того, что лучше всего подходит для вас:

- Используйте SQLFluff, чтобы ваш код был проверен и отформатирован (то есть проанализируйте и исправьте ваш код на наличие ошибок/багов и отформатируйте ваш стиль). Это позволяет вам гибкость в настройке собственных правил.

- Используйте sqlfmt, чтобы ваш код был хорошо отформатирован без анализа на наличие ошибок и багов. Вы можете использовать sqlfmt из коробки, что делает его удобным для использования сразу без необходимости настройки.

</DetailsToggle>

<DetailsToggle alt_header="Могу ли я вложить файлы `.sqlfluff`?">

Чтобы обеспечить оптимальное качество кода, согласованный код и стили &mdash; настоятельно рекомендуется иметь один основной конфигурационный файл `.sqlfluff` в корневой папке вашего проекта. Наличие нескольких файлов может привести к различным стилям SQL в вашем проекте. <br /><br />

Однако вы можете настроить и включить дополнительный дочерний конфигурационный файл `.sqlfluff` в определенных подпапках вашего проекта dbt. <br /><br />Вложив файл `.sqlfluff` в подпапку, SQLFluff будет применять правила, определенные в конфигурационном файле этой подпапки, к любым файлам, находящимся в ней. Правила, указанные в родительском файле `.sqlfluff`, будут использоваться для всех других файлов и папок за пределами подпапки. Этот иерархический подход позволяет использовать индивидуальные правила проверки, сохраняя при этом согласованность во всем проекте. Обратитесь к [документации SQLFluff](https://docs.sqlfluff.com/en/stable/configuration.html#configuration-files) для получения дополнительной информации.

</DetailsToggle>

<DetailsToggle alt_header="Могу ли я запускать команды SQLFluff из терминала?">

В настоящее время запуск команд SQLFluff из терминала не поддерживается.
</DetailsToggle>

<DetailsToggle alt_header="What are some considerations when using dbt linting?">
В настоящее время <Constant name="cloud_ide" /> может выполнять линтинг или автоматическое исправление файлов только до определённого размера и уровня сложности. Если вы попытаетесь выполнить линтинг или исправление файлов, которые слишком большие и требуют более 60 секунд на обработку со стороны бэкенда <Constant name="cloud" />, вы увидите ошибку `Unable to complete linting this file`.

Чтобы избежать этого, разбейте вашу модель на более мелкие модели (файлы), чтобы они были менее сложными для проверки или исправления. Обратите внимание, что проверка проще, чем исправление, поэтому могут быть случаи, когда файл можно проверить, но не исправить.

</DetailsToggle>

## Связанные документы

- [Пользовательский интерфейс](/docs/cloud/studio-ide/ide-user-interface)
- [Горячие клавиши](/docs/cloud/studio-ide/keyboard-shortcuts)
- [SQL‑линтинг в CI‑задачах](/docs/deploy/continuous-integration#sql-linting)
