---
title: "Подключение PostgreSQL, Lakebase и AlloyDB"
id: connect-postgresql-alloydb
description: "Инструкции по настройке подключения PostgreSQL, Lakebase и AlloyDB к dbt"
sidebar_label: "Подключение PostgreSQL, Lakebase и AlloyDB"
---

Платформа dbt поддерживает подключение к PostgresSQL и Postgres-совместимым базам данных (AlloyDB, Lakebase).

Следующие поля являются обязательными при создании подключения:

| Field | Description | Examples |
| ----- | ----------- | -------- |
| Host Name | Имя хоста базы данных, к которой выполняется подключение. Это может быть как DNS-имя, так и IP-адрес. Обратитесь к [страницам настройки](/docs/core/connect-data-platform/about-core-connections), чтобы узнать hostname для вашего адаптера. | Postgres: `xxx.us-east-1.amazonaws.com` |
| Port | Обычно 5432 | `5439` |
| Database | Логическая база данных, к которой выполняется подключение и в которой будут запускаться запросы. | `analytics` |

**Примечание**: При настройке подключения Postgres в <Constant name="cloud" /> параметры, связанные с SSL, недоступны для ввода.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/postgres-redshift-connection.png" width="70%" title="Настройка подключения Postgres"/>

### Параметры аутентификации

Для аутентификации пользователи <Constant name="cloud" /> могут использовать **имя пользователя и пароль базы данных** для Postgres и Postgres-совместимых баз данных. Подробнее о поддерживаемых возможностях, ограничениях и полезных рекомендациях см. на странице настройки конкретной базы данных.

В следующей таблице приведены параметры для подключения к базе данных с использованием пароля.

| Field | Description | Examples |
| ------------- | ------- | ------------ |
| `user`   | Имя пользователя учетной записи для входа в кластер | myuser |
| `password`  | Пароль для аутентификации | _password1! |

### Подключение через SSH-туннель

import BastionServer from '/snippets/_bastion-server.md';

<BastionServer postgresalloydb='Postgres or AlloyDB' postgres='Postgres' />

## Конфигурация

Чтобы предоставить пользователям или ролям разрешения на уровне базы данных (права доступа и привилегии), обратитесь к странице [Postgres permissions](/reference/database-permissions/postgres-permissions).

## FAQs

<DetailsToggle alt_header="Ошибка базы данных — не удалось подключиться к серверу: Connection timed out">
При настройке подключения к базе данных через SSH-туннель необходимы следующие компоненты:

- Балансировщик нагрузки (например, ELB или NLB) для управления трафиком.
- Bastion host (или jump server), на котором работает SSH-протокол и который служит защищенной точкой входа.
- Сама база данных (например, кластер Postgres).

<Constant name="cloud" /> использует SSH-туннель для подключения через балансировщик нагрузки к базе данных. Это соединение устанавливается в начале каждого запуска задания dbt. Если туннельное соединение обрывается, выполнение задания завершается с ошибкой.

Сбои SSH-туннеля обычно происходят по следующим причинам:

- SSH-демон завершает соединение при слишком длительном простое.
- Балансировщик нагрузки разрывает соединение при отсутствии активности.
- <Constant name="cloud" /> пытается поддерживать соединение, отправляя проверочные запросы каждые 30 секунд, и система завершает соединение, если не получает ответа от SSH-сервиса в течение 300 секунд. Это помогает избежать разрывов из‑за простоя, если только тайм-аут балансировщика нагрузки не меньше 30 секунд.

Bastion host может иметь дополнительные настройки SSH, которые отключают неактивных клиентов после нескольких проверок без ответа. По умолчанию выполняется три такие проверки.

Чтобы предотвратить преждевременные разрывы соединения, можно изменить настройки на bastion host:

- `ClientAliveCountMax` &mdash; определяет количество проверок перед тем, как клиент считается неактивным. Например, `ClientAliveCountMax 10` означает 10 проверок.
- `ClientAliveInterval` &mdash; определяет интервал проверки активности клиента. Например, `ClientAliveInterval 30` выполняет проверку каждые 30 секунд.

Эти примеры настроек обеспечивают отключение неактивных SSH-клиентов примерно через 300 секунд, снижая вероятность сбоев SSH-туннеля.
</DetailsToggle>
