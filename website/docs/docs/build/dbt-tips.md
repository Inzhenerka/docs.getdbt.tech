---
title: "Советы и рекомендации по dbt"
description: "Ознакомьтесь с любыми советами и рекомендациями, связанными с dbt, чтобы работать быстрее и быть более продуктивными."
sidebar_label: "Советы и рекомендации по dbt"
pagination_next: null
---

Используйте эту страницу для получения ценных идей и практических советов, чтобы улучшить ваш опыт работы с dbt. Независимо от того, новичок вы в dbt или опытный пользователь, эти советы помогут вам работать более эффективно и результативно.

Следующие советы организованы по следующим категориям:

- [Советы по пакетам](#package-tips) для оптимизации вашего рабочего процесса.
- [Продвинутые советы и техники](#advanced-tips-and-techniques) для максимального использования возможностей dbt.

Если вы разрабатываете с использованием <Constant name="cloud_ide" />, вы можете обратиться к странице [keyboard shortcuts](/docs/cloud/studio-ide/keyboard-shortcuts), чтобы сделать разработку более продуктивной и удобной для всех.

## YAML tips

В этом разделе поясняется, где именно вы можете использовать [Jinja](/docs/build/jinja-macros), а также вкладывать [vars](/reference/dbt-jinja-functions/var) и [`env_var`](/reference/dbt-jinja-functions/env_var) в ваших YAML-файлах.

- Вы можете использовать Jinja почти в любом YAML-файле в dbt, _кроме_ файла [`dependencies.yml`](/docs/build/packages#use-cases). Это связано с тем, что файл `dependencies.yml` не поддерживает Jinja.
- Используйте `vars` в любом YAML-файле, который поддерживает Jinja (например, `schema.yml`, `snapshots.yml`). Однако обратите внимание:
  - В файлах `dbt_project.yml`, `packages.yml` и `profiles.yml` вы должны передавать `vars` через CLI с помощью параметра `--vars`, а не определять их внутри блока `vars:` в самом YAML-файле. Это связано с тем, что эти файлы обрабатываются до рендеринга Jinja.
- Вы можете использовать `env_var()` во всех YAML-файлах, которые поддерживают Jinja. При этом только `profiles.yml` и `packages.yml` поддерживают использование переменных окружения для защищённых значений (с префиксом `DBT_ENV_SECRET_`). Такие значения маскируются в логах и предназначены для хранения учётных данных или секретов.

Для получения дополнительной информации см. документацию по контексту [<Constant name="core" />](https://github.com/dbt-labs/dbt-core/blob/main/core/dbt/context/README.md).

Используйте эти пакеты dbt для оптимизации вашего рабочего процесса:

| Пакет | Описание |
|-------|----------|
| [`dbt_codegen`](https://hub.getdbt.com/dbt-labs/codegen/latest/) | Используйте пакет для генерации YML файлов для ваших моделей и источников, а также SQL файлов для ваших промежуточных моделей. |
| [`dbt_utils`](https://hub.getdbt.com/dbt-labs/dbt_utils/latest/) | Пакет содержит макросы, полезные для ежедневной разработки. Например, `date_spine` генерирует таблицу со всеми датами между указанными в параметрах. |
| [`dbt_project_evaluator`](https://hub.getdbt.com/dbt-labs/dbt_project_evaluator/latest) | Пакет сравнивает ваш проект dbt с перечнем наших лучших практик и предоставляет рекомендации и руководства по обновлению ваших моделей. |
| [`dbt_expectations`](https://hub.getdbt.com/calogica/dbt_expectations/latest) | Пакет содержит множество тестов, выходящих за рамки встроенных в dbt. |
| [`dbt_audit_helper`](https://hub.getdbt.com/#:~:text=adwords-,audit_helper,-codegen) | Пакет позволяет сравнивать результаты двух запросов. Используйте его при рефакторинге существующей логики, чтобы убедиться, что новые результаты идентичны. |
| [`dbt_artifacts`](https://hub.getdbt.com/brooklyn-data/dbt_artifacts/latest) | Пакет сохраняет информацию о ваших запусках dbt непосредственно на вашей платформе данных, чтобы вы могли отслеживать производительность моделей с течением времени. |
| [`dbt_meta_testing`](https://hub.getdbt.com/tnightengale/dbt_meta_testing/latest) | Этот пакет проверяет, что ваш проект dbt достаточно протестирован и задокументирован. |

| Package | Description |
|---------|-------------|
| [`dbt_codegen`](https://hub.getdbt.com/dbt-labs/codegen/latest/) | Используйте пакет, чтобы упростить генерацию YML‑файлов для моделей и источников, а также SQL‑файлов для staging‑моделей. |
| [`dbt_utils`](https://hub.getdbt.com/dbt-labs/dbt_utils/latest/) | Пакет содержит макросы, полезные для повседневной разработки. Например, `date_spine` генерирует таблицу со всеми датами между значениями, переданными в параметрах. |
| [`dbt_project_evaluator`](https://hub.getdbt.com/dbt-labs/dbt_project_evaluator/latest) | Пакет сравнивает ваш dbt‑проект со списком лучших практик и предоставляет рекомендации и гайдлайны по обновлению моделей. |
| [`dbt_expectations`](https://hub.getdbt.com/metaplane/dbt_expectations/latest/) | Пакет содержит множество тестов, выходящих за рамки встроенных в dbt. |
| [`dbt_audit_helper`](https://hub.getdbt.com/#:~:text=adwords-,audit_helper,-codegen) | Пакет позволяет сравнивать результаты выполнения двух запросов. Используйте его при рефакторинге существующей логики, чтобы убедиться, что новые результаты полностью совпадают со старыми. |
| [`dbt_artifacts`](https://hub.getdbt.com/brooklyn-data/dbt_artifacts/latest) | Пакет сохраняет информацию о выполнениях dbt напрямую в вашей платформе данных, чтобы вы могли отслеживать производительность моделей со временем. |
| [`dbt_meta_testing`](https://hub.getdbt.com/tnightengale/dbt_meta_testing/latest) | Пакет проверяет, что ваш dbt‑проект достаточно покрыт тестами и документацией. |

- Используйте структуру папок в качестве основного метода выбора. `dbt build --select marts.marketing` проще и более устойчив, чем полагаться на маркировку каждой модели.
- Рассматривайте задания с точки зрения частоты сборки и SLA. Запускайте модели с почасовой, ежедневной или еженедельной частотой сборки вместе.
- Используйте [where config](/reference/resource-configs/where) для тестов, чтобы проверить утверждение на подмножестве записей.
- [store_failures](/reference/resource-configs/store_failures) позволяет вам изучать записи, которые вызывают сбои тестов, чтобы вы могли либо исправить данные, либо изменить тест по мере необходимости.
- Используйте пороги [severity](/reference/resource-configs/severity), чтобы установить допустимое количество сбоев для теста.
- Используйте [incremental_strategy](/docs/build/incremental-strategy) в конфигурации вашей инкрементальной модели, чтобы реализовать наиболее эффективное поведение в зависимости от объема ваших данных и надежности уникальных ключей.
- Установите `vars` в вашем `dbt_project.yml`, чтобы определить глобальные значения по умолчанию для определенных условий, которые затем можно переопределить с помощью флага `--vars` в ваших командах.
- Используйте [for loops](/guides/using-jinja?step=3) в Jinja, чтобы <Term id="dry">DRY</Term> повторяющуюся логику, такую как выбор серии столбцов, для которых необходимо применить одинаковые преобразования и шаблоны именования.
- Вместо того чтобы полагаться на post-hooks, используйте [grants config](/reference/resource-configs/grants) для устойчивого применения разрешений в хранилище.
- Определите пороги [source-freshness](/docs/build/sources#source-data-freshness) для ваших источников, чтобы избежать выполнения преобразований на данных, которые уже были обработаны.
- Используйте оператор `+` слева от модели `dbt build --select +model_name`, чтобы запустить модель и все ее вышестоящие зависимости. Используйте оператор `+` справа от модели `dbt build --select model_name+`, чтобы запустить модель и все, что от нее зависит.
- Используйте `dir_name`, чтобы запустить все модели в пакете или директории.
- Используйте оператор `@` слева от модели в настройке CI без учета состояния, чтобы протестировать ее. Этот оператор запускает всех родителей и детей выбора, а также родителей его детей, которые в новой схеме CI, вероятно, еще не существуют.
- Используйте флаг [--exclude](/reference/node-selection/exclude), чтобы исключить подмножество моделей из выбора.
- Используйте флаг [--full-refresh](/reference/commands/run#refresh-incremental-models), чтобы перестроить инкрементальную модель с нуля.
- Используйте [seeds](/docs/build/seeds) для создания ручных таблиц поиска, таких как почтовые индексы для штатов или маркетинговые UTM для кампаний. `dbt seed` создаст их из CSV в вашем хранилище и сделает их доступными для `ref` в ваших моделях.
- Используйте [target.name](/docs/build/custom-schemas#an-alternative-pattern-for-generating-schema-names), чтобы изменять логику в зависимости от того, какую среду вы используете. Например, чтобы строить в одну схему разработки во время разработки, но использовать несколько схем в производстве.

## Связанные документы

## Связанная документация

- [Руководство по быстрому началу](/guides)
- [О <Constant name="cloud" />](/docs/cloud/about-cloud/dbt-cloud-features)
- [Разработка в облаке](/docs/cloud/about-develop-dbt)
