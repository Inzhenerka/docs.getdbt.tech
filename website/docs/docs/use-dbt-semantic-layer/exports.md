---
title: "Запись запросов с помощью экспорта"
description: "Используйте экспорт для записи таблиц в платформу данных по расписанию."
sidebar_label: "Запись запросов с помощью экспорта"
keywords: [DBT_INCLUDE_SAVED_QUERY, exports, DBT_EXPORTS_SAVED_QUERY, dbt Cloud, Semantic Layer]
---

Экспорты улучшают [сохраненные запросы](/docs/build/saved-queries), выполняя ваши сохраненные запросы и записывая результаты в таблицу или представление в вашей платформе данных. Сохраненные запросы позволяют сохранять и повторно использовать часто используемые запросы в MetricFlow, а экспорты расширяют эту функциональность, позволяя:

- Записывать эти запросы в вашей платформе данных с помощью планировщика заданий dbt Cloud.
- Обеспечивать интеграцию для инструментов, которые не поддерживают dbt Semantic Layer, предоставляя таблицы метрик и измерений.

По сути, экспорты подобны любым другим таблицам в вашей платформе данных &mdash; они позволяют вам запрашивать определения метрик через любой SQL-интерфейс или подключаться к инструментам downstream без полноценной интеграции [Semantic Layer](/docs/cloud-integrations/avail-sl-integrations). Запуск экспорта учитывается в использовании [запрашиваемых метрик](/docs/cloud/billing#what-counts-as-a-queried-metric). Запрос результирующей таблицы или представления из экспорта не учитывается в использовании запрашиваемых метрик.

## Предварительные условия

- У вас есть учетная запись dbt Cloud на плане [Team или Enterprise](https://www.getdbt.com/pricing/).
- Вы используете одну из следующих платформ данных: Snowflake, BigQuery, Databricks или Redshift.
- Вы используете [версию dbt](/docs/dbt-versions/upgrade-dbt-version-in-cloud) 1.7 или новее.
- У вас настроен [dbt Semantic Layer](/docs/use-dbt-semantic-layer/setup-sl) в вашем проекте dbt.
- У вас есть окружение dbt Cloud с включенным [планировщиком заданий](/docs/deploy/job-scheduler).
- У вас есть [сохраненный запрос](/docs/build/saved-queries) и [экспорт, настроенный](/docs/build/saved-queries#configure-exports) в вашем проекте dbt. В вашей конфигурации используйте [кэширование](/docs/use-dbt-semantic-layer/sl-cache) для кэширования общих запросов, ускорения работы и снижения вычислительных затрат.
- У вас установлен [dbt Cloud CLI](/docs/cloud/cloud-cli-installation). Обратите внимание, что экспорты пока не поддерживаются в dbt Cloud IDE.

## Преимущества экспорта

В следующем разделе объясняются основные преимущества использования экспорта, включая:
- [Представление DRY](#dry-representation)
- [Упрощенные изменения](#easier-changes)
- [Кэширование](#caching)

#### Представление DRY

В настоящее время создание таблиц часто связано с генерацией десятков, сотен или даже тысяч таблиц, которые денормализуют данные в таблицы сводок или метрик. Основное преимущество экспорта заключается в создании "Не повторяйте себя (DRY)" представления логики для построения каждой метрики, измерения, соединения, фильтра и т.д. Это позволяет повторно использовать эти компоненты для долгосрочной масштабируемости, даже если вы заменяете вручную написанные SQL-модели ссылками на метрики или измерения в сохраненных запросах.

#### Упрощенные изменения

Экспорты гарантируют, что изменения в метриках и измерениях вносятся в одном месте и затем бесшовно каскадируются к различным назначениям. Это предотвращает проблему необходимости обновления метрики в каждой модели, которая ссылается на ту же концепцию.

#### Кэширование 
Используйте экспорты для предварительного заполнения кэша, чтобы заранее вычислить то, что вам нужно для обслуживания пользователей через динамические API Semantic Layer.

#### Учитывайте

Экспорты предлагают множество преимуществ, и важно отметить некоторые случаи использования, которые выходят за рамки этих преимуществ:
- Бизнес-пользователи могут по-прежнему испытывать трудности с потреблением данных из десятков, сотен или тысяч таблиц, и выбор правильной может быть сложной задачей.
- Бизнес-пользователи также могут допускать ошибки при агрегации и фильтрации из заранее созданных таблиц.

Для этих случаев используйте динамические [API dbt Semantic Layer](/docs/dbt-cloud-apis/sl-api-overview) вместо экспорта.

## Запуск экспорта

Перед тем как вы сможете запустить экспорт в разработке или производстве, вам нужно убедиться, что вы [настроили сохраненные запросы и экспорты](/docs/build/saved-queries) в вашем проекте dbt. В вашей конфигурации сохраненного запроса вы также можете использовать [кэширование](/docs/use-dbt-semantic-layer/sl-cache) с планировщиком заданий dbt Cloud для кэширования общих запросов, ускорения работы и снижения вычислительных затрат.

Существует два способа запустить экспорт:
  
- [Запуск экспорта в разработке](#exports-in-development) с использованием [dbt Cloud CLI](/docs/cloud/cloud-cli-installation) для тестирования вывода перед производством (вы можете настроить экспорты в dbt Cloud IDE, однако запуск их непосредственно в IDE пока не поддерживается). Если вы используете dbt Cloud IDE, используйте `dbt build` для запуска экспорта. Убедитесь, что у вас включена [переменная окружения](#set-environment-variable).
- [Запуск экспорта в производстве](#exports-in-production) с использованием [планировщика заданий dbt Cloud](/docs/deploy/job-scheduler) для записи этих запросов в вашей платформе данных.

## Экспорты в разработке

Вы можете запустить экспорт в вашей среде разработки, используя ваши учетные данные разработки, если хотите протестировать вывод экспорта перед производством. 

Этот раздел объясняет различные команды и параметры, доступные для запуска экспорта в разработке.

- Используйте команду [`dbt sl export`](#exports-for-single-saved-query), чтобы протестировать и сгенерировать экспорты в вашей среде разработки для одного сохраненного запроса. Вы также можете использовать флаг `--select`, чтобы указать конкретные экспорты из сохраненного запроса.

- Используйте команду [`dbt sl export-all`](#exports-for-multiple-saved-queries), чтобы запустить экспорты для нескольких сохраненных запросов одновременно. Эта команда предоставляет удобный способ управления и выполнения экспорта для нескольких запросов одновременно, экономя время и усилия. 

### Экспорты для одного сохраненного запроса

Используйте следующую команду для запуска экспорта в dbt Cloud CLI:

```bash
dbt sl export
```

Следующая таблица перечисляет параметры для команды `dbt sl export`, используя префикс `--` для указания параметров:  

| Параметры | Тип    | Обязательный | Описание    |
| ------- | --------- | ---------- | ---------------- |
| `name` | String    | Обязательный     | Имя объекта `export`.    |
| `saved-query` | String    | Обязательный     | Имя сохраненного запроса, который может быть использован.    |
| `select` | List или String   | Необязательный    | Укажите имена экспортов для выбора из сохраненного запроса. |
| `exclude` | String  | Необязательный    | Укажите имена экспортов для исключения из сохраненного запроса. |
| `export_as` | String  | Необязательный    | Тип экспорта, который нужно создать из доступных типов `export_as` в конфигурации. Доступные варианты: `table` или `view`. |
| `schema` | String  | Необязательный    | Схема, которая будет использоваться для создания таблицы или представления. |
| `alias` | String  | Необязательный    | Псевдоним таблицы, который будет использоваться для записи таблицы или представления. |

Вы также можете запустить любой экспорт, определенный для сохраненного запроса, и записать таблицу или представление в вашей среде разработки. Смотрите следующий пример команды и вывод:

```bash
dbt sl export --saved-query sq_name
```

Вывод будет выглядеть примерно так: 

```bash
Polling for export status - query_id: 2c1W6M6qGklo1LR4QqzsH7ASGFs..
Export completed.
```

### Использование флага select

Вы можете иметь несколько экспортов для сохраненного запроса, и по умолчанию все экспорты запускаются для сохраненного запроса. Вы можете использовать флаг `select` в [разработке](#exports-in-development), чтобы выбрать конкретные или несколько экспортов. Обратите внимание, что вы не можете подбирать метрики или измерения из сохраненного запроса, это просто для изменения конфигурации экспорта, т.е. формата таблицы или схемы.

Например, следующая команда запускает `export_1` и `export_2` и не работает с флагами `--alias` или `--export_as`:

```bash
dbt sl export --saved-query sq_name --select export_1,export2
```

<details>
<summary>Переопределение конфигураций экспорта</summary>

Флаг `--select` в основном используется для включения или исключения конкретных экспортов. Если вам нужно изменить эти настройки, вы можете использовать следующие флаги для переопределения конфигураций экспорта:

- `--export-as` &mdash; Определяет тип материализации (таблица или представление) для экспорта. Это создает новый экспорт с его собственными настройками и полезно для тестирования в разработке.
- `--schema` &mdash;  Указывает схему, которая будет использоваться для записанной таблицы или представления.
- `--alias` &mdash; Присваивает пользовательский псевдоним записанной таблице или представлению. Это переопределяет имя экспорта по умолчанию.

Будьте осторожны. Флаг `--select` _не может_ использоваться с `alias` или `schema`.

Например, вы можете использовать следующую команду для создания нового экспорта с именем `new_export` в виде таблицы:

```bash
dbt sl export --saved-query sq_number1 --export-as table --alias new_export
```
</details>

### Экспорты для нескольких сохраненных запросов

Используйте команду `dbt sl export-all`, чтобы запустить экспорты для нескольких сохраненных запросов одновременно. Это отличается от команды `dbt sl export`, которая запускает экспорты только для одного сохраненного запроса. Например, чтобы запустить экспорты для нескольких сохраненных запросов,