---
title: "Часто задаваемые вопросы о семантическом слое dbt"
id: sl-faqs
description: "Читать часто задаваемые вопросы, чтобы узнать больше о семантическом слое dbt, о том, как он работает, как создавать метрики, интеграции и многое другое."
sidebar_label: "Часто задаваемые вопросы о семантическом слое"
tags: [Семантический слой]
pagination_next: null
---

[Семантический слой dbt](/docs/use-dbt-semantic-layer/dbt-sl) — это предложение dbt Cloud, которое позволяет пользователям централизованно определять свои метрики в рамках проекта dbt с использованием [MetricFlow](/docs/build/about-metricflow).

Семантический слой dbt предлагает:

- Генерацию динамического SQL для вычисления метрик
- API для запроса метрик и измерений
- Первоклассные [интеграции](/docs/cloud-integrations/avail-sl-integrations) для запроса этих централизованных метрик в инструментах нижнего уровня

Семантический слой dbt работает на базе MetricFlow, который является компонентом с открытым исходным кодом.

## Обзор семантического слоя dbt

<Expandable alt_header="Каковы основные преимущества использования семантического слоя dbt?">

Основная ценность семантического слоя dbt заключается в централизованном управлении и обеспечении согласованности ваших метрик в организации. Кроме того, он позволяет вам:

- **Встречать пользователей там, где они находятся**, будучи независимым от того, где ваши конечные пользователи потребляют данные, благодаря поддержке различных API для интеграций.
- **Оптимизировать затраты**, тратя меньше времени на подготовку данных для потребления.
- **Упрощать код**, избегая дублирования логики метрик и позволяя MetricFlow выполнять сложные вычисления за вас.
- **Уполномочивать заинтересованные стороны** с помощью богатого контекста и гибкого, но управляемого опыта.

<Lightbox src="/img/docs/dbt-cloud/semantic-layer/sl-concept.png" width="90%" title="Эта диаграмма показывает, как семантический слой dbt работает с вашим стеком данных." />

</Expandable>

<Expandable alt_header="В чем основное отличие между семантическим слоем dbt и метриками dbt?">

Метрики dbt — это устаревший пакет dbt, который использовался для определения метрик в dbt. Метрики dbt были заменены на [MetricFlow](/docs/build/about-metricflow), более гибкий и мощный движок, который сегодня является основой семантического слоя dbt.

MetricFlow вводит генерацию SQL в семантический слой dbt и предлагает более продвинутые возможности, чем метрики dbt, например:

- **Конструирование запросов** — MetricFlow итеративно строит запросы, используя план потоков данных, наш внутренний DAG для генерации SQL. В отличие от этого, метрики dbt полагались на шаблонный Jinja для построения SQL.
- **Соединения** — MetricFlow также имеет сложный способ обработки соединений, который не поддерживался метриками dbt. С помощью MetricFlow вы можете без труда получать доступ ко всем допустимым измерениям для ваших метрик на лету, даже если они определены в разных семантических моделях.

</Expandable>

<Expandable alt_header="Существует ли центр обсуждения семантического слоя dbt?">

Да, конечно! Присоединяйтесь к [сообществу dbt в Slack](https://app.slack.com/client/T0VLPD22H) и каналу [#dbt-cloud-semantic-layer](https://getdbt.slack.com/archives/C046L0VTVR6) для обсуждения всего, что связано с семантическим слоем dbt.

</Expandable>

<Expandable alt_header="Как семантический слой dbt вписывается в различные подходы к моделированию (Medallion, Data Vault, измерительное моделирование)?">

Семантический слой dbt достаточно гибок, чтобы работать с многими распространенными подходами к моделированию. Он ссылается на модели dbt, что означает, что то, как вы настраиваете свой семантический слой, будет отражать подход к моделированию, который вы выбрали для исходных данных.

Основное внимание уделяется гибкости и производительности исходных запросов. Например:

- Модель данных в виде звезды предлагает большую гибкость для измерений, доступных для данной метрики, но потребует больше соединений.
- Полностью денормализованная модель данных проще, будет материализована на определенном уровне детализации, но не сможет соединяться с другими таблицами.

Хотя семантический слой dbt будет работать в обоих случаях, лучше позволить MetricFlow обрабатывать некоторый уровень денормализации за вас, чтобы обеспечить большую гибкость для потребителей метрик.
</Expandable>

<Expandable alt_header="Какова стоимость семантического слоя dbt?">

Семантический слой dbt измеряет использование в отдельных 'Запрашиваемых метриках'. Обратитесь к [Платежам](/docs/cloud/billing#what-counts-as-a-queried-metric), чтобы узнать больше о ценообразовании.
</Expandable>

## Доступность

<Expandable alt_header="Какие платформы данных поддерживаются семантическим слоем dbt?">

Семантический слой dbt поддерживает следующие платформы данных:

- Snowflake
- BigQuery
- Databricks
- Redshift

Поддержка других платформ данных, таких как Fabric и Trino, в настоящее время недоступна. Если вы заинтересованы в использовании семантического слоя dbt с платформой данных, не входящей в список, пожалуйста, [свяжитесь с нами](https://www.getdbt.com/get-started).
</Expandable>

<Expandable alt_header="Нужно ли использовать конкретную версию dbt для работы с семантическим слоем dbt?">

Да, семантический слой dbt совместим с [dbt v1.6 или выше](/docs/dbt-versions/upgrade-dbt-version-in-cloud).
</Expandable>

<Expandable alt_header="Требуется ли для семантического слоя dbt конкретный план dbt Cloud?">

Да, клиенты плана dbt Cloud [Enterprise или Team](https://www.getdbt.com/pricing) могут получить доступ к семантическому слою dbt.
</Expandable>

<Expandable alt_header="Существует ли способ использовать возможности семантического слоя dbt в dbt Core?">

Семантический слой dbt является собственностью dbt Cloud, однако некоторые его компоненты являются открытыми. Пользователи dbt Core могут использовать функции MetricFlow, такие как определение метрик в своих проектах, без плана dbt Cloud.

Пользователи dbt Core также могут запрашивать свой семантический слой локально с помощью командной строки. Однако они не смогут использовать [API](/docs/dbt-cloud-apis/sl-api-overview) или [доступные интеграции](/docs/cloud-integrations/avail-sl-integrations) для динамического доступа к метрикам.

</Expandable>

<Expandable alt_header="Существует ли решение или путь лицензирования для организации, которая не использует dbt для создания потоков данных, но может захотеть реализовать семантический слой dbt?">

Если вас интересует такой тип реализации, пожалуйста, свяжитесь с нами [здесь](https://www.getdbt.com/get-started).
</Expandable>

## Как работает семантический слой dbt?

<Expandable alt_header="Почему семантический слой dbt лучше, чем использование таблиц или моделей dbt для вычисления метрик?">

Вы можете использовать таблицы и модели dbt для вычисления метрик, но это статический подход, который жесток и трудоемок в обслуживании. Это связано с тем, что метрики редко полезны сами по себе: они обычно нуждаются в измерениях, уровнях детализации и атрибутах, чтобы бизнес-пользователи могли эффективно анализировать (или разбивать на части) данные.

Если вы создаете таблицу с метрикой, вам нужно будет создать множество других таблиц, производных от этой таблицы, чтобы показать желаемую метрику, разбитую по желаемому измерению или временной детализации. В зрелых моделях данных тысячи измерений, поэтому вы можете увидеть, как это быстро приведет к ненужному дублированию, обслуживанию и затратам. Также невероятно трудно предсказать все срезы данных, которые пользователю понадобятся заранее.

С семантическим слоем dbt вам не нужно предварительно соединять или строить какие-либо таблицы; вместо этого вы можете просто добавить несколько строк кода в свою семантическую модель, и эти данные будут вычислены только по запросу.

<Lightbox src="/img/docs/dbt-cloud/semantic-layer/sl-concept.png" width="90%" title="Эта диаграмма показывает, как семантический слой dbt работает с вашим стеком данных." />

</Expandable>

<Expandable alt_header="Материализую ли я что-либо, когда определяю семантическую модель?">

Нет, не материализуете. При запросе семантического слоя dbt через [API семантического слоя](/docs/dbt-cloud-apis/sl-api-overview) вы по умолчанию не материализуете никаких данных.

Семантический слой dbt динамически вычисляет метрику, используя исходные таблицы данных. Затем он возвращает результат конечному пользователю.
</Expandable>

<Expandable alt_header="Является ли семантический слой dbt физической копией ваших данных, хранящейся в вашем хранилище данных?">

Семантический слой dbt не хранит физическую копию ваших данных. Он использует исходные таблицы для построения или вычисления запрашиваемого результата.
</Expandable>

<Expandable alt_header="Как семантический слой обрабатывает данные?">

Семантический слой dbt является частью dbt Cloud. Он позволяет командам данных определять метрики один раз, централизованно, и получать к ним доступ из любого интегрированного аналитического инструмента, обеспечивая согласованные ответы на основе различных наборов данных. Предоставляя эту услугу, dbt Labs позволяет клиентам получать доступ к метрикам семантического слоя. Данные клиентов проходят через семантический слой на пути обратно из хранилища данных.

dbt Labs обрабатывает это безопасным образом, используя шифрование и аутентификацию из хранилища данных клиента. В некоторых случаях такие данные могут временно кэшироваться в системе dbt Labs (данные не хранятся постоянно).

Сотрудники dbt Labs не могут получить доступ к кэшированным данным в обычных условиях и должны иметь деловую необходимость и/или прямое одобрение менеджера для доступа к основной инфраструктуре. Доступ будет предоставлен только в случае необходимости для предоставления клиентских услуг и никогда с целью обогащения dbt Labs.

Данные клиентов из хранилища не сохраняются в системах dbt Labs. Мы предлагаем решение для кэширования для оптимизации производительности запросов. Функция кэширования использует хранилище данных клиента, а не хранится в системах dbt Labs. Кроме того, эта функция активируется только по желанию клиента. Таким образом, кэширование всегда находится в руках клиента и по его усмотрению.

</Expandable>

<Expandable alt_header="Применяются ли к семантическому слою наши соглашения, Условия обслуживания (ToS) для dbt Cloud?">

Да, применяются.

</Expandable>

<Expandable alt_header="Где размещен MetricFlow? Как запросы проходят через MetricFlow и dbt Cloud и возвращаются к конечному пользователю?">

MetricFlow размещен в dbt Cloud. Запросы от [API семантического слоя](/docs/dbt-cloud-apis/sl-api-overview) направляются от нашего API-шлюза к MetricFlow, который генерирует SQL для вычисления запрашиваемого пользователем. MetricFlow передает SQL обратно в наш шлюз, который затем выполняет его против платформы данных.
</Expandable>

<Expandable alt_header="Как я могу настроить семантический слой dbt?">

1. Вы определяете [семантические модели](/docs/build/semantic-models) в YAML-файлах, которые описывают ваши данные, включая сущности (для соединений), меры (с типами агрегации в качестве строительных блоков для ваших метрик) и измерения (для разбивки ваших метрик).

2. Затем вы строите свои метрики на основе этих семантических моделей. Все это делается в конфигурациях `.yml` вместе с вашими моделями dbt в ваших проектах.
3. После того как вы определили свои метрики и семантические модели, вы можете [настроить семантический слой dbt](/docs/use-dbt-semantic-layer/setup-sl) в dbt Cloud.

Прочитайте наш [краткий справочник по семантическому слою dbt](/guides/sl-snowflake-qs) для получения дополнительной информации.

</Expandable>

<Expandable alt_header="Как работает кэширование в семантическом слое dbt?">

Начиная с марта 2024 года, семантический слой dbt предложит два уровня кэширования:

- Кэш результатов, который кэширует результаты запросов в платформе данных, чтобы последующие запуски того же запроса были быстрее.
- Декларативный кэш, который также находится в вашей платформе данных.

</Expandable>

<Expandable alt_header="Ожидает ли семантический слой dbt, что все модели будут в нормализованном формате?">

Нет, семантический слой dbt достаточно гибок, чтобы работать с многими подходами к моделированию данных, включая Snowflake, звездообразные схемы, Data Vault или другие нормализованные таблицы.
</Expandable>

<Expandable alt_header="Как оптимизируются запросы, чтобы не сканировать больше данных, чем необходимо?">

MetricFlow всегда старается генерировать SQL наиболее производительным способом, обеспечивая при этом правильность значения метрики. Он генерирует SQL таким образом, чтобы мы могли добавлять оптимизации, такие как "продвижение предикатов", чтобы гарантировать, что мы не выполняем полные сканирования таблиц.

</Expandable>

<Expandable alt_header="Каковы соображения по задержке при использовании семантического слоя dbt?">

Задержка времени выполнения запросов низкая, в пределах миллисекунд.

</Expandable>

<Expandable alt_header="Что делать, если у разных команд разные определения?">

Если базовая агрегация метрики различна, то это будут разные метрики. Однако, если у команд разные определения из-за использования конкретных фильтров или измерений, это все еще одна и та же метрика. Они просто используют ее по-разному.

Это можно управлять, настраивая, как метрика отображается в инструментах нижнего уровня, или настраивая [сохраненные запросы](/docs/build/saved-queries) для обработки различных вариантов.

</Expandable>

## Создание метрик и семантических моделей

<Expandable alt_header="Могу ли я определить свои собственные агрегации?">

MetricFlow в настоящее время не поддерживает пользовательские агрегации для мер. Вы можете найти поддерживаемые типы агрегации [здесь](/docs/build/measures#aggregation).

</Expandable>

<Expandable alt_header="Как идентифицируются соединения в семантической модели? ">

[Соединения](/docs/build/join-logic) идентифицируются через [сущности](/docs/build/entities), определенные в [семантической модели](/docs/build/semantic-models). Это ключи в вашем наборе данных. Вы можете указать соединения `foreign`, `unique`, `primary` или `natural`.

С помощью нескольких семантических моделей и сущностей внутри них MetricFlow создает граф, используя семантические модели в качестве узлов и пути соединений в качестве ребер для автоматического выполнения соединений. MetricFlow выбирает соответствующий тип соединения и избегает соединений с разветвлением или пропастью с другими таблицами на основе типов сущностей. Вы можете найти поддерживаемые типы соединений [здесь](/docs/build/join-logic#types-of-joins).
</Expandable>

<Expandable alt_header="Какова польза от “expr”, используемого в семантических моделях и конфигурациях метрик?">

Expr (сокращение от “expression”) позволяет вам вставлять любой произвольный SQL, поддерживаемый вашей платформой данных, в любое определение меры, сущности или измерения.

Это полезно, если вы хотите, чтобы имя объекта в семантической модели отличалось от того, как оно называется в базе данных. Или если вы хотите включить логику в определение компонента, который вы создаете.

Спецификация MetricFlow преднамеренно имеет определенные предпочтения, и мы предлагаем “expr” в качестве альтернативы, чтобы разработчики могли быть более выразительными.
</Expandable>

<Expandable alt_header="Поддерживаете ли вы полунакапливаемые метрики?">

Да, мы подходим к этому, указывая [измерение](/docs/build/dimensions), по которому метрика не может быть агрегирована (например, `time`). Вы можете узнать, как настроить полунакапливаемые измерения [здесь](/docs/build/measures#non-additive-dimensions).
</Expandable>

<Expandable alt_header="Могу ли я использовать сущность в качестве измерения?">

Да, хотя [сущности](/docs/build/entities) должны быть определены под "сущностями", их можно запрашивать как измерения в инструментах нижнего уровня. Кроме того, если сущность не используется для выполнения соединений между вашими семантическими моделями, вы можете по желанию определить ее как измерение.
</Expandable>

<Expandable alt_header="Могу ли я тестировать свои семантические модели и метрики?">

Да! Вы можете проверить свои семантические узлы (семантические модели, метрики, сохраненные запросы) несколькими способами:

- [Запросите и проверьте свои метрики](/docs/build/metricflow-commands) в вашем инструменте разработки перед отправкой изменений кода.
- [Проверьте семантические узлы в CI](/docs/deploy/ci-jobs#semantic-validations-in-ci), чтобы убедиться, что изменения кода, внесенные в модели dbt, не нарушают эти метрики.

</Expandable>

## Доступные интеграции

<Expandable alt_header="Какие интеграции поддерживаются сегодня?">

Существует множество приложений для работы с данными, которые имеют интеграции с семантическим слоем dbt, включая Tableau, Google Sheets, Hex и Mode, среди прочих.

Обратитесь к [Доступным интеграциям](/docs/cloud-integrations/avail-sl-integrations) для получения дополнительной информации.

</Expandable>

<Expandable alt_header="Как я могу извлечь выгоду из использования семантического слоя dbt, если мой инструмент визуализации в настоящее время не поддерживается?">

Вы можете использовать [экспорты](/docs/use-dbt-semantic-layer/exports) для материализации ваших метрик в таблицу или представление в вашей платформе данных. Оттуда вы можете подключить свой инструмент визуализации к вашей платформе данных.

Хотя этот подход не предоставляет динамических преимуществ семантического слоя dbt, вы все равно получаете выгоду от централизованных метрик и использования конфигураций MetricFlow для определения, генерации и вычисления SQL для ваших метрик.

</Expandable>

<Expandable alt_header="Почему я должен использовать экспорты вместо определения представления в своей платформе данных?">

Создание [экспорта](/docs/use-dbt-semantic-layer/exports) позволяет вам перенести ваши управляемые определения метрик в вашу платформу данных в виде таблицы или представления. Это означает, что ваша логика метрик управляется централизованно в dbt, а не как представление в вашей платформе данных, и гарантирует, что значения метрик остаются согласованными во всех интерфейсах.

</Expandable>

<Expandable alt_header="Могут ли описания метрик быть видны из сторонних инструментов?">

Да, все наши интерфейсы или API предоставляют описания метрик, которые вы можете использовать в инструментах нижнего уровня.

</Expandable>

## Разрешения и доступ

<Expandable alt_header="Как работают детализированные контроль доступа с семантическим слоем dbt?">

Семантический слой dbt использует токены службы для аутентификации, сопоставленные с учетными данными платформы данных. Эти учетные данные контролируют физический доступ к необработанным данным. Конфигурация учетных данных позволяет администраторам создавать учетные данные и сопоставлять их с токенами службы, которые затем могут быть переданы соответствующим командам для настройки подключения BI. Вы можете настроить учетные данные и токены службы, чтобы отразить ваши команды и их роли.

В настоящее время учетные данные, которые вы настраиваете при настройке семантического слоя dbt, используются для каждого запроса. Любые физические политики доступа, которые у вас связаны с вашими учетными данными, будут соблюдены.

Мы в настоящее время работаем над введением более детализированных контроль доступа, включая доступ на уровне пользователя и групповые учетные данные, которые обеспечивают гибкие детализированные разрешения.

</Expandable>

## Реализация

<Expandable alt_header="Как я могу реализовать dbt Mesh с семантическим слоем dbt">

import SLMeshFAQs from '/snippets/_sl-dbt-mesh-faq.md';

<SLMeshFAQs/>

</Expandable>

<Expandable alt_header="С каким 'стадийным слоем' должен взаимодействовать семантический слой dbt? Сырой, стадийный или марты?">

Мы рекомендуем строить ваш семантический слой на основе [слоя марты](/best-practices/how-we-structure/4-marts), который представляет собой чистые и преобразованные данные из ваших моделей dbt.
</Expandable>

<Expandable alt_header="Должны ли учетные данные семантического слоя совпадать с учетными данными для производственных сред? Или они должны быть разными?">

Учетные данные семантического слоя отличаются от учетных данных, которые вы используете для запуска моделей dbt. В частности, мы рекомендуем использовать менее привилегированный набор учетных данных, поскольку потребители только читают данные.
</Expandable>

<Expandable alt_header="Как семантический слой dbt поддерживает архитектурный дизайн dbt Mesh?">

В настоящее время семантические модели могут быть созданы из моделей dbt, которые находятся в разных проектах ([dbt Mesh](/best-practices/how-we-mesh/mesh-1-intro)). В будущем пользователи также смогут использовать концепции mesh на семантических объектах и определять метрики между проектами dbt.
</Expandable>

<Expandable alt_header="Как мне мигрировать с устаревшего семантического слоя?">

Если вы используете устаревший семантический слой, мы настоятельно рекомендуем вам [обновить вашу версию dbt](/docs/dbt-versions/upgrade-dbt-version-in-cloud) до dbt v1.6 или выше, чтобы использовать последний семантический слой dbt. Обратитесь к специальному [руководству по миграции](/guides/sl-migration) для получения дополнительной информации.
</Expandable>