---
title: "Пользовательские токены"
sidebar_label: "Персональные токены доступа"
id: "user-tokens"
pagination_next: "docs/dbt-cloud-apis/service-tokens"
---

# Персональные токены доступа уровня аккаунта

:::warning

Пользовательские API токены устарели и больше не работают. [Перейдите](#migrate-deprecated-user-api-keys-to-personal-access-tokens) на персональные токены доступа, чтобы возобновить работу сервисов.

:::

Каждый пользователь <Constant name="cloud" /> с [лицензией Developer](/docs/cloud/manage-access/seats-and-users) может создать новый персональный токен доступа (personal access token, PAT) для работы с API <Constant name="cloud" /> и CLI <Constant name="cloud" />. Этот токен может выполнять запросы к API <Constant name="cloud" /> от имени пользователя.  
Для доступа к API и ресурсам <Constant name="cloud" /> от имени _аккаунта_ мы рекомендуем использовать сервисные токены. Подробнее о различиях между токенами см. в разделе [какой тип токена следует использовать](/docs/dbt-cloud-apis/authentication#which-token-type-should-you-use).

PAT наследуют права доступа пользователя, который их создал. Например, если пользователь с лицензией Developer и ролью Project Admin, имеющий доступ к определённым проектам, создаёт PAT, то этот токен также получит роль Project Admin с доступом к тем же проектам, что и у пользователя. Эти токены также привязаны к конкретному аккаунту, поэтому если у пользователя есть доступ более чем к одному аккаунту <Constant name="cloud" /> с одним и тем же адресом электронной почты, ему необходимо создать отдельный PAT для каждого из этих аккаунтов.

## Создание персонального токена доступа

Создание **account-scoped PAT** требует всего нескольких шагов.

1. Перейдите в **Account Settings**, разверните раздел **API tokens** и нажмите **Personal tokens**.
2. Нажмите **Create personal access token**.
3. Задайте токену понятное описательное имя и нажмите **Save**.

4. Скопируйте токен перед закрытием окна. _Он не будет доступен позже, и вам придется создать новый токен, если вы его потеряете._

Для поддержания лучших практик безопасности рекомендуется регулярно менять ваши PAT. Для этого создайте новый токен и удалите старый, как только он будет заменен.

## Удаление персонального токена доступа

Чтобы навсегда удалить PAT:

1. Перейдите в **Настройки аккаунта**, разверните **API токены** и нажмите **Персональные токены**.
2. Найдите токен, который хотите удалить, и нажмите "X" справа от полей описания токена.
3. **Подтвердите удаление**, и токен больше не будет действителен.

## Переход от устаревших пользовательских API ключей к персональным токенам доступа

Переход на PAT критически важен, если вы используете пользовательские API ключи. Текущий API ключ находится в **Личные настройки → API ключ**.

Есть несколько вещей, которые нужно понять, если вы используете пользовательский API ключ:

* Персональные токены доступа более безопасны.
    * Чтобы обеспечить минимальные привилегии и высокую безопасность для ваших аккаунтов dbt Cloud, мы настоятельно рекомендуем перейти на новые персональные токены доступа с привязкой к аккаунту.
* Вы должны создавать и использовать уникальные токены в каждом из ваших аккаунтов dbt Cloud, которые используют один и тот же адрес электронной почты.
    * Например, если paul.atreides@example.com принадлежит двум аккаунтам dbt Cloud: Spice Harvesting Account и Guild Navigator Account. До этого обновления использовался один и тот же API ключ для доступа к обоим аккаунтам.
    * После этого обновления Пол должен индивидуально зайти в эти аккаунты и создать уникальный PAT для каждого аккаунта, к которому он хочет получить доступ через API. Эти PAT привязаны к аккаунту, а не к пользователю.
* Поведение API конечных точек для кросс-аккаунтов изменится при использовании персональных токенов доступа.
    * Это, в частности, /v2/accounts и /v3/accounts. Поскольку все PAT теперь привязаны к аккаунту, получение всех аккаунтов, связанных с именем пользователя, невозможно. /v3/accounts будет возвращать только метаданные аккаунта, которые относятся к используемому PAT.
    * Метаданные пользовательского аккаунта будут содержать информацию только о конкретном аккаунте, в рамках которого выполняется запрос.
    * Любые другие аккаунты, принадлежащие этому пользовательскому аккаунту, должны быть запрошены через PAT, принадлежащий этому аккаунту.

* **PAT более безопасны.**
    * Чтобы обеспечить принцип наименьших привилегий и высокий уровень безопасности для ваших аккаунтов <Constant name="cloud" />, мы настоятельно рекомендуем перейти на новые PAT с областью действия на уровне аккаунта.
* **Вы должны создавать и использовать уникальные токены в каждом из ваших аккаунтов <Constant name="cloud" />, которые используют один и тот же адрес электронной почты.**
    * Например, если paul.atreides@example.com принадлежит двум аккаунтам <Constant name="cloud" />: Spice Harvesting Account и Guild Navigator Account. До этого релиза один и тот же API‑ключ использовался для доступа к обоим аккаунтам.
    * После этого релиза Пол должен отдельно зайти в каждый из этих аккаунтов и создать уникальный PAT для каждого аккаунта, к API которого он хочет получить доступ. Эти PAT привязаны к аккаунту, а не к пользователю.
* **Поведение межаккаунтных API‑эндпоинтов изменится при использовании PAT.**
    * В частности, это касается `/v2/accounts` и `/v3/accounts`. Поскольку все PAT теперь привязаны к конкретному аккаунту, получение всех аккаунтов, связанных с именем пользователя, больше не работает. `/v3/accounts` будет возвращать только метаданные аккаунта, относящиеся к используемому PAT.
    * Метаданные пользовательского аккаунта будут содержать информацию только о том конкретном аккаунте, в рамках которого выполняется запрос.
    * Любые другие аккаунты, принадлежащие этому пользователю, необходимо запрашивать с помощью PAT, который принадлежит соответствующему аккаунту.

Если вы используете какие-либо не документированные и не поддерживаемые API конечные точки, обратите внимание, что они могут быть устаревшими без какого-либо уведомления. Если вы используете какие-либо не документированные конечные точки и у вас есть случаи использования, которые не удовлетворяются текущим API, пожалуйста, свяжитесь с [support@getdbt.com](mailto:support@getdbt.com).

:::

### Использование персональных токенов доступа

Используете ли вы сегодня пользовательский API‑ключ для доступа к API <Constant name="cloud" /> в каких‑либо своих процессах? Если нет — никаких действий предпринимать не нужно. Если же вы используете пользовательский API‑ключ, следуйте инструкциям ниже.

1. Составьте список всех мест, где вы выполняете вызовы API <Constant name="cloud" /> с использованием пользовательского API‑ключа <Constant name="cloud" />.
2. Создайте новый PAT в разделе **Account Settings → API Tokens → Personal Tokens.** Инструкции см. в разделе [Create a personal access token](#create-a-personal-access-token).
3. Замените API‑ключ в ваших API‑запросах на созданный PAT. Вы можете использовать PAT везде, где ранее использовался API‑ключ.
    
    Чтобы заменить API‑ключ на PAT, укажите PAT в заголовке Authorization ваших API‑запросов. Например: `Authorization: Bearer <your-token>`.

    Убедитесь, что вы заменили `<your-token>` на новый PAT, который вы создали.

    :::note

    Опция ротации API‑ключей используется для существующих API‑ключей, а не для их замены на PAT. Вам не нужно заменять API‑ключ на PAT в UI <Constant name="cloud" />.

    :::

4. Убедитесь, что вы используете PAT только там, где это действительно необходимо. Для процессов, которым требуется service account, используйте service token.

1. Составьте список всех мест, где вы делаете вызов к API dbt Cloud, используя пользовательский API ключ dbt Cloud.
2. Создайте новый персональный токен доступа в **Настройки аккаунта → API токены → Персональные токены.**
3. Создайте и скопируйте новый PAT, чтобы заменить старый пользовательский API ключ.
4. Убедитесь, что вы используете PAT только там, где это необходимо. Для потоков, требующих учетной записи сервиса, используйте сервисный токен.