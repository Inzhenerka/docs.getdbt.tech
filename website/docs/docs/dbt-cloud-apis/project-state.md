---
title: "Состояние проекта в dbt Cloud"
---

dbt Cloud предоставляет состояние для развертывания dbt. Артефакты доступны программно через [Discovery API](/docs/dbt-cloud-apis/discovery-querying) в платформе метаданных.

С внедрением конечной точки `environment` в Discovery API мы представили концепцию нескольких состояний. Discovery API предоставляет единую конечную точку API, которая возвращает последнее состояние моделей, источников и других узлов в DAG.

Единственная [развертываемая среда](/docs/environments-in-dbt) должна представлять производственное состояние данного проекта dbt Cloud.

В dbt Cloud можно запросить два состояния:

- **Примененное состояние** относится к тому, что существует в хранилище данных после успешного выполнения `dbt run`. Построение модели успешно завершено и теперь существует как таблица в хранилище.

- **Состояние определения** зависит от того, что существует в проекте с учетом кода, определенного в нем (например, состояние манифеста), который не обязательно был выполнен в платформе данных (возможно, это просто результат `dbt compile`).

## Состояние определения (логическое) против примененного состояния узлов dbt

В проекте dbt состояние _определения_ узла представляет собой конфигурацию, преобразования и зависимости, определенные в SQL и YAML файлах. Оно фиксирует, как узел должен обрабатываться в отношении других узлов и таблиц в хранилище данных и может быть получено с помощью `dbt build`, `run`, `parse` или `compile`. Оно изменяется всякий раз, когда изменяется код проекта.

_Примененное состояние_ узла относится к фактическому состоянию узла после его успешного выполнения в DAG; например, модели выполняются, и, следовательно, их состояние применяется к хранилищу данных через `dbt run` или `dbt build`. Оно изменяется всякий раз, когда узел выполняется. Это состояние представляет собой результат преобразований и фактические данные, хранящиеся в базе данных, которые для моделей могут быть таблицей или представлением на основе определенной логики.

Примененное состояние включает информацию о выполнении, которая содержит метаданные о том, как узел достиг примененного состояния: последняя выполненная операция (успешная или попытка), например, когда она началась, ее статус и сколько времени это заняло.

Вот как вы можете запросить и сравнить состояние определения и примененное состояние модели, используя Discovery API:

```graphql
query Compare($environmentId: Int!, $first: Int!) {
	environment(id: $environmentId) {
		definition {
			models(first: $first) {
				edges {
					node {
						name
						rawCode
					}
				}
			}
		}
		applied {
			models(first: $first) {
				edges {
					node {
						name
						rawCode 
						executionInfo {
							executeCompletedAt
						}
					}
				}
			}
		}
	}
}
```

Большинство случаев использования Discovery API будет предпочитать _примененное состояние_, поскольку оно относится к тому, что действительно было выполнено и может быть проанализировано.

## Затронутые состояния по типу узла

Следующая таблица показывает состояния узлов dbt и то, как они затрагиваются Discovery API.

| Узел                                          | Выполнен в DAG  | Создан в результате выполнения | Существует в базе данных | Происхождение          | Состояния            |
|-----------------------------------------------|------------------|-------------------------------|--------------------------|------------------------|----------------------|
| [Анализ](/docs/build/analyses)              | Нет              | Нет                           | Нет                      | Вверх по потоку        | Определение          |
| [Тест данных](/docs/build/data-tests)       | Да               | Да                            | Нет                      | Вверх по потоку        | Примененное и определение |
| [Экспозиция](/docs/build/exposures)         | Нет              | Нет                           | Нет                      | Вверх по потоку        | Определение          |
| [Группа](/docs/build/groups)                 | Нет              | Нет                           | Нет                      | Вниз по потоку         | Определение          |
| [Макрос](/docs/build/jinja-macros)           | Да               | Нет                           | Нет                      | N/A                    | Определение          |
| [Метрика](/docs/build/metrics-overview)      | Нет              | Нет                           | Нет                      | Вверх и вниз по потоку | Определение          |
| [Модель](/docs/build/models)                 | Да               | Да                            | Да                       | Вверх и вниз по потоку | Примененное и определение |
| [Сохраненные запросы](/docs/build/saved-queries) <br /> (не в API) | N/A               | N/A                           | N/A                      | N/A                    | N/A                  |
| [Seed](/docs/build/seeds)                     | Да               | Да                            | Да                       | Вниз по потоку         | Примененное и определение |
| [Семантическая модель](/docs/build/semantic-models) | Нет              | Нет                           | Нет                      | Вверх и вниз по потоку | Определение          |
| [Снимок](/docs/build/snapshots)             | Да               | Да                            | Да                       | Вверх и вниз по потоку | Примененное и определение |
| [Источник](/docs/build/sources)               | Да               | Нет                           | Да                       | Вниз по потоку         | Примененное и определение |
| [Модульные тесты](/docs/build/unit-tests)    | Да               | Да                            | Нет                      | Вниз по потоку         | Определение          |

## Ограничения обновлений состояния/метаданных

Со временем Cloud Artifacts предоставит информацию для поддержания состояния для функций/услуг в dbt Cloud и позволит вам получить доступ к состоянию в dbt Cloud и его экосистеме. В настоящее время Cloud Artifacts сосредоточены на последнем производственном состоянии, но этот фокус будет развиваться.

Вот некоторые ограничения представления состояния в Discovery API:

- Пользователи должны получить доступ к стандартной производственной среде, чтобы узнать последнее состояние проекта.
- API получает определение из последнего манифеста, сгенерированного в данной развертываемой среде, но это часто не отражает последнее состояние кода проекта.
- Результаты скомпилированного кода могут быть устаревшими в зависимости от порядка выполнения шагов dbt Cloud и сбоев.
- Информация каталога может быть устаревшей или неполной (в примененном состоянии), в зависимости от того, когда в последний раз выполнялась команда `docs generate`.
- Проверки свежести источников могут быть устаревшими (в примененном состоянии) в зависимости от того, когда команда в последний раз выполнялась, и она не включена в `build`.