---
title: "Обновление версии dbt в Cloud"
id: "upgrade-dbt-version-in-cloud"
---

В dbt Cloud как [задания](/docs/deploy/jobs), так и [окружения](/docs/dbt-cloud-environments) настроены на использование определенной версии dbt Core. Версию можно обновить в любое время.

## Окружения

Перейдите на страницу настроек окружения, затем нажмите **Edit**. Нажмите на выпадающее меню **dbt version** и выберите нужную версию. Вы можете выбрать [трассу релизов](#release-tracks) для получения постоянных обновлений (рекомендуется) или устаревшую версию dbt Core. Обязательно сохраните изменения перед тем, как покинуть страницу.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/choosing-dbt-version/example-environment-settings.png" width="90%" title="Пример настроек окружения в dbt Cloud"/>

### Трассы релизов

Начиная с 2024 года, ваш проект будет автоматически обновляться с выбранной вами периодичностью.

Трасса **Latest** гарантирует, что у вас будет актуальная функциональность dbt Cloud и ранний доступ к новым функциям фреймворка dbt. Трассы **Compatible** и **Extended** предназначены для клиентов, которым требуется менее частая периодичность релизов, возможность тестировать новые релизы dbt перед их запуском в производственной среде и/или постоянная совместимость с последними версиями dbt Core с открытым исходным кодом.

Как лучшую практику, dbt Labs рекомендует сначала протестировать обновление в среде разработки; используйте настройку [Override dbt version](#override-dbt-version), чтобы протестировать _ваш_ проект на последней версии dbt перед обновлением ваших окружений развертывания и стандартной среды разработки для всех ваших коллег.

Чтобы обновить окружение в [dbt Cloud Admin API](/docs/dbt-cloud-apis/admin-cloud-api) или [Terraform](https://registry.terraform.io/providers/dbt-labs/dbtcloud/latest), установите `dbt_version` в имя вашей трассы релизов:
- `latest` (ранее называлась `versionless`; старое название все еще поддерживается)
- `compatible` (доступно для Team + Enterprise)
- `extended` (доступно для Enterprise)

### Переопределение версии dbt

Настройте ваш проект на использование другой версии dbt Core, чем та, что настроена в вашей [среде разработки](/docs/dbt-cloud-environments#types-of-environments). Это _переопределение_ влияет только на вашу учетную запись пользователя, а не на других. Используйте это, чтобы безопасно тестировать новые функции dbt перед обновлением версии dbt для ваших проектов.

1. Нажмите на имя вашей учетной записи в левой панели и выберите **Account settings**.
1. Выберите **Credentials** в боковой панели и выберите проект. Это откроет боковую панель.
1. В боковой панели нажмите **Edit** и прокрутите до раздела **User development settings**. Выберите версию из выпадающего меню **dbt version** и нажмите **Save**.

  Пример переопределения настроенной версии на 1.7 для выбранного проекта:

  <Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/choosing-dbt-version/example-override-version.png" width="60%" title="Пример переопределения версии dbt в вашей учетной записи"/>

1. (Опционально) Убедитесь, что dbt Cloud будет использовать ваше переопределение для сборки проекта. Вызовите `dbt build` в командной строке IDE. Разверните раздел **System Logs** и найдите первую строку вывода. Она должна начинаться с `Running with dbt=` и указывать версию, которую использует dbt Cloud.

  Пример вывода успешного выполнения `dbt build`:

  <Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/choosing-dbt-version/example-verify-overridden-version.png" title="Пример вывода, показывающий использование версии 1.7, а не 1.5"/>

## Задания

Каждое задание в dbt Cloud может быть настроено на наследование параметров из окружения, к которому оно принадлежит.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/choosing-dbt-version/job-settings.png" width="200%" title="Настройки задания в dbt Cloud"/>

Пример задания, показанный на скриншоте выше, принадлежит окружению "Prod". Оно наследует версию dbt из своего окружения, как показано в выборе **Inherited from ENVIRONMENT_NAME (DBT_VERSION)**. Вы также можете вручную переопределить версию dbt для конкретного задания, выбрав другую опцию из выпадающего меню.

## Поддерживаемые версии

dbt Labs всегда поощрял пользователей обновлять версии dbt Core, когда выходит новая минорная версия. Мы выпустили нашу первую мажорную версию dbt - `dbt 1.0` - в декабре 2021 года. Вместе с этим выпуском мы обновили нашу политику относительно версий dbt Core, которые мы будем поддерживать в dbt Cloud.

> **Начиная с v1.0, все последующие минорные версии доступны в dbt Cloud. Версии активно поддерживаются, с патчами и исправлениями ошибок, в течение 1 года после их первоначального выпуска. В конце этого 1-летнего периода мы рекомендуем всем пользователям обновиться до более новой версии для лучшего постоянного обслуживания и поддержки.**

Мы предоставляем разные уровни поддержки для разных версий, которые могут включать новые функции, исправления ошибок или патчи безопасности:

<Snippet path="core-version-support" />

Мы будем продолжать обновлять следующую таблицу релизов, чтобы пользователи знали, когда мы планируем прекратить поддержку различных версий Core в dbt Cloud.

<Snippet path="core-versions-table" />

Начиная с v1.0, dbt Cloud будет гарантировать, что вы всегда используете последнюю совместимую патч-версию `dbt-core` и плагинов, включая все последние исправления. Вы также можете выбрать попробовать предварительные релизы этих патчей до их общего доступа.

<!--- TODO: Включить информацию о:
  - уведомлении пользователей, когда доступны новые минорные версии
  - уведомлении пользователей, когда используется минорная версия, приближающаяся к концу своего критического периода поддержки
  - автоматическом обновлении пользователей до следующей минорной версии, когда критическая поддержка заканчивается
--->

Для получения дополнительной информации о поддержке версий и будущих релизах, см. [Понимание версий dbt Core](/docs/dbt-versions/core).

#### Нужна помощь с обновлением?

Если вам нужен дополнительный совет о том, как обновить ваши проекты dbt, ознакомьтесь с нашими [руководствами по миграции](/docs/dbt-versions/core-upgrade/) и нашей [страницей вопросов и ответов по обновлению](/docs/dbt-versions/upgrade-dbt-version-in-cloud#upgrading-legacy-versions-under-10).

## Обновление устаревших версий до 1.0

Вы можете использовать следующие разделы, чтобы успешно обновить вашу версию dbt Core в dbt Cloud. Мы рекомендуем всем обновиться до самой последней версии dbt Core, так как новые версии содержат улучшения, исправления ошибок и обновленные функции безопасности. Мы документируем, какие [версии dbt Core в настоящее время поддерживаются](/docs/dbt-versions/upgrade-dbt-version-in-cloud#supported-versions).

Между минорными версиями нет многих критических изменений, и может оказаться, что вам не нужно менять код для обновления до более новой версии dbt в dbt Cloud. Критические изменения есть только между минорными версиями dbt до dbt 1.0. Минорные релизы, начиная с dbt 1.0, не имеют критических изменений в коде. Если изменения в коде не требуются, все, что вам нужно сделать, это [изменить настройки](/docs/dbt-versions/upgrade-dbt-version-in-cloud#upgrading-to-the-latest-version-of-dbt-in-cloud) в вашем окружении или задании, чтобы использовать более новую версию dbt.

#### Изменения между минорными версиями dbt, которые повлияют на ваш проект

Ниже мы постараемся помочь вам ответить на вопрос, повлияет ли известное критическое изменение между минорными версиями dbt на ваш проект. Если вы ответите "да" на любой из вопросов ниже, мы рекомендуем вам прочитать руководства по миграции, которые мы подготовили для каждого минорного релиза dbt.

:::info Важное замечание о пакетах

Если вы используете какие-либо пакеты из [dbt Hub](https://hub.getdbt.com/), убедитесь, что вы также обновили версию пакета, которая поддерживает версию dbt, на которую вы собираетесь обновиться. Вы можете увидеть, какие версии dbt поддерживает пакет, проверив `require-dbt-version:` в файле dbt_project.yml пакета на GitHub.

Например, версия dbt-utils 0.7.6 поддерживает dbt v0.20, v0.21 и v1.0, как описано в его [dbt_project.yml](https://github.com/dbt-labs/dbt-utils/blob/0.7.6/dbt_project.yml).

После того как вы изменили версию пакета в вашем файле packages.yml, обязательно выполните `dbt deps` в IDE, чтобы установить обновленную версию.

:::

<details>
<summary>  Обновление до v1.0.latest с v0.21 </summary>
<br></br>

:::info Универсальное изменение
Некоторые конфигурации в dbt_project.yml были переименованы
:::

Существующие проекты увидят предупреждения о незначительных изменениях, которые не являются критическими. Вы можете изменить три строки в большинстве проектов, чтобы убрать предупреждения:

<File name='dbt_project.yml'>

```yml
model-paths: ["models"] # ранее называлось "source-paths"
seed-paths: ["data"]    # ранее называлось "data-paths"
clean-targets:
  - "target"
  - "dbt_packages"      # ранее называлось "dbt_modules"
```

</File>

- Вы выбираете тесты, используя старые названия типов тестов? (`test_type:schema`, `test_type:data`, `--schema`, `--data`)
- У вас есть пользовательский макрос, который вызывает (недокументированные) глобальные макросы `column_list`, `column_list_for_create_table`, `incremental_upsert`?
- У вас есть пользовательские скрипты, которые парсят артефакты dbt <Term id="json" />?
- (Только BigQuery) Вы используете устаревшие возможности dbt для таблиц с разделением по времени загрузки?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade/Older%20versions/upgrading-to-v1.0).

</details>


<details>
<summary>  Обновление до v0.21.latest с v0.20 </summary>
<br></br>

- Вы выбираете конкретные источники для проверки свежести (`dbt snapshot-freshness --select <source_name>`)?
- У вас есть пользовательские скрипты, которые парсят артефакты dbt JSON?
- (Только Snowflake) У вас есть пользовательские макросы или <Term id="materialization">материализации</Term>, которые зависят от использования транзакций, таких как блоки операторов с `auto_begin=True`?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).

</details>



<details>
<summary>  Обновление до v0.20.latest с v0.19 </summary>
<br></br>

- Ваш проект определяет какие-либо пользовательские тесты схемы?
- Ваш проект использует `adapter.dispatch` или пакет `spark_utils`?
- У вас есть пользовательские скрипты, которые парсят артефакты dbt JSON?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).

</details>



<details>
<summary>  Обновление до v0.19.latest с v0.18 </summary>
<br></br>
<div>

</div>


- У вас есть пользовательские скрипты, которые парсят артефакты dbt JSON?
- У вас есть какие-либо пользовательские материализации?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).

</details>


<details>
<summary>  Обновление до v0.18.latest с v0.17 </summary>
<br></br>

- Вы напрямую вызываете `adapter_macro`?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).

</details>



<details>
<summary>  Обновление до v0.17.latest с v0.16 </summary>
<br></br>
<div>

:::info Универсальное изменение

Вы должны добавить `config-version: 2` в ваш файл dbt_project.yml.
:::
</div>

<File name='dbt_project.yml'>

```yml
name: my_project
version: 1.0.0

config-version: 2

vars:
  my_var: 1
  another_var: true

models:
  ...
```

</File>

<div>

:::info Универсальное изменение

`vars:` теперь определяются не в вашем `models:`, а являются отдельным разделом в файле dbt_project.yml.
:::
</div>


<File name='dbt_project.yml'>

```yml
name: my_project
version: 1.0.0

config-version: 2

vars:
  my_var: 1
  another_var: true

models:
  ...
```

</File>


- У вас есть конфигурации словарей в вашем dbt_project.yml, такие как `partition_by` или `persist_docs`? Если да, вам нужно добавить перед ними +.

<File name='dbt_project.yml'>

```yml

models:
  my_project:
    reporting:
      +partition_by:
        field: date_day
        data_type: timestamp
```
</File>

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).

</details>


<details>
<summary>  Обновление до v0.16.latest с v0.15 </summary>
<br></br>

- Вы используете пользовательский макрос `generate_schema_name`?
- Вы используете конфигурацию `partition_by` для моделей BigQuery?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).
</details>


<details>
<summary>  Обновление до v0.15.latest с v0.14 </summary>

<br></br>

- У вас есть пользовательская материализация?
- У вас есть макрос, который напрямую обращается к `Relations`?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).
</details>

<details>
<summary>  Обновление до v0.14.latest с v0.13 </summary>
<br></br>

- Вы все еще используете `Archives`?
- Вы используете пользовательский макрос `generate_schema_name`?
- Вы используете флаг `—non-destructive`?

Если вы считаете, что ваш проект может быть затронут, прочитайте больше деталей в руководстве по миграции [здесь](/docs/dbt-versions/core-upgrade).
</details>


#### Тестирование ваших изменений перед обновлением
Как только вы узнаете, какие изменения в коде вам нужно будет сделать, вы можете начать их внедрять. Мы рекомендуем создать отдельный проект dbt, **Upgrade Project**, чтобы протестировать ваши изменения перед их внедрением в ваш основной проект dbt. В вашем **Upgrade Project** подключитесь к тому же репозиторию, который вы используете для вашего производственного проекта. На этот раз настройте [настройки](/docs/dbt-versions/upgrade-dbt-version-in-cloud) среды разработки на использование последней версии dbt Core. Затем создайте ветку `dbt-version-upgrade`, внесите соответствующие обновления в ваш проект и убедитесь, что ваш проект dbt компилируется и запускается с новой версией в IDE. Если обновление напрямую до последней версии вызывает слишком много проблем, попробуйте протестировать ваш проект итеративно на последовательных минорных версиях. Между далекими версиями dbt Core (например, 0.14 --> 1.0) прошло много лет разработки и несколько критических изменений. Вероятность возникновения проблем при обновлении между последовательными минорными версиями значительно ниже, поэтому регулярное обновление рекомендуется.

Как только ваш проект будет компилироваться и запускаться на последней версии dbt в среде разработки для вашей ветки `dbt-version-upgrade`, попробуйте воспроизвести одно из ваших производственных заданий, чтобы оно работало с кодом вашей ветки. Вы можете сделать это, создав новую среду развертывания для тестирования, установив пользовательскую ветку в 'ON' и ссылаясь на вашу ветку `dbt-version-upgrade`. Вам также нужно будет установить версию dbt в этой среде на последнюю версию dbt Core.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/cloud-upgrading-dbt-versions/upgrade-environment.png" title="Настройка вашей тестовой среды" />

Затем добавьте задание в новую тестовую среду, которое воспроизводит одно из производственных заданий, на которые полагается ваша команда. Если это задание выполняется без проблем, вы должны быть готовы объединить вашу ветку в основную и изменить ваши среды разработки и развертывания в вашем основном проекте dbt, чтобы они работали на самой новой версии dbt Core.