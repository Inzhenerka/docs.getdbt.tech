---
title: "Обновление до v1.6"
description: Новые функции и изменения в dbt Core v1.6
id: "upgrading-to-v1.6"
displayed_sidebar: "docs"
---

dbt Core v1.6 сосредоточен на трех основных областях:
1. Следующий этап [многоуровневых развертываний](https://github.com/dbt-labs/dbt-core/discussions/6725): улучшения контрактов, групп/доступа, версий; и строительные блоки для кросс-проектного `ref`
2. Перезапуск семантического слоя: интеграция dbt Core и [MetricFlow](https://docs.getdbt.com/docs/build/about-metricflow)
3. Механизмы для поддержки зрелого развертывания в масштабе (`dbt clone` и `dbt retry`)

## Ресурсы

- [Журнал изменений](https://github.com/dbt-labs/dbt-core/blob/1.6.latest/CHANGELOG.md)
- [Руководство по установке dbt Core](/docs/core/installation-overview)
- [Руководство по обновлению в облаке](/docs/dbt-versions/upgrade-dbt-version-in-cloud)
- [График релизов](https://github.com/dbt-labs/dbt-core/issues/7481)

## Что нужно знать перед обновлением

dbt Labs стремится обеспечить обратную совместимость для всех версий 1.x, за исключением любых изменений, явно упомянутых ниже. Если вы столкнетесь с ошибкой при обновлении, пожалуйста, дайте нам знать, [открыв проблему](https://github.com/dbt-labs/dbt-core/issues/new).

### Изменения в поведении

:::info Требуется действие, если ваш проект определяет `metrics`

[Спецификация для метрик](https://github.com/dbt-labs/dbt-core/discussions/7456) изменилась и теперь использует [MetricFlow](/docs/build/about-metricflow). 

:::

Если ваш проект dbt определяет метрики, вам необходимо перейти на dbt v1.6, так как спецификация YAML была перенесена с dbt_metrics на MetricFlow. Любые тесты, которые у вас есть, не будут компилироваться на v1.5 или более ранних версиях.

- dbt Core v1.6 не поддерживает Python 3.7, который достиг конца поддержки 23 июня. Поддерживаемые версии Python: 3.8, 3.9, 3.10 и 3.11.
- В рамках перезапуска [семантического слоя dbt](/docs/use-dbt-semantic-layer/dbt-sl) (в бета-версии) спецификация для `metrics` значительно изменилась. Обратитесь к [руководству по миграции](/guides/sl-migration) для получения дополнительной информации о том, как перейти на перезапущенный семантический слой dbt.
- Версия схемы манифеста теперь v10.
- dbt Labs прекращает поддержку установки dbt-core и адаптеров через Homebrew. См. [обсуждение](https://github.com/dbt-labs/dbt-core/discussions/8277) для получения дополнительных деталей.

### Для потребителей артефактов dbt (метаданные)

Схема [манифеста](/reference/artifacts/manifest-json) была обновлена до `v10`. Конкретные изменения:
- Добавление `semantic_models` и изменения в атрибутах `metrics`
- Добавление `deprecation_date` как свойства модели
- Добавление `on_configuration_change` как конфигурации узла по умолчанию (для поддержки материализованных представлений)
- Небольшие изменения типов в `contracts` и `constraints`
- Метаданные манифеста включают `project_name`

### Для поддерживающих плагины адаптеров

Для получения более подробной информации и для задавания вопросов, пожалуйста, читайте и комментируйте обсуждение на GH: [dbt-labs/dbt-core#7958](https://github.com/dbt-labs/dbt-core/discussions/7958).

## Новая и измененная документация

### MetricFlow

- [**Создайте свои метрики**](/docs/build/build-metrics-intro) с MetricFlow, ключевым компонентом семантического слоя dbt. Вы можете определить свои метрики и создать семантические модели с помощью MetricFlow, доступного в командной строке (CLI) для dbt Core v1.6 beta или выше.

### Материализованные представления

Поддерживается на:
- [Postgres](/reference/resource-configs/postgres-configs#materialized-view)
- [Redshift](/reference/resource-configs/redshift-configs#materialized-view)
- [Snowflake](/reference/resource-configs/snowflake-configs#dynamic-tables)
- [Databricks](/reference/resource-configs/databricks-configs#materialized-views-and-streaming-tables)

Поддержка BigQuery скоро появится.

### Новые команды для зрелого развертывания

[`dbt retry`](/reference/commands/retry) выполняет ранее запущенную команду с точки сбоя. Перестраивает только узлы, которые выдали ошибку или были пропущены в предыдущем запуске/сборке/тестировании, вместо того чтобы начинать с нуля.

[`dbt clone`](/reference/commands/clone) использует функциональность каждой платформы данных для создания легковесных копий моделей dbt из одной среды в другую. Полезно при быстром создании новой среды разработки или при продвижении конкретных моделей из тестовой среды в продуктивную.

### Многоуровневая совместная работа

[**Дата устаревания**](/reference/resource-properties/deprecation_date): Модели могут объявлять дату устаревания, которая будет предупреждать производителей моделей и downstream-потребителей. Это позволяет четко определить окна миграции для версионированных моделей и предоставляет механизм для упрощения удаления незрелых или малоиспользуемых моделей, что помогает избежать разрастания проекта.

[Имена моделей](/faqs/Project/unique-resource-names) могут дублироваться в разных пространствах имен (проектах/пакетах), при условии, что они уникальны в каждом проекте/пакете. Мы настоятельно рекомендуем использовать [двухаргументный `ref`](/reference/dbt-jinja-functions/ref#ref-project-specific-models) при ссылке на модель из другого пакета/проекта.

Больше согласованности и гибкости в отношении пакетов. Ресурсы, определенные в пакете, будут учитывать определения переменных и глобальных макросов в пределах этого пакета.
- `vars`, определенные в `dbt_project.yml` пакета, теперь доступны в порядке разрешения при компиляции узлов в этом пакете, хотя CLI `--vars` и `vars` корневого проекта все еще будут иметь приоритет. См. ["Приоритет переменных"](/docs/build/project-variables#variable-precedence) для получения подробной информации.
- Макросы `generate_x_name` (определяющие пользовательские правила для именования базы данных, схемы, псевдонима) следуют той же схеме, что и другие "глобальные" макросы для переопределений в рамках пакета. См. [диспетчеризацию макросов](/reference/dbt-jinja-functions/dispatch) для обзора возможных схем.

:::caution Закрытая бета-версия - dbt Cloud Enterprise
[**Зависимости проектов**](/docs/collaborate/govern/project-dependencies): Вводит `dependencies.yml` и зависимые `projects` как функцию dbt Cloud Enterprise. Позволяет обеспечивать доступ к моделям (публичный против защищенного/частного) через границы проектов/пакетов. Позволяет кросс-проектный `ref` публичных моделей без необходимости установки исходного кода верхнего уровня.
:::

### Устаревшая функциональность

Возможность для установленных пакетов переопределять встроенные материализации без явного согласия пользователя устаревает.

- Переопределение встроенной материализации из установленного пакета вызывает предупреждение об устаревании.
- Использование пользовательской материализации из установленного пакета не вызывает предупреждения об устаревании.
- Использование переопределения встроенной материализации пакета из корневого проекта через обернутую материализацию по-прежнему поддерживается. Например:

  ```
  {% materialization view, default %}
  {{ return(my_cool_package.materialization_view_default()) }}
  {% endmaterialization %}
  ```

### Быстрые заметки

- [`state:unmodified` и `state:old`](/reference/node-selection/methods#state) для [MECE](https://en.wikipedia.org/wiki/MECE_principle) выборки по состоянию
- [`invocation_args_dict`](/reference/dbt-jinja-functions/flags#invocation_args_dict) включает полную `invocation_command` в виде строки
- [`dbt debug --connection`](/reference/commands/debug) для тестирования только соединения с платформой данных, указанного в профиле
- [`dbt docs generate --empty-catalog`](/reference/commands/cmd-docs) для пропуска заполнения каталога при генерации документации
- [`--defer-state`](/reference/node-selection/defer) позволяет более детально управлять
- [`dbt ls`](/reference/commands/list) добавляет метод выбора семантической модели, позволяя использовать `dbt ls -s "semantic_model:*"` и возможность выполнять `dbt ls --resource-type semantic_model`.
- Синтаксис для `DBT_ENV_SECRET_` изменился на `DBT_ENV_SECRET` и больше не требует закрывающего подчеркивания.