---
title: "Обновление до 0.16.0"
id: "upgrading-to-0-16-0"
displayed_sidebar: "docs"
---

dbt v0.16.0 содержит множество новых функций, исправлений ошибок и улучшений. Этот гид охватывает всю важную информацию, которую следует учитывать при обновлении с более ранней версии dbt до 0.16.0.

## Статьи:
 - [Изменения в инкрементальных моделях BigQuery](https://discourse.getdbt.com/t/bigquery-dbt-incremental-changes/982)
 - [Бенчмаркинг производительности инкрементальных моделей BigQuery](https://discourse.getdbt.com/t/benchmarking-incremental-strategies-on-bigquery/981)

## Ломающие изменения

Следующие изменения могут потребовать от вас изменения кода в вашем проекте dbt после обновления до v0.16.0.

### Вывод типов для Seed
В dbt было внесено несколько улучшений в логику вывода типов. Ранее dbt ошибочно преобразовывал строковые значения в [seed CSV файлах](/docs/build/seeds), такие как `sunday` или `March`, в временные метки даты в году `0001`. Это было явно неверно и теперь исправлено, но если вы _полагались_ на эту функциональность, то это представляет собой ломающее изменение. Дополнительную информацию об изменении можно найти в [этом запросе на изменение](https://github.com/dbt-labs/dbt-core/pull/1920).

### Устаревание однопараметрического варианта generate_schema_name
Поддержка однопараметрического варианта макроса `generate_schema_name` (устаревшего в предыдущем релизе) больше не поддерживается. Если вы используете однопараметрический вариант `generate_schema_name`, смотрите [документацию по пользовательским схемам](/docs/build/custom-schemas) для примера использования двухпараметрического варианта `generate_schema_name`.

### Синтаксис partition_by для BigQuery

Конфигурация `partition_by` для моделей BigQuery теперь принимает словарь, содержащий следующие ключи:
- `field`: Имя поля в <Term id="table" />, по которому будет происходить разбиение
- `data_type`: Тип данных для поля разбиения (`date`, `timestamp`, `datetime`, `int64`)
- `range`: Требуется только если `data_type` равен `int64` (для разбиения по диапазону)

Если строка предоставляется в качестве конфигурации `partition_by` для модели в BigQuery, dbt попытается разобрать эту строку на представление поля и типа данных. В будущем релизе dbt будет удалена возможность конфигурирования `partition_by` с использованием строки.

Смотрите документацию по [разбиению в BigQuery](/reference/resource-configs/bigquery-configs#partition-clause) для получения дополнительной информации о обновленном синтаксисе `partition_by` для моделей BigQuery. Также смотрите [этот гид](https://discourse.getdbt.com/t/bigquery-dbt-incremental-changes/982) для получения дополнительной информации о том, как dbt использует этот новый синтаксис для ускорения и удешевления построения инкрементальных моделей.

### Компиляция аргументов тестов источника
Аргументы тестов источника теперь обрабатываются так же, как и аргументы тестов моделей. Если вы предоставляете выражения jinja в тестах схемы таблиц источника, то это является ломающим изменением для вашего проекта. Смотрите [этот запрос на изменение](https://github.com/dbt-labs/dbt-core/pull/2150) для получения дополнительной информации об изменении.

### Форматирование временных меток в отладочных логах
Формат временных меток в отладочных логах изменился. Ранее для разделения секунд и микросекунд в временных метках отладочных логов использовалась запятая (`,`). Если вы программно обрабатываете отладочные логи, создаваемые dbt, это может быть ломающим изменением. Смотрите [этот запрос на изменение](https://github.com/dbt-labs/dbt-core/pull/2099) для получения дополнительной информации об изменении.

### Удаление docrefs из манифеста
`docrefs` больше не присутствуют в скомпилированном файле `manifest.json`. Если вы программно обрабатываете файл `manifest.json`, создаваемый dbt, и используете поле `docrefs` в манифесте, то это является ломающим изменением. Смотрите [этот запрос на изменение](https://github.com/dbt-labs/dbt-core/pull/2096) для получения дополнительной информации об изменении.

### Изменение интерфейса макроса get_catalog
Макросы `get_catalog` теперь должны принимать два аргумента: Relation, указывающий на информационную схему, и список схем для поиска в предоставленной информационной схеме. Если вы переопределяете макрос `get_catalog` в вашем проекте, вы можете найти дополнительную информацию об этом изменении в [этом запросе на изменение](https://github.com/dbt-labs/dbt-core/pull/2037).

### Изменение интерфейса макроса snowflake__list_schemas
Макрос `snowflake__list_schemas` теперь должен возвращать фрейм данных Agate с колонкой, названной `"name"`. Если вы переопределяете макрос `snowflake__list_schemas` в вашем проекте, вы можете найти дополнительную информацию об этом изменении в [этом запросе на изменение](https://github.com/dbt-labs/dbt-core/pull/2171).

### Snowflake базы данных с 10,000 схем
dbt больше не поддерживает работу с базами данных Snowflake, содержащими более 10,000 схем. Это связано с ограничениями запроса `show schemas in database`, который dbt теперь использует для поиска схем в базе данных Snowflake. Если ваш проект dbt работает с базой данных Snowflake, содержащей более 10,000 схем, вам не следует обновляться до dbt v0.16.0.

Если это изменение применимо к вашему проекту dbt, пожалуйста, дайте нам знать в вопросе dbt или в Slack dbt.

## Требования к Python

Если вы устанавливаете dbt в среде Python вместе с другими модулями Python, пожалуйста, обратите внимание на следующие изменения в зависимостях Python dbt:

- Добавлена зависимость на `'cffi>=1.9,<1.14',` для исправления проблем с `snowflake-connector-python`
- Изменен верхний предел на `'requests<2.23.0',` для исправления проблем с `snowflake-connector-python`
- Добавлена зависимость на `'idna<2.9'` для исправления проблем с `snowflake-connector-python`
- Изменен `snowflake-connector-python` на `2.2.1`
- Увеличен `google-cloud-bigquery` до `>=1.22.0` для добавления поддержки разбиения по целым числам
- Изменен верхний предел на `Jinja2 < 3`

## Новая и измененная документация
- [Конфигурации разбиения BigQuery](/reference/resource-configs/bigquery-configs)
- [Выбор конкретных seed для запуска с помощью `--select`](/reference/commands/seed)
- [Новый макрос `generate_database_name`](/docs/build/custom-databases#generate_database_name)
- [Новый контекст `dbt_project.yml`](/reference/dbt-jinja-functions/dbt-project-yml-context)
- [Новые конфигурации для файлов schema.yml](/reference/configs-and-properties)
- [Новые конфигурации для деклараций источников](/docs/build/sources)
- [Новые конфигурации подключения для Postgres](/docs/core/connect-data-platform/postgres-setup)
- [Новые конфигурации аутентификации Snowflake KeyPair](/docs/core/connect-data-platform/snowflake-setup)
- [Новая переменная контекста `builtins` jinja](/reference/dbt-jinja-functions/builtins)
- [Новый метод контекста `fromyaml`](/reference/dbt-jinja-functions/fromyaml)
- [Новый метод контекста `toyaml`](/reference/dbt-jinja-functions/toyaml)
- [Новая переменная контекста `project_name`](/reference/dbt-jinja-functions/project_name)
- [Новая переменная контекста `dbt_version`](/reference/dbt-jinja-functions/dbt_version)
- [Новая переменная `database_schemas` в контексте `on-run-end`](/reference/dbt-jinja-functions/on-run-end-context)