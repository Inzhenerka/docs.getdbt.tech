---
title: "Обновление до 0.19.0"
displayed_sidebar: "docs"

---

### Ресурсы

- [Discourse](https://discourse.getdbt.com/t/1951)
- [Примечания к выпуску](https://github.com/dbt-labs/dbt-core/releases/tag/v0.19.0)
- [Полный журнал изменений](https://github.com/dbt-labs/dbt-core/blob/0.19.latest/CHANGELOG.md)

## Ломающие изменения

### Для пользователей dbt

Обратите внимание на следующие изменения в версии v0.19.0:

1. Артефакты dbt имеют новую схему. С этого момента схемы артефактов официально версионируются на **schemas.getdbt.com**. Будущие ломающие изменения будут ограничены минорными версиями. Некоторые классы dbt, такие как объект `Result`, имеют связанные ломающие изменения.
2. Defer, бета-функция, представленная в v0.18.0, немного изменилась, чтобы лучше поддерживать случай использования "Slim CI".
3. Блок `call statement` возвращает структурированный `response` вместо строки `status`, хотя они печатаются одинаково. Если вы ранее обращались к `statement['status']` в пользовательской макросе или материализации, теперь вам следует использовать `statement['response']`.

Смотрите документацию ниже для получения более подробной информации. Мы не ожидаем, что это потребует действий в большинстве проектов.

#### Устаревания

Удалена поддержка `config-version: 1` в dbt_project.yml, которая была устаревшей в v0.17.0. Используйте `config-version: 2` во всех проектах и установленных пакетах. В противном случае dbt выдаст ошибку. Смотрите документацию по [config-version](/reference/project-configs/config-version) и [Руководство по миграции v0.17.0](/docs/dbt-versions/core-upgrade) для получения подробностей.

### Для поддерживающих плагины dbt

(Вы знаете, кто вы!)

Связано с изменением #3 выше: Контекст `results` и артефакт `run_results.json` включают новый неструктурированный словарь под названием `adapter_response`. Это отражает структурированную информацию, возвращаемую базой данных после выполнения dbt "основного" запроса для модели, seed, snapshot и т.д.

По умолчанию этот словарь принимает ключи, такие как `code` (`OK`, `SUCCESS`, `CREATE TABLE` и т.д.) и `rows_affected` (целое число). Вы можете добавить пользовательские аргументы для отражения информации, специфичной для вашего адаптера. Например, `dbt-bigquery` заполняет дополнительный аргумент `bytes_processed`.

В рамках этого изменения:
- Метод `get_status` в `SQLConnectionManager` был переименован в `get_response`
- `execute` теперь возвращает кортеж вместо строки

Смотрите [dbt#2961](https://github.com/dbt-labs/dbt-core/pull/2961) для получения полных деталей реализации. Хотя `adapter_response` еще не заполняется тестами или проверками свежести источников, мы надеемся добавить это в будущем релизе ([dbt#2964](https://github.com/dbt-labs/dbt-core/issues/2964)).

## Новая и измененная документация

### Основные изменения
- [Артефакты dbt](/docs/deploy/artifacts): Артефакты <Term id="json" /> , производимые dbt — манифест, каталог, результаты выполнения и источники — стали проще для восприятия и более четко задокументированы.
- [Классы dbt](/reference/dbt-classes#result-objects), [Контекст on-run-end](/reference/dbt-jinja-functions/on-run-end-context#results): Объект `Result` имеет новую схему, в соответствии с изменениями в `run_results.json`.
- [Блоки операторов](/reference/dbt-jinja-functions/statement-blocks): Строка результата `status` в `call statement` теперь является структурированным объектом с именем `response`.
- [Снимки](/docs/build/snapshots#snapshot-configurations): Если конфигурация `invalidate_hard_deletes` включена, `dbt snapshot` обновит записи, уникальный ключ которых больше не существует в запросе снимка. Если эти уникально идентифицированные записи "возродятся", `dbt snapshot` снова добавит их.
- [YAML селекторы](/reference/node-selection/yaml-selectors) поддерживают свойство `description` и записывают их расширенные словарные представления в манифест.
- [Модули](/reference/dbt-jinja-functions/modules): Модуль регулярных выражений Python, `re`, доступен в контексте Jinja dbt.
- [parse](/reference/commands/parse): Новая команда для разбора проекта dbt и записи подробной информации о времени.

#### Состояние
- [О состоянии](/reference/node-selection/syntax#about-node-selection): Новая документация, описывающая концептуальные основы запусков, информированных состоянием, а также [известные ограничения](/reference/node-selection/state-comparison-caveats) для сравнения состояния. В v0.19.0 dbt стал немного умнее в определении "ложных срабатываний" `state:modified`, которые ранее возникали из-за конфигураций на основе окружения в `dbt_project`.
- [Defer](/reference/node-selection/defer) изменился: Вместо того чтобы откладывать все невыбранные ссылки на узлы, dbt теперь откладывает невыбранную ссылку на узел _только в том случае_, если она не существует в текущем окружении. Тесты также могут откладывать свои ссылки на вышестоящие узлы. Это лучше поддерживает случай использования "Slim CI", учитывая ресурсы текущего окружения на этапах `seed`, `run` и `test`.
- [RPC](/reference/commands/rpc): Добавлены `state` и `defer` в качестве аргументов к методам RPC, для которых это поддерживается в CLI.

### BigQuery
- [Профиль BigQuery](/docs/core/connect-data-platform/bigquery-setup): dbt может подключаться через OAuth токены (однократные или обновляемые), и он может использовать проект по умолчанию при подключении через `gcloud` oauth.
- [Часовые, месячные и годовые разделы](/reference/resource-configs/bigquery-configs#partitioning-by-a-date-or-timestamp): С новым атрибутом `granularity` конфигурации `partition_by` dbt может материализовать модели как таблицы, разделенные по часам, месяцам или годам.

### Spark
- [Профиль Spark](/docs/core/connect-data-platform/spark-setup): Методы подключения `thrift` и `http` требуют установки дополнительного пакета `PyHive`.