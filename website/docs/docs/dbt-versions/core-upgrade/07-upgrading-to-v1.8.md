---
title: "Обновление до v1.8"
id: upgrading-to-v1.8
description: Новые функции и изменения в dbt Core v1.8
displayed_sidebar: "docs"
---

## Ресурсы

- [Журнал изменений](https://github.com/dbt-labs/dbt-core/blob/1.8.latest/CHANGELOG.md)
- [Руководство по установке dbt Core CLI](/docs/core/installation-overview)
- [Руководство по обновлению в облаке](/docs/dbt-versions/upgrade-dbt-version-in-cloud)

## Что нужно знать перед обновлением

dbt Labs стремится обеспечить обратную совместимость для всех версий 1.x, за исключением изменений, явно упомянутых на этой странице. Если вы столкнетесь с ошибкой после обновления, пожалуйста, дайте нам знать, [открыв проблему](https://github.com/dbt-labs/dbt-core/issues/new).

## Треки релизов

Начиная с 2024 года, dbt Cloud предоставляет функциональность новых версий dbt Core через [треки релизов](/docs/dbt-versions/cloud-release-tracks) с автоматическими обновлениями. Выберите трек релиза в ваших [окружениях](/docs/deploy/deploy-environments) разработки, тестирования и производства, чтобы получить доступ ко всему в dbt Core v1.8+ и не только. Чтобы обновить окружение в [API администратора dbt Cloud](/docs/dbt-cloud-apis/admin-cloud-api) или [Terraform](https://registry.terraform.io/providers/dbt-labs/dbtcloud/latest), установите `dbt_version` в строку `latest`.

## Новые и измененные функции и функциональность

Функции и функциональность, новые в dbt v1.8.

### Новая процедура установки адаптера dbt Core

До dbt Core v1.8, когда вы выполняли `pip install` адаптер для хранилища данных для dbt, `pip` автоматически устанавливал `dbt-core` вместе с ним. Адаптер dbt напрямую зависел от компонентов `dbt-core`, а `dbt-core` зависел от адаптера для выполнения. Эта двусторонняя зависимость затрудняла разработку адаптеров независимо от `dbt-core`.

Начиная с v1.8, [`dbt-core` и адаптеры отделены](https://github.com/dbt-labs/dbt-adapters/discussions/87). В дальнейшем ваши установки должны явно включать _как_ `dbt-core`, _так и_ желаемый адаптер. Новая команда установки `pip` должна выглядеть следующим образом:

```shell
pip install dbt-core dbt-ADAPTER_NAME
```

Например, вы бы использовали следующую команду, если используете Snowflake:
```shell
pip install dbt-core dbt-snowflake
```

На данный момент мы сохранили зависимости во время установки, чтобы избежать неожиданного нарушения существующих скриптов; `pip install dbt-snowflake` продолжит устанавливать последние версии как `dbt-core`, так и `dbt-snowflake`. Учитывая, что мы можем удалить эту неявную зависимость в будущих версиях, мы настоятельно рекомендуем вам обновить скрипты установки **сейчас**.

### Модульные тесты

Исторически, тестовое покрытие dbt ограничивалось [«данными» тестами](/docs/build/data-tests), оценивающими качество входных данных или структуру результирующих наборов данных.

В v1.8 мы вводим нативную поддержку [модульного тестирования](/docs/build/unit-tests). Модульные тесты проверяют вашу логику SQL моделирования на небольшом наборе статических входных данных __до__ того, как вы материализуете вашу полную модель в производстве. Они поддерживают подход разработки через тестирование, улучшая как эффективность разработчиков, так и надежность кода.

Начиная с v1.8, когда вы выполняете команду `dbt test`, она будет запускать как модульные, так и данные тесты. Используйте метод [`test_type`](/reference/node-selection/methods#test_type), чтобы запустить только модульные или данные тесты:

```shell
dbt test --select "test_type:unit"           # запустить все модульные тесты
dbt test --select "test_type:data"           # запустить все данные тесты
```

Модульные тесты определяются в YML файлах в вашем каталоге `models/` и в настоящее время поддерживаются только для SQL моделей. Чтобы различать их, конфигурация `tests:` была переименована в `data_tests:`. Оба варианта в настоящее время поддерживаются для обратной совместимости.

#### Новый синтаксис `data_tests:`

Синтаксис `tests:` изменяется, чтобы отразить добавление модульных тестов. Начните миграцию ваших [данных тестов](/docs/build/data-tests#new-data_tests-syntax) YML, чтобы использовать `data_tests:`, после обновления до v1.8, чтобы избежать проблем в будущем.

```yml
models:
  - name: orders
    columns:
      - name: order_id
        data_tests:
          - unique
          - not_null
```

#### Флаг `--empty`

Команды [`run`](/reference/commands/run#the-`--empty`-flag) и [`build`](/reference/commands/build#the---empty-flag) теперь поддерживают флаг `--empty` для построения только схемы без выполнения. Флаг `--empty` ограничивает ссылки и источники до нуля строк. dbt все равно выполнит SQL модели против целевого хранилища данных, но избежит дорогих чтений входных данных. Это проверяет зависимости и гарантирует, что ваши модели будут правильно построены.

### Устаревшая функциональность

Возможность для установленных пакетов переопределять встроенные материализации без явного согласия пользователя устаревает.

- Переопределение встроенной материализации из установленного пакета вызывает предупреждение об устаревании.
- Использование пользовательской материализации из установленного пакета не вызывает предупреждения об устаревании.
- Использование переопределения встроенной материализации пакета из корневого проекта через обертывающую материализацию по-прежнему поддерживается. Например:

  ```sql
  {% materialization view, default %}
  {{ return(my_cool_package.materialization_view_default()) }}
  {% endmaterialization %}
  ```

### Управление изменениями в устаревших поведениях

dbt Core v1.8 ввел флаги для [управления изменениями в устаревших поведениях](/reference/global-configs/behavior-changes). Вы можете включить недавно введенные изменения (по умолчанию отключены) или отключить устоявшиеся изменения (по умолчанию включены), установив значения `True` / `False` соответственно для `flags` в `dbt_project.yml`.

Вы можете прочитать больше о каждом из этих изменений поведения по следующим ссылкам:

- (Устоявшееся, включено по умолчанию) [Требовать явные переопределения пакетов для встроенных материализаций](/reference/global-configs/behavior-changes#require_explicit_package_overrides_for_builtin_materializations)
- (Введено, отключено по умолчанию) [Требовать имена ресурсов без пробелов](/reference/global-configs/behavior-changes#require_resource_names_without_spaces)
- (Введено, отключено по умолчанию) [Запускать хуки проекта (`on-run-*`) в команде `dbt source freshness`](/reference/global-configs/behavior-changes#source_freshness_run_project_hooks)

## Быстрые заметки

- Пользовательские значения [глобальных конфигурационных флагов](/reference/global-configs/about-global-configs) должны устанавливаться в словаре `flags` в [`dbt_project.yml`](/reference/dbt_project.yml), а не в [`profiles.yml`](/docs/core/connect-data-platform/profiles.yml). Поддержка `profiles.yml` была устаревшей.
- Новый флаг CLI [`--resource-type`/`--exclude-resource-type`](/reference/global-configs/resource-type) для включения/исключения ресурсов из dbt `build`, `run` и `clone`.
- Для улучшения производительности dbt теперь выполняет один (пакетный) запрос при расчете `source freshness` через метаданные, вместо выполнения запроса для каждого источника.
- Синтаксис для `DBT_ENV_SECRET_` изменился на `DBT_ENV_SECRET` и больше не требует закрывающего подчеркивания.