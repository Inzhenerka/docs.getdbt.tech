---
title: "Среды развертывания"
id: "deploy-environments"
description: "Узнайте о средах развертывания dbt Cloud для бесшовного планирования задач или включения CI."
---

Среды развертывания в dbt Cloud имеют решающее значение для развертывания задач dbt в производственной среде и использования функций или интеграций, которые зависят от метаданных или результатов dbt. Для выполнения dbt среды определяют настройки, используемые во время выполнения задач, включая:

- Версию dbt Core, которая будет использоваться для запуска вашего проекта
- Информацию о подключении к хранилищу (включая настройки целевой базы данных/схемы)
- Версию вашего кода для выполнения

Проект dbt Cloud может иметь несколько сред развертывания, что дает вам гибкость и возможность настройки для адаптации выполнения задач dbt. Вы можете использовать среды развертывания для [создания и планирования задач](/docs/deploy/deploy-jobs#create-and-schedule-jobs), [включения непрерывной интеграции](/docs/deploy/continuous-integration) или других действий в зависимости от ваших конкретных потребностей или требований.

:::tip Узнайте, как управлять средами dbt Cloud
Чтобы узнать о различных подходах к управлению средами dbt Cloud и рекомендациях для уникальных потребностей вашей организации, прочитайте [лучшие практики работы со средами dbt Cloud](/guides/set-up-ci).
:::

Узнайте больше о средах разработки и развертывания в [Средах dbt Cloud](/docs/dbt-cloud-environments).

Существует три типа сред развертывания:
- **Производственная**: Среда для преобразования данных и построения конвейеров для производственного использования.
- **Тестовая**: Среда для работы с производственными инструментами при ограниченном доступе к производственным данным.
- **Общая**: Среда общего назначения для разработки развертывания.

Мы настоятельно рекомендуем использовать тип среды `Производственная` для окончательных, достоверных данных развертывания. Может быть только одна среда, помеченная для окончательных производственных рабочих процессов, и мы не рекомендуем использовать `Общую` среду для этой цели.

## Создание среды развертывания

Чтобы создать новую среду развертывания dbt Cloud, перейдите в **Развертывание** -> **Среды**, а затем нажмите **Создать среду**. Выберите **Развертывание** в качестве типа среды. Опция будет недоступна, если у вас уже есть среда разработки.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/create-deploy-env.png" width="85%" title="Перейдите в Развертывание -> Среды, чтобы создать среду развертывания" />

### Установить как производственную среду

В dbt Cloud каждый проект может иметь одну назначенную среду развертывания, которая служит его производственной средой. Эта производственная среда является _необходимой_ для использования таких функций, как dbt Explorer и межпроектные ссылки. Она служит источником правды для производственного состояния проекта в dbt Cloud.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/prod-settings-1.png" width="100%" title="Установите вашу производственную среду как среду по умолчанию в настройках среды"/>

### Семантический уровень

Для клиентов, использующих семантический уровень dbt, следующий раздел настроек среды — это конфигурации семантического уровня. [Руководство по настройке семантического уровня](/docs/use-dbt-semantic-layer/setup-sl) содержит самые актуальные инструкции по настройке.

Вы также можете использовать планировщик задач dbt, чтобы [проверить ваши семантические узлы в CI задаче](/docs/deploy/ci-jobs#semantic-validations-in-ci), чтобы убедиться, что изменения кода, внесенные в модели dbt, не нарушают эти метрики.

## Тестовая среда

Используйте тестовую среду, чтобы предоставить разработчикам доступ к рабочим процессам развертывания и инструментам, контролируя доступ к производственным данным. Тестовые среды позволяют вам добиться более детального контроля над разрешениями, подключениями к хранилищу данных и изоляцией данных — в рамках одного проекта в dbt Cloud.

### Git рабочий процесс

Вы можете подойти к этому несколькими способами, но самый простой — настроить тестовую среду с долгоживущей веткой (например, `staging`), аналогичной, но отдельной от основной ветки (например, `main`).

В этом сценарии рабочие процессы, как правило, движутся вверх от среды разработки -> тестовой среды -> производственной среды, при этом ветки разработчиков вливаются в ветку `staging`, а затем в конечном итоге сливаются в `main`. В большинстве случаев ветки `main` и `staging` будут идентичны после слияния и останутся такими до следующей партии изменений из веток `development`, готовых к повышению. Мы рекомендуем установить правила защиты веток на `staging`, аналогичные `main`.

Некоторые клиенты предпочитают подключать разработки и тестирование к своей ветке `main`, а затем регулярно создавать ветки для релизов (ежедневно или еженедельно), которые будут поступать в производственную среду.

### Зачем использовать тестовую среду

Основные причины для использования тестовой среды:
1. Дополнительный уровень проверки перед развертыванием изменений в производственной среде. Вы можете развертывать, тестировать и исследовать свои модели dbt в тестовой среде.
2. Четкая изоляция между рабочими процессами разработки и производственными данными. Это позволяет разработчикам работать с использованием метаданных, используя такие функции, как отложенные и межпроектные ссылки, без доступа к данным в производственных развертываниях.
3. Предоставление разработчикам возможности создавать, редактировать и запускать разовые задачи в тестовой среде, при этом производственная среда остается заблокированной с использованием [разрешений на уровне среды](/docs/cloud/manage-access/environment-permissions).

**Условная конфигурация источников** позволяет вам указывать "prod" или "non-prod" исходные данные в зависимости от среды, в которой вы работаете. Например, этот источник будет указывать на `<DATABASE>.sensitive_source.table_with_pii`, где `<DATABASE>` динамически разрешается на основе переменной среды.

<File name="models/sources.yml">

```yaml
sources:
  - name: sensitive_source
    database: "{{ env_var('SENSITIVE_SOURCE_DATABASE') }}"
    tables:
      - name: table_with_pii
```

</File>

Существует ровно один источник (`sensitive_source`), и все последующие модели dbt выбирают из него как `{{ source('sensitive_source', 'table_with_pii') }}`. Код в вашем проекте и структура DAG остаются неизменными между средами. Настраивая это таким образом, вместо дублирования источников, вы получаете важные преимущества.

**Межпроектные ссылки в dbt Mesh:** Предположим, у вас есть `Project B`, который находится ниже по потоку от `Project A` с настроенными межпроектными ссылками в моделях. Когда разработчики работают в IDE для `Project B`, межпроектные ссылки будут разрешаться на тестовую среду `Project A`, а не на производственную. Вы получите те же результаты с этими ссылками, когда задачи выполняются в тестовой среде. Только производственная среда будет ссылаться на производственные данные, сохраняя данные и доступ изолированными без необходимости в отдельных проектах.

**Более быстрое развитие благодаря отложенным задачам:** Если у `Project B` также есть тестовое развертывание, то ссылки на не построенные модели выше по потоку в `Project B` будут разрешаться на эту среду, используя [отложенные задачи](/docs/cloud/about-cloud-develop-defer), а не разрешаться на модели в производственной среде. Это экономит время разработчиков и затраты на хранилище, сохраняя четкое разделение сред.

Наконец, тестовая среда имеет свой собственный вид в [dbt Explorer](/docs/collaborate/explore-projects), предоставляя вам полный обзор ваших производственных и пред-производственных данных.

<Lightbox src="/img/docs/collaborate/dbt-explorer/explore-staging-env.png" width="85%" title="Исследуйте в тестовой среде" />

### Создание тестовой среды

В dbt Cloud перейдите в **Развертывание** -> **Среды**, а затем нажмите **Создать среду**. Выберите **Развертывание** в качестве типа среды. Опция будет недоступна, если у вас уже есть среда разработки.

<Lightbox src="/img/docs/dbt-cloud/cloud-configuring-dbt-cloud/create-staging-environment.png" width="85%" title="Создайте тестовую среду" />

Следуйте шагам, описанным в [учетных данных развертывания](#deployment-connection), чтобы завершить настройку среды.

Мы рекомендуем, чтобы учетные данные хранилища данных были для выделенного пользователя или сервисного принципала.

## Подключение развертывания

:::info Подключения к хранилищу

 Подключения к хранилищу устанавливаются на уровне проекта для учетных записей dbt Cloud, и каждый проект может иметь одно подключение (аккаунт Snowflake, хост Redshift, проект Bigquery, хост Databricks и т.д.). Некоторые детали этого подключения (базы данных/схемы и т.д.) могут быть переопределены в этом разделе настроек среды dbt Cloud.

:::

Этот раздел определяет точное местоположение в вашем хранилище, на которое dbt должен нацеливаться при создании объектов хранилища! Этот раздел будет выглядеть немного иначе в зависимости от вашего поставщика хранилища.

Для всех хранилищ используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения отсутствующих или неактивных (затемненных) настроек.

<WHCode>

<div warehouse="Postgres">

Этот раздел не появится, если вы используете Postgres, так как все значения выводятся из подключения проекта. Используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения этих значений.

</div>

<div warehouse="Redshift">

Этот раздел не появится, если вы используете Redshift, так как все значения выводятся из подключения проекта. Используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения этих значений.

</div>

<div warehouse="Snowflake">

<Lightbox src="/img/docs/collaborate/snowflake-deploy-env-deploy-connection.png" width="85%" title="Настройки подключения развертывания Snowflake"/>

#### Редактируемые поля

- **Роль**: Роль Snowflake
- **База данных**: Целевая база данных
- **Хранилище**: Хранилище Snowflake

</div>

<div warehouse="Bigquery">

Этот раздел не появится, если вы используете Bigquery, так как все значения выводятся из подключения проекта. Используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения этих значений.

</div>

<div warehouse="Spark">

Этот раздел не появится, если вы используете Spark, так как все значения выводятся из подключения проекта. Используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения этих значений.

</div>

<div warehouse="Databricks">

<Lightbox src="/img/docs/collaborate/databricks-deploy-env-deploy-connection.png" width="85%" title="Настройки подключения развертывания Databricks"/>

#### Редактируемые поля

- **Каталог** (необязательно): [Пространство имен Unity Catalog](/docs/core/connect-data-platform/databricks-setup)

</div>

</WHCode>

### Учетные данные развертывания

Этот раздел позволяет вам определить учетные данные, которые должны использоваться при подключении к вашему хранилищу. Методы аутентификации могут различаться в зависимости от хранилища и уровня dbt Cloud, на котором вы находитесь.

Для всех хранилищ используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения отсутствующих или неактивных (затемненных) настроек. Для учетных данных мы рекомендуем оборачивать расширенные атрибуты в [переменные среды](/docs/build/environment-variables) (`password: '{{ env_var(''DBT_ENV_SECRET_PASSWORD'') }}'`), чтобы избежать отображения секретного значения в текстовом поле и логах.

<WHCode>

<div warehouse="Postgres">

<Lightbox src="/img/docs/collaborate/postgres-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Postgres"/>

#### Редактируемые поля

- **Имя пользователя**: Имя пользователя Postgres для использования (скорее всего, сервисная учетная запись)
- **Пароль**: Пароль Postgres для указанного пользователя
- **Схема**: Целевая схема

</div>

<div warehouse="Redshift">

<Lightbox src="/img/docs/collaborate/postgres-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Redshift"/>

#### Редактируемые поля

- **Имя пользователя**: Имя пользователя Redshift для использования (скорее всего, сервисная учетная запись)
- **Пароль**: Пароль Redshift для указанного пользователя
- **Схема**: Целевая схема

</div>

<div warehouse="Snowflake">

<Lightbox src="/img/docs/collaborate/snowflake-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Snowflake"/>

#### Редактируемые поля

- **Метод аутентификации**: Это определяет способ подключения dbt к вашему хранилищу
  - Один из: [**Имя пользователя и пароль**, **Ключевая пара**]
- Если **Имя пользователя и пароль**:
  - **Имя пользователя**: имя пользователя для использования (скорее всего, сервисная учетная запись)
  - **Пароль**: пароль для указанного пользователя
- Если **Ключевая пара**:
  - **Имя пользователя**: имя пользователя для использования (скорее всего, сервисная учетная запись)
  - **Закрытый ключ**: значение закрытого SSH-ключа (необязательно)
  - **Пароль закрытого ключа**: значение пароля закрытого SSH-ключа (необязательно, только если требуется)
- **Схема**: Целевая схема для этой среды

</div>

<div warehouse="Bigquery">

<Lightbox src="/img/docs/collaborate/bigquery-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Bigquery"/>

#### Редактируемые поля

- **Набор данных**: Целевой набор данных

Используйте [расширенные атрибуты](/docs/dbt-cloud-environments#extended-attributes) для переопределения отсутствующих или неактивных (затемненных) настроек. Для учетных данных мы рекомендуем оборачивать расширенные атрибуты в [переменные среды](/docs/build/environment-variables) (`password: '{{ env_var(''DBT_ENV_SECRET_PASSWORD'') }}'`), чтобы избежать отображения секретного значения в текстовом поле и логах.

</div>

<div warehouse="Spark">

<Lightbox src="/img/docs/collaborate/spark-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Spark"/>

#### Редактируемые поля

- **Токен**: Токен доступа
- **Схема**: Целевая схема

</div>

<div warehouse="Databricks">

<Lightbox src="/img/docs/collaborate/spark-deploy-env-deploy-credentials.png" width="85%" title="Настройки учетных данных развертывания Databricks"/>

#### Редактируемые поля

- **Токен**: Токен доступа
- **Схема**: Целевая схема

</div>

</WHCode>

## Связанные документы

- [Лучшие практики работы со средами dbt Cloud](/guides/set-up-ci)
- [Развертывание задач](/docs/deploy/deploy-jobs)
- [CI задачи](/docs/deploy/continuous-integration)
- [Удаление задачи или среды в dbt Cloud](/faqs/Environments/delete-environment-job)