---
title: "Слияние заданий в dbt Cloud"
sidebar_label: "Слияние заданий"
description: "Узнайте, как запустить выполнение задания dbt при слиянии запроса на извлечение Git."
---

Вы можете настроить задание слияния для реализации рабочего процесса непрерывного развертывания (CD) в dbt Cloud. Задание слияния запускает выполнение задания dbt, когда кто-то сливает запросы на извлечение Git в продуктивную среду. Этот рабочий процесс создает бесшовный опыт разработки, при котором изменения в коде автоматически обновляют данные в продуктивной среде. Также вы можете использовать этот рабочий процесс для выполнения `dbt compile`, чтобы обновить манифест вашей среды, что сделает последующие запуски CI более производительными.

Используя CD в dbt Cloud, вы можете воспользоваться отложенным выполнением, чтобы строить только измененную модель и любые изменения downstream. С заданиями слияния состояние будет обновляться почти мгновенно, всегда предоставляя самую актуальную информацию о состоянии в [dbt Explorer](/docs/collaborate/explore-projects).

## Предварительные требования
- У вас есть аккаунт dbt Cloud.
- Вы настроили [соединение с вашим Git-поставщиком](/docs/cloud/git/git-configuration-in-dbt-cloud). Эта интеграция позволяет dbt Cloud запускать задания от вашего имени для триггера заданий.
   - Если вы используете нативную интеграцию с [GitLab](/docs/cloud/git/connect-gitlab), вам нужен платный или самохостингованный аккаунт, который включает поддержку вебхуков GitLab и [токенов доступа к проекту](https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html). Если вы используете GitLab Free, запросы на слияние будут триггерить CI задания, но обновления статуса CI заданий (успех или неудача задания) не будут возвращаться в GitLab.
- Для отложенного выполнения (что является значением по умолчанию) убедитесь, что в среде, к которой вы откладываете, был хотя бы один успешный запуск задания.

## Настройка триггера задания при слиянии в Git {#set-up-merge-jobs}

1. На странице вашей среды развертывания нажмите **Создать задание** > **Задание слияния**.
1. Опции в разделе **Настройки задания**:
    - **Имя задания** &mdash; Укажите имя для задания слияния.
    - **Описание** &mdash; Укажите описание задания.
    - **Среда** &mdash; По умолчанию установлено на среду, из которой вы создали задание.
1. В разделе **Git триггер** опция **Запуск при слиянии** включена по умолчанию. Каждый раз, когда PR сливается (в базовую ветку, настроенную в среде) в вашем репозитории Git, это задание будет триггериться для выполнения.
1. Опции в разделе **Настройки выполнения**:
    - **Команды** &mdash; По умолчанию включает команду `dbt build --select state:modified+`. Это информирует dbt Cloud о том, чтобы строить только новые или измененные модели и их downstream зависимости. Важно, что сравнение состояния может происходить только при выбранной отложенной среде для сравнения состояния. Нажмите **Добавить команду**, чтобы добавить больше [команд](/docs/deploy/job-commands), которые вы хотите вызвать при выполнении этого задания.
    - **Сравнить изменения с** &mdash; По умолчанию установлено на сравнение изменений с средой, из которой вы создали задание. Эта опция позволяет dbt Cloud проверять состояние кода в PR по сравнению с кодом, работающим в отложенной среде, чтобы проверять только измененный код, а не строить полную таблицу или весь DAG. Чтобы изменить настройки по умолчанию, вы можете выбрать **Без отложенного выполнения**, **Это задание** для самостановки или выбрать другую среду.
1. (необязательно) Опции в разделе **Расширенные настройки**:
    - **Переменные среды** &mdash; Определите [переменные среды](/docs/build/environment-variables), чтобы настроить поведение вашего проекта при выполнении этого задания.
    - **Имя цели** &mdash; Определите [имя цели](/docs/build/custom-target-names). Аналогично переменным среды, эта опция позволяет вам настроить поведение проекта.
    - **Таймаут выполнения** &mdash; Отменить это задание, если время выполнения превышает значение таймаута.
    - **Версия dbt** &mdash; По умолчанию установлено на наследование [версии dbt](/docs/dbt-versions/core) из среды. dbt Labs настоятельно рекомендует не изменять настройки по умолчанию. Эта опция изменения версии на уровне задания полезна только при обновлении проекта до следующей версии dbt; в противном случае несоответствующие версии между средой и заданием могут привести к путанице.
    - **Потоки** &mdash; По умолчанию установлено на 4 [потока](/docs/core/connect-data-platform/connection-profiles#understanding-threads). Увеличьте количество потоков, чтобы увеличить параллелизм выполнения модели.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-create-merge-job.png" title="Пример создания задания слияния"/>

## Проверьте события push в Git

Задания слияния требуют событий push, поэтому убедитесь, что они включены у вашего Git-поставщика, особенно если у вас уже есть интеграция с Git. Однако для новой настройки интеграции вы можете пропустить эту проверку, так как события push обычно включены по умолчанию.

<Expandable alt_header="Пример GitHub" >

Следующий пример GitHub показывает, когда события push уже настроены:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-github-push-events.png" title="Пример включенной опции Pushes в настройках GitHub"/>

</Expandable>

<Expandable alt_header="Пример GitLab" >

Следующий пример GitLab показывает, когда события push уже настроены:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-gitlab-push-events.png" title="Пример включенной опции Push events в настройках GitLab"/>

</Expandable>

<Expandable alt_header="Пример Azure DevOps" >

Следующий пример показывает создание нового триггера **Код отправлен** в Azure DevOps. Создайте новую подписку на сервисные хуки, когда события отправки кода не были настроены:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-azuredevops-new-event.png" title="Пример создания нового триггера для событий push в Azure DevOps"/>

</Expandable>