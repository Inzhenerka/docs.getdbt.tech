---
title: "Объединение заданий в dbt Cloud"
sidebar_label: "Объединение заданий"
description: "Узнайте, как запускать выполнение задания dbt при слиянии pull-запроса Git."
---

Вы можете настроить задание на объединение, чтобы реализовать рабочий процесс непрерывного развертывания (CD) в dbt Cloud. Задание на объединение запускает выполнение задания dbt, когда кто-то объединяет pull-запросы Git в продакшн. Этот рабочий процесс создает бесшовный опыт разработки, при котором изменения в коде автоматически обновляют данные в продакшн. Также вы можете использовать этот рабочий процесс для выполнения `dbt compile`, чтобы обновить манифест вашей среды, что делает последующие запуски CI-заданий более производительными.

Используя CD в dbt Cloud, вы можете воспользоваться отложенным выполнением, чтобы строить только отредактированную модель и любые изменения вниз по потоку. С помощью заданий на объединение состояние будет обновляться почти мгновенно, всегда предоставляя самую актуальную информацию о состоянии в [dbt Explorer](/docs/collaborate/explore-projects).

## Предварительные условия
- У вас есть аккаунт в dbt Cloud.
- Вы настроили [подключение к вашему Git-провайдеру](/docs/cloud/git/git-configuration-in-dbt-cloud). Эта интеграция позволяет dbt Cloud запускать задания от вашего имени для их триггера.
   - Если вы используете нативную интеграцию с [GitLab](/docs/cloud/git/connect-gitlab), вам нужен платный или самохостинг аккаунт, который включает поддержку вебхуков GitLab и [токенов доступа к проекту](https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html). Если вы используете GitLab Free, запросы на слияние будут запускать CI-задания, но обновления статуса CI-заданий (успех или неудача задания) не будут сообщаться обратно в GitLab.
- Для отложенного выполнения (которое является настройкой по умолчанию) убедитесь, что в среде, к которой вы откладываете выполнение, было хотя бы одно успешное выполнение задания.

## Настройка триггера задания на слияние Git {#set-up-merge-jobs}

1. На странице вашей среды развертывания нажмите **Создать задание** > **Задание на объединение**.
1. Опции в разделе **Настройки задания**:
    - **Имя задания** &mdash; Укажите имя для задания на объединение.
    - **Описание** &mdash; Предоставьте описание задания.
    - **Среда** &mdash; По умолчанию установлена среда, из которой вы создали задание.
1. В разделе **Git-триггер** опция **Запуск при слиянии** включена по умолчанию. Каждый раз, когда PR сливается (в базовую ветку, настроенную в среде) в вашем Git-репозитории, это задание будет запускаться.
1. Опции в разделе **Настройки выполнения**:
    - **Команды** &mdash; По умолчанию включает команду `dbt build --select state:modified+`. Это информирует dbt Cloud о необходимости строить только новые или измененные модели и их зависимые элементы. Важно, что сравнение состояния может происходить только тогда, когда выбрана отложенная среда для сравнения состояния. Нажмите **Добавить команду**, чтобы добавить больше [команд](/docs/deploy/job-commands), которые вы хотите вызвать при выполнении этого задания.
    - **Сравнить изменения с** &mdash; По умолчанию установлено сравнение изменений со средой, из которой вы создали задание. Эта опция позволяет dbt Cloud проверять состояние кода в PR по сравнению с кодом, работающим в отложенной среде, чтобы проверять только измененный код, вместо построения полной таблицы или всего DAG. Чтобы изменить настройки по умолчанию, вы можете выбрать **Без отложенного выполнения**, **Это задание** для самопроверки или выбрать другую среду.
1. (опционально) Опции в разделе **Расширенные настройки**:
    - **Переменные среды** &mdash; Определите [переменные среды](/docs/build/environment-variables), чтобы настроить поведение вашего проекта при выполнении этого задания.
    - **Имя цели** &mdash; Определите [имя цели](/docs/build/custom-target-names). Подобно переменным среды, эта опция позволяет настроить поведение проекта.
    - **Тайм-аут выполнения** &mdash; Отмените это задание, если время выполнения превышает значение тайм-аута.
    - **Версия dbt** &mdash; По умолчанию установлено наследование [версии dbt](/docs/dbt-versions/core) из среды. dbt Labs настоятельно рекомендует не изменять настройку по умолчанию. Эта опция изменения версии на уровне задания полезна только при обновлении проекта до следующей версии dbt; в противном случае несоответствие версий между средой и заданием может привести к запутанному поведению.
    - **Потоки** &mdash; По умолчанию установлено 4 [потока](/docs/core/connect-data-platform/connection-profiles#understanding-threads). Увеличьте количество потоков, чтобы увеличить параллелизм выполнения модели.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-create-merge-job.png" title="Пример создания задания на объединение"/>

## Проверка событий push в Git

Задания на объединение требуют событий push, поэтому убедитесь, что они включены у вашего Git-провайдера, особенно если у вас уже есть существующая интеграция с Git. Однако для новой настройки интеграции вы можете пропустить эту проверку, так как события push обычно включены по умолчанию.

<Expandable alt_header="Пример GitHub" >

Следующий пример показывает, когда события push уже установлены в GitHub:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-github-push-events.png" title="Пример включенной опции Pushes в настройках GitHub"/>

</Expandable>

<Expandable alt_header="Пример GitLab" >

Следующий пример показывает, когда события push уже установлены в GitLab:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-gitlab-push-events.png" title="Пример включенной опции Push events в настройках GitLab"/>

</Expandable>

<Expandable alt_header="Пример Azure DevOps" >

Следующий пример показывает создание нового триггера **Code pushed** в Azure DevOps. Создайте новую подписку на сервисные хуки, если события push не были установлены:

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-azuredevops-new-event.png" title="Пример создания нового триггера для push-событий в Azure DevOps"/>

</Expandable>