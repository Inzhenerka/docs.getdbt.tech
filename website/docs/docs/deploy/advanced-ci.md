---
title: "Расширенная CI"
id: "advanced-ci"
sidebar_label: "Расширенная CI"
description: "Расширенная CI позволяет разработчикам сравнивать изменения, демонстрируя изменения, которые вносит код."
image: /img/docs/dbt-cloud/example-ci-compare-changes-tab.png
---

# Расширенная CI <Lifecycle status="enterprise"/>

[Рабочие процессы непрерывной интеграции](/docs/deploy/continuous-integration) помогают повысить управление и улучшить качество данных. Кроме того, для этих CI задач вы можете использовать функции Расширенной CI, такие как [сравнение изменений](#compare-changes), которые предоставляют информацию о различиях между тем, что в настоящее время находится в вашей производственной среде, и последним коммитом из запроса на слияние, предоставляя вам возможность наблюдать, как изменения в данных зависят от изменений в коде. Анализируя изменения в данных, которые вносят изменения в код, вы можете убедиться, что всегда поставляете надежные продукты данных в процессе разработки.

:::info Как включить эту функцию

Вы можете активировать Расширенную CI в dbt Cloud. Пожалуйста, обратитесь к [Доступу к функциям Расширенной CI](/docs/cloud/account-settings#account-access-to-advanced-ci-features), чтобы узнать, как включить ее в вашей учетной записи dbt Cloud.

:::

:::tip Больше функций
dbt Labs планирует предоставить дополнительные функции Расширенной CI в ближайшем будущем. Скоро появится больше информации.

:::

## Предварительные требования
- У вас есть учетная запись dbt Cloud Enterprise.
- У вас включены [функции Расширенной CI](/docs/cloud/account-settings#account-access-to-advanced-features).
- Вы используете поддерживаемую платформу данных: BigQuery, Databricks, Postgres или Snowflake. Поддержка дополнительных платформ данных будет добавлена в ближайшее время.

## Функция сравнения изменений {#compare-changes}

Для [CI задач](/docs/deploy/ci-jobs), у которых включена [опция **dbt compare**](/docs/deploy/ci-jobs#set-up-ci-jobs), dbt Cloud сравнивает изменения между последним примененным состоянием производственной среды (по умолчанию с отсрочкой для снижения вычислительных затрат) и последними изменениями из запроса на слияние, всякий раз, когда открывается запрос на слияние или добавляются новые коммиты.

dbt сообщает о различиях в сравнении в:

- **dbt Cloud** &mdash; Показывает изменения (если таковые имеются) в основных ключах данных, строках и столбцах на вкладке [Сравнение](/docs/deploy/run-visibility#compare-tab) на странице [Детали выполнения задания](/docs/deploy/run-visibility#job-run-details).
- **Запросе на слияние от вашего Git-поставщика** &mdash; Показывает сводку изменений в виде комментария Git.

<Lightbox src="/img/docs/dbt-cloud/example-ci-compare-changes-tab.png" width="85%" title="Пример вкладки Сравнение" />

### Оптимизация сравнений

Когда в вашей модели указана колонка [`event_time`](/reference/resource-configs/event-time), сравнение изменений может оптимизировать сравнения, используя только перекрывающееся время (то есть время, которое существует как в CI, так и в производственной среде), что помогает избежать неправильных изменений количества строк и возвращать результаты быстрее.

Это полезно в таких сценариях, как:
- **Подмножество данных в CI** &mdash; Когда CI строит только [подмножество данных](/best-practices/best-practice-workflows#limit-the-data-processed-when-in-development) (например, за последние 7 дней), сравнение изменений будет интерпретировать исключенные данные как "удаленные строки". Настройка `event_time` позволяет избежать этой проблемы, ограничивая сравнения перекрывающимся временем, предотвращая ложные сигналы о удалении данных, которые просто отфильтрованы в CI.
- **Свежие данные в CI, чем в производстве** &mdash; Когда ваша CI задача включает более свежие данные, чем в производственной среде (поскольку она выполнялась более недавно), сравнение изменений будет помечать дополнительные строки как "новые" данные, даже если это просто более свежие данные в CI. С настроенным `event_time` сравнение включает только общее время и правильно отражает фактические изменения в данных.

<Lightbox src="/img/docs/deploy/apples_to_apples.png" width="90%" title="event_time гарантирует, что один и тот же временной срез данных точно сравнивается между вашими CI и производственными средами." />

## О кэшированных данных

После [сравнения изменений](#compare-changes) dbt Cloud хранит кэш не более 100 записей для каждой измененной модели для предварительного просмотра. Кэшируя эти данные, вы можете просматривать примеры измененных данных без повторного выполнения сравнения с хранилищем данных каждый раз (оптимизируя для снижения вычислительных затрат). Для отображения изменений dbt Cloud использует кэшированную версию выборки записей данных. Эти записи данных запрашиваются из базы данных с использованием конфигурации подключения (такой как пользователь, роль, сервисный аккаунт и т. д.), которая установлена в среде CI задачи.

Вы контролируете, какие данные использовать. Это может включать синтетические данные, если данные предшествующей версии или разработки сильно регулируются или являются конфиденциальными.

- Выбранные данные кэшируются в системах dbt Labs на срок до 30 дней. Никакие данные не сохраняются в системах dbt Labs после этого периода.
- Кэш зашифрован и хранится в Amazon S3 или Azure blob storage в регионе вашей учетной записи.
- dbt Labs не будет получать доступ к кэшированным данным из Расширенной CI в своих интересах, и данные используются только для предоставления услуг по вашему указанию.
- Третьи лица, кроме подрядчиков по хранению, не будут иметь доступа к кэшированным данным.

Если вы получите доступ к выполнению CI задачи, которое старше 30 дней, вы не сможете увидеть результаты сравнения. Вместо этого появится сообщение, указывающее на то, что данные истекли.

<Lightbox src="/img/docs/deploy/compare-expired.png" width="60%" title="Пример сообщения о просроченных данных на вкладке Сравнение" />

## Разрешения подключения

Функция сравнения изменений использует те же учетные данные, что и CI задача, как определено в среде CI задачи. Администратор dbt Cloud должен убедиться, что учетные данные клиента CI должным образом ограничены, поскольку все пользователи учетной записи клиента смогут просматривать результаты сравнения и кэшированные данные.

Если используется динамическое маскирование данных в хранилище данных, кэшированные данные больше не будут динамически замаскированы в выводе Расширенной CI, в зависимости от разрешений пользователей, которые их просматривают. dbt Labs рекомендует ограничить доступ пользователей к немаскированным данным или рассмотреть возможность использования синтетических данных для функциональности тестирования Расширенной CI.

<Lightbox src="/img/docs/deploy/compare-credentials.png" width="60%" title="Пример учетных данных в настройках пользователя" />
