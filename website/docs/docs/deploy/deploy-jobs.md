---
title: "Задания на развертывание"
description: "Узнайте, как создавать и планировать задания на развертывание в dbt Cloud для запуска планировщиком. При работе с dbt Cloud вы получаете встроенные возможности наблюдения, ведения журналов и оповещения." 
tags: [scheduler]
---

Вы можете использовать задания на развертывание для создания производственных данных. Задания на развертывание упрощают выполнение команд dbt в проекте на вашей облачной платформе данных, которые могут быть запущены по расписанию или по событиям. Каждое выполнение задания в dbt Cloud будет иметь запись в истории выполнения задания и подробный обзор выполнения, который предоставляет вам:

- Тип триггера задания
- SHA коммита
- Имя окружения
- Информация о источниках и документации, если применимо
- Подробности выполнения задания, включая время выполнения, [данные о времени модели](/docs/deploy/run-visibility#model-timing) и [артефакты](/docs/deploy/artifacts)
- Подробные шаги выполнения с журналами и статусами шагов выполнения

Вы можете создать задание на развертывание и настроить его для выполнения в [запланированные дни и время](#schedule-days), ввести [пользовательское расписание cron](#cron-schedule) или [запустить задание после завершения другого задания](#trigger-on-job-completion).

## Предварительные условия

- У вас должен быть [аккаунт dbt Cloud](https://www.getdbt.com/signup/) и [лицензия на место разработчика](/docs/cloud/manage-access/seats-and-users).
    - Для функции [Запуск при завершении задания](#trigger-on-job-completion) ваш аккаунт dbt Cloud должен находиться на [Командном или Корпоративном плане](https://www.getdbt.com/pricing/).
- У вас должен быть проект dbt, подключенный к [платформе данных](/docs/cloud/connect-data-platform/about-connections).
- У вас должны быть [права доступа](/docs/cloud/manage-access/about-user-access) для просмотра, создания, изменения или выполнения заданий.
- Вы должны настроить [окружение развертывания](/docs/deploy/deploy-environments). 

## Создание и планирование заданий {#create-and-schedule-jobs}

1. На странице вашего окружения развертывания нажмите **Создать задание** > **Задание на развертывание**, чтобы создать новое задание на развертывание. 
2. Опции в разделе **Настройки задания**:
    - **Имя задания** &mdash; Укажите имя для задания на развертывание. Например, `Ежедневная сборка`.
    - (Необязательно) **Описание** &mdash; Укажите описание того, что делает задание (например, что задание использует и что оно производит). 
    - **Окружение** &mdash; По умолчанию установлено на окружение развертывания, из которого вы создали задание на развертывание.
3. Опции в разделе **Настройки выполнения**:
    - **Команды** &mdash; По умолчанию включает команду `dbt build`. Нажмите **Добавить команду**, чтобы добавить больше [команд](/docs/deploy/job-commands), которые вы хотите вызвать при выполнении задания.
    - **Генерировать документацию при выполнении** &mdash; Включите эту опцию, если хотите [сгенерировать документацию проекта](/docs/collaborate/build-and-view-your-docs) при выполнении этого задания на развертывание.
    - **Проверка свежести источников** &mdash; Включите эту опцию, чтобы вызвать команду `dbt source freshness` перед выполнением задания на развертывание. Смотрите [Свежесть источников](/docs/deploy/source-freshness) для получения дополнительных сведений.
4. Опции в разделе **Триггеры**:
    - **Запуск по расписанию** &mdash; Запуск задания на развертывание по установленному расписанию.
        - **Время** &mdash; Укажите, следует ли [планировать](#schedule-days) задание на развертывание с использованием **Интервалов**, которые запускают задание через указанное количество часов, **Конкретных часов**, которые запускают задание в определенные часы дня, или **Расписания cron**, которое запускает задание по указанному [синтаксису cron](#cron-schedule).
        - **Дни недели** &mdash; По умолчанию установлено на каждый день, когда выбраны **Интервалы** или **Конкретные часы** для **Времени**.
    - **Запуск при завершении другого задания** &mdash; Запуск задания на развертывание, когда другое _вышестоящее_ задание [завершится](#trigger-on-job-completion).  
        - **Проект** &mdash; Укажите родительский проект, в котором находится это вышестоящее задание. 
        - **Задание** &mdash; Укажите вышестоящее задание. 
        - **Завершено на** &mdash; Выберите статус(ы) выполнения задания, которые [поставят в очередь](/docs/deploy/job-scheduler#scheduler-queue) задание на развертывание.  

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-triggers-section.png" width="90%" title="Пример триггеров на странице задания на развертывание"/>

5. (Необязательно) Опции в разделе **Расширенные настройки**: 
    - **Переменные окружения** &mdash; Определите [переменные окружения](/docs/build/environment-variables), чтобы настроить поведение вашего проекта при выполнении задания на развертывание.
    - **Имя цели** &mdash; Определите [имя цели](/docs/build/custom-target-names), чтобы настроить поведение вашего проекта при выполнении задания на развертывание. Переменные окружения и имена целей часто используются взаимозаменяемо. 
    - **Таймаут выполнения** &mdash; Отменить задание на развертывание, если время выполнения превышает значение таймаута. 
    - **Сравнить изменения с** &mdash; По умолчанию установлено на **Без отсрочки**. Выберите либо **Окружение**, либо **Это задание**, чтобы сообщить dbt Cloud, с чем следует сравнить изменения.  

    :::info
    Более старые версии dbt Cloud позволяют откладывать только на конкретное задание, а не на окружение. Откладывание на задание сравнивает состояние с кодом проекта, который был выполнен в последнем успешном запуске откладываемого задания. В то время как откладывание на окружение более эффективно, так как dbt Cloud будет сравнивать с представлением проекта (которое хранится в `manifest.json`) последнего успешного выполнения задания на развертывание, которое было выполнено в откладываемом окружении. Учитывая _все_ задания на развертывание, которые выполняются в откладываемом окружении, dbt Cloud получит более точное, актуальное состояние представления проекта.
    :::

    - **Версия dbt** &mdash; По умолчанию установлено на наследование [версии dbt](/docs/dbt-versions/core) из окружения. dbt Labs настоятельно рекомендует не изменять настройки по умолчанию. Эта опция изменения версии на уровне задания полезна только при обновлении проекта до следующей версии dbt; в противном случае несоответствующие версии между окружением и заданием могут привести к путанице. 
    - **Потоки** &mdash; По умолчанию установлено на 4 [потока](/docs/core/connect-data-platform/connection-profiles#understanding-threads). Увеличьте количество потоков, чтобы увеличить параллелизм выполнения моделей.

    <Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/deploy-job-adv-settings.png" width="90%" title="Пример расширенных настроек на странице задания на развертывание"/>

### Запланированные дни

Чтобы установить расписание вашего задания, используйте опцию **Запуск по расписанию**, чтобы выбрать конкретные дни недели и выбрать настраиваемые часы или интервалы.

В разделе **Время** вы можете использовать регулярные интервалы для заданий, которые необходимо выполнять часто в течение дня, или настраиваемые часы для заданий, которые необходимо выполнять в определенные часы:

- **Интервалы** &mdash; Используйте эту опцию, чтобы установить, как часто ваше задание выполняется, в часах. Например, если вы выберете **Каждые 2 часа**, задание будет выполняться каждые 2 часа с полуночи по UTC. Это не означает, что оно будет выполняться ровно в полночь по UTC. Однако последующие запуски всегда будут выполняться с одинаковым интервалом времени между ними. Например, если предыдущий запланированный конвейер выполнялся в 00:04 UTC, следующий запуск будет в 02:04 UTC. Эта опция полезна, если вам нужно выполнять задания несколько раз в день с регулярными интервалами.

- **Конкретные часы** &mdash; Используйте эту опцию, чтобы установить конкретные часы, когда ваше задание должно выполняться. Вы можете ввести список часов, разделенных запятыми (в UTC), когда вы хотите, чтобы задание выполнялось. Например, если вы установите его на `0,12,23,` задание будет выполняться в полночь, в полдень и в 11 вечера по UTC. Запуски заданий всегда будут последовательными как по часам, так и по дням, поэтому, если ваше задание выполняется в 00:05, 12:05 и 23:05 UTC, оно будет выполняться в эти же часы каждый день. Эта опция полезна, если вы хотите, чтобы ваши задания выполнялись в определенные часы дня и не нужно, чтобы они выполнялись чаще одного раза в день.

:::info

dbt Cloud использует [Универсальное координированное время](https://en.wikipedia.org/wiki/Coordinated_Universal_Time) (UTC) и не учитывает переводы в вашу конкретную часовой пояс или не принимает во внимание переход на летнее/зимнее время. Например:

- 0 означает 12 ночи (полночь) по UTC
- 12 означает 12 дня (после полудня) по UTC
- 23 означает 11 вечера по UTC

:::

### Расписание cron

Чтобы полностью настроить расписание вашего задания, выберите опцию **Расписание cron** и используйте синтаксис cron. С помощью этого синтаксиса вы можете указать минуту, час, день месяца, месяц и день недели, что позволяет вам настраивать сложные расписания, такие как выполнение задания в первый понедельник каждого месяца.

**Частота cron**

Чтобы улучшить производительность, частоты планирования заданий различаются в зависимости от плана dbt Cloud:

- Планы разработчиков: dbt Cloud устанавливает минимальный интервал в 10 минут для планирования заданий. Это означает, что планирование заданий на более частое выполнение или с интервалами менее 10 минут не поддерживается.
- Командные и корпоративные планы: Нет ограничений на частоту выполнения заданий.

**Примеры**

Используйте такие инструменты, как [crontab.guru](https://crontab.guru/), чтобы сгенерировать правильный синтаксис cron. Этот инструмент позволяет вам вводить фрагменты cron и возвращать их переводы на простой английский. Планировщик заданий dbt Cloud поддерживает использование `L` для планирования заданий на последний день месяца.

Примеры расписаний заданий cron:

- `0 * * * *`: Каждый час, в 0 минут.
- `*/5 * * * *`: Каждые 5 минут. (Не доступно на планах разработчиков)
- `5 4 * * *`: Точно в 4:05 AM по UTC.
- `30 */4 * * *`: В 30-й минуте каждого 4-го часа (например, 4:30 AM, 8:30 AM, 12:30 PM и так далее, все по UTC).
- `0 0 */2 * *`: В 12:00 AM (полночь) по UTC каждые два дня.
- `0 0 * * 1`: В полночь по UTC каждую понедельник.
- `0 0 L * *`: В 12:00 AM (полночь), в последний день месяца.
- `0 0 L 1,2,3,4,5,6,8,9,10,11,12 *`: В 12:00 AM, в последний день месяца, только в январе, феврале, марте, апреле, мае, июне, августе, сентябре, октябре, ноябре и декабре.
- `0 0 L 7 *`: В 12:00 AM, в последний день месяца, только в июле.
- `0 0 L * FRI,SAT`: В 12:00 AM, в последний день месяца, и в пятницу и субботу.
- `0 12 L * *`: В 12:00 PM (после полудня), в последний день месяца.
- `0 7 L * 5`: В 07:00 AM, в последний день месяца, и в пятницу.
- `30 14 L * *`: В 02:30 PM, в последний день месяца.

### Запуск при завершении задания  <Lifecycle status="team,enterprise" />

Чтобы _связать_ задания на развертывание:
1. В разделе **Триггеры** включите опцию **Запуск при завершении другого задания**.
2. Выберите проект, в котором находится задание на развертывание, которое вы хотите запустить после завершения.
3. Укажите вышестоящее (родительское) задание, которое, по завершении, вызовет выполнение вашего задания.
   - Вы также можете использовать [API создания задания](/dbt-cloud/api-v2#/operations/Create%20Job) для этого.
4. В опции **Завершено на** выберите статус(ы) выполнения задания, которые [поставят в очередь](/docs/deploy/job-scheduler#scheduler-queue) задание на развертывание.

<Lightbox src="/img/docs/deploy/deploy-job-completion.jpg" width="100%" title="Пример запуска при завершении задания на странице задания на развертывание"/>

5. Вы можете настроить конфигурацию, при которой вышестоящее задание вызывает выполнение нескольких нижестоящих (дочерних) заданий и заданий в других проектах. У вас должны быть соответствующие [права доступа](/docs/cloud/manage-access/enterprise-permissions#project-role-permissions) к проекту и заданию, чтобы настроить триггер. 

Если другое задание вызывает выполнение вашего задания, вы можете найти ссылку на вышестоящее задание в [разделе деталей выполнения](/docs/deploy/run-visibility#job-run-details).

## Связанные документы

- [Артефакты](/docs/deploy/artifacts)
- [Задания непрерывной интеграции (CI)](/docs/deploy/ci-jobs)
- [Webhook'и](/docs/deploy/webhooks)