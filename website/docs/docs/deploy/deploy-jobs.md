---
title: "Задания развертывания"
description: "Узнайте, как создавать и планировать задания развертывания в dbt для запуска через планировщик. При запуске dbt вы получаете встроенные возможности наблюдаемости, логирования и оповещений."
tags: [scheduler]
---

Вы можете использовать задания развертывания (deploy jobs) для сборки продакшен‑датасетов. Задания развертывания упрощают запуск команд dbt для проекта в вашей облачной платформе данных — по расписанию или в ответ на события. Каждый запуск задания в <Constant name="cloud" /> будет иметь запись в истории запусков задания и подробный обзор выполнения, который предоставляет вам:

- Тип триггера задания
- Commit SHA
- Имя окружения
- Информация об источниках и документации, если применимо
- Подробности выполнения задания, включая время выполнения, [данные о времени выполнения моделей](/docs/deploy/run-visibility#model-timing) и [артефакты](/docs/deploy/artifacts)
- Подробные шаги выполнения с журналами и статусами шагов выполнения

Вы можете создать задание развертывания и настроить его для выполнения в [запланированные дни и время](#schedule-days), ввести [пользовательский cron-расписание](#cron-schedule) или [запустить задание после завершения другого задания](#trigger-on-job-completion).

## Предварительные требования

- У вас должна быть [учетная запись dbt Cloud](https://www.getdbt.com/signup/) и [лицензия на место разработчика](/docs/cloud/manage-access/seats-and-users).
    - Для функции [Запуск по завершению задания](#trigger-on-job-completion) ваша учетная запись dbt Cloud должна быть на [плане Team или Enterprise](https://www.getdbt.com/pricing/).
- У вас должен быть проект dbt, подключенный к [платформе данных](/docs/cloud/connect-data-platform/about-connections).
- У вас должны быть [разрешения на доступ](/docs/cloud/manage-access/about-user-access) для просмотра, создания, изменения или выполнения заданий.
- Вы должны настроить [окружение развертывания](/docs/deploy/deploy-environments).

- У вас должна быть учетная запись [<Constant name="cloud" />](https://www.getdbt.com/signup/) и лицензия [Developer seat](/docs/cloud/manage-access/seats-and-users).
    - Для функции [Trigger on job completion](#trigger-on-job-completion) ваша учетная запись <Constant name="cloud" /> должна быть на тарифном плане [Starter или Enterprise-tier](https://www.getdbt.com/pricing/).
- У вас должен быть проект dbt, подключенный к [платформе данных](/docs/cloud/connect-data-platform/about-connections).
- У вас должны быть [права доступа](/docs/cloud/manage-access/about-user-access) для просмотра, создания, изменения или запуска jobs.
- Вы должны настроить [deployment environment](/docs/deploy/deploy-environments).

1. На странице вашего окружения развертывания нажмите **Create job** > **Deploy job**, чтобы создать новое задание развертывания.
2. Опции в разделе **Job settings**:
    - **Job name** &mdash; Укажите имя для задания развертывания. Например, `Daily build`.
    - (Необязательно) **Description** &mdash; Укажите описание того, что делает задание (например, что задание потребляет и что производит).
    - **Environment** &mdash; По умолчанию установлено на окружение развертывания, из которого вы создали задание развертывания.
3. Опции в разделе **Execution settings**:
    - **Commands** &mdash; По умолчанию включает команду `dbt build`. Нажмите **Add command**, чтобы добавить больше [команд](/docs/deploy/job-commands), которые вы хотите вызвать при выполнении задания.
    - **Generate docs on run** &mdash; Включите эту опцию, если хотите [генерировать документацию проекта](/docs/collaborate/build-and-view-your-docs) при выполнении этого задания развертывания.
    - **Run source freshness** &mdash; Включите эту опцию, чтобы вызвать команду `dbt source freshness` перед выполнением задания развертывания. Подробнее см. в разделе [Актуальность источников](/docs/deploy/source-freshness).
4. Опции в разделе **Triggers**:
    - **Run on schedule** &mdash; Выполнять задание развертывания по установленному расписанию.
        - **Timing** &mdash; Укажите, следует ли [планировать](#schedule-days) задание развертывания с использованием **Интервалов**, которые запускают задание каждые указанное количество часов, **Определенные часы**, которые запускают задание в определенное время дня, или **Cron-расписание**, которое запускает задание, указанное с использованием [синтаксиса cron](#cron-schedule).
        - **Days of the week** &mdash; По умолчанию установлено на каждый день, когда для **Timing** выбраны **Интервалы** или **Определенные часы**.
    - **Run when another job finishes** &mdash; Выполнять задание развертывания, когда другое _вышестоящее_ задание развертывания [завершается](#trigger-on-job-completion).
        - **Project** &mdash; Укажите родительский проект, в котором находится это вышестоящее задание развертывания.
        - **Job** &mdash; Укажите вышестоящее задание развертывания.
        - **Completes on** &mdash; Выберите статус(ы) выполнения задания, которые будут [поставлены в очередь](/docs/deploy/job-scheduler#scheduler-queue) для задания развертывания.

1. На странице вашего deployment environment нажмите **Create job** > **Deploy job**, чтобы создать новый deploy job.  
2. Параметры в разделе **Job settings**:
    - **Job name** &mdash; Укажите имя deploy job. Например, `Daily build`.
    - (Опционально) **Description** &mdash; Добавьте описание того, что делает job (например, какие данные он потребляет и какие результаты производит).
    - **Environment** &mdash; По умолчанию установлен тот deployment environment, из которого вы создаёте deploy job.
3. Параметры в разделе **Execution settings**:
    - [**Commands**](/docs/deploy/job-commands#built-in-commands) &mdash; По умолчанию здесь уже есть команда `dbt build`. Нажмите **Add command**, чтобы добавить дополнительные [commands](/docs/deploy/job-commands), которые должны выполняться при запуске job. Во время выполнения job [built-in commands](/docs/deploy/job-commands#built-in-commands) «связываются» в цепочку, и если какой‑либо шаг завершается с ошибкой, весь job завершается со статусом **Error**.
    - [**Generate docs on run**](/docs/deploy/job-commands#checkbox-commands) &mdash; Включите эту опцию, если хотите [генерировать документацию проекта](/docs/explore/build-and-view-your-docs) при запуске deploy job. Если этот шаг завершится с ошибкой, job всё равно может считаться успешным, если последующие шаги пройдут успешно.
    - [**Run source freshness**](/docs/deploy/job-commands#checkbox-commands) &mdash; Включите эту опцию, чтобы выполнить команду `dbt source freshness` перед запуском deploy job. Если этот шаг завершится с ошибкой, job всё равно может быть успешным при условии, что последующие шаги пройдут успешно. Подробнее см. в разделе [Source freshness](/docs/deploy/source-freshness).
4. Параметры в разделе **Triggers**:
    - **Run on schedule** &mdash; Запускать deploy job по расписанию.
        - **Timing** &mdash; Укажите, как именно [планировать](#schedule-days) запуск deploy job: с помощью **Intervals**, которые запускают job через заданное количество часов, **Specific hours**, которые запускают job в определённое время суток, или **Cron schedule**, которое задаётся с помощью [cron syntax](#cron-schedule).
        - **Days of the week** &mdash; По умолчанию установлено значение «каждый день», если для **Timing** выбран **Intervals** или **Specific hours**.
    - **Run when another job finishes** &mdash; Запускать deploy job, когда другой _upstream_ deploy [job завершается](#trigger-on-job-completion).  
        - **Project** &mdash; Укажите родительский проект, в котором находится upstream deploy job.
        - **Job** &mdash; Укажите upstream deploy job.
        - **Completes on** &mdash; Выберите статус(ы) выполнения job, при которых deploy job будет [поставлен в очередь](/docs/deploy/job-scheduler#scheduler-queue).

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/example-triggers-section.png" width="90%" title="Example of Triggers on the Deploy Job page"/>

5. (Опционально) Параметры в разделе **Advanced settings**:
    - **Environment variables** &mdash; Определите [environment variables](/docs/build/environment-variables), чтобы настроить поведение проекта при запуске deploy job.
    - **Target name** &mdash; Задайте [target name](/docs/build/custom-target-names), чтобы настроить поведение проекта при запуске deploy job. Environment variables и target names часто используются взаимозаменяемо.
    - **Run timeout** &mdash; Отменить deploy job, если время выполнения превышает заданный таймаут.
    - **Compare changes against** &mdash; По умолчанию установлено значение **No deferral**. Выберите **Environment** или **This Job**, чтобы указать <Constant name="cloud" />, с чем следует сравнивать изменения.

    :::info
    Более старые версии <Constant name="cloud" /> позволяют выполнять deferral только к конкретному job, а не к environment. Deferral к job сравнивает состояние с кодом проекта, который был выполнен в последнем успешном запуске этого job. Deferral к environment является более эффективным, так как <Constant name="cloud" /> сравнивает изменения с представлением проекта (которое хранится в `manifest.json`) последнего успешного deploy job, выполненного в этом environment. Поскольку при этом учитываются _все_ deploy jobs, запущенные в отложенном environment, <Constant name="cloud" /> получает более точное и актуальное представление состояния проекта.
    :::

    - **dbt version** &mdash; По умолчанию установлено на наследование [версии dbt](/docs/dbt-versions/core) из окружения. dbt Labs настоятельно рекомендует не изменять настройку по умолчанию. Эта опция изменения версии на уровне задания полезна только при обновлении проекта до следующей версии dbt; в противном случае несоответствие версий между окружением и заданием может привести к запутанному поведению.
    - **Threads** &mdash; По умолчанию установлено на 4 [потока](/docs/core/connect-data-platform/connection-profiles#understanding-threads). Увеличьте количество потоков, чтобы увеличить параллельность выполнения моделей.

    <Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/deploy-job-adv-settings.png" width="90%" title="Пример расширенных настроек на странице задания развертывания"/>

### Дни расписания

Чтобы установить расписание вашего задания, используйте опцию **Run on schedule**, чтобы выбрать конкретные дни недели и выбрать настраиваемые часы или интервалы.

В разделе **Timing** вы можете использовать регулярные интервалы для заданий, которые нужно запускать часто в течение дня, или настраиваемые часы для заданий, которые нужно запускать в определенное время:

- **Интервалы** &mdash; Используйте эту опцию, чтобы установить, как часто выполняется ваше задание, в часах. Например, если вы выберете **Каждые 2 часа**, задание будет выполняться каждые 2 часа с полуночи по UTC. Это не означает, что оно будет выполняться ровно в полночь по UTC. Однако последующие запуски всегда будут выполняться с одинаковым промежутком времени между ними. Например, если предыдущий запланированный конвейер выполнялся в 00:04 по UTC, следующий запуск будет в 02:04 по UTC. Эта опция полезна, если вам нужно выполнять задания несколько раз в день с регулярными интервалами.

- **Определенные часы** &mdash; Используйте эту опцию, чтобы установить конкретное время, когда должно выполняться ваше задание. Вы можете ввести список часов (в UTC), разделенных запятыми, когда вы хотите, чтобы задание выполнялось. Например, если вы установите `0,12,23,`, задание будет выполняться в полночь, в полдень и в 11 вечера по UTC. Запуски заданий всегда будут согласованы как по часам, так и по дням, поэтому, если ваше задание выполняется в 00:05, 12:05 и 23:05 по UTC, оно будет выполняться в эти же часы каждый день. Эта опция полезна, если вы хотите, чтобы ваши задания выполнялись в определенное время дня и не нужно, чтобы они выполнялись чаще, чем раз в день.

:::info

<Constant name="cloud" /> использует [Coordinated Universal Time](https://en.wikipedia.org/wiki/Coordinated_Universal_Time) (UTC) и не выполняет преобразование в ваш конкретный часовой пояс, а также не учитывает переход на летнее/зимнее время. Например:

- 0 означает 12 часов ночи (полночь) по UTC
- 12 означает 12 часов дня (полдень) по UTC
- 23 означает 11 часов вечера по UTC

:::

### Cron-расписание

Чтобы полностью настроить расписание вашего задания, выберите опцию **Cron schedule** и используйте синтаксис cron. С помощью этого синтаксиса вы можете указать минуту, час, день месяца, месяц и день недели, что позволяет вам настроить сложные расписания, такие как выполнение задания в первый понедельник каждого месяца.

**Частота Cron**

Чтобы повысить производительность, частота планирования заданий зависит от тарифного плана <Constant name="cloud" />:

- **Developer plans**: <Constant name="cloud" /> устанавливает минимальный интервал планирования заданий — каждые 10 минут. Это означает, что планирование заданий с более высокой частотой, то есть с интервалом менее 10 минут, не поддерживается.
- **Starter, Enterprise и Enterprise+ plans**: ограничений на частоту выполнения заданий нет.

**Примеры**

Используйте такие инструменты, как [crontab.guru](https://crontab.guru/), чтобы сгенерировать корректный cron‑синтаксис. Этот инструмент позволяет вводить фрагменты cron и получать их перевод на простой человеческий язык. Планировщик заданий <Constant name="cloud" /> поддерживает использование `L` для планирования заданий на последний день месяца.

Примеры расписаний cron-заданий:

- `0 * * * *`: Каждый час, в минуту 0.
- `*/5 * * * *`: Каждые 5 минут. (Недоступно в планах разработчиков)
- `5 4 * * *`: Ровно в 4:05 утра по UTC.
- `30 */4 * * *`: В минуту 30 каждого 4-го часа (например, 4:30 утра, 8:30 утра, 12:30 дня и так далее, все по UTC).
- `0 0 */2 * *`: В 12:00 ночи (полночь) по UTC через день.
- `0 0 * * 1`: В полночь по UTC каждый понедельник.
- `0 0 L * *`: В 12:00 ночи (полночь) в последний день месяца.
- `0 0 L 1,2,3,4,5,6,8,9,10,11,12 *`: В 12:00 ночи в последний день месяца, только в январе, феврале, марте, апреле, мае, июне, августе, сентябре, октябре, ноябре и декабре.
- `0 0 L 7 *`: В 12:00 ночи в последний день месяца, только в июле.
- `0 0 L * FRI,SAT`: В 12:00 ночи в последний день месяца и в пятницу и субботу.
- `0 12 L * *`: В 12:00 дня (полдень) в последний день месяца.
- `0 7 L * 5`: В 07:00 утра в последний день месяца и в пятницу.
- `30 14 L * *`: В 02:30 дня в последний день месяца.

### Триггер по завершению задания <Lifecycle status="self_service,managed,managed_plus" />
Чтобы _сцепить_ (chain) deploy‑задания между собой:

1. В разделе **Triggers** включите опцию **Run when another job finishes**.
2. Выберите проект, в котором находится deploy‑задание, которое нужно запустить после завершения другого задания.
3. Укажите вышестоящее (parent) задание, завершение которого будет триггером для запуска вашего задания.
   - Также вы можете сделать это с помощью [Create Job API](/dbt-cloud/api-v2#/operations/Create%20Job).
4. В опции **Completes on** выберите статус(ы) выполнения задания, при которых deploy‑задание будет добавлено в очередь ([enqueue](/docs/deploy/job-scheduler#scheduler-queue)).

<Lightbox src="/img/docs/deploy/deploy-job-completion.jpg" width="100%" title="Пример запуска по завершению задания на странице задания развертывания"/>

5. Вы можете настроить конфигурацию, в которой вышестоящее задание запускает несколько нижестоящих (дочерних) заданий и заданий в других проектах. У вас должны быть соответствующие [разрешения](/docs/cloud/manage-access/enterprise-permissions#project-role-permissions) на проект и задание для настройки триггера.

Если другое задание запускает ваше задание, вы можете найти ссылку на вышестоящее задание в [разделе деталей выполнения](/docs/deploy/run-visibility#job-run-details).

## Удаление задания

import DeleteJob from '/snippets/_delete-job.md';

<DeleteJob/>

import JobMonitoring from '/snippets/_in-progress-top-jobs.md';

<JobMonitoring />

## История настроек задания

Вы можете просматривать историю изменений настроек задания за последние 90 дней.

Чтобы посмотреть историю изменений:  
1. Перейдите в раздел **Orchestration** в главном меню и нажмите **Jobs**.  
2. Выберите **job name**.  
3. Нажмите **Settings**.  
4. Нажмите **History**.  

<Lightbox src="/img/docs/deploy/job-history.png" width="100%" title="Пример истории настроек задания."/>

## Связанные материалы

- [Артефакты](/docs/deploy/artifacts)
- [Задания непрерывной интеграции (CI)](/docs/deploy/ci-jobs)
- [Вебхуки](/docs/deploy/webhooks)