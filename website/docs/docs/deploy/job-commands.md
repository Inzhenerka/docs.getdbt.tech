---
title: "Команды заданий"
id: "job-commands"
description: "Как использовать команды dbt для задания задач для ваших заданий в dbt Cloud."
---

Задание в dbt Cloud позволяет вам настроить систему для выполнения задания dbt и команд заданий по расписанию, вместо того чтобы запускать команды dbt вручную из командной строки или [IDE](/docs/cloud/dbt-cloud-ide/develop-in-the-cloud). Задание состоит из команд, которые "связываются" друг с другом и выполняются как шаги выполнения. Каждый шаг выполнения может завершиться успешно или с ошибкой, что может определить статус выполнения задания (Успех, Отмена или Ошибка).

Каждое задание позволяет вам:

- Настроить команды задания
- Просмотреть детали выполнения задания, включая время, артефакты и подробные шаги выполнения
- Получить доступ к журналам для просмотра или помощи в отладке проблем и исторических вызовов dbt
- Настроить уведомления и [многое другое](/docs/deploy/deployments#dbt-cloud)

## Типы команд задания

Команды задания — это конкретные задачи, выполняемые заданием, и вы можете настраивать их без проблем, добавляя [команды dbt](/reference/dbt-commands) или используя опцию флажка в разделе **Команды**.

Во время выполнения задания команды "связываются" друг с другом и выполняются как шаги выполнения. Когда вы добавляете команду dbt в разделе **Команды**, вы можете ожидать различных результатов по сравнению с опцией флажка.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/job-commands.gif" width="85%" title="Настройка флажка и списка команд"/>

### Встроенные команды

Каждое выполнение задания автоматически включает команду [`dbt deps`](/reference/commands/deps), что означает, что вам не нужно добавлять ее в список **Команд** в настройках вашего задания. Вы также заметите, что каждое задание будет включать шаг выполнения для повторного клонирования вашего репозитория и подключения к вашей платформе данных, что может повлиять на статус вашего задания, если эти шаги выполнения не будут успешными.

**Результат задания** &mdash; Во время выполнения задания встроенные команды "связываются" друг с другом. Это означает, что если один из шагов выполнения в цепочке завершится с ошибкой, то последующие команды не будут выполнены, и все задание завершится с ошибкой со статусом "Ошибка".

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/fail-dbtdeps.png" width="85%" title="Неудачное задание, которое завершилось с ошибкой во время шага выполнения dbt deps."/>

### Команды с флажками

Для каждого задания у вас есть возможность выбрать флажки [Генерировать документацию при выполнении](/docs/collaborate/build-and-view-your-docs) или [Проверить свежесть источника](/docs/deploy/source-freshness), что позволяет вам автоматически выполнять команды.

**Результат задания для флажка Генерировать документацию при выполнении** &mdash; dbt Cloud выполняет команду `dbt docs generate` _после_ перечисленных команд. Если этот конкретный шаг выполнения в вашем задании завершится с ошибкой, задание все равно может завершиться успешно, если все последующие шаги выполнения будут успешными. Читайте [Настройка задания документации](/docs/collaborate/build-and-view-your-docs) для получения дополнительной информации.

**Результат задания для флажка Проверить свежесть источника** &mdash; dbt Cloud выполняет команду `dbt source freshness` как первый шаг выполнения в вашем задании. Если этот конкретный шаг выполнения в вашем задании завершится с ошибкой, задание все равно может завершиться успешно, если все последующие шаги выполнения будут успешными. Читайте [Свежесть источника](/docs/deploy/source-freshness) для получения дополнительной информации.

### Список команд

Вы можете добавлять или удалять столько команд dbt, сколько необходимо для каждого задания. Однако вам нужно иметь хотя бы одну команду dbt. Есть несколько команд, указанных как "dbt Cloud CLI" или "dbt Core" на странице [Справочник команд dbt](/reference/dbt-commands). Это означает, что они предназначены для использования в dbt Core или dbt Cloud CLI, а не в dbt Cloud IDE.

:::tip Использование селекторов

Используйте [селекторы](/reference/node-selection/syntax) как мощный способ выбирать и выполнять части вашего проекта во время выполнения задания. Например, чтобы запустить тесты для `one_specific_model`, используйте селектор: `dbt test --select one_specific_model`. Задание все равно будет выполняться, если селектор не соответствует ни одной модели.

:::

#### Пользовательские команды для сравнения изменений
Для пользователей, у которых включена функция Advanced CI [сравнение изменений](/docs/deploy/advanced-ci#compare-changes) и выбрана опция **dbt compare**, вы можете добавить пользовательские команды dbt для оптимизации выполнения сравнения (например, чтобы исключить конкретные большие модели или группы моделей с тегами). Выполнение сравнений на больших моделях может значительно увеличить время, необходимое для завершения CI заданий.

<Lightbox src="/img/docs/deploy/dbt-compare.jpg" width="90%" title="Добавьте пользовательские команды dbt при использовании dbt compare." />

Следующие примеры подчеркивают, как вы можете настроить поле команды dbt compare:

- Исключите большую модель `fct_orders` из сравнения, чтобы запустить CI задание на меньшем количестве или меньших моделях и сократить время/потребление ресурсов задания. Используйте следующую команду:
  
  ```sql
  --select state:modified --exclude fct_orders
  ```
- Исключите модели на основе тегов для сценариев, когда модели имеют общую функцию или характеристику. Используйте следующую команду:

   ```sql 
      --select state modified --exclude tag:tagname_a tag:tagname_b
   ```
- Включите модели, которые были непосредственно изменены, а также те, которые находятся на один шаг ниже, используя селектор `modified+1`. Используйте следующую команду:
  ```sql
  --select state:modified+1
  ```

#### Результат задания
Во время выполнения задания команды "связываются" друг с другом и выполняются как шаги выполнения. Если один из шагов выполнения в цепочке завершится с ошибкой, то последующие шаги не будут выполнены, и задание завершится с ошибкой.

На следующем примере изображение первые четыре шага выполнения успешны. Однако, если пятый шаг выполнения (`dbt run --select state:modified+ --full-refresh --fail-fast`) завершится с ошибкой, то последующие шаги выполнения не будут выполнены, и все задание завершится с ошибкой. Неудачное задание возвращает ненулевой [код выхода](/reference/exit-codes) и статус "Ошибка":

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/skipped-jobs.jpg" width="85%" title="Неудачное выполнение задания, которое завершилось с ошибкой во время шага выполнения"/>

## Ошибки команд задания

Ошибки команд задания могут означать разные вещи для разных команд. Некоторые распространенные причины, по которым команда задания может завершиться с ошибкой:

- **Ошибка на `dbt run`** &mdash; [`dbt run`](/reference/commands/run) выполняет скомпилированные SQL файлы моделей против текущей целевой базы данных. Он завершится с ошибкой, если в любой из построенных моделей есть ошибка. Тесты на вышестоящих ресурсах предотвращают выполнение нижестоящих ресурсов, и неудачный тест пропустит их.

- **Ошибка на `dbt test`** &mdash;  [`dbt test`](/reference/commands/test) выполняет тесты, определенные для моделей, источников, снимков и семян. Тест может пройти, завершиться с ошибкой или выдать предупреждение в зависимости от его [серьезности](/reference/resource-configs/severity). Если вы не установили [предупреждения как ошибки](/reference/global-configs/warnings), только ошибка остановит следующий шаг.

- **Ошибка на `dbt build`** &mdash; [`dbt build`](/reference/commands/build) выполняет модели, тесты, снимки и семена. Эта команда выполняет ресурсы в порядке, указанном в DAG. Если любой вышестоящий ресурс завершится с ошибкой, все нижестоящие ресурсы будут пропущены, и команда завершится с кодом ошибки 1.

- **Ошибки селекторов**
   - Если [`select`](/reference/node-selection/set-operators) соответствует нескольким узлам, и один из узлов завершится с ошибкой, то задание получит код выхода `1`, и последующая команда завершится с ошибкой. Если вы указали флаг [`—fail-fast`](/reference/global-configs/failing-fast), то первая ошибка остановит все соединение для любых моделей, которые находятся в процессе.

   - Если селектор не соответствует ни одному узлу, это не считается ошибкой.


## Связанные документы
- [Лучшие практики создания заданий](https://discourse.getdbt.com/t/job-creation-best-practices-in-dbt-cloud-feat-my-moms-lasagna/2980)
- [Справочник команд dbt](/reference/dbt-commands)
- [Уведомления о заданиях](/docs/deploy/job-notifications)
- [Свежесть источника](/docs/deploy/source-freshness)
- [Создание и просмотр вашей документации](/docs/collaborate/build-and-view-your-docs)