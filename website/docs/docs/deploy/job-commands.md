---
title: "Команды заданий"
id: "job-commands"
description: "Как использовать команды dbt для настройки задач в ваших заданиях dbt Cloud."
---

Производственное задание в dbt Cloud позволяет настроить систему для выполнения задания dbt и команд задания по расписанию, вместо того чтобы запускать команды dbt вручную из командной строки или [IDE](/docs/cloud/dbt-cloud-ide/develop-in-the-cloud). Задание состоит из команд, которые "связываются" вместе и выполняются как шаги выполнения. Каждый шаг выполнения может быть успешным или неудачным, что может определить статус выполнения задания (Успех, Отмена или Ошибка).

Каждое задание позволяет вам:

- Настраивать команды задания
- Просматривать детали выполнения задания, включая время, артефакты и подробные шаги выполнения
- Получать доступ к журналам для просмотра или помощи в отладке проблем и исторических вызовов dbt
- Настраивать уведомления и [другое](/docs/deploy/deployments#dbt-cloud)

## Типы команд заданий

Команды заданий — это конкретные задачи, выполняемые заданием, и вы можете настроить их без проблем, добавляя [команды dbt](/reference/dbt-commands) или используя опцию флажка в разделе **Commands**.

Во время выполнения задания команды "связываются" вместе и выполняются как шаги выполнения. Когда вы добавляете команду dbt в разделе **Commands**, вы можете ожидать различных результатов по сравнению с опцией флажка.

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/job-commands.gif" width="85%" title="Настройка флажков и списка команд"/>

### Встроенные команды

Каждый вызов задания автоматически включает команду [`dbt deps`](/reference/commands/deps), что означает, что вам не нужно добавлять ее в список **Commands** в настройках вашего задания. Вы также заметите, что каждое задание будет включать шаг выполнения для повторного клонирования вашего репозитория и подключения к вашей платформе данных, что может повлиять на статус вашего задания, если эти шаги выполнения не будут успешными.

**Результат задания** &mdash; Во время выполнения задания встроенные команды "связываются" вместе. Это означает, что если один из шагов выполнения в цепочке не удается, то следующие команды не выполняются, и все задание завершается с ошибкой "Ошибка".

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/fail-dbtdeps.png" width="85%" title="Неудачное задание, в котором произошла ошибка во время шага выполнения dbt deps."/>

### Команды с флажками

Для каждого задания у вас есть возможность выбрать флажки [Generate docs on run](/docs/collaborate/build-and-view-your-docs) или [Run source freshness](/docs/deploy/source-freshness), позволяя вам автоматически выполнять команды.

**Результат задания с флажком Generate docs on run** &mdash; dbt Cloud выполняет команду `dbt docs generate` _после_ перечисленных команд. Если этот конкретный шаг выполнения в вашем задании не удается, задание все равно может быть успешным, если все последующие шаги выполнения успешны. Подробнее читайте в разделе [Настройка задания документации](/docs/collaborate/build-and-view-your-docs).

**Результат задания с флажком Source freshness** &mdash; dbt Cloud выполняет команду `dbt source freshness` как первый шаг выполнения в вашем задании. Если этот конкретный шаг выполнения в вашем задании не удается, задание все равно может быть успешным, если все последующие шаги выполнения успешны. Подробнее читайте в разделе [Source freshness](/docs/deploy/source-freshness).

### Список команд

Вы можете добавлять или удалять столько команд dbt, сколько необходимо для каждого задания. Однако вам нужно иметь хотя бы одну команду dbt. На странице [справки по командам dbt](/reference/dbt-commands) перечислены несколько команд как "dbt Cloud CLI" или "dbt Core". Это означает, что они предназначены для использования в dbt Core или dbt Cloud CLI, а не в dbt Cloud IDE.

:::tip Использование селекторов

Используйте [селекторы](/reference/node-selection/syntax) как мощный способ выбора и выполнения частей вашего проекта во время выполнения задания. Например, чтобы запустить тесты для `one_specific_model`, используйте селектор: `dbt test --select one_specific_model`. Задание все равно будет выполнено, если селектор не соответствует ни одной модели.

:::

#### Сравнение изменений с пользовательскими командами
Для пользователей, у которых включена функция Advanced CI [сравнения изменений](/docs/deploy/advanced-ci#compare-changes) и выбран флажок **dbt compare**, вы можете добавить пользовательские команды dbt для оптимизации выполнения сравнения (например, чтобы исключить конкретные большие модели или группы моделей с тегами). Сравнение больших моделей может значительно увеличить время выполнения CI-заданий.

<Lightbox src="/img/docs/deploy/dbt-compare.jpg" width="90%" title="Добавление пользовательских команд dbt при использовании dbt compare." />

Следующие примеры показывают, как вы можете настроить поле команды dbt compare:

- Исключите большую модель `fct_orders` из сравнения, чтобы выполнить CI-задание на меньшем количестве или меньших моделях и сократить время/ресурсы задания. Используйте следующую команду:
  
  ```sql
  --select state:modified --exclude fct_orders
  ```
- Исключите модели на основе тегов для сценариев, когда модели имеют общую функцию или характеристику. Используйте следующую команду:

   ```sql 
      --select state modified --exclude tag:tagname_a tag:tagname_b
   ```
- Включите модели, которые были непосредственно изменены, а также те, которые находятся на один шаг ниже по потоку, используя селектор `modified+1`. Используйте следующую команду:
  ```sql
  --select state:modified+1
  ```

#### Результат задания
Во время выполнения задания команды "связываются" вместе и выполняются как шаги выполнения. Если один из шагов выполнения в цепочке не удается, то последующие шаги не выполняются, и задание завершится неудачей.

На следующем изображении примера первые четыре шага выполнения успешны. Однако, если пятый шаг выполнения (`dbt run --select state:modified+ --full-refresh --fail-fast`) не удается, то следующие шаги выполнения не выполняются, и все задание завершается неудачей. Неудачное задание возвращает ненулевой [код выхода](/reference/exit-codes) и статус задания "Ошибка":

<Lightbox src="/img/docs/dbt-cloud/using-dbt-cloud/skipped-jobs.jpg" width="85%" title="Неудачное выполнение задания, в котором произошла ошибка во время шага выполнения"/>

## Неудачи команд заданий

Неудачи команд заданий могут означать разные вещи для разных команд. Некоторые общие причины, по которым команда задания может не выполниться:

- **Неудача при `dbt run`** &mdash; [`dbt run`](/reference/commands/run) выполняет скомпилированные файлы моделей SQL в текущей целевой базе данных. Он завершится неудачей, если в любой из построенных моделей возникнет ошибка. Тесты на вышестоящих ресурсах предотвращают выполнение нижестоящих ресурсов, и неудачный тест пропустит их.

- **Неудача при `dbt test`** &mdash; [`dbt test`](/reference/commands/test) запускает тесты, определенные на моделях, источниках, снимках и семенах. Тест может пройти, не пройти или предупредить в зависимости от его [серьезности](/reference/resource-configs/severity). Если вы не установили [предупреждения как ошибки](/reference/global-configs/warnings), только ошибка остановит следующий шаг.

- **Неудача при `dbt build`** &mdash; [`dbt build`](/reference/commands/build) запускает модели, тесты, снимки и семена. Эта команда выполняет ресурсы в порядке, указанном в DAG. Если любой вышестоящий ресурс не удается, все нижестоящие ресурсы пропускаются, и команда завершает работу с кодом ошибки 1.

- **Неудачи селекторов**
   - Если [`select`](/reference/node-selection/set-operators) соответствует нескольким узлам и один из узлов не удается, то задание будет иметь код выхода `1`, и последующая команда не удастся. Если вы указали флаг [`—fail-fast`](/reference/global-configs/failing-fast), то первая неудача остановит все соединение для любых моделей, которые находятся в процессе выполнения.

   - Если селектор не соответствует ни одному узлу, это не считается неудачей.

## Связанные документы
- [Лучшие практики создания заданий](https://discourse.getdbt.com/t/job-creation-best-practices-in-dbt-cloud-feat-my-moms-lasagna/2980)
- [Справка по командам dbt](/reference/dbt-commands)
- [Уведомления о заданиях](/docs/deploy/job-notifications)
- [Source freshness](/docs/deploy/source-freshness)
- [Создание и просмотр ваших документов](/docs/collaborate/build-and-view-your-docs)