---
title: "Быстрый старт с семантическим слоем dbt Cloud и Snowflake"
id: sl-snowflake-qs
description: "Используйте это руководство для создания и определения метрик, настройки семантического слоя dbt Cloud и их запроса с помощью Google Sheets."
sidebar_label: "Быстрый старт с семантическим слоем dbt и Snowflake"
meta:
  api_name: dbt Semantic Layer APIs
icon: 'guides'
hide_table_of_contents: true
tags: ['Semantic Layer', 'Snowflake', 'dbt Cloud','Quickstart']
keywords: ['dbt Semantic Layer','Metrics','dbt Cloud', 'Snowflake', 'Google Sheets']
level: 'Intermediate'
recently_updated: true
---

## Введение

[Семантический слой dbt](/docs/use-dbt-semantic-layer/dbt-sl), работающий на базе [MetricFlow](/docs/build/about-metricflow), упрощает настройку ключевых бизнес-метрик. Он централизует определения, избегает дублирования кода и обеспечивает легкий доступ к метрикам в последующих инструментах. MetricFlow помогает легче управлять метриками компании, позволяя вам определять метрики в вашем проекте dbt и запрашивать их в dbt Cloud с помощью [команд MetricFlow](/docs/build/metricflow-commands).

Этот гид по быстрому старту предназначен для пользователей dbt Cloud, использующих Snowflake в качестве своей платформы данных. Он сосредоточен на создании и определении метрик, настройке семантического слоя dbt в проекте dbt Cloud и запросе метрик в Google Sheets.

**Для пользователей на других платформах данных**

Если вы используете платформу данных, отличную от Snowflake, это руководство также применимо к вам. Вы можете адаптировать настройку для вашей конкретной платформы, следуя инструкциям по настройке учетной записи и загрузке данных, изложенным в следующих вкладках для каждой соответствующей платформы.

Остальная часть этого руководства применима ко всем поддерживаемым платформам, обеспечивая полное использование семантического слоя dbt.

## Предварительные требования

- Вам нужен аккаунт [dbt Cloud](https://www.getdbt.com/signup/) Trial, Team или Enterprise для всех развертываний. Свяжитесь с вашим представителем для настройки Single-tenant; в противном случае создайте аккаунт, используя это руководство.
- Иметь правильную [лицензию dbt Cloud](/docs/cloud/manage-access/seats-and-users) и [разрешения](/docs/cloud/manage-access/enterprise-permissions) в зависимости от вашего плана:
  <DetailsToggle alt_header="Подробнее о лицензии и разрешениях">  
  
  - Enterprise &mdash; Лицензия разработчика с разрешениями администратора аккаунта. Или "Владелец" с лицензией разработчика, назначенный создателем проекта, администратором базы данных или администратором.
  - Team &mdash; Доступ "Владелец" с лицензией разработчика.
  - Trial &mdash; Автоматический доступ "Владелец" в рамках пробной версии плана Team.
  
  </DetailsToggle>

- Создайте [пробный аккаунт Snowflake](https://signup.snowflake.com/):
  - Выберите издание Enterprise Snowflake с доступом ACCOUNTADMIN. Учитывайте организационные вопросы при выборе облачного провайдера, обратитесь к [Введению в облачные платформы](https://docs.snowflake.com/en/user-guide/intro-cloud-platforms) Snowflake.
  - Выберите облачного провайдера и регион. Все облачные провайдеры и регионы будут работать, поэтому выберите тот, который вам больше нравится.
- Базовое понимание SQL и dbt. Например, вы уже использовали dbt или прошли курс [Основы dbt](https://learn.getdbt.com/courses/dbt-fundamentals).

### Чему вы научитесь

Это руководство охватывает следующие темы:

- [Создание нового рабочего листа Snowflake и настройка вашей среды](/guides/sl-snowflake-qs?step=3)
- [Загрузка образцов данных в ваш аккаунт Snowflake](/guides/sl-snowflake-qs?step=4)
- [Подключение dbt Cloud к Snowflake](/guides/sl-snowflake-qs?step=5)
- [Настройка управляемого репозитория dbt Cloud](/guides/sl-snowflake-qs?step=6)
- [Инициализация проекта dbt Cloud и начало разработки](/guides/sl-snowflake-qs?step=7)
- [Создание вашего проекта dbt Cloud](/guides/sl-snowflake-qs?step=8)
- [Создание семантической модели в dbt Cloud](/guides/sl-snowflake-qs?step=9)
- [Определение метрик в dbt Cloud](/guides/sl-snowflake-qs?step=10)
- [Добавление второй семантической модели](/guides/sl-snowflake-qs?step=11)
- [Тестирование и запрос метрик в dbt Cloud](/guides/sl-snowflake-qs?step=12)
- [Запуск производственного задания в dbt Cloud](/guides/sl-snowflake-qs?step=13)
- [Настройка семантического слоя dbt в dbt Cloud](/guides/sl-snowflake-qs?step=14)
- [Подключение и запрос метрик с помощью Google Sheets](/guides/sl-snowflake-qs?step=15)

## Создание нового рабочего листа Snowflake и настройка среды

1. Войдите в свой [пробный аккаунт Snowflake](https://signup.snowflake.com).
2. В пользовательском интерфейсе Snowflake (UI) нажмите **+ Worksheet** в правом верхнем углу.
3. Выберите **SQL Worksheet**, чтобы создать новый рабочий лист.

### Настройка среды Snowflake

Данные, используемые здесь, хранятся в виде CSV-файлов в общедоступном S3-бакете, и следующие шаги помогут вам подготовить ваш аккаунт Snowflake для этих данных и загрузить их.

Создайте новый виртуальный склад, две новые базы данных (одну для необработанных данных, другую для будущей разработки dbt) и две новые схемы (одну для данных `jaffle_shop`, другую для данных `stripe`).

1. Выполните следующие SQL-команды одну за другой, вводя их в редакторе вашего нового рабочего листа SQL Snowflake, чтобы настроить вашу среду.

2. Нажмите **Run** в правом верхнем углу пользовательского интерфейса для каждой из них:

```sql
-- Создайте виртуальный склад с именем 'transforming'
create warehouse transforming;

-- Создайте две базы данных: одну для необработанных данных и другую для аналитики
create database raw;
create database analytics;

-- В базе данных 'raw' создайте две схемы: 'jaffle_shop' и 'stripe'
create schema raw.jaffle_shop;
create schema raw.stripe;
```

## Загрузка данных в Snowflake

Теперь, когда ваша среда настроена, вы можете начать загрузку данных в нее. Вы будете работать в базе данных raw, используя схемы `jaffle_shop` и `stripe` для организации ваших таблиц.

1. Создайте таблицу клиентов. Сначала удалите все содержимое (очистите) в редакторе рабочего листа Snowflake. Затем выполните эту SQL-команду, чтобы создать таблицу клиентов в схеме `jaffle_shop`:

  ```sql
  create table raw.jaffle_shop.customers
  ( id integer,
    first_name varchar,
    last_name varchar
  );
  ```

  Вы должны увидеть сообщение «Таблица `CUSTOMERS` успешно создана».

2. Загрузите данные. После создания таблицы удалите все содержимое в редакторе. Выполните эту команду, чтобы загрузить данные из S3-бакета в таблицу клиентов:

  ```sql
  copy into raw.jaffle_shop.customers (id, first_name, last_name)
  from 's3://dbt-tutorial-public/jaffle_shop_customers.csv'
  file_format = (
      type = 'CSV'
      field_delimiter = ','
      skip_header = 1
      );
  ```

  Вы должны увидеть подтверждающее сообщение после выполнения команды.

3. Создайте таблицу `orders`. Удалите все содержимое в редакторе. Выполните следующую команду, чтобы создать...

  ```sql
  create table raw.jaffle_shop.orders
  ( id integer,
    user_id integer,
    order_date date,
    status varchar,
    _etl_loaded_at timestamp default current_timestamp
  );
  ```

  Вы должны увидеть подтверждающее сообщение после выполнения команды.

4. Загрузите данные. Удалите все содержимое в редакторе, затем выполните эту команду, чтобы загрузить данные в таблицу заказов:

  ```sql
  copy into raw.jaffle_shop.orders (id, user_id, order_date, status)
  from 's3://dbt-tutorial-public/jaffle_shop_orders.csv'
  file_format = (
      type = 'CSV'
      field_delimiter = ','
      skip_header = 1
      );
  ```

  Вы должны увидеть подтверждающее сообщение после выполнения команды.

5. Создайте таблицу `payment`. Удалите все содержимое в редакторе. Выполните следующую команду, чтобы создать таблицу платежей:

  ```sql
  create table raw.stripe.payment
  ( id integer,
    orderid integer,
    paymentmethod varchar,
    status varchar,
    amount integer,
    created date,
    _batched_at timestamp default current_timestamp
  );
  ```

  Вы должны увидеть подтверждающее сообщение после выполнения команды.

6. Загрузите данные. Удалите все содержимое в редакторе. Выполните следующую команду, чтобы загрузить данные в таблицу платежей:

  ```sql
  copy into raw.stripe.payment (id, orderid, paymentmethod, status, amount, created)
  from 's3://dbt-tutorial-public/stripe_payments.csv'
  file_format = (
      type = 'CSV'
      field_delimiter = ','
      skip_header = 1
      );
  ```

  Вы должны увидеть подтверждающее сообщение после выполнения команды.

7. Проверьте данные. Убедитесь, что данные загружены, выполнив эти SQL-запросы. Подтвердите, что вы видите вывод для каждого из них, как на следующем изображении подтверждения.

  ```sql
  select * from raw.jaffle_shop.customers;
  select * from raw.jaffle_shop.orders;
  select * from raw.stripe.payment;
  ```

  <Lightbox src="/img/docs/dbt-cloud/semantic-layer/sl-snowflake-confirm.jpg" width="90%" title="Изображение показывает вывод подтверждения Snowflake, когда данные загружены правильно в редакторе." />

## Подключение dbt Cloud к Snowflake

Существует два способа подключения dbt Cloud к Snowflake. Первый вариант — Partner Connect, который предоставляет упрощенную настройку для создания вашего аккаунта dbt Cloud из вашего нового пробного аккаунта Snowflake. Второй вариант — создать ваш аккаунт dbt Cloud отдельно и самостоятельно настроить подключение к Snowflake (подключение вручную). Если вы хотите быстро начать, dbt Labs рекомендует использовать Partner Connect. Если вы хотите настроить все с самого начала и ознакомиться с процессом настройки dbt Cloud, dbt Labs рекомендует подключение вручную.

## Настройка управляемого репозитория dbt Cloud

Если вы использовали Partner Connect, вы можете перейти к [инициализации вашего проекта dbt](#initialize-your-dbt-project-and-start-developing), так как Partner Connect предоставляет вам [управляемый репозиторий](/docs/collaborate/git/managed-repository). В противном случае вам нужно будет создать ваше подключение к репозиторию.

## Инициализация вашего проекта dbt и начало разработки

Это руководство предполагает, что вы используете [IDE dbt Cloud](/docs/cloud/dbt-cloud-ide/develop-in-the-cloud) для разработки вашего проекта dbt, определения метрик и запроса и предварительного просмотра метрик с помощью [команд MetricFlow](/docs/build/metricflow-commands).

Теперь, когда у вас настроен репозиторий, вы можете инициализировать ваш проект и начать разработку в dbt Cloud, используя IDE:

1. Нажмите **Начать разработку в IDE dbt Cloud**. Это может занять несколько минут, так как ваш проект впервые запускается, устанавливая соединение с git, клонируя ваш репозиторий и тестируя соединение с хранилищем.
2. Над деревом файлов слева нажмите **Инициализировать ваш проект**. Это создаст структуру папок с примерами моделей.
3. Сделайте ваш первый коммит, нажав **Коммит и синхронизация**. Используйте сообщение коммита `initial commit`. Это создаст первый коммит в вашем управляемом репозитории и позволит вам открыть ветку, где вы можете добавить новый код dbt.
4. Теперь вы можете напрямую запрашивать данные из вашего хранилища и выполнять `dbt run`. Вы можете попробовать это сейчас:
    - Удалите папку models/examples в **Проводнике файлов**.
    - Нажмите **+ Создать новый файл**, добавьте этот запрос в новый файл и нажмите **Сохранить как**, чтобы сохранить новый файл:
      ```sql
      select * from raw.jaffle_shop.customers
      ```
    - В командной строке внизу введите dbt run и нажмите Enter. Вы должны увидеть сообщение о успешном выполнении dbt run.

## Создание вашего проекта dbt

Следующий шаг — построить ваш проект. Это включает добавление источников, моделей стадий, бизнес-определенных сущностей и пакетов в ваш проект.

### Добавление источников

[Источники](/docs/build/sources) в dbt — это необработанные таблицы данных, которые вы будете преобразовывать. Организуя определения источников, вы документируете происхождение ваших данных. Это также делает ваш проект и трансформацию более надежными, структурированными и понятными.

У вас есть два варианта работы с файлами в IDE dbt Cloud:

- **Создать новую ветку (рекомендуется)** &mdash; Создайте новую ветку, чтобы редактировать и коммитить ваши изменения. Перейдите в **Управление версиями** на левой боковой панели и нажмите **Создать ветку**.
- **Редактировать в защищенной основной ветке** &mdash; Если вы предпочитаете редактировать, форматировать или проверять файлы и выполнять команды dbt непосредственно в вашей основной ветке git, используйте этот вариант. IDE dbt Cloud предотвращает коммиты в защищенную ветку, поэтому вам будет предложено коммитить ваши изменения в новую ветку.

Назовите новую ветку `build-project`.

1. Наведите курсор на директорию `models` и нажмите на меню с тремя точками (**...**), затем выберите **Создать файл**.
2. Назовите файл `staging/jaffle_shop/src_jaffle_shop.yml`, затем нажмите **Создать**.
3. Скопируйте следующий текст в файл и нажмите **Сохранить**.

### Добавление моделей стадий

[Модели стадий](/best-practices/how-we-structure/2-staging) — это первый шаг преобразования в dbt. Они очищают и подготавливают ваши необработанные данные, делая их готовыми для более сложных преобразований и анализов. Следуйте этим шагам, чтобы добавить ваши модели стадий в ваш проект.

### Добавление бизнес-определенных сущностей

Этот этап включает создание [моделей, которые служат слоем сущностей или концептуальным слоем вашего проекта dbt](/best-practices/how-we-structure/4-marts), делая данные готовыми для отчетности и анализа. Он также включает добавление [пакетов](/docs/build/packages) и [временной оси MetricFlow](/docs/build/metricflow-time-spine), которые расширяют функциональность dbt.

Этот этап является [слоем рынков](/best-practices/how-we-structure/1-guide-overview#guide-structure-overview), который объединяет модульные части в широкое, богатое видение сущностей, которые важны для организации.

## Создание семантических моделей

[Семантические модели](/docs/build/semantic-models) содержат множество типов объектов (таких как сущности, меры и измерения), которые позволяют MetricFlow строить запросы для определения метрик.

- Каждая семантическая модель будет 1:1 с моделью dbt SQL/Python.
- Каждая семантическая модель будет содержать (в лучшем случае) 1 основную или естественную сущность.
- Каждая семантическая модель будет содержать ноль, одну или много внешних или уникальных сущностей, используемых для соединения с другими сущностями.
- Каждая семантическая модель может также содержать измерения, меры и метрики. Это то, что фактически передается и запрашивается вашим последующим инструментом BI.

В следующих шагах семантические модели позволяют вам определить, как интерпретировать данные, связанные с заказами. Они включают сущности (например, столбцы ID, служащие ключами для соединения данных), измерения (для группировки или фильтрации данных) и меры (для агрегации данных).

### Сущности

[Сущности](/docs/build/semantic-models#entities) — это концепция реального мира в бизнесе, служащая основой вашей семантической модели. Это будут столбцы ID (например, `order_id`) в наших семантических моделях. Они будут служить ключами соединения с другими семантическими моделями.

### Измерения

[Измерения](/docs/build/semantic-models#entities) — это способ группировки или фильтрации информации на основе категорий или времени.

### Меры

[Меры](/docs/build/semantic-models#measures) — это агрегации, выполняемые над столбцами в вашей модели. Часто вы будете использовать их как конечные метрики сами по себе. Меры также могут служить строительными блоками для более сложных метрик.

## Определение метрик

[Метрики](/docs/build/metrics-overview) — это язык, на котором говорят ваши бизнес-пользователи и измеряют производительность бизнеса. Они представляют собой агрегацию над столбцом в вашем хранилище, которую вы обогащаете срезами измерений.

Существуют различные типы метрик, которые вы можете настроить:

- [Метрики конверсии](/docs/build/conversion) &mdash; Отслеживают, когда базовое событие и последующее событие конверсии происходят для сущности в течение заданного периода времени.
- [Кумулятивные метрики](/docs/build/metrics-overview#cumulative-metrics) &mdash; Агрегируют меру за заданное окно. Если окно не указано, окно будет накапливать меру за весь записанный период времени. Обратите внимание, что вы должны создать модель временной оси перед добавлением кумулятивных метрик.
- [Производные метрики](/docs/build/metrics-overview#derived-metrics) &mdash; Позволяют выполнять вычисления на основе метрик.
- [Простые метрики](/docs/build/metrics-overview#simple-metrics) &mdash; Непосредственно ссылаются на одну меру без участия дополнительных мер.
- [Метрики отношения](/docs/build/metrics-overview#ratio-metrics) &mdash; Включают числитель и знаменатель метрики. Строка ограничения может быть применена как к числителю, так и к знаменателю, или отдельно к числителю или знаменателю.

## Добавление второй семантической модели в ваш проект

Отличная работа, вы успешно создали вашу первую семантическую модель! Она содержит все необходимые элементы: сущности, измерения, меры и метрики.

Давайте расширим аналитические возможности вашего проекта, добавив еще одну семантическую модель в вашу другую модель рынков, такую как: `dim_customers.yml`.

## Тестирование и запрос метрик

## Запуск производственного задания

## Настройка семантического слоя dbt

## Запрос семантического слоя

Эта страница поможет вам подключиться и использовать следующие интеграции для запроса ваших метрик:

- [Подключение и запрос с помощью Google Sheets](#connect-and-query-with-google-sheets)
- [Подключение и запрос с помощью Hex](#connect-and-query-with-hex)

Семантический слой dbt позволяет вам подключаться и запрашивать ваши метрики с помощью различных доступных инструментов, таких как Google Sheets, Hex, Tableau и другие.

Запрашивайте метрики, используя другие инструменты, такие как [интеграции первого класса](/docs/cloud-integrations/avail-sl-integrations), [API семантического слоя](/docs/dbt-cloud-apis/sl-api-overview) и [экспорты](/docs/use-dbt-semantic-layer/exports), чтобы раскрыть таблицы метрик и измерений в вашей платформе данных и создать пользовательскую интеграцию с такими инструментами, как PowerBI.

### Подключение и запрос с помощью Google Sheets

### Подключение и запрос с помощью Hex

## Что дальше

Отличная работа по завершению комплексного руководства по семантическому слою dbt 🎉! Надеюсь, вы получили четкое представление о том, что такое семантический слой dbt, его назначение и когда его использовать в ваших проектах.

Вы узнали, как:

- Настроить вашу среду Snowflake и dbt Cloud, включая создание рабочих листов и загрузку данных.
- Подключить и настроить dbt Cloud с Snowflake.
- Создавать, тестировать и управлять проектами dbt Cloud, сосредотачиваясь на метриках и семантических слоях.
- Запускать производственные задания и запрашивать метрики с помощью наших доступных интеграций.

Для следующих шагов вы можете начать определять свои собственные метрики и изучать дополнительные параметры конфигурации, такие как [экспорты](/docs/use-dbt-semantic-layer/exports), [заполнение нулевых значений](/docs/build/advanced-topics), [реализация dbt Mesh с семантическим слоем](/docs/use-dbt-semantic-layer/sl-faqs#how-can-i-implement-dbt-mesh-with-the-dbt-semantic-layer) и многое другое.

Вот некоторые дополнительные ресурсы, которые помогут вам продолжить ваше путешествие:

- [Часто задаваемые вопросы о семантическом слое dbt](/docs/use-dbt-semantic-layer/sl-faqs)
- [Доступные интеграции](/docs/cloud-integrations/avail-sl-integrations)
- Демонстрация [как определять и запрашивать метрики с MetricFlow](https://www.loom.com/share/60a76f6034b0441788d73638808e92ac?sid=861a94ac-25eb-4fd8-a310-58e159950f5a)
- [Присоединяйтесь к нашим живым демонстрациям](https://www.getdbt.com/resources/webinars/dbt-cloud-demos-with-experts)