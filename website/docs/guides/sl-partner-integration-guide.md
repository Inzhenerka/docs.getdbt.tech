---
title: "Интеграция с семантическим слоем dbt с использованием лучших практик" 
id: "sl-partner-integration-guide"
description: Узнайте о рекомендациях по интеграции с партнерами, дорожной карте и подключении. 
hoverSnippet: Узнайте, как интегрироваться с семантическим слоем, используя лучшие практики
# time_to_complete: '30 минут' закомментировано до тестирования
icon: 'guides'
hide_table_of_contents: true
tags: ['Семантический слой','Лучшие практики']
level: 'Продвинутый'
recently_updated: true
---

<div style={{maxWidth: '900px'}}>

## Введение

Чтобы интегрировать ваш инструмент в мир семантического слоя, dbt Labs предлагает некоторые рекомендации по лучшим практикам для того, как представлять метрики и позволять пользователям взаимодействовать с ними без проблем.

Это развивающееся руководство, которое предназначено для предоставления рекомендаций на основе нашего опыта. Если у вас есть какие-либо отзывы, мы будем рады их услышать!

import SLCourses from '/snippets/_sl-course.md';

<SLCourses/>

### Предварительные требования

Для создания интеграции с семантическим слоем dbt: 

- Мы предлагаем [JDBC](/docs/dbt-cloud-apis/sl-jdbc) API и [GraphQL API](/docs/dbt-cloud-apis/sl-graphql). Обратитесь к специализированному [API семантического слоя dbt](/docs/dbt-cloud-apis/sl-api-overview) для получения более подробной информации о технической интеграции.

- Ознакомьтесь с ключевыми концепциями [семантического слоя dbt](/docs/use-dbt-semantic-layer/dbt-sl) и [MetricFlow](/docs/build/about-metricflow). Существует два основных объекта: 

  - [Семантические модели](/docs/build/semantic-models) &mdash; Узлы в вашей семантической графе, соединенные через сущности в качестве рёбер. MetricFlow принимает семантические модели, определенные в YAML конфигурационных файлах, в качестве входных данных и создает семантическую графу, которую вы можете использовать для запроса метрик. 
  - [Метрики](/docs/build/metrics-overview) &mdash; Могут быть определены в тех же YAML файлах, что и ваши семантические модели, или разделены на отдельные YAML файлы в любых других подкаталогах (при условии, что эти подкаталоги также находятся в одном репозитории проекта dbt).

### Параметры подключения

API семантического слоя dbt аутентифицируются с помощью `environmentId`, `SERVICE_TOKEN` и `host`.

Мы рекомендуем предоставить пользователям отдельные поля ввода для этих компонентов для аутентификации (dbt Cloud предоставит эти параметры пользователю). 

### Экспонирование метаданных для dbt Labs 

При создании интеграции мы рекомендуем вам экспонировать определенные метаданные в запросе для аналитики и устранения неполадок.

Пожалуйста, отправляйте нам следующий заголовок с каждым запросом:

`'X-dbt-partner-source': 'Ваше-Имя-Приложения'`

Кроме того, будет полезно, если вы также включите адрес электронной почты и имя пользователя человека, генерирующего запрос из вашего приложения.

## Используйте лучшие практики при экспонировании метрик

Лучшие практики для экспонирования метрик можно обобщить в пять тем:

- [Управление](#governance-and-traceability) &mdash; Рекомендации по установлению рамок для управляемой работы с данными.
- [Обнаружимость](#discoverability) &mdash; Рекомендации по созданию удобных для пользователя взаимодействий с данными.
- [Организация](#organization) &mdash; Организуйте метрики и измерения для всех аудиторий, используйте [сохраненные запросы](/docs/build/saved-queries).
- [Гибкость запросов](#query-flexibility) &mdash; Позвольте пользователям запрашивать либо одну метрику без измерений, либо несколько метрик с измерениями.
- [Контекст и интерпретация](#context-and-interpretation) &mdash; Контекстуализируйте метрики для лучшего анализа; экспонируйте определения, метаданные, происхождение и свежесть.

### Управление и отслеживаемость

При работе с более управляемыми данными важно установить четкие рамки. Вот некоторые рекомендации:

- **Контроль агрегаций** &mdash; Пользователям не следует в общем случае разрешать изменять агрегации, если они не выполняют постобработку расчетов на данных семантического слоя (например, анализ год к году).

- **Согласование временных рядов и использование metric_time** &mdash; Убедитесь, что пользователи просматривают метрики по правильным временным рядам. При отображении графиков метрик использование не стандартного временного измерения агрегации может привести к вводящим в заблуждение интерпретациям. Хотя пользователи все еще могут группировать по другим временным измерениям, им следует быть осторожными, чтобы не создавать трендовые линии с неправильными временными осями.<br /><br />При просмотре одной или нескольких метрик пользователи должны использовать `metric_time` в качестве основного временного измерения, чтобы гарантировать, что они смотрят на правильный временной ряд для метрик. <br /><br />Таким образом, при создании приложения мы рекомендуем экспонировать `metric_time` как отдельное, "специальное" временное измерение. Это измерение всегда будет согласовываться со всеми метриками и будет общим для них. Другие временные измерения все еще могут быть рассмотрены и сгруппированы, но четкое разделение между измерением `metric_time` и другими временными измерениями проясняет ситуацию, чтобы люди не путали, как метрики должны быть построены. <br /><br />Также, когда пользователь запрашивает изменение временной гранулярности для основного временного ряда, запрос, который выполняет ваше приложение, должен использовать `metric_time`, так как это всегда даст вам правильный срез. В связи с этим мы также настоятельно рекомендуем вам иметь способ экспонировать, к какому измерению на самом деле соответствует `metric_time` для пользователей, которые могут быть не знакомы. Наши API позволяют вам получать фактические подлежащие временные измерения, которые составляют metric_time (такие как `transaction_date`), чтобы вы могли предоставить их своим пользователям.

- **Согласованность единиц** &mdash; Если поддерживаются единицы, важно избегать неправильного отображения данных с различными единицами. Обеспечение согласованности в представлении единиц предотвратит путаницу и неверную интерпретацию данных.

- **Отслеживаемость изменений метрик и измерений** &mdash; Когда пользователи изменяют названия метрик и измерений для отчетов, важно иметь механизм отслеживаемости, чтобы связать их с оригинальным именем метрики.

### Обнаружимость 

- Рассмотрите возможность обращения с [метриками](/docs/build/metrics-overview) как с объектами первого класса, а не как с мерами. Метрики предлагают более высокий уровень и более контекстуальный способ взаимодействия с данными, снижая нагрузку на конечных пользователей по ручной агрегации данных.

- **Удобные взаимодействия с метриками** &mdash; Предоставьте пользователям интуитивный подход к:
    * Поиску метрик &mdash; Пользователи должны иметь возможность легко искать и находить соответствующие метрики. Метрики могут служить отправной точкой для того, чтобы привести пользователей к исследованию измерений.
    * Поиску измерений &mdash; Пользователи должны иметь возможность запрашивать метрики с сопутствующими измерениями, что позволяет им глубже понять данные.
    * Фильтрации по значениям измерений &mdash; Экспонируйте и позволяйте пользователям фильтровать метрики на основе значений измерений, что способствует анализу и исследованию данных.
    * Фильтрации по дополнительным метаданным &mdash; Позвольте пользователям фильтровать метрики на основе других доступных метаданных, таких как тип метрики и стандартная временная гранулярность.

- **Предложенные метрики** &mdash; В идеале система должна интеллектуально предлагать пользователям соответствующие метрики на основе активности их команды. Этот подход способствует вовлечению пользователей, облегчает обучение и поддерживает сотрудничество между членами команды.

Реализуя эти рекомендации, процесс взаимодействия с данными становится более удобным для пользователя, позволяя пользователям получать ценные инсайты без необходимости в обширной манипуляции данными.

### Организация 

Мы рекомендуем организовать метрики и измерения таким образом, чтобы не технический пользователь мог понять модель данных, не нуждаясь в большом контексте:

- **Организация измерений** &mdash; Чтобы помочь не техническим пользователям лучше понять модель данных, мы рекомендуем организовать измерения на основе сущности, от которой они произошли. Например, рассмотрите измерения, такие как `user__country` и `product__category`.<br /><br />Вы можете создать группы, извлекая `user` и `product`, а затем вложить соответствующие измерения под каждую группу. Таким образом, измерения будут согласовываться с сущностью или семантической моделью, к которой они принадлежат, и сделают их более удобными и доступными для пользователей. Кроме того, мы рекомендуем добавить параметр `label` к измерениям, чтобы определить значение, отображаемое в инструментах на нижнем уровне.

- **Организация метрик** &mdash; Цель состоит в том, чтобы организовать метрики в иерархию в наших конфигурациях, а не представлять их в длинном списке.<br /><br />Эта иерархия помогает организовать метрики на основе определенных критериев, таких как бизнес-единица или команда. Предоставляя такую структурированную организацию, пользователи могут находить и навигировать по метрикам более эффективно, улучшая их общий опыт анализа данных.

- **Использование сохраненных запросов** &mdash; Семантический слой dbt имеет концепцию [сохраненных запросов](/docs/build/saved-queries), которая позволяет пользователям заранее создавать срезы метрик, измерений и фильтров для легкого доступа. Вы должны представить их как объекты первого класса в вашей интеграции. Обратитесь к [JDBC](/docs/dbt-cloud-apis/sl-jdbc) и [GraphQL](/docs/dbt-cloud-apis/sl-graphql) API для синтаксиса.

### Гибкость запросов

Позвольте пользователям запрашивать либо одну метрику без измерений, либо несколько метрик с измерениями.

- Позвольте переключаться между метриками/измерениями без проблем.

- Будьте ясны в том, какие измерения можно запрашивать с какими метриками, и скрывайте то, что не применимо. (Наши API предоставляют вызовы, чтобы получить соответствующие измерения для метрик и наоборот).

- Экспонируйте только те временные гранулярности (ежемесячно, ежедневно, ежегодно), которые соответствуют доступным метрикам. 
  * Например, если модель dbt и ее результирующая семантическая модель имеют ежемесячную гранулярность, убедитесь, что запрос данных с 'ежедневной' гранулярностью недоступен для пользователя. Наши API имеют функциональность, которая поможет вам представить правильные гранулярности.

- Мы рекомендуем рассматривать временную гранулярность как общее понятие, специфичное для временного измерения, и что оно может применяться не только к основной агрегации (или `metric_time`). 
  
  Рассмотрите ситуацию, когда пользователь хочет посмотреть `sales` с течением времени по `customer signup month`; в этой ситуации возможность применения гранулярностей к обоим временным измерениям имеет решающее значение. Наши API включают информацию для получения гранулярностей для основных (metric_time) измерений, а также для всех временных измерений. 
  
  Вы можете рассматривать каждое временное измерение и выбор гранулярности независимо в вашем приложении. Примечание: Изначально, в качестве отправной точки, имеет смысл поддерживать только `metric_time` или основное временное измерение, но мы рекомендуем расширить это по мере развития вашего решения. 

- Вы должны позволить пользователям фильтровать по диапазонам дат и предоставить календарь и удобные предустановки для фильтрации. 
  * Например, последние 30 дней, последняя неделя и так далее.

### Контекст и интерпретация

Для лучшего анализа лучше всего иметь контекст метрик рядом с тем местом, где происходит анализ. Мы рекомендуем следующее:

- Экспонируйте бизнес-определения метрик, а также логические определения.

- Экспонируйте дополнительные метаданные из семантического слоя (меры, параметры типов).

- Используйте [Discovery API](/docs/dbt-cloud-apis/discovery-api) для улучшения метрики и повышения уверенности в ее точности:
  * Проверьте, свежа ли метрика и когда она была в последний раз обновлена.
  * Включите информацию о происхождении, чтобы понять источник метрики.

- Позвольте создавать другие метаданные, которые полезны для метрики. Мы можем предоставить часть этой информации в нашей конфигурации (отображаемое имя, стандартная гранулярность для просмотра, стандартный временной диапазон), но могут быть и другие метаданные, которые ваш инструмент хочет предоставить, чтобы сделать метрику более насыщенной.

### Прозрачность и использование compile

Для прозрачности и дополнительного контекста мы рекомендуем иметь простой способ для пользователя получить SQL, который генерирует MetricFlow. В зависимости от того, какой API вы используете, вы можете сделать это, используя наш параметр `compile`. Это невероятно мощно и подчеркивает прозрачность и открытость, особенно для технически подкованных пользователей.

### Фильтры и оптимизация

В случаях, когда наши API поддерживают либо строку, либо список фильтров для условия `where`, мы всегда рекомендуем вашему приложению использовать список фильтров, чтобы получить максимальные преимущества от оптимизации. Строка `where` может быть более интуитивной для пользователей, пишущих запросы во время тестирования, но она не будет иметь преимуществ по производительности по сравнению со списком фильтров в производственной среде.

## Понимание этапов интеграции

Это рекомендации о том, как развивать интеграцию семантического слоя, а не строгая инструкция.

**Этап 1 - Основы**
* Поддержка и использование [JDBC](/docs/dbt-cloud-apis/sl-jdbc) или [GraphQL](/docs/dbt-cloud-apis/sl-graphql) является первым шагом. Обратитесь к [API семантического слоя dbt](/docs/dbt-cloud-apis/sl-api-overview) для получения более подробной информации.

**Этап 2 - Больше обнаружимости и базовые запросы**
* Поддержка перечисления метрик, определенных в проекте
* Перечисление доступных измерений на основе одной или нескольких метрик
* Запрос определенных значений метрик самостоятельно или группировка по доступным измерениям
* Отображение метаданных из [Discovery API](/docs/dbt-cloud-apis/discovery-api) и другого контекста
* Экспонирование [сохраненных запросов](/docs/build/saved-queries), которые являются заранее созданными метриками, измерениями и фильтрами, которые разработчики семантического слоя создают для упрощения анализа. Вы можете экспонировать их в своем приложении. Обратитесь к [JDBC](/docs/dbt-cloud-apis/sl-jdbc) и [GraphQL](/docs/dbt-cloud-apis/sl-graphql) API для синтаксиса.

**Этап 3 - Больше гибкости запросов и лучшего пользовательского опыта (UX)**
* Более продвинутая фильтрация
  * Временные фильтры с хорошими предустановками/UX календаря
  * Фильтрация метрик по заранее заполненному набору значений измерений
* Сделайте значения измерений более удобными для пользователя, эффективно их организуя
* Интеллектуальная фильтрация метрик на основе доступных измерений и наоборот

**Этап 4 - Более кастомизированный пользовательский интерфейс (UI) / Сотрудничество**
* Место, где пользователи могут видеть всю соответствующую информацию о данной метрике
* Организация метрик по иерархии и более продвинутые функции поиска (такие как фильтрация по типу метрики или другим метаданным)
* Использование и экспонирование большего количества метаданных 
* Запрос измерений без метрик и другие более продвинутые функции запросов
* Предложение метрик пользователям на основе команд/идентичности и так далее.

### Связанные документы
- [Часто задаваемые вопросы о семантическом слое dbt](/docs/use-dbt-semantic-layer/sl-faqs)
- [Используйте семантический слой dbt](/docs/use-dbt-semantic-layer/dbt-sl), чтобы узнать о продукте.
- [Создайте свои метрики](/docs/build/build-metrics-intro) для получения дополнительной информации о MetricFlow и его компонентах. 
- [Страница интеграций семантического слоя dbt](https://www.getdbt.com/product/semantic-layer-integrations) для получения информации о доступных интеграциях с партнерами.

</div>