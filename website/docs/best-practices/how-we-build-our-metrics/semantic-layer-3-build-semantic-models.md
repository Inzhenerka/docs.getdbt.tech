---
title: "–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π"
description: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º —Å–ª–æ–µ–º dbt
hoverSnippet: –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º —Å–ª–æ–µ–º dbt
pagination_next: "best-practices/how-we-build-our-metrics/semantic-layer-4-build-metrics"
---

## –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å

–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–æ–º –ª–æ–≥–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º —Å–ª–æ–µ. –¢–∞–∫ –∂–µ, –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ –∫–ª—é—á–µ YAML `models:`, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –ø–æ–¥ `semantic models:`. –ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ SQL –∏–ª–∏ Python –∫–æ–¥–∞, **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é YAML**. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–Ω–µ—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –∏ —É—Ç–æ—á–Ω—è—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö.

- ‚öôÔ∏è –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ **—Å–æ—Å—Ç–æ—è—Ç –∏–∑ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**:
  - ü´Ç **—Å—É—â–Ω–æ—Å—Ç–∏**: –æ–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç **–æ—Ç–Ω–æ—à–µ–Ω–∏—è** –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã)
  - üî™ **–∏–∑–º–µ—Ä–µ–Ω–∏—è**: —ç—Ç–æ —Å—Ç–æ–ª–±—Ü—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –≤—ã —Ö–æ—Ç–∏—Ç–µ **—Ä–∞–∑–¥–µ–ª—è—Ç—å, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è).
  - üìè **–º–µ—Ä—ã**: —ç—Ç–æ **–∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å**
- ü™£ –ú—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º **—Å—Ç–æ–ª–±—Ü—ã –∫–∞–∫ —Å—É—â–Ω–æ—Å—Ç—å, –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏–ª–∏ –º–µ—Ä—É**. –°—Ç–æ–ª–±—Ü—ã –æ–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–¥–Ω—É –∏–∑ —ç—Ç–∏—Ö —Ç—Ä–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∏–ª–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π —Å–ª–æ–∂–Ω–æ–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –º–æ–≥—É—Ç —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –º–µ—Ç—Ä–∏–∫—É.

## –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

–î–∞–≤–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å _–∑–∞–∫–∞–∑–æ–≤_.

- üìó –ú—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–µ –∫–∞–∫ **—Å–ª–æ–≤–∞—Ä—å YAML –≤ —Å–ø–∏—Å–∫–µ `semantic_models`**.
- üìë –û–Ω–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å **–∏–º—è, —Å–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏ —Å–ø–∏—Å–æ–∫ –º–µ—Ä**.
- ‚è¨ –ú—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏—Ö **–≤ —ç—Ç–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** –∫–∞–∫ –ª—É—á—à—É—é –ø—Ä–∞–∫—Ç–∏–∫—É —Å—Ç–∏–ª—è.

<File name="models/marts/orders.yml" />

```yaml
semantic_models:
  - name: orders
    entities: ... # –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –∏—Ö –ø–æ–∑–∂–µ
    dimensions: ... # –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –∏—Ö –ø–æ–∑–∂–µ
    measures: ... # –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –∏—Ö –ø–æ–∑–∂–µ
```

- –î–∞–ª–µ–µ –º—ã —É–∫–∞–∂–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–≤ [`ref`](https://docs.getdbt.com/reference/dbt-jinja-functions/ref) –≤ —Å–≤–æ–π—Å—Ç–≤–µ `model:` –∏ `description` –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

<File name="models/marts/orders.yml" />

```yml
semantic_models:
  - name: orders
    description: |
      –ú–æ–¥–µ–ª—å, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–∞—Ö. –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞.
    model: ref('stg_orders')
    entities: ...
    dimensions: ...
    measures: ...
```

## –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—à–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

- ü´Ç –°—É—â–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ **–æ–±—ä–µ–∫—Ç—ã –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏** –≤ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ _–∏–º–µ—é—Ç_ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –º–µ—Ä—ã. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Ö –∫–∞–∫ **—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ** –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, **–æ—Å–Ω–æ–≤—É** –Ω–∞—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º—ã –º–æ–∂–µ–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∫–∞–∫ **–∫–ª—é—á–∏ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**.
- üîÄ –°—É—â–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞—é—Ç MetricFlow –ø–æ–Ω—è—Ç—å, **–∫–∞–∫ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —Å–æ–æ—Ç–Ω–æ—Å—è—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º**.
- ‚õìÔ∏è –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –º–Ω–æ–≥–∏—Ö –¥—Ä—É–≥–∏—Ö —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ–µ–≤, –≤ MetricFlow **–Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ **–æ—Ç–Ω–æ—à–µ–Ω–∏—è –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–µ—è–≤–Ω–æ —á–µ—Ä–µ–∑ —Å—É—â–Ω–æ—Å—Ç–∏**.
- 1Ô∏è‚É£ –ö–∞–∂–¥–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å **–æ–¥–Ω—É –æ—Å–Ω–æ–≤–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å**, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–ª—è —Å–µ–±—è, –∏ **–ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π** –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω–∞ –º–æ–∂–µ—Ç —Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è.
- ü´Ç –°—É—â–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–±—É—é—Ç **–∏–º—è –∏ —Ç–∏–ø**
  - üîë –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã: **–æ—Å–Ω–æ–≤–Ω–æ–π**, **–≤–Ω–µ—à–Ω–∏–π**, **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π** –∏–ª–∏ **–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π** ‚Äî –º—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –Ω–∞ –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ [—É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª—é—á–∞—Ö](https://docs.getdbt.com/docs/build/entities#entity-types).

### –°—É—â–Ω–æ—Å—Ç–∏ –≤ –¥–µ–π—Å—Ç–≤–∏–∏

–ï—Å–ª–∏ –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–∫–∞–∑–æ–≤, –º—ã —É–≤–∏–¥–∏–º, —á—Ç–æ —É –Ω–µ–µ –µ—Å—Ç—å 3 —Å—Ç–æ–ª–±—Ü–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —Ç—Ä–∏ —Å—É—â–Ω–æ—Å—Ç–∏.

<File name="models/staging/stg_orders.sql" />

```sql
renamed as (

    select

        ----------  –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        id as order_id,
        store_id as location_id,
        customer as customer_id,

        ---------- —Å–≤–æ–π—Å—Ç–≤–∞
        (order_total / 100.0) as order_total,
        (tax_paid / 100.0) as tax_paid,

        ---------- –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
        ordered_at

    from source
```

- üëâ –ú—ã –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö —Å –ø–æ–º–æ—â—å—é **`name`, `type` –∏ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ `expr`** (–≤—ã—Ä–∞–∂–µ–Ω–∏–µ). –í—ã—Ä–∞–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º –¥–æ–ø—É—Å—Ç–∏–º—ã–º SQL –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –Ω–∞ –≤–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.
- üìõ –ï—Å–ª–∏ –≤—ã **–Ω–µ –¥–æ–±–∞–≤–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ**, MetricFlow –±—É–¥–µ—Ç **–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å, —á—Ç–æ –∏–º—è —Ä–∞–≤–Ω–æ –∏–º–µ–Ω–∏ —Å—Ç–æ–ª–±—Ü–∞** –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏.
- üëç –ù–∞—à–∞ –ª—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å `name`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —á–∏—Å–ª–æ–º –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–ª–∏ —É—Ä–æ–≤–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `expr`, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å —Ç–æ—á–Ω–æ–µ –∏–º—è —Å—Ç–æ–ª–±—Ü–∞ (—Å `_id` –∏ —Ç.–¥.). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞–º –ø–∏—Å–∞—Ç—å **–±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `location` –≤–º–µ—Å—Ç–æ `location_id`.

<File name="models/marts/orders.yml" />

```yml
semantic_models:
  - name: orders
    ...
    entities:
      # –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –∏–º–µ–Ω–∏ –∑–¥–µ—Å—å, –ø–æ—Ç–æ–º—É —á—Ç–æ order ‚Äî –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –≤ SQL
      - name: order_id
        type: primary
      - name: location
        type: foreign
        expr: location_id
      - name: customer
        type: foreign
        expr: customer_id

    dimensions:
      ...
    measures:
      ...
```

## –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—à–∏—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π

- üßÆ –ò–∑–º–µ—Ä–µ–Ω–∏—è ‚Äî —ç—Ç–æ —Å—Ç–æ–ª–±—Ü—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ö–æ—Ç–∏–º **—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å**, **–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞**. –û–Ω–∏ –±—ã–≤–∞—é—Ç —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤:
  - **–∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ**
  - **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ**
  - –º–µ–¥–ª–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è –∏–∑–º–µ—Ä–µ–Ω–∏—è ‚Äî [–æ–Ω–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.getdbt.com/docs/build/dimensions#scd-type-ii) –∏ –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ. –ß—Ç–æ–±—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≤–∞—à–∏—Ö –º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –æ—Å–Ω–æ–≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ª–æ—è MetricFlow, –º—ã –Ω–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SCD –≤ —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ.
- ‚ûï –ú—ã **–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏**, –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `expr`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ –Ω–∞—à–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è.
- üìõ –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —Å–∞–º—ã–º–∏ –ø—Ä–æ—Å—Ç—ã–º–∏, –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç `name` –∏ `type` (—Ç–∏–ø ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π). **–ï—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ `name` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Å—Ç–æ–ª–±—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è**, –Ω–∞ —ç—Ç–æ–º –≤—Å–µ, –≤—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º—è, –æ—Ç–ª–∏—á–Ω–æ–µ –æ—Ç –∏–º–µ–Ω–∏ —Å—Ç–æ–ª–±—Ü–∞, –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∫–∞–∫–æ–µ-–ª–∏–±–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ, **–≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ `expr`** –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è.

### –ò–∑–º–µ—Ä–µ–Ω–∏—è –≤ –¥–µ–π—Å—Ç–≤–∏–∏

- üëÄ –î–∞–≤–∞–π—Ç–µ —Å–Ω–æ–≤–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–∞—à—É –º–æ–¥–µ–ª—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–≤–∏–¥–∏–º, –∫–∞–∫–∏–µ –ø–æ–ª—è —É –Ω–∞—Å –µ—Å—Ç—å.

<File name="models/staging/stg_orders.sql" />

```sql
select

    ----------  –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã -> —Å—É—â–Ω–æ—Å—Ç–∏
    id as order_id,
    store_id as location_id,
    customer as customer_id,

    ---------- —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è -> –º–µ—Ä—ã
    (order_total / 100.0) as order_total,
    (tax_paid / 100.0) as tax_paid,

    ---------- –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ -> –∏–∑–º–µ—Ä–µ–Ω–∏—è
    ordered_at

from source
```

- ‚è∞ –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è **–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ**: `ordered_at`.
- üï∞Ô∏è –ü–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –æ–¥–Ω–æ **–æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ** —è–≤–ª—è–µ—Ç—Å—è **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º** –¥–ª—è –ª—é–±—ã—Ö —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ **–∏–º–µ—é—Ç –º–µ—Ä—ã**.
- 1Ô∏è‚É£ –ú—ã –æ–±–æ–∑–Ω–∞—á–∞–µ–º —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é —Å–≤–æ–π—Å—Ç–≤–∞ `is_primary`, –∏–ª–∏ –µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ, –æ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º. –ù–∏–∂–µ —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ `ordered_at` –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∏—á–µ–≥–æ, –∫—Ä–æ–º–µ _–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏_, –∫ –∫–æ—Ç–æ—Ä–æ–π –º—ã –≥—Ä—É–ø–ø–∏—Ä—É–µ–º (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –¥–µ–Ω—å). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –Ω–µ –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã —Å –±–æ–ª–µ–µ —Ç–æ–Ω–∫–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π, —á–µ–º –¥–µ–Ω—å.

<File name="models/marts/orders.yml" />

```yml
dimensions:
  - name: ordered_at
    expr: date_trunc('day', ordered_at)
    type: time
    type_params:
      time_granularity: day
```

:::tip
**–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏**. –£ –≤–∞—Å –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ—Ä, —Ç–æ–ª—å–∫–æ –∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–æ–≥–∞—â–∞—é—Ç –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç—ã. –≠—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏–ª–∏ –º–µ—Ä, –µ–π –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, –∞ –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –º–µ—Ä—ã, —Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ.

–ú—ã –æ–±—Å—É–¥–∏–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é, –∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏, –Ω–æ –Ω–µ –∏–º–µ—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π, –ø–æ–∑–∂–µ –≤ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ.
:::

- üî¢ –ú—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º **—Å–æ–∑–¥–∞—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏–∑ —á–∏—Å–ª–æ–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞**, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ –±—ã–ª –±—ã –º–µ—Ä–æ–π.
- ü™£ –ò—Å–ø–æ–ª—å–∑—É—è `expr`, –º—ã –º–æ–∂–µ–º **—Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—ã –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–æ–º–µ—á–∞–µ–º** –¥–ª—è –Ω–∞—à–µ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è. –ú—ã –¥–æ–±–∞–≤–∏–º –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è '–∫—Ä—É–ø–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤' –∫–∞–∫ –ª—é–±—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å—É–º–º—É –±–æ–ª–µ–µ 50 –¥–æ–ª–ª–∞—Ä–æ–≤.

<File name="models/marts/orders.yml" />

```yml
dimensions:
  - name: ordered_at
    expr: date_trunc('day', ordered_at)
    type: time
    type_params:
      time_granularity: day
  - name: is_large_order
    type: categorical
    expr: case when order_total > 50 then true else false end
```

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—à–∏—Ö –º–µ—Ä

- üìè –ú–µ—Ä—ã —è–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏. –û–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç **—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å**.
- üß± –ú–µ—Ä—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç **—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –º–µ—Ç—Ä–∏–∫**, —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏.
- üèÉ –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Ö –∫–∞–∫ –Ω–µ—á—Ç–æ –≤—Ä–æ–¥–µ **–≥–ª–∞–≥–æ–ª–æ–≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏**.

### –ú–µ—Ä—ã –≤ –¥–µ–π—Å—Ç–≤–∏–∏

- üëÄ –î–∞–≤–∞–π—Ç–µ –µ—â–µ —Ä–∞–∑ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ **–Ω–∞—à—É –º–æ–¥–µ–ª—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö** –∏ —É–≤–∏–¥–∏–º, –∫–∞–∫–∏–µ **–ø–æ–ª—è –º—ã —Ö–æ—Ç–∏–º –∏–∑–º–µ—Ä–∏—Ç—å**.

<File name="models/staging/stg_orders.sql" />

```sql
select

    ----------  –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã -> —Å—É—â–Ω–æ—Å—Ç–∏
    id as order_id,
    store_id as location_id,
    customer as customer_id,

    ---------- —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è -> –º–µ—Ä—ã
    (order_total / 100.0) as order_total,
    (tax_paid / 100.0) as tax_paid,

    ---------- –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ -> –∏–∑–º–µ—Ä–µ–Ω–∏—è
    ordered_at

from source
```

- ‚ûï –ó–¥–µ—Å—å `order_total` –∏ `tax_paid` ‚Äî —ç—Ç–æ **—Å—Ç–æ–ª–±—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –º–µ—Ä—ã**.
- üìù –ú—ã –º–æ–∂–µ–º –æ–ø–∏—Å–∞—Ç—å –∏—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–¥–∞ –Ω–∏–∂–µ, —É–∫–∞–∑–∞–≤ **–∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞–≥—Ä–µ–≥–∞—Ü–∏—é –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ**.
- üëç –ö–∞–∫ –∏ –ø—Ä–µ–∂–¥–µ, MetricFlow –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ **–∏–º—è —è–≤–ª—è–µ—Ç—Å—è –∏–º–µ–Ω–µ–º —Å—Ç–æ–ª–±—Ü–∞, –µ—Å–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ**.
- üßÆ [–î–æ—Å—Ç—É–ø–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ü–∏–π](https://docs.getdbt.com/docs/build/measures#aggregation). –ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏–º —Å—É–º–º—ã.

<File name="models/marts/orders.yml" />

```yml
measures:
  - name: order_total
    description: –û–±—â–∞—è —Å—É–º–º–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞, –≤–∫–ª—é—á–∞—è –Ω–∞–ª–æ–≥–∏.
    agg: sum
  - name: tax_paid
    description: –û–±—â–∞—è —Å—É–º–º–∞ –Ω–∞–ª–æ–≥–∞, —É–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
    agg: sum
```

- üÜï –ú—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º **—Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ä—ã —Å –ø–æ–º–æ—â—å—é –≤—ã—Ä–∞–∂–µ–Ω–∏–π**, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª—è—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂–µ.

<File name="models/marts/orders.yml" />

```yml
- name: order_count
  description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.
  expr: 1
  agg: sum
```

## –û–±–∑–æ—Ä –Ω–∞—à–µ–π —Ä–∞–±–æ—Ç—ã

–ù–∞—à –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º, —ç—Ç–æ –Ω–∞—à–∞ –ø–µ—Ä–≤–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å! –í–æ—Ç –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏—Ö —Ä–∞–∑–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:

<Expandable alt_header="–ü–æ–¥—Ö–æ–¥ —Å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º">

<File name="models/marts/orders.yml" />

```yml
semantic_models:
  - name: orders
    defaults:
      agg_time_dimension: ordered_at
    description: |
      –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤. –≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞ –∑–∞–∫–∞–∑.

    model: ref('stg_orders')

    entities:
      - name: order_id
        type: primary
      - name: location
        type: foreign
        expr: location_id
      - name: customer
        type: foreign
        expr: customer_id

    dimensions:
      - name: ordered_at
        expr: date_trunc('day', ordered_at)
        # –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ date_trunc(ordered_at, DAY), –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ BigQuery
        type: time
        type_params:
          time_granularity: day
      - name: is_large_order
        type: categorical
        expr: case when order_total > 50 then true else false end

    measures:
      - name: order_total
        description: –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
        agg: sum
      - name: order_count
        description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.
        expr: 1
        agg: sum
      - name: tax_paid
        description: –û–±—â–∞—è —Å—É–º–º–∞ –Ω–∞–ª–æ–≥–∞, —É–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
        agg: sum
```
</Expandable>

<Expandable alt_header="–ü–æ–¥—Ö–æ–¥ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∞–ø–∫–æ–π">

<File name="models/semantic_models/sem_orders.yml" />

```yml
semantic_models:
  - name: orders
    defaults:
      agg_time_dimension: ordered_at
    description: |
      –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤. –≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞ –∑–∞–∫–∞–∑.

    model: ref('stg_orders')

    entities:
      - name: order_id
        type: primary
      - name: location
        type: foreign
        expr: location_id
      - name: customer
        type: foreign
        expr: customer_id

    dimensions:
      - name: ordered_at
        expr: date_trunc('day', ordered_at)
        # –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ date_trunc(ordered_at, DAY), –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ BigQuery
        type: time
        type_params:
          time_granularity: day
      - name: is_large_order
        type: categorical
        expr: case when order_total > 50 then true else false end

    measures:
      - name: order_total
        description: –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
        agg: sum
      - name: order_count
        description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.
        expr: 1
        agg: sum
      - name: tax_paid
        description: –û–±—â–∞—è —Å—É–º–º–∞ –Ω–∞–ª–æ–≥–∞, —É–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
        agg: sum
```
</Expandable>

–ö–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –≤–∏–¥–µ—Ç—å, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ –≤ –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–∞—Ö. –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º:

1. **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞**
   - –ü–æ–¥—Ö–æ–¥ —Å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º: `models/marts/orders.yml`
   - –ü–æ–¥—Ö–æ–¥ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∞–ø–∫–æ–π: `models/semantic_models/sem_orders.yml`

2. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**
   - –ü–æ–¥—Ö–æ–¥ —Å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ –∂–µ –∏–º—è, —á—Ç–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π mart (`orders.yml`)
   - –ü–æ–¥—Ö–æ–¥ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∞–ø–∫–æ–π: –ü—Ä–µ—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–π–ª —Å `sem_` (`sem_orders.yml`)

–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã. –ü–æ–¥—Ö–æ–¥ —Å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ –ø—Ä–æ—â–µ –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –ø–æ–¥—Ö–æ–¥ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∞–ø–∫–æ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ —è—Å–Ω—ã–º –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –∫—Ä—É–ø–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π:

- üß± –°–æ—Å—Ç–æ—è—Ç –∏–∑ **—Å—É—â–Ω–æ—Å—Ç–µ–π, –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏ –º–µ—Ä**.
- ü´Ç –û–ø–∏—Å—ã–≤–∞—é—Ç **—Å–µ–º–∞–Ω—Ç–∏–∫—É –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤** –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö.
- 1Ô∏è‚É£ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç **–æ–¥–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏** –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ dbt.

–°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –¥–∞–≤–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à—É –Ω–æ–≤—É—é —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã **—Å–æ–∑–¥–∞—Ç—å –º–µ—Ç—Ä–∏–∫—É**!