---
title: "Парсинг проекта"
description: "Прочитайте это руководство, чтобы понять конфигурацию парсинга проекта в dbt."
---

## Связанная документация
- Команда `dbt parse` [command](/reference/commands/parse)
- Конфигурация профиля для частичного парсинга [profile config](/docs/core/connect-data-platform/profiles.yml#partial_parse) и [флаги CLI](/reference/global-configs/parsing)
- Флаги парсинга [CLI flags](/reference/global-configs/parsing)

## Что такое парсинг?

В начале каждого вызова dbt он читает все файлы в вашем проекте, извлекает информацию и создает манифест, содержащий каждый объект (модель, источник, макрос и т.д.). Среди прочего, dbt использует вызовы макросов `ref()`, `source()` и `config()` внутри моделей для установки свойств, вывода зависимостей и построения DAG вашего проекта.

Парсинг проектов может быть медленным, особенно по мере увеличения размера проектов — сотни моделей, тысячи файлов — что вызывает разочарование в процессе разработки. Существует несколько способов оптимизации производительности dbt:
- Привязки LibYAML для PyYAML
- Частичный парсинг, который избегает повторного парсинга неизмененных файлов между вызовами
- Статический парсер, который извлекает информацию из простых моделей гораздо быстрее
- [RPC сервер](/reference/commands/rpc), который хранит манифест в памяти и повторно парсит проект при запуске/завершении сервера

Эти оптимизации могут использоваться в комбинации, чтобы сократить время парсинга с минут до секунд. В то же время у каждой из них есть известные ограничения, поэтому они отключены по умолчанию.

## PyYAML + LibYAML

dbt использует [PyYAML](https://pyyaml.org/wiki/PyYAML) для чтения и проверки YAML файлов в вашем проекте. PyYAML написан на чистом Python, но может использовать [LibYAML](https://pyyaml.org/wiki/LibYAML) (написан на C, гораздо быстрее), если он доступен в вашей системе. Каждый раз, когда он парсит ваш проект, dbt всегда сначала проверяет, доступен ли LibYAML.

Вы можете проверить, установлен ли LibYAML, выполнив эту команду в среде, где вы установили dbt:
```
python -c "from yaml import CLoader"
```

## Частичный парсинг

После парсинга вашего проекта dbt сохраняет внутренний манифест проекта в файле с именем `partial_parse.msgpack`. Когда частичный парсинг включен, dbt будет использовать этот внутренний манифест, чтобы определить, какие файлы были изменены (если такие имеются) с момента последнего парсинга проекта. Затем он будет _только_ парсить измененные файлы или файлы, связанные с этими изменениями.

Начиная с версии 1.0, частичный парсинг включен по умолчанию. В процессе разработки частичный парсинг может значительно сократить время ожидания в начале выполнения, что приводит к более быстрым циклам разработки и итерациям.

Глобальную конфигурацию [`PARTIAL_PARSE`](/reference/global-configs/parsing) можно включить или отключить через `profiles.yml`, переменную окружения или флаг CLI.

### Известные ограничения

Атрибуты времени парсинга (зависимости, конфигурации и свойства ресурсов) разрешаются с использованием контекста времени парсинга. Когда частичный парсинг включен и определенные переменные контекста изменяются, эти атрибуты _не_ будут повторно разрешены и, вероятно, станут устаревшими.

В частности, вы можете увидеть некорректные результаты, если эти атрибуты зависят от "волатильных" переменных контекста, таких как [`run_started_at`](/reference/dbt-jinja-functions/run_started_at), [`invocation_id`](/reference/dbt-jinja-functions/invocation_id) или [флаги](/reference/dbt-jinja-functions/flags). Эти переменные, вероятно (или даже гарантированно!), изменятся при каждом вызове. dbt Labs _категорически не рекомендует_ использовать эти переменные для установки атрибутов времени парсинга (зависимости, конфигурации и свойства ресурсов).

Начиная с версии 1.0, dbt _будет_ обнаруживать изменения в переменных окружения. Он будет выборочно повторно парсить только те файлы, которые зависят от этого значения [`env_var`](/reference/dbt-jinja-functions/env_var). (Если переменная окружения используется в `profiles.yml` или `dbt_project.yml`, потребуется полный повторный парсинг.) Однако dbt _не_ будет повторно рендерить **описания**, которые включают переменные окружения. Если ваши описания содержат часто изменяющиеся переменные окружения (что крайне редко), мы рекомендуем вам полностью повторно парсить при генерации документации: `dbt --no-partial-parse docs generate`.

Если определенные входные данные изменяются между запусками, dbt инициирует полный повторный парсинг. Результаты будут корректными, но полный повторный парсинг может быть довольно медленным. В настоящее время эти входные данные:
- `--vars`
- Содержимое `profiles.yml` (или значения `env_var`, используемые в нем)
- Содержимое `dbt_project.yml` (или значения `env_var`, используемые в нем)
- Установленные пакеты
- Версия dbt
- Некоторые широко используемые макросы (например, [builtins](/reference/dbt-jinja-functions/builtins), переопределения или `generate_x_name` для `database`/`schema`/`alias`)

Если вы запускаете [CI](/docs/deploy/continuous-integration) задания, преимущества частичного парсинга не применимы к новым запросам на слияние (PR) или новым веткам. Однако они применяются к последующим коммитам в новый PR или ветку.

Если вы когда-либо окажетесь в плохом состоянии, вы можете отключить частичный парсинг и инициировать полный повторный парсинг, установив глобальную конфигурацию `PARTIAL_PARSE` в false или удалив `target/partial_parse.msgpack` (например, выполнив `dbt clean`).

## Статический парсер

Во время парсинга dbt необходимо извлечь содержимое `ref()`, `source()` и `config()` из всех моделей в проекте. Традиционно dbt извлекал эти значения, рендеря Jinja в каждом файле модели, что может быть медленным. В версии 0.20 мы представили новый способ статического анализа файлов моделей, используя [`tree-sitter`](https://github.com/tree-sitter/tree-sitter). Вы можете увидеть код для начальной грамматики Jinja2 [здесь](https://github.com/dbt-labs/tree-sitter-jinja2).

Начиная с версии 1.0, статический парсер включен по умолчанию. Мы считаем, что он может предложить *некоторое* ускорение для 95% проектов. Вы можете отключить его, используя глобальную конфигурацию [`STATIC_PARSER`](/reference/global-configs/parsing).

На данный момент статический парсер работает только с моделями и моделями, чей Jinja ограничен этими тремя специальными макросами (`ref`, `source`, `config`). Статический парсер как минимум в 3 раза быстрее, чем полный рендер Jinja. На основе тестирования с данными из dbt Cloud мы считаем, что текущая грамматика может статически парсить 60% моделей в дикой природе. Таким образом, для среднего проекта мы надеемся увидеть 40% ускорение в парсере моделей.

## Экспериментальный парсер

В настоящее время не используется.