---
title: "Конфигурации Teradata"
id: "teradata-configs"
---

## Общая информация

* *Установите `quote_columns`* - чтобы избежать предупреждения, убедитесь, что вы явно установили значение для `quote_columns` в вашем `dbt_project.yml`. Дополнительную информацию смотрите в [документации по quote_columns](https://docs.getdbt.com/reference/resource-configs/quote_columns).

* *Включите типы столбцов представлений в документации* - Teradata Vantage имеет флаг конфигурации dbscontrol под названием `DisableQVCI`. Этот флаг инструктирует базу данных создавать `DBC.ColumnsJQV` с определениями типов столбцов представлений. Чтобы включить эту функциональность, вам необходимо:
  1. Включить режим QVCI в Vantage. Используйте утилиту `dbscontrol`, а затем перезапустите Teradata. Выполните эти команды от имени привилегированного пользователя на узле Teradata.
  2. Инструктировать `dbt` использовать режим `QVCI`. Включите следующую переменную в ваш `dbt_project.yml`:
      Для примера конфигурации смотрите [dbt_project.yml](https://github.com/Teradata/dbt-teradata/blob/main/test/catalog/with_qvci/dbt_project.yml) в тестах QVCI `dbt-teradata`.

## Модели

### <Term id="table" />
* `table_kind` - определяет тип таблицы. Допустимые значения: `MULTISET` (по умолчанию для режима транзакций ANSI, требуемого `dbt-teradata`) и `SET`.
  Для подробностей смотрите [документацию CREATE TABLE](https://docs.teradata.com/r/76g1CuvvQlYBjb2WPIuk3g/B6Js16DRQVwPDjgJ8rz7hg).
* `table_option` - определяет параметры таблицы. Конфигурация поддерживает несколько операторов. Примеры:
  Для подробностей смотрите [документацию CREATE TABLE](https://docs.teradata.com/r/76g1CuvvQlYBjb2WPIuk3g/B6Js16DRQVwPDjgJ8rz7hg).

* `with_statistics` - следует ли копировать статистику из базовой таблицы.
  Для подробностей смотрите [документацию CREATE TABLE](https://docs.teradata.com/r/76g1CuvvQlYBjb2WPIuk3g/B6Js16DRQVwPDjgJ8rz7hg).

* `index` - определяет индексы таблицы.
  Примеры:
  Обратите внимание, что в отличие от `table_option`, между операторами индекса нет запятых!

## Семена

:::info Использование семян для загрузки необработанных данных

Как объясняется в [документации по семенам dbt](/docs/build/seeds), семена не следует использовать для загрузки необработанных данных (например, больших CSV-экспортов из производственной базы данных).

Поскольку семена контролируются версиями, они лучше всего подходят для файлов, содержащих бизнес-специфическую логику, например, список кодов стран или идентификаторов пользователей сотрудников.

Загрузка CSV-файлов с использованием функциональности семян dbt неэффективна для больших файлов. Рассмотрите возможность использования другого инструмента для загрузки этих CSV-файлов в ваш <Term id="data-warehouse" />.

:::

* `use_fastload` - используйте [fastload](https://github.com/Teradata/python-driver#FastLoad) при обработке команды `dbt seed`. Эта опция, вероятно, ускорит загрузку, когда ваши файлы семян содержат сотни тысяч строк.

## Снимки

Снимки используют [функцию HASHROW](https://docs.teradata.com/r/Enterprise_IntelliFlex_VMware/SQL-Functions-Expressions-and-Predicates/Hash-Related-Functions/HASHROW/HASHROW-Function-Syntax) базы данных Teradata для генерации уникального хеш-значения для столбца `dbt_scd_id`.

Чтобы использовать свою собственную UDF хеш-функцию, в модели снимка есть параметр конфигурации `snapshot_hash_udf`, который по умолчанию равен HASHROW. Вы можете указать значение, например, `<database_name.hash_udf_name>`.

#### Права

Права поддерживаются в адаптере dbt-teradata с версии 1.2.0 и выше. Вы можете использовать права для управления доступом к наборам данных, которые вы создаете с помощью dbt. Чтобы реализовать эти разрешения, определите права как конфигурации ресурсов для каждой модели, семени или снимка.

## Запросы Band
Запрос Band в dbt-teradata может быть установлен на трех уровнях:
1. Уровень профилей: в файле `profiles.yml` пользователь может предоставить `query_band` с использованием следующего примера:

2. Уровень проекта: в файле `dbt_project.yml` пользователь может предоставить `query_band` с использованием следующего примера:

3. Уровень модели: его можно установить в SQL-файле модели или в конфигурации уровня модели в YAML-файлах.

Если пользователь устанавливает пару ключ-значение со значением `'{model}'`, это `'{model}'` будет заменено на имя модели, что может быть полезно для телеметрического отслеживания логирования sql/dbql.

- Если пользователь не устанавливает `query_band`, будет использоваться значение по умолчанию: ```org=teradata-internal-telem;appname=dbt;```

## Стратегия инкрементальной материализации valid_history
_Это доступно в раннем доступе_

Эта стратегия предназначена для эффективного управления историческими данными в среде Teradata, используя функции dbt для обеспечения качества данных и оптимального использования ресурсов.

```yaml
  {{
      config(
          materialized='incremental',
          unique_key='id',
          on_schema_change='fail',
          incremental_strategy='valid_history',
          valid_from='valid_from_column',
          history_column_in_target='history_period_column'
  )
  }}
  ```

Стратегия `valid_history` требует следующие параметры:
* `valid_from` — столбец в исходной таблице типа **timestamp**, указывающий, когда каждая запись стала действительной.
* `history_column_in_target` — столбец в целевой таблице типа **period**, который отслеживает историю.

Эти шаги совместно обеспечивают, что стратегия valid_history эффективно управляет историческими данными, поддерживая их целостность и точность, одновременно оптимизируя производительность.

:::info
Целевая таблица должна уже существовать перед запуском модели. Убедитесь, что целевая таблица создана и правильно структурирована с необходимыми столбцами, включая столбец, который отслеживает историю с типом period, перед запуском модели dbt.
:::

## Общие задачи, специфичные для Teradata
* *собирать статистику* - когда таблица создается или значительно изменяется, может возникнуть необходимость сообщить Teradata о необходимости собрать статистику для оптимизатора. Это можно сделать с помощью команды `COLLECT STATISTICS`. Вы можете выполнить этот шаг с помощью `post-hooks` dbt.
  Дополнительную информацию смотрите в [документации по сбору статистики](https://docs.teradata.com/r/76g1CuvvQlYBjb2WPIuk3g/RAyUdGfvREwbO9J0DMNpLw).