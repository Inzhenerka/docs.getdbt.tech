---
title: " О функции env_var"
sidebar_label: "env_var"
id: "env_var"
description: "Используйте переменные окружения с помощью функции `env_var`."
---

Функция `env_var` может быть использована для интеграции переменных окружения из системы в ваш проект dbt. Эта функция `env_var` может быть использована в вашем файле `profiles.yml`, файле `dbt_project.yml`, файле `sources.yml`, ваших файлах `schema.yml` и в моделях `.sql`. По сути, `env_var` доступна везде, где dbt обрабатывает код jinja.

При использовании в файле `profiles.yml` (чтобы избежать размещения учетных данных на сервере), она может быть использована следующим образом:

<File name='profiles.yml'>

```yaml
profile:
  target: prod
  outputs:
    prod:
      type: postgres
      host: 127.0.0.1
      # ВАЖНО: Убедитесь, что вся строка Jinja заключена в кавычки
      user: "{{ env_var('DBT_USER') }}"
      password: "{{ env_var('DBT_PASSWORD') }}"
      ....
```

</File>

Если переменные окружения `DBT_USER` и `DBT_PASSWORD` присутствуют при вызове dbt, то эти переменные будут подставлены в профиль, как и ожидалось. Если какие-либо переменные окружения не установлены, dbt вызовет ошибку компиляции.

:::info Целочисленные переменные окружения
Если вы передаете переменную окружения для свойства, которое использует целочисленный тип (например, `port`, `threads`), обязательно добавьте фильтр к выражению Jinja, как показано здесь. В противном случае dbt вызовет ошибку `['threads']: '1' is not of type 'integer'`.
`{{ env_var('DBT_THREADS') | int }}` или `{{ env_var('DB_PORT') | as_number }}` 

:::

:::caution Кавычки, фигурные скобки и вы

Обязательно заключайте всю строку jinja в кавычки (как показано выше), иначе парсер YAML будет сбит с толку фигурными скобками Jinja.

:::

`env_var` принимает второй, необязательный аргумент для значения по умолчанию, как показано ниже:

<File name='dbt_project.yml'>

```yaml
...
models:
  jaffle_shop:
    +materialized: "{{ env_var('DBT_MATERIALIZATION', 'view') }}"
```

</File>

Это может быть полезно для избежания ошибок компиляции, когда переменная окружения недоступна.


### Секреты

Для определенных конфигураций вы можете использовать "секретные" переменные окружения. Любая переменная окружения с префиксом `DBT_ENV_SECRET` будет:
- Доступна для использования в `profiles.yml` + `packages.yml` через ту же функцию `env_var()`
- Запрещена везде, кроме этого, включая `dbt_project.yml` и SQL моделей, чтобы предотвратить случайную запись этих секретных значений в <Term id="data-warehouse" /> или метаданные
- Удалена из логов dbt и заменена на `*****`, всякий раз, когда ее значение появляется в этих логах (даже если переменная окружения не была вызвана напрямую)

Основное применение секретных переменных окружения — это токены доступа git для [приватных пакетов](/docs/build/packages#private-packages).

**Примечание:** Когда dbt загружает учетные данные профиля и конфигурацию пакета, секретные переменные окружения будут заменены строковым значением переменной окружения. Вы не можете изменять секреты с помощью фильтров Jinja, включая фильтры приведения типов, такие как [`as_number`](/reference/dbt-jinja-functions/as_number) или [`as_bool`](/reference/dbt-jinja-functions/as_bool), или передавать их в качестве аргументов в другие макросы Jinja. Вы можете использовать _только один секрет_ на конфигурацию:
```yml
# работает
host: "{{ env_var('DBT_ENV_SECRET_HOST') }}"

# не работает
host: "www.{{ env_var('DBT_ENV_SECRET_HOST_DOMAIN') }}.com/{{ env_var('DBT_ENV_SECRET_HOST_PATH') }}"
```

### Пользовательские метаданные

Любая переменная окружения с префиксом `DBT_ENV_CUSTOM_ENV_` будет включена в два места, с именем без префикса в качестве ключа:
- [артефакты dbt](/reference/artifacts/dbt-artifacts#common-metadata): `metadata` -> `env`
- [события и структурированные логи](/reference/events-logging#info-fields): `info` -> `extra`

Словарь этих префиксированных переменных окружения также будет доступен в контекстной переменной `dbt_metadata_envs`:
```sql
-- {{ dbt_metadata_envs }}

select 1 as id
```
```shell
$ DBT_ENV_CUSTOM_ENV_MY_FAVORITE_COLOR=indigo DBT_ENV_CUSTOM_ENV_MY_FAVORITE_NUMBER=6 dbt compile
```
Компилируется в:
```sql
-- {'MY_FAVORITE_COLOR': 'indigo', 'MY_FAVORITE_NUMBER': '6'}

select 1 as id
```

### Использование dbt Cloud

Если вы используете dbt Cloud, вы должны соблюдать правила именования для переменных окружения. Переменные окружения в dbt Cloud должны начинаться с префикса `DBT_` (включая `DBT_ENV_CUSTOM_ENV_` или `DBT_ENV_SECRET`). Ключи переменных окружения записываются в верхнем регистре и чувствительны к регистру. При ссылке на `{{env_var('DBT_KEY')}}` в коде вашего проекта ключ должен точно соответствовать переменной, определенной в интерфейсе dbt Cloud.